<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>OSRD – Calcul de marche</title><link>https://osrd.fr/fr/docs/explanation/running_time_calculation/</link><description>Recent content in Calcul de marche on OSRD</description><generator>Hugo -- gohugo.io</generator><language>fr</language><atom:link href="https://osrd.fr/fr/docs/explanation/running_time_calculation/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Modélisation physique</title><link>https://osrd.fr/fr/docs/explanation/running_time_calculation/physical_modeling/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://osrd.fr/fr/docs/explanation/running_time_calculation/physical_modeling/</guid><description>
&lt;!-- script to auto-render KaTeX extension : $$...$$ for outline formula, \\(...\\) for inline formula -->
&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
&lt;script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous">&lt;/script>
&lt;script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
onload="renderMathInElement(document.body);">&lt;/script>
&lt;script src="https://polyfill.io/v3/polyfill.min.js?features=es6">&lt;/script>
&lt;script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">&lt;/script>
&lt;p>La modélisation physique joue un rôle important dans le cœur de calcul d&amp;rsquo;OSRD. C&amp;rsquo;est elle qui nous permet de simuler la circulation des trains, et elle doit être aussi réaliste que possible.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="bilan-des-forces">Bilan des forces&lt;/h3>
&lt;/font>
&lt;p>Pour calculer le déplacement du train au cours du temps, il faut d&amp;rsquo;abord calculer sa vitesse à chaque instant.
Une manière simple d&amp;rsquo;obtenir cette vitesse est de passer par le calcul de l&amp;rsquo;accélération.
Grâce au principe fondamental de la dynamique, l&amp;rsquo;accélération du train à chaque instant est directement dépendant
des différentes forces qui lui sont appliquées : $$ \sum \vec{F}=m\vec{a} $$&lt;/p>
&lt;p>&lt;img src="../forces.png" alt="Marche">&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>Traction&lt;/strong> : La valeur de la force de traction \(F_{mot}\) dépend de plusieurs facteurs :&lt;/p>
&lt;ul>
&lt;li>du matériel roulant&lt;/li>
&lt;li>de la vitesse du train \(v^{\prime}x\), selon la courbe effort-vitesse ci-dessous :&lt;/li>
&lt;/ul>
&lt;p>$$ {\vec{F_{mot}}(v_{x^{\prime}}, x^{\prime})=F_{mot}(v_{x^{\prime}}, x^{\prime})\vec{e_x^{\prime}}} $$&lt;/p>
&lt;p>&lt;img src="../effort-vitesse.png" alt="Marche" title="Exemple de courbe effort-vitesse d'un train">&lt;/p>
&lt;blockquote>
&lt;p>L&amp;rsquo;axe &lt;strong>x&lt;/strong> représente la vitesse du train en [km/h], l&amp;rsquo;axe &lt;strong>y&lt;/strong>, la valeur de la force de traction en [kN].&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>de l&amp;rsquo;action du conducteur, qui accélère plus ou moins fort en fonction de l&amp;rsquo;endroit où il se trouve sur son trajet&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;br>
&lt;ul>
&lt;li>&lt;strong>Freinage&lt;/strong> : La valeur de la force de freinage \(F_{brk}\) dépend elle aussi du matériel roulant et de l&amp;rsquo;action du conducteur mais possède une valeur constante pour un matériel donné. Dans l&amp;rsquo;état actuel de la modélisation, le freinage est soit nul, soit à sa valeur maximale.&lt;/li>
&lt;/ul>
&lt;p>$$ \vec{F_{brk}}(x^{\prime})=-F_{brk}(x^{\prime}){\vec{e_{x^{\prime}}}} $$&lt;/p>
&lt;p>Une seconde approche de la modélisation du freinage est l&amp;rsquo;approche dite horaire, car utilisée pour la production horaire à la SNCF. Dans ce cas, la décélération est fixe et le freinage ne dépend plus des différentes forces appliquées au train. Les valeurs de décélération typiques vont de 0.4 à 0.7m/s².&lt;/p>
&lt;br>
&lt;ul>
&lt;li>&lt;strong>Résistance à l&amp;rsquo;avancement&lt;/strong> : Pour modéliser la résistance à l’avancement du train on utilise la formule de Davis qui prend en compte tous les frottements et la résistance aérodynamique de l’air. La valeur de la résistance à l&amp;rsquo;avancement dépend de la vitesse \(v^{\prime}_x\). Les coefficients \(A\), \(B\), et \(C\) dépendent du matériel roulant.&lt;/li>
&lt;/ul>
&lt;p>$$ {\vec{R}(v_{x^{\prime}})}=-(A+Bv_{x^{\prime}}+{Cv_{x^{\prime}}}^2){\vec{e_{x^{\prime}}}} $$&lt;/p>
&lt;br>
&lt;ul>
&lt;li>&lt;strong>Poids (pentes + virages)&lt;/strong> : La force du poids donnée par le produit entre la masse \(m\) du train et la constante gravitationnelle \(g\) est projetée sur les axes \(\vec{e_x}^{\prime}\) et \(\vec{e_y}^{\prime}\).Pour la projection, on utilise l&amp;rsquo;angle \(i(x^{\prime})\), qui est calculé à partir de l&amp;rsquo;angle de déclivité \(s(x^{\prime})\) corrigé par un facteur qui prend en compte l&amp;rsquo;effet du rayon de virage \(r(x^{\prime})\).&lt;/li>
&lt;/ul>
&lt;p>$$
\vec{P(x^{\prime})}=-mg\vec{e_y}(x^{\prime})=
-mg\Big[sin\big(i(x^{\prime})\big){\vec{e_{x^{\prime}}}(x^{\prime})}+cos\big(i(x^{\prime})\big){\vec{e_{{\prime}}}(x^{\prime})}\Big]
$$&lt;/p>
&lt;p>$$ i(x^{\prime})= s(x^{\prime})+\frac{800m}{r(x^{\prime})} $$&lt;/p>
&lt;br>
&lt;ul>
&lt;li>&lt;strong>Réaction du sol&lt;/strong> : La force de réaction du sol compense simplement la composante verticale du poids, mais n&amp;rsquo;a pas d&amp;rsquo;impact sur la dynamique du train car elle n&amp;rsquo;a aucune composante selon l&amp;rsquo;axe \({\vec{e_x}^{\prime}}\).&lt;/li>
&lt;/ul>
&lt;p>$$ \vec{R_{gnd}}=R_{gnd}{\vec{e_{y^{\prime}}}} $$&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="equilibre-des-forces">Equilibre des forces&lt;/h3>
&lt;/font>
&lt;p>L&amp;rsquo;équation du principe fondamental de la dynamique projetée sur l&amp;rsquo;axe \({\vec{e_x}^{\prime}}\) (dans le référentiel du train) donne l&amp;rsquo;équation scalaire suivante :&lt;/p>
&lt;p>$$
a_{x^{\prime}}(t) = \frac{1}{m}\Big
[F_{mot}(v_{x^{\prime}}, x^{\prime})-F_{brk}(x^{\prime})-(A+Bv_{x^{\prime}}+{Cv_{x^{\prime}}}^2)-mgsin(i(x^{\prime}))\Big]
$$&lt;/p>
&lt;p>Celle-ci est ensuite simplifiée en considérant que malgré la pente le train se déplace sur un plan et en amalgamant
\(\vec{e_x}\) et \(\vec{e_x}^{\prime}\). La pente a toujours un impact sur le bilan des forces mais on considère que le train ne se déplace qu&amp;rsquo;horizontalement, ce qui donne l&amp;rsquo;équation simplifiée suivante :&lt;/p>
&lt;p>$$ a_{x}(t) = \frac{1}{m}\Big[F_{mot}(v_{x}, x)-F_{brk}(x)-(A+Bv_{x}+{Cv_{x}}^2)-mgsin(i(x))\Big] $$&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="résolution">Résolution&lt;/h3>
&lt;/font>
&lt;p>La force motrice et la force de freinage dépendent de l&amp;rsquo;action du conducteur (il décide d&amp;rsquo;accélérer ou de freiner plus ou moins fort en fonction de la situation). Cette dépendance se traduit donc par une dépendance de ces deux forces à la position du train. La composante du poids dépend elle aussi de la position du train, car provenant directement des pentes et des virages situées sous ce dernier.&lt;/p>
&lt;p>De plus, la force motrice dépend de la vitesse du train (selon la courbe effort vitesse) tout comme la résistance à
l&amp;rsquo;avancement.&lt;/p>
&lt;p>Ces différentes dépendances rendent impossible la résolution analytique de cette équation, et l&amp;rsquo;accélération du train à chaque instant doit être calculée par intégration numérique.&lt;/p></description></item><item><title>Docs: Intégration numérique</title><link>https://osrd.fr/fr/docs/explanation/running_time_calculation/numerical_integration/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://osrd.fr/fr/docs/explanation/running_time_calculation/numerical_integration/</guid><description>
&lt;!-- script to auto-render KaTeX extension : $$...$$ for outline formula, \\(...\\) for inline formula -->
&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
&lt;script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous">&lt;/script>
&lt;script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
onload="renderMathInElement(document.body);">&lt;/script>
&lt;script src="https://polyfill.io/v3/polyfill.min.js?features=es6">&lt;/script>
&lt;script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">&lt;/script>
&lt;font color=#aa026d>
&lt;h3 id="introduction">Introduction&lt;/h3>
&lt;/font>
&lt;p>La modélisation physique ayant montré que l&amp;rsquo;accélération du train était influencée par différents facteurs variant le long du trajet (pente, courbure, force de traction du moteur&amp;hellip;), le calcul doit passer par une méthode d&amp;rsquo;intégration numérique. Le trajet est alors séparé en étapes suffisamment courtes pour considérer tous ces facteurs comme constants, ce qui permet cette fois ci d&amp;rsquo;utiliser l&amp;rsquo;équation du mouvement pour calculer le déplacement et la vitesse du train.&lt;/p>
&lt;p>La méthode d&amp;rsquo;intégration numérique d&amp;rsquo;Euler est la plus simple pour effectuer ce genre de calcul, mais elle présente un certain nombre d&amp;rsquo;inconvénients. Cet article explique la méthode d&amp;rsquo;Euler, pourquoi elle ne convient pas aux besoins d&amp;rsquo;OSRD et quelle méthode d&amp;rsquo;intégration doit être utilisée à la place.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="la-méthode-deuler">La méthode d&amp;rsquo;Euler&lt;/h3>
&lt;/font>
&lt;p>La méthode d&amp;rsquo;Euler appliquée à l&amp;rsquo;intégration de l&amp;rsquo;équation du mouvement d&amp;rsquo;un train est :&lt;/p>
&lt;p>$$v(t+dt) = a(v(t), x(t))dt + v(t)$$&lt;/p>
&lt;p>$$x(t+dt) = \frac{1}{2}a(v(t), x(t))dt^2 + v(t)dt + x(t)$$&lt;/p>
&lt;center>
&lt;p>&lt;img src="../euler.png?style=method" alt="Méthode d&amp;rsquo;Euler">&lt;/p>
&lt;/center>
&lt;p>&amp;nbsp;&lt;/p>
&lt;h4 id="les-avantages-de-la-méthode-deuler">&lt;strong>Les avantages de la méthode d&amp;rsquo;Euler&lt;/strong>&lt;/h4>
&lt;p>La méthode d&amp;rsquo;Euler a pour avantages d&amp;rsquo;être très simple à implémenter et d&amp;rsquo;avoir un calcul plutôt rapide pour un pas de temps donné, en comparaison avec d&amp;rsquo;autres méthodes d&amp;rsquo;intégration numérique (voir &lt;a href="#le-choix-de-la-m%C3%A9thode-dint%C3%A9gration-pour-osrd">annexe&lt;/a>)&lt;/p>
&lt;h4 id="les-inconvénients-de-la-méthode-deuler">&lt;strong>Les inconvénients de la méthode d&amp;rsquo;Euler&lt;/strong>&lt;/h4>
&lt;p>La méthode d&amp;rsquo;intégration d&amp;rsquo;Euler présente un certain nombre de problèmes pour OSRD :&lt;/p>
&lt;ul>
&lt;li>Elle est relativement imprécise, et donc nécessite un faible pas de temps, ce qui génère beaucoup de données.&lt;/li>
&lt;li>En intégrant dans le temps, on ne connaît que les conditions du point de départ du pas d&amp;rsquo;intégration (pente, paramètres d&amp;rsquo;infrastructure, etc.) car on ne peut pas prédire précisément l&amp;rsquo;endroit où il se termine.&lt;/li>
&lt;li>On ne peut pas anticiper les futurs changements de directive : le train ne réagit qu&amp;rsquo;en comparant son état actuel à sa consigne au même instant. Pour illustrer c&amp;rsquo;est un peu comme si le conducteur était incapable de voir devant lui, alors que dans la réalité il anticipe en fonction des signaux, pentes, virages qu&amp;rsquo;il voit devant lui.&lt;/li>
&lt;/ul>
&lt;font color=#aa026d>
&lt;h3 id="la-méthode-runge-kutta-4">La méthode Runge-Kutta 4&lt;/h3>
&lt;/font>
&lt;p>La méthode Runge-Kutta 4 appliquée à l&amp;rsquo;intégration de l&amp;rsquo;équation du mouvement d&amp;rsquo;un train est :&lt;/p>
&lt;p>$$v(t+dt) = v(t) + \frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)dt$$&lt;/p>
&lt;p>Avec :&lt;/p>
&lt;p>$$k_1 = a(v(t), x(t))$$&lt;/p>
&lt;p>$$k_2 = a\Big(v(t+k_1\frac{dt}{2}), x(t) + v(t)\frac{dt}{2} + k_1\frac{dt^2}{8}\Big)$$&lt;/p>
&lt;p>$$k_3 = a\Big(v(t+k_2\frac{dt}{2}), x(t) + v(t)\frac{dt}{2} + k_2\frac{dt^2}{8}\Big)$$&lt;/p>
&lt;p>$$k_4 = a\Big(v(t+k_3dt), x(t) + v(t)dt + k_3\frac{dt^2}{2}\Big)$$&lt;/p>
&lt;center>
&lt;p>&lt;img src="../rk4.png?style=method" alt="Méthode de Runge-Kutta 4">&lt;/p>
&lt;/center>
&lt;p>&amp;nbsp;&lt;/p>
&lt;h4 id="les-avantages-de-la-méthode-de-runge-kutta-4">&lt;strong>Les avantages de la méthode de Runge Kutta 4&lt;/strong>&lt;/h4>
&lt;p>La méthode d&amp;rsquo;intégration de Runge Kutta 4 permet de répondre aux différents problèmes soulevés par celle d&amp;rsquo;Euler :&lt;/p>
&lt;ul>
&lt;li>Elle permet d&amp;rsquo;anticiper les changements de directive au sein d&amp;rsquo;un pas de calcul, représentant ainsi davantage la réalité de conduite d&amp;rsquo;un train.&lt;/li>
&lt;li>Elle est plus précise pour le même temps de calcul (voir &lt;a href="#le-choix-de-la-m%C3%A9thode-dint%C3%A9gration-pour-osrd">annexe&lt;/a>), permettant des étapes d&amp;rsquo;intégration plus grandes, donc moins de points de données.&lt;/li>
&lt;/ul>
&lt;h4 id="les-inconvénients-de-la-méthode-de-runge-kutta-4">&lt;strong>Les inconvénients de la méthode de Runge Kutta 4&lt;/strong>&lt;/h4>
&lt;p>Le seul inconvénient notable de la méthode de Runge Kutta 4 rencontré pour l&amp;rsquo;instant est sa difficulté d&amp;rsquo;implémentation.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="le-choix-de-la-méthode-dintégration-pour-osrd">Le choix de la méthode d&amp;rsquo;intégration pour OSRD&lt;/h3>
&lt;/font>
&lt;h4 id="étude-de-la-précision-et-de-la-vitesse-de-calcul">&lt;strong>Étude de la précision et de la vitesse de calcul&lt;/strong>&lt;/h4>
&lt;p>Différentes méthodes d&amp;rsquo;intégration auraient pu remplacer l&amp;rsquo;intégration d&amp;rsquo;Euler de base dans l&amp;rsquo;algorithme d&amp;rsquo;OSRD. Afin de décider quelle méthode conviendrait le mieux, une étude sur la précision et la vitesse de calcul de différentes méthodes a été menée. Cette étude sert à comparé les méthodes suivantes :&lt;/p>
&lt;ul>
&lt;li>Euler&lt;/li>
&lt;li>Euler-Cauchy&lt;/li>
&lt;li>Runge-Kutta 4&lt;/li>
&lt;li>Adams 2&lt;/li>
&lt;li>Adams 3&lt;/li>
&lt;/ul>
&lt;p>Toutes les explications sur ces méthodes peuvent être trouvées dans &lt;a href="https://github.com/OpenRailAssociation/osrd/wiki/documents/integration/MethodesNumeriques_EricGoncalves.pdf">ce document&lt;/a>, et le code python utilisé pour la simulation est &lt;a href="https://raw.githubusercontent.com/wiki/OpenRailAssociation/osrd/code/integration/Tests_precision.py">ici&lt;/a>.&lt;/p>
&lt;p>La simulation calcule la position et la vitesse d&amp;rsquo;un TGV accélérant sur une ligne droite plate.&lt;/p>
&lt;h4 id="simulations-à-pas-de-temps-équivalent">&lt;strong>Simulations à pas de temps équivalent&lt;/strong>&lt;/h4>
&lt;p>Une courbe de référence a été simulée en utilisant la méthode d&amp;rsquo;Euler avec un pas de temps de 0,1s, puis le même parcours a été simulé en utilisant les autres méthodes avec un pas de temps de 1s. Il est alors possible de comparer simplement chaque courbe à la courbe de référence, en calculant la valeur absolue de la différence à chaque point calculé. Voici l&amp;rsquo;erreur absolue résultante de la position du train sur sa distance parcourue :&lt;/p>
&lt;p>&lt;img src="../precisions_h_equivalent.png" alt="precisions_h_equivalent">&lt;/p>
&lt;p>Il apparaît immédiatement que la méthode d&amp;rsquo;Euler est moins précise que les quatre autres d&amp;rsquo;environ un ordre de grandeur. Chaque courbe présente un pic où la précision est extrêmement élevée (erreur extrêmement faible), ce qui s&amp;rsquo;explique par le fait que toutes les courbes commencent légèrement au-dessus de la courbe de référence, la croisent en un point et finissent légèrement en dessous, ou &lt;em>vice versa&lt;/em>.&lt;/p>
&lt;p>Comme la précision n’est pas le seul indicateur important, le temps de calcul de chaque méthode a été mesuré. Voici ce que nous obtenons pour les mêmes paramètres d’entrée :&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">Méthode d&amp;rsquo;intégration&lt;/th>
&lt;th style="text-align:right">Temps de calcul (s)&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">Euler&lt;/td>
&lt;td style="text-align:right">1.86&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Euler-Cauchy&lt;/td>
&lt;td style="text-align:right">3.80&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Runge-Kutta 4&lt;/td>
&lt;td style="text-align:right">7.01&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Adams 2&lt;/td>
&lt;td style="text-align:right">3.43&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Adams 3&lt;/td>
&lt;td style="text-align:right">5.27&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Ainsi, Euler-Cauchy et Adams 2 sont environ deux fois plus lents que Euler, Adams 3 est environ trois fois plus lent, et RK4 est environ quatre fois plus lent. Ces résultats ont été vérifiés sur des simulations beaucoup plus longues, et les différents ratios sont maintenus.&lt;/p>
&lt;h4 id="simulation-à-temps-de-calcul-équivalent">&lt;strong>Simulation à temps de calcul équivalent&lt;/strong>&lt;/h4>
&lt;p>Comme les temps de calcul de toutes les méthodes dépendent linéairement du pas de temps, il est relativement simple de comparer la précision pour un temps de calcul à peu près identique. En multipliant le pas de temps d&amp;rsquo;Euler-Cauchy et d&amp;rsquo;Adams 2 par 2, le pas de temps d&amp;rsquo;Adams 3 par 3, et le pas de temps de RK4 par 4, voici les courbes d&amp;rsquo;erreur absolue résultantes :&lt;/p>
&lt;p>&lt;img src="../precisions_time_equivalent.png" alt="precisions_time_equivalent">&lt;/p>
&lt;p>Et voici les temps de calcul :&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">Méthode d&amp;rsquo;intégration&lt;/th>
&lt;th style="text-align:right">Temps de calcul (s)&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">Euler&lt;/td>
&lt;td style="text-align:right">1.75&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Euler-Cauchy&lt;/td>
&lt;td style="text-align:right">2.10&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Runge-Kutta 4&lt;/td>
&lt;td style="text-align:right">1.95&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Adams 2&lt;/td>
&lt;td style="text-align:right">1.91&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">Adams 3&lt;/td>
&lt;td style="text-align:right">1.99&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Après un certain temps, RK4 tend à être la méthode la plus précise, légèrement plus précise que Euler-Cauchy, et toujours bien plus précise que la méthode d&amp;rsquo;Euler.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="conclusions-de-létude">Conclusions de l&amp;rsquo;étude&lt;/h3>
&lt;/font>
&lt;p>L&amp;rsquo;étude de la précision et de la vitesse de calcul présentée ci-dessus montre que RK4 et Euler-Cauchy seraient de bons candidats pour remplacer l&amp;rsquo;algorithme d&amp;rsquo;Euler dans OSRD : les deux sont rapides, précis, et pourraient remplacer la méthode d&amp;rsquo;Euler sans nécessiter de gros changements d&amp;rsquo;implémentation car ils ne font que des calculs au sein du pas de temps en cours de calcul.
&lt;strong>Il a été décidé qu&amp;rsquo;OSRD utiliserait la méthode Runge-Kutta 4 parce qu&amp;rsquo;elle est légèrement plus précise que Euler-Cauchy et que c&amp;rsquo;est une méthode bien connue pour ce type de calcul, donc très adaptée à un simulateur open-source.&lt;/strong>&lt;/p>
&lt;style>
img[src$="method"] {
height: 50%;
width: 50%;
}
&lt;/style></description></item><item><title>Docs: Le système d'enveloppes</title><link>https://osrd.fr/fr/docs/explanation/running_time_calculation/envelopes_system/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://osrd.fr/fr/docs/explanation/running_time_calculation/envelopes_system/</guid><description>
&lt;p>Le système d&amp;rsquo;enveloppes est une interface créée spécifiquement pour le calcul de marche d&amp;rsquo;OSRD. Il permet de manipuler différentes courbes espace/vitesse, de les découper, de les mettre bout à bout, d&amp;rsquo;interpoler des points spécifiques, et d&amp;rsquo;adresser beaucoup d&amp;rsquo;autres besoins nécessaires au calcul de marche.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="une-interface-spécifique-dans-le-service-osrd-core">Une interface spécifique dans le service OSRD Core&lt;/h3>
&lt;/font>
&lt;p>Le système d&amp;rsquo;enveloppes fait partie du service core d&amp;rsquo;OSRD (voir &lt;a href="../architecture/_index">l&amp;rsquo;architecture du logiciel&lt;/a>).&lt;/p>
&lt;p>Ses principaux composants sont :&lt;/p>
&lt;p>&lt;strong>1 - EnvelopePart :&lt;/strong> courbe espace/vitesse, définie comme une séquence des points et possédant des métadonnées indiquant par exemple s&amp;rsquo;il s&amp;rsquo;agit d&amp;rsquo;une courbe d&amp;rsquo;accélération, de freinage, de maintien de vitesse, etc.&lt;/p>
&lt;p>&lt;strong>2 - Envelope :&lt;/strong> liste d&amp;rsquo;EnvelopeParts mises bout-à-bout et sur laquelle il est possible d&amp;rsquo;effectuer certaines opérations :&lt;/p>
&lt;ul>
&lt;li>vérifier la continuité dans l’espace (obligatoire) et dans la vitesse (facultative)&lt;/li>
&lt;li>chercher la vitesse minimale et/ou maximale de l&amp;rsquo;enveloppe&lt;/li>
&lt;li>couper une partie de l’enveloppe entre deux points de l&amp;rsquo;espace&lt;/li>
&lt;li>effectuer une interpolation de vitesse à une certaine position&lt;/li>
&lt;li>calculer le temps écoulé entre deux positions de l’enveloppe&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="../envelopes_scheme.png" alt="envelope_scheme">&lt;/p>
&lt;p>&lt;strong>3 - Overlays :&lt;/strong> système permettant d’ajouter des EnvelopePart plus contraignantes (c&amp;rsquo;est-à-dire dont la vitesse est plus faible) à une enveloppe existante.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="enveloppes-données-vs-enveloppes-calculées">Enveloppes données vs enveloppes calculées&lt;/h3>
&lt;/font>
&lt;p>Pendant la simulation, le train est censé suivre certaines instructions de vitesse. Celles-ci sont modélisées dans OSRD par des enveloppes sous forme de courbes espace/vitesse. On en distingue deux types :&lt;/p>
&lt;ul>
&lt;li>Les enveloppes provenant &lt;strong>des données d&amp;rsquo;infrastructure et de matériel roulant&lt;/strong>, comme la vitesse maximale de la ligne et la vitesse maximale du train. Etant des données d&amp;rsquo;entrée de notre calcul, elles ne correspondent pas à des courbes ayant un sens physique, car elles ne sont pas issues des résultats d&amp;rsquo;une intégration réelle des équations physiques du mouvement.&lt;/li>
&lt;li>Les enveloppes résultant &lt;strong>d&amp;rsquo;une intégration réelle&lt;/strong> des équations du mouvement physique. Elles correspondent à une courbe physiquement tenable par le train et contiennent également des informations sur le temps.&lt;/li>
&lt;/ul>
&lt;p>Un exemple simple pour illustrer cette différence : si l&amp;rsquo;on simule un trajet de TER sur une ligne de montagne, une des données d&amp;rsquo;entrée va être une enveloppe de vitesse maximale à 160km/h, correspondant à la vitesse maximale de notre TER. Mais cette enveloppe ne correspond pas à une réalité physique, car il se peut que sur certaines portions la rampe soit trop raide pour que le train arrive effectivement à maintenir cette vitesse maximale de 160km/h. L&amp;rsquo;enveloppe calculée présentera donc dans cet exemple un décrochage de vitesse dans les zones de fortes rampes, là où l&amp;rsquo;enveloppe donnée était parfaitement plate.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="simulation-de-plusieurs-trains">Simulation de plusieurs trains&lt;/h3>
&lt;/font>
&lt;p>Dans le cas de la simulation de nombreux trains, le système de signalisation doit assurer &lt;strong>la sécurité&lt;/strong>. L&amp;rsquo;effet de la signalisation sur le calcul de marche d&amp;rsquo;un train est reproduit en superposant des enveloppes dynamiques à l&amp;rsquo;enveloppe statique. Une nouvelle enveloppe dynamique est introduite par exemple lorsqu&amp;rsquo;un signal se ferme. Le train suit l&amp;rsquo;enveloppe économique statique superposée aux enveloppes dynamiques, s&amp;rsquo;il y en a. Dans ce mode de simulation, un contrôle du temps est effectué par rapport à un temps théorique provenant de l&amp;rsquo;information temporelle de l&amp;rsquo;enveloppe économique statique. Si le train est en retard par rapport à l&amp;rsquo;heure prévue, il cesse de suivre l&amp;rsquo;enveloppe économique et essaie d&amp;rsquo;aller plus vite. Sa courbe espace/vitesse sera donc limitée par l&amp;rsquo;enveloppe d&amp;rsquo;effort maximum.&lt;/p></description></item><item><title>Docs: Le processus de calcul de marche</title><link>https://osrd.fr/fr/docs/explanation/running_time_calculation/pipeline/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://osrd.fr/fr/docs/explanation/running_time_calculation/pipeline/</guid><description>
&lt;p>Le calcul de marche dans OSRD est un processus à 4 étapes, utilisant chacune &lt;a href="../envelopes_system">le système d&amp;rsquo;enveloppes&lt;/a> :&lt;/p>
&lt;ol>
&lt;li>&lt;a href="#calcul-du-profil-de-vitesse-le-plus-restrictif">Construction du profil de vitesse le plus restrictif&lt;/a>&lt;/li>
&lt;li>&lt;a href="#calcul-du-profil-de-vitesse-maximale">Ajout des différentes courbes de freinage&lt;/a>&lt;/li>
&lt;li>&lt;a href="#calcul-du-profil-deffort-maximal">Ajout des différentes courbes d&amp;rsquo;accélération et vérification des courbes de vitesse constante&lt;/a>&lt;/li>
&lt;li>&lt;a href="#application-de-marges">Application de marge(s)&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>&amp;nbsp;&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="calcul-du-profil-de-vitesse-le-plus-restrictif">Calcul du profil de vitesse le plus restrictif&lt;/h3>
&lt;/font>
&lt;p>Une première enveloppe est calculée au début de la simulation en regroupant toutes les limites de vitesse statiques :&lt;/p>
&lt;ul>
&lt;li>vitesse maximale de la ligne&lt;/li>
&lt;li>vitesse maximale du matériel roulant&lt;/li>
&lt;li>limitations temporaires de vitesse (en cas de travaux sur une ligne par exemple)&lt;/li>
&lt;li>limitations de vitesse par catégorie de train&lt;/li>
&lt;li>limitations de vitesse selon la charge du train&lt;/li>
&lt;li>limitations de vitesse correspondant à des panneaux de signalisation&lt;/li>
&lt;/ul>
&lt;p>La longueur du train est également prise en compte pour s&amp;rsquo;assurer que le train n&amp;rsquo;accélère qu&amp;rsquo;une fois sa queue ayant quitté la zone de plus faible vitesse. Un décalage est alors appliqué à la courbe en pointillée rouge. L&amp;rsquo;enveloppe résultante (courbe noire) est appelée &lt;strong>MRSP (Most Restricted Speed Profile)&lt;/strong> correspondant donc au profil de vitesse le plus restrictif. C&amp;rsquo;est sur cette enveloppe que seront calculées les étapes suivantes.&lt;/p>
&lt;p>&lt;img src="../mrsp.png" alt="Most Restricted Speed Profile">&lt;/p>
&lt;blockquote>
&lt;p>La ligne pointillée rouge représente la vitesse maximale autorisée en fonction de la position.
La ligne noire représente le MRSP où la longueur du train a été prise en compte.&lt;/p>
&lt;/blockquote>
&lt;p>Il est à noter que les différentes envelopeParts composant le MRSP sont des données d&amp;rsquo;entrée, elles ne correspondent donc pas à des courbes avec une réalité physique.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="calcul-du-profil-de-vitesse-maximale">Calcul du profil de vitesse maximale&lt;/h3>
&lt;/font>
&lt;p>En partant du MRSP, toutes les courbes de freinage sont calculées grâce au système d&amp;rsquo;overlay (voir &lt;a href="../envelopes_system/#une-interface-sp%C3%A9cifique-dans-le-service-osrd-core">ici&lt;/a> pour plus de détails sur les overlays), c&amp;rsquo;est-à-dire en créant des envelopeParts qui seront plus restrictives que le MRSP. La courbe ainsi obtenue est appelée &lt;strong>Max Speed Profile&lt;/strong> (profil de vitesse maximale). Il s&amp;rsquo;agit de l&amp;rsquo;enveloppe de vitesse maximale du train, tenant compte de ses capacités de freinage.&lt;/p>
&lt;p>Etant donné que les courbes de freinage ont un point de fin imposé et que l&amp;rsquo;équation de freinage n&amp;rsquo;a pas de solution analytique, il est impossible de prédire leur point de départ. Les courbes de freinage sont donc calculées à rebours en partant de leur point cible, c&amp;rsquo;est-à-dire le point dans l&amp;rsquo;espace où une certaine limite de vitesse est imposée (vitesse cible finie) ou le point d&amp;rsquo;arrêt (vitesse cible nulle).&lt;/p>
&lt;p>&lt;img src="../msp.png" alt="Max Speed Profile">&lt;/p>
&lt;p>Pour des raisons historiques en production horaire, les courbes de freinages sont calculées avec une décélération forfaitaire, dite décélération horaire (typiquement ~0,5m/s²) sans prendre en compte les autres forces. Cette méthode a donc également été implémentée dans OSRD, permettant ainsi de calculer les freinages de deux manières différentes : avec ce taux horaire ou avec une force de freinage qui vient simplement s&amp;rsquo;ajouter aux autres forces.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="calcul-du-profil-deffort-maximal">Calcul du profil d&amp;rsquo;effort maximal&lt;/h3>
&lt;/font>
&lt;p>Pour chaque point correspondant à une augmentation de vitesse dans le &lt;strong>MRSP&lt;/strong> ou à la fin d&amp;rsquo;une courbe de freinage d&amp;rsquo;arrêt, une courbe d&amp;rsquo;accélération est calculée. Les courbes d&amp;rsquo;accélération sont calculées en tenant compte de toutes les forces actives (force de traction, résistance à l&amp;rsquo;avancement, poids) et ont donc un sens physique.&lt;/p>
&lt;p>Pour les envelopeParts dont le sens physique n&amp;rsquo;a pas encore été vérifié (qui à ce stade sont les phases de circulation à vitesse constante, provenant toujours du MRSP), une nouvelle intégration des équations de mouvement est effectuée. Ce dernier calcul est nécessaire pour prendre en compte d&amp;rsquo;éventuels décrochages de vitesse dans le cas où le train serait physiquement incapable de tenir sa vitesse, typiquement en présence de fortes rampes (voir &lt;a href="../envelopes_system/#enveloppes-donn%C3%A9es-vs-enveloppes-calcul%C3%A9es">cet exemple&lt;/a>).&lt;/p>
&lt;p>L&amp;rsquo;enveloppe qui résulte de ces ajouts de courbes d&amp;rsquo;accélérations et de la vérification des plateaux de vitesse est appelée &lt;strong>Max Effort Profile&lt;/strong> (profil d&amp;rsquo;effort maximal).&lt;/p>
&lt;p>&lt;img src="../mep.png" alt="Max Effort Profile">&lt;/p>
&lt;p>A ce stade, l&amp;rsquo;enveloppe obtenue est continue et a un sens physique du début à fin. Le train accélère au maximum, roule aussi vite que possible en fonction des différentes limites de vitesse et de ses capacités motrices, et freine au maximum. Le calcul de marche obtenu s&amp;rsquo;appelle la &lt;strong>marche de base&lt;/strong>. Elle correspond au trajet le plus rapide possible pour le matériel roulant donné sur le parcours donné.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="application-de-marges">Application de marge(s)&lt;/h3>
&lt;/font>
&lt;p>Après avoir effectué le calcul de la marche de base (correspondant au Max Effort Profile dans OSRD), il est possible d&amp;rsquo;y appliquer des marges (allowances). Les marges sont des ajouts de temps supplémentaire au parcours du train. Elles servent notamment à lui permettre de rattraper son retard si besoin ou à d&amp;rsquo;autres besoins opérationnels (plus de détails sur les marges &lt;a href="../allowances">ici&lt;/a>).&lt;/p>
&lt;p>Une nouvelle enveloppe &lt;strong>Allowances&lt;/strong> est donc calculée grâce à des overlays pour distribuer la marge demandée par l&amp;rsquo;utilisateur sur l&amp;rsquo;enveloppe d&amp;rsquo;effort maximal calculée précédemment.&lt;/p>
&lt;p>&lt;img src="../allowances.png" alt="Marges">&lt;/p>
&lt;p>Dans le calcul de marche d&amp;rsquo;OSRD, il est possible de distribuer les marges d&amp;rsquo;une manière linéaire, en abaissant toutes les vitesses d&amp;rsquo;un certain facteur, ou économique, c&amp;rsquo;est-à-dire en minimisant la consommation d&amp;rsquo;énergie pendant le parcours du train.&lt;/p></description></item><item><title>Docs: Les marges</title><link>https://osrd.fr/fr/docs/explanation/running_time_calculation/allowances/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://osrd.fr/fr/docs/explanation/running_time_calculation/allowances/</guid><description>
&lt;font color=#aa026d>
&lt;h3 id="la-raison-dêtre-des-marges">La raison d&amp;rsquo;être des marges&lt;/h3>
&lt;/font>
&lt;p>Comme expliqué dans le &lt;a href="../pipeline/#calcul-du-profil-deffort-maximal">calcul du Max Effort Profile&lt;/a>, la &lt;strong>marche de base&lt;/strong> représente la marche la plus tendue normalement réalisable, c&amp;rsquo;est-à-dire le trajet le plus rapide possible du matériel donné sur le parcours donné. Le train accélère au maximum, roule aussi vite que possible en fonction des différentes limites de vitesse et de ses capacités motrices, et freine au maximum.&lt;/p>
&lt;p>Cette marche de base présente un inconvénient majeur : si un train part avec 10min de retard, il arrivera au mieux avec 10min de retard, car par définition il lui est impossible de rouler plus vite que la marche de base. Par conséquent, les trains sont programmés avec un ajout d&amp;rsquo;une ou de plusieurs marges. Les marges sont une détente du trajet du train, un ajout de temps à l&amp;rsquo;horaire prévu, qui se traduit inévitablement par un abaissement des vitesses de circulation.&lt;/p>
&lt;blockquote>
&lt;p>Un train circulant en marche de base est incapable de rattraper son retard !&lt;/p>
&lt;/blockquote>
&lt;font color=#aa026d>
&lt;h3 id="le-type-de-marge">Le type de marge&lt;/h3>
&lt;/font>
&lt;p>On distingue deux types de marges :&lt;/p>
&lt;ul>
&lt;li>&lt;strong>La marge de régularité&lt;/strong> : il s&amp;rsquo;agit du temps complémentaire ajouté à la marche de base pour tenir compte de l’imprécision de la mesure de la vitesse, pour pallier les conséquences des incidents extérieurs venant perturber la marche théorique des trains, et pour maintenir la régularité de la circulation. La marge de régularité s&amp;rsquo;applique sur l&amp;rsquo;ensemble du trajet, bien que sa valeur puisse changer sur certains intervalles.&lt;/li>
&lt;li>&lt;strong>La marge de construction&lt;/strong> : il s&amp;rsquo;agit du temps ajouté / retiré sur un intervalle spécifique, en plus de la marge de régularité, mais cette fois pour des raisons opérationnelles (esquiver un autre train, libérer une voie plus rapidement, etc.)&lt;/li>
&lt;/ul>
&lt;p>Une marche de base à laquelle on vient ajouter une marge de régularité donne ce que l&amp;rsquo;on appelle une &lt;strong>marche type&lt;/strong>.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="la-distribution-de-la-marge">La distribution de la marge&lt;/h3>
&lt;/font>
&lt;p>L&amp;rsquo;ajout de marge se traduisant par un abaissement des vitesses le long du trajet, plusieurs marches types sont possibles. En effet, il existe une infinité de solutions aboutissant au même temps de parcours.&lt;/p>
&lt;p>En guise d&amp;rsquo;exemple simple, pour détendre la marche d&amp;rsquo;un train de 10% de son temps de parcours, il est possible de prolonger n&amp;rsquo;importe quel arrêt de l&amp;rsquo;équivalent en temps de ces 10%, tout comme il est possible de rouler à 1/1,1 = 90,9% des capacités du train sur l&amp;rsquo;ensemble du parcours, ou encore de rouler moins vite, mais seulement aux vitesses élevées&amp;hellip;&lt;/p>
&lt;p>Il y a pour l&amp;rsquo;instant deux algorithmes de distribution de la marge dans OSRD : linéaire et économique.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="la-distribution-linéaire">La distribution linéaire&lt;/h3>
&lt;/font>
&lt;p>La distribution de marge linéaire consiste simplement à abaisser les vitesses d&amp;rsquo;un même facteur sur la zone où l&amp;rsquo;utilisateur applique la marge. En voici un exemple d&amp;rsquo;application :&lt;/p>
&lt;p>&lt;img src="../python_plot_linear.png" alt="Python plot linear">&lt;/p>
&lt;p>Cette distribution a pour avantage de répartir la marge de la même manière sur tout le trajet. Un train prenant du retard à 30% de son trajet disposera de 70% de sa marge pour les 70% de trajets restants.&lt;/p>
&lt;font color=#aa026d>
&lt;h3 id="la-distribution-économique">La distribution économique&lt;/h3>
&lt;/font>
&lt;p>La distribution économique de la marge, présentée en détail dans &lt;a href="https://osrd.fr/pdf/MARECO.pdf">ce document&lt;/a> (&lt;strong>MARECO&lt;/strong> est un algorithme conçu par la direction de la recherche SNCF), consiste à répartir la marge de la manière la plus économe possible en énergie. Elle est basée sur deux principes :&lt;/p>
&lt;ol>
&lt;li>une vitesse plafond, évitant les vitesses les plus consommatrices en énergie&lt;/li>
&lt;li>des zones de marche sur l&amp;rsquo;erre, situées avant les freinages et les fortes pentes, où le train circule à moteur coupé grâce à son inertie, permettant de ne consommer aucune énergie pendant ce laps de temps&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="../python_plot_eco_w_slopes.png" alt="Python plot eco with slopes">&lt;/p>
&lt;blockquote>
&lt;p>Un exemple de marche économique. En haut, les pentes/rampes rencontrées par le train. Les zones de marche sur l&amp;rsquo;erre sont représentées en bleu.&lt;/p>
&lt;/blockquote></description></item></channel></rss>