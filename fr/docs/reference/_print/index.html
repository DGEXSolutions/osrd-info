<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=fr class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://osrd.fr/fr/docs/reference/><link rel=alternate type=application/rss+xml href=https://osrd.fr/fr/docs/reference/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Référence technique | OSRD</title><meta name=description content="Machinerie interne et APIs"><meta property="og:title" content="Référence technique"><meta property="og:description" content="Machinerie interne et APIs"><meta property="og:type" content="website"><meta property="og:url" content="https://osrd.fr/fr/docs/reference/"><meta property="og:site_name" content="OSRD"><meta itemprop=name content="Référence technique"><meta itemprop=description content="Machinerie interne et APIs"><meta name=twitter:card content="summary"><meta name=twitter:title content="Référence technique"><meta name=twitter:description content="Machinerie interne et APIs"><link rel=preload href=/scss/main.min.6a97a232111e8c01d1eed2c4b5cf2d0b180718f96d5c7e5aec2f7e997230ba06.css as=style><link href=/scss/main.min.6a97a232111e8c01d1eed2c4b5cf2d0b180718f96d5c7e5aec2f7e997230ba06.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/fr/><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" id="svg36" width="110.767" height="22"><style id="style1">.st9{fill:#fff}</style><g id="ok" transform="scale(.1918)"><g id="g36"><g id="g29"><path id="path23" d="M38.5 83.4c-1.9 8.2-2.9 17-2.9 26.5v4.8h16.6c-2.8-13.2-7.8-23.4-13.7-31.3z" class="st9"/><path id="path24" d="M0 57.5v19.9c3.1 1.2 6.3 2.7 9.5 4.6 8.5 5.2 15 12.6 19.4 21.8v-31c-3.4-3-6.9-5.5-10.3-7.5-6.5-3.7-13-6.2-18.6-7.8z" class="st9"/><path id="path25" d="M35.6 69.9c4.3-11.3 10.6-21.1 18.9-29.4V0H35.6z" class="st9"/><path id="path26" d="M40.8 75.4c5.3 6.2 10.1 13.8 13.7 23.3V50.6C48.6 57.8 44 66.1 40.8 75.4z" class="st9"/><path id="path27" d="M100.7.0H61.3v34.5C73.1 25.2 86 20 96.9 17.2c1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-11.4 2.9-25.3 8.6-37.2 19.7v31.8c2.9-6.3 6.7-11.7 11.4-16.4 9.4-9.3 21-14.1 30.5-16.6 1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-4.7 1.2-10.1 3.1-15.3 6-19 10.3-28.2 28.4-28.2 55.2v4.8h39.3c7.8.0 14.1-6.3 14.1-14.1V14.1C114.7 6.3 108.4.0 100.7.0z" class="st9"/><path id="path28" d="M22 59.6c2.2 1.3 4.5 2.8 6.8 4.6V0H14.1C6.3.0.0 6.3.0 14.1v36.4c6.5 1.7 14.2 4.5 22 9.1z" class="st9"/><path id="path29" d="M5.4 87.5c-1.8-1.1-3.6-2-5.4-2.8v15.9c0 7.8 6.3 14.1 14.1 14.1h11.6c-3.6-12.2-10.4-21.3-20.3-27.2z" class="st9"/></g><g id="g30"><path id="path30" d="M201.7 109c-30.8.0-53.7-21.2-53.7-52.5.0-31.7 22.9-51.6 53.7-51.6 31 0 53.9 20 53.9 51.6-.1 31.3-23 52.5-53.9 52.5zm0-82.6c-16.7.0-28.2 12.8-28.2 30.1.0 17.9 11.6 30.7 28.2 30.7S230 74.4 230 56.6c0-17.3-11.6-30.2-28.3-30.2z" class="st9"/></g><g id="g32"><g id="g31"><path id="path31" d="M334.3 33.3c-4-5.2-11.4-8.5-17.6-8.5-6.2.0-13.8 2.1-13.8 9.9.0 6.6 5.9 8.7 15.2 11.6 13.4 4.3 30.7 10 30.7 29.7.0 22.7-18.3 32.9-37.8 32.9-14.1.0-28.3-5.2-37-14.2l15.6-15.9c4.7 6 13.5 10.5 21.3 10.5 7.3.0 13.7-2.8 13.7-10.7.0-7.5-7.5-9.9-20.5-14.1C291.6 60.3 279 53.9 279 36c0-21.9 19.8-31 38.2-31 11.2.0 23.7 4.2 32.4 12.1z" class="st9"/></g></g><g id="g34"><g id="g33"><path id="path32" d="m433.1 106.4-21.3-39.2h-8.1v39.2h-23.4V7.6H418c19 0 37.8 7.3 37.8 29.9.0 13.3-7.8 22.7-20.5 26.6l25.8 42.3zm-16.9-79.6h-12.7v23h11.3c7.7.0 17.3-2 17.3-12 0-9.2-8.7-11-15.9-11z" class="st9"/></g></g><g id="g35"><path id="path34" d="M522.2 106.4h-36.8V7.6H521c28 0 56.5 11.7 56.5 49.1.0 34.7-28.1 49.7-55.3 49.7zm-1.7-78.5h-11.9v57.8h11.3c17 0 32.8-7 32.8-29 0-22.2-15.8-28.8-32.2-28.8z" class="st9"/></g></g></g></svg></span><span class=navbar-brand__name>OSRD</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/fr/about/><span>À propos</span></a></li><li class=nav-item><a class="nav-link active" href=/fr/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/fr/blog/><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Français</a><ul class=dropdown-menu><li><a class=dropdown-item href=/en/docs/reference/>English</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder=Rechercher aria-label=Rechercher autocomplete=off data-offline-search-index-json-src=/offline-search-index.fa188297cb521c8b648b06b96338d9ed.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Version imprimable multipages.
<a href=# onclick="return print(),!1">Cliquer ici pour imprimer</a>.</p><p><a href=/fr/docs/reference/>Retour à la version par défaut</a>.</p></div><h1 class=title>Référence technique</h1><div class=lead>Machinerie interne et APIs</div><ul><li>1: <a href=#pg-b5e4bdbf196beb2ab115d04daf58146b>Architecture</a></li><ul><li>1.1: <a href=#pg-21c6725e49c5e2766b8042790b5db698>Flux des données</a></li><li>1.2: <a href=#pg-edf52d1d45d4337614b654cb14e38066>Services</a></li></ul><li>2: <a href=#pg-4f5886dd5946f64520e4862a078500b8>Documents de conception</a></li><ul><li>2.1: <a href=#pg-7f1a0daf0354ed2b782628a3f5c6f5c4>Poste d'aiguillage</a></li><ul><li>2.1.1: <a href=#pg-ee6003e9414db3f0e05978636a844345>Éléments mobiles</a></li><li>2.1.2: <a href=#pg-f9ae9ad8e8b03f8f0fcbef3b7d4be0b9>Localisation</a></li><li>2.1.3: <a href=#pg-102b27462f1d7abc5a5824a7ba5d0b82>Reservation</a></li><li>2.1.4: <a href=#pg-db83f9bbda0f6a9be54f5872c94185f4>Routage</a></li><li>2.1.5: <a href=#pg-d84f7d18068af2c677e12c6761184b2f>Ordonnancement</a></li><li>2.1.6: <a href=#pg-7430cbed022a567839d982205fb6211d>Train</a></li></ul><li>2.2: <a href=#pg-91414828f61d97b52f2ae39b3f79bf94>Signalisation</a></li><li>2.3: <a href=#pg-2a67b560f64e237130e37a54280c81f6>Recherche de sillons de dernière minute (STDCM)</a></li><ul><li>2.3.1: <a href=#pg-5e6a8c58f44ec33565becd41e00148ef>Contexte métier</a></li><li>2.3.2: <a href=#pg-43ea4c19a1c68f9d3854a75420fe7d2b>Module de recherche de sillons</a></li><ul><li>2.3.2.1: <a href=#pg-00f3695c563557ce911133a4e0d319ff>Description du format d'entrée</a></li><li>2.3.2.2: <a href=#pg-0b86147cbfa958e9f4364f4ce2ba795b>Représentation de l'espace de solutions</a></li><li>2.3.2.3: <a href=#pg-4cbbf502b73f6a39d1784fb6ef5fc8bf>Discontinuités et retours en arrière</a></li><li>2.3.2.4: <a href=#pg-86a0f2f4d5cb5405bb586c1fba4d4c0a>Contourner les conflits</a></li><li>2.3.2.5: <a href=#pg-878a5654bd8bd9fb14457386180665c4>Marge de régularité</a></li><li>2.3.2.6: <a href=#pg-9789474a8d15fe1be9951465d5eb1361>Détails d'implémentation</a></li></ul><li>2.3.3: <a href=#pg-0b00093315849c9bfa952c90dbea33c0>Interface avec la signalisation</a></li></ul></ul><li>3: <a href=#pg-2a332266a38ba0b364467fca3fea9588>APIs</a></li><ul><li>3.1: <a href=#pg-6c6648284a8f498a5c7d1c23b0747863>API</a></li><li>3.2: <a href=#pg-b82726558bc79465332a6e9c939ccbf4>Chartos</a></li><li>3.3: <a href=#pg-3c08243c3e7bb0294640211d13991640>Core</a></li><li>3.4: <a href=#pg-d975f6d361d3dce86194fedde84e54b7>Editoast</a></li><li>3.5: <a href=#pg-c52def2602c6ac6be920ccaddf5c35a0>JSON Schemas</a></li><ul></ul></ul></ul><div class=content><p>Les guides de référence technique contiennent des références techniques pour les API et autres aspects de la machinerie OSRD. Ils présentent son fonctionnement et la manière de l’exploiter en partant du principe que les concepts clés de base sont maîtrisés.</p></div></div><div class=td-content><h1 id=pg-b5e4bdbf196beb2ab115d04daf58146b>1 - Architecture</h1><div class=lead>Détails lié à l&rsquo;architecture de OSRD</div><p>Les documents d&rsquo;architecture permettent de comprendre comment OSRD fonctionne globalement.</p></div><div class=td-content><h1 id=pg-21c6725e49c5e2766b8042790b5db698>1.1 - Flux des données</h1><div class=lead>Schéma des flux des données d&rsquo;osrd</div><p><img src=data_flow.svg alt="Data-flow diagram"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-edf52d1d45d4337614b654cb14e38066>1.2 - Services</h1><div class=lead>Architecture des services de l&rsquo;application</div><p>Il s’agit d’une architecture multi-services où plusieurs composants logiciels interagissent entre eux. Ce choix a été fait pour assurer la modularité du code et pour garantir l’exploitabilité de certains services d’OSRD par des applications extérieures.</p><p><img src=services.fr.svg alt="Schéma des services du projet"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4f5886dd5946f64520e4862a078500b8>2 - Documents de conception</h1><div class=lead>Détails liés à la conceptions de solutions techniques</div><p>Les documents de conceptions décrivent comment et pourquoi un composant logiciel a été conçu, de l&rsquo;exposition du problème à la solution technique, en passant par le chemin pris pour y arriver.</p></div><div class=td-content><h1 id=pg-7f1a0daf0354ed2b782628a3f5c6f5c4>2.1 - Poste d'aiguillage</h1><div class=lead>Décrit le fonctionnement du poste d&rsquo;aiguillage virtuel</div><p>Le modèle de simulation définit le rôle et comportement des différents objets simulés au sein d&rsquo;OSRD.</p><p>Cette modélisation est un compromis entre de multiples enjeux:</p><ul><li>fidélité de la simulation</li><li>interprétabilité des résultats</li><li>adaptabilité du modèle à différentes technologies et usages, que cela soit en terme de signalisation, de poste d&rsquo;aiguillage, ou d&rsquo;usage des données</li></ul><p>En particulier, certaines subtilités propres aux systèmes pratiques ont été sacrifiées sur l&rsquo;autel de la compatibilité et de l&rsquo;interprétabilité:</p><ul><li>un signal doit forcément s&rsquo;addresser à un train en particulier: les signaux n&rsquo;ont pas d&rsquo;aspect par défaut; ils n&rsquo;existent que pour être vus</li><li>les itinéraires / routes sont formées à destination d&rsquo;un train en particulier</li></ul><div class="pageinfo pageinfo-info"><p>Ce document est une description du modèle de fonctionnement cible d&rsquo;OSRD.
Il a pour objectif de renseigner développeurs et experts métiers sur le fonctionnement du simulateur.
Des changements y sont apportés au fil de l&rsquo;évolution du projet.</p></div><div class="pageinfo pageinfo-warning"><p>Ce modèle est en cours d&rsquo;implémentation</p></div><h2 id=architecture>Architecture</h2><pre class=mermaid>flowchart TD
    %%%% NODES

    train[Train]
    %% ↓
    signaling[Signalisation]
    %% ↓
    routing[Routage]
    ordering[Ordonnancement]
    %% ↓
    reservation[Réservation]
    %% ↓
    location[Localisation]
    movable-elements[&#34;Éléments mobiles&#34;]

    %%%% EDGES

    train -- réagit à --&gt; signaling
    train -- réclame les itinéraires --&gt; ordering
    ordering -- commande --&gt; routing
    signaling -- observe --&gt; reservation
    routing -- observe et réserve --&gt; reservation
    reservation -- observe --&gt; location
    reservation -- actionne --&gt; movable-elements
    train -- informe --&gt; location

    %%%% CLICKABLE LINKS

    click train href &#34;./train/&#34; _self
    click ordering href &#34;./ordering/&#34; _self
    click signaling href &#34;./signaling/&#34; _self
    click routing href &#34;./routing/&#34; _self
    click reservation href &#34;./reservation/&#34; _self
    click location href &#34;./location/&#34; _self
    click movable-elements href &#34;./movable-elements/&#34; _self</pre><div class="alert alert-info" role=alert><h4 class=alert-heading>Pistes d'évolution</h4><ul><li>Gestion des overlaps</li></ul></div><h2 id=remerciements>Remerciements</h2><p>Par ordre alphabétique:</p><ul><li>Christophe Mémin</li><li>Djamal Bellebia</li><li>Gilles Dessagne</li><li>Nathanaël Dias</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ee6003e9414db3f0e05978636a844345>2.1.1 - Éléments mobiles</h1><div class=lead>Gère l&rsquo;état des organes de commande des aiguilles, passages à niveau, …</div><h2 id=description>Description</h2><p>Chaque élément mobile, aiguille ou passage à niveau, a une liste d&rsquo;états possibles.
Ces états sont mutuellement exclusifs.</p><h2 id=dépendances>Dépendances</h2><ul><li><code>statique</code> une liste d&rsquo;élements mobiles</li><li><code>statique</code> liste des états possibles de chaque élément mobile</li></ul><h2 id=opérations-possibles>Opérations possibles</h2><ul><li>observer un élément mobile</li><li>verrouiller / déverrouiller un élément mobile</li><li>bouger un élément mobile</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f9ae9ad8e8b03f8f0fcbef3b7d4be0b9>2.1.2 - Localisation</h1><div class=lead>Fournit les informations de position des trains sur le réseau</div><h2 id=description>Description</h2><p>La couche de localisation permet à d&rsquo;autres modules de simulation de suivre le déplacement du train dans l&rsquo;infrastructure.
L&rsquo;infrastructure ferroviaire est découpée en régions appelées zones. Quand on train entre dans une zone, ce module permet d&rsquo;en être notifié.</p><p>Les zones (ou TVDSection / DetectionSection) sont des partitions physiques des voies :</p><ul><li>capables de détecter la présence d&rsquo;un train</li></ul><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>il doit être possible de suivre les changements d&rsquo;occupation d&rsquo;une zone</li><li>il <em>devra</em> être possible de suivre les déplacements d&rsquo;un train</li><li>il <em>devra</em> être possible d&rsquo;implémenter un système de bloc mobile</li></ul><h2 id=dépendances>Dépendances</h2><ul><li><code>statique</code> une liste de zones</li></ul><h2 id=opérations>Opérations</h2><ul><li>Occuper une zone</li><li>Libérer une zone</li><li>Observer les changements d&rsquo;occupation d&rsquo;une zone</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-102b27462f1d7abc5a5824a7ba5d0b82>2.1.3 - Reservation</h1><div class=lead>Gère l&rsquo;état de réservation des zones</div><div class="alert alert-warning" role=alert>Le mot réservation ici a pour sens réservation de la resource itinéraire, et non le sens commande plannifiée d&rsquo;itinéraire</div><h2 id=description>Description</h2><p>Les zones (ou TVDSection / DetectionSection) sont des partitions physiques des voies :</p><ul><li>capables de détecter la présence d&rsquo;un train</li><li>qui fournissent un service de réservation à l&rsquo;usage des routes</li></ul><p>Chaque zone a un certain nombre de configurations différentes.
Par exemple, une zone sans aiguille aura deux configurations :</p><ul><li>sens pair</li><li>sens impair</li></ul><p>Une zone avec une aiguille aura 4 configurations possibles :</p><ul><li>sens pair voie principale</li><li>sens impair voie principale</li><li>sens pair voie déviation</li><li>sens impair voie déviation</li></ul><p><strong>Chaque zone ne peut être réservée que pour une configuration donnée à la fois, mais peut être réservée simultanément par plusieurs routes</strong>.
Une zone ne peut changer de configuration que lorsqu&rsquo;elle n&rsquo;est pas réservée.</p><div class="alert alert-info" role=alert><p>En discutant avec des experts métiers, vont entendrez parler d&rsquo;<a href=https://fr.wikipedia.org/wiki/Enclenchement>enclenchements</a>:
le terme viens de l&rsquo;époque où les postes de signalisations étaient entièrement mécaniques.
Les enclenchements étaient alors des objets physiques qui empêchaient certaines configurations.</p><p>Une conséquence de cet héritage historique et que beaucoup de règles ferroviaires sont exprimées par contraintes au lieu d&rsquo;être exprimées par garanties.
Un enclenchement, c&rsquo;est une garantie qu&rsquo;une situation particulière ne peut pas se produire.</p></div><h3 id=état-dynamique-dune-zone>État dynamique d&rsquo;une zone</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>ZoneState</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// A list of active reservations.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// Each reservation requires a particular configuration to be upheld.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>reservations</span>: <span style=color:#000>VecDeque</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>ZoneReservation</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>ZoneReservation</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The train which requires this reservation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>train</span>: <span style=color:#000>TrainHandle</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// The configuration required for this reservation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>requirements</span>: <span style=color:#000>ZoneRequirements</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The state of this reservation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>status</span>: <span style=color:#000>ZoneReservationStatus</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>ZoneReservationStatus</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// In the process of being reserved, but not yet ready
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>PRE_RESERVED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The train can arrive anytime
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>RESERVED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The train is inside the zone
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>OCCUPIED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The zone is pending release
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>PENDING_RELEASE</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>ZoneRequirements</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>entry</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DirDetector</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>exit</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DirDetector</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>movable_elements</span>: <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>MovableElement</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MovableElementConfig</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>impl</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ZoneState</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// Get the combined requirements for all the currently active reservations
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>get_combined_requirements</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>ZoneRequirements</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>reservations</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>map</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#000>res</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>requirements</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>reduce</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>b</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ZoneRequirements</span>::<span style=color:#000>combine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>b</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Les zones doivent pouvoir être <strong>verrouillées</strong> dans une configuration particulière.</li><li>Il doit être possible pour plusieurs routes de <strong>partager une réservation</strong> de configuration.</li><li>Il doit être possible d&rsquo;observer l&rsquo;<strong>évolution de statut d&rsquo;une réservation</strong>.</li><li>Il doit être possible de faire évoluer le statut d&rsquo;une réservation.</li></ul><h2 id=dépendances>Dépendances</h2><ul><li><code>statique</code> les détecteurs qui délimitent chaque zone</li><li><code>statique</code> les aiguilles dans chaque zone</li><li><code>dynamique</code> capacité d&rsquo;observer l&rsquo;occupation des zones</li><li><code>dynamique</code> capacité d&rsquo;actionner les éléments mobiles</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>espacement</strong>: Observer l&rsquo;état d&rsquo;une zone</li><li><strong>routage</strong>: Verrouiller et déverrouiller la zone : permet d&rsquo;obtenir un droit d&rsquo;action. Toutes les opérations en écriture nécessitent d&rsquo;avoir acquis le verrou.</li><li><strong>routage</strong>: Attendre que toutes les réservations d&rsquo;une zone expirent</li><li><strong>routage</strong>: Pré-réserver une configuration de zone</li><li><strong>routage</strong>: Confirmer la réservation d&rsquo;une zone</li><li><strong>routage</strong>: Attendre que la réservation de la zone soit occupée par son train</li><li><strong>routage</strong>: Relacher une réservation de zone</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-db83f9bbda0f6a9be54f5872c94185f4>2.1.4 - Routage</h1><div class=lead>Gère le cycle des routes</div><h2 id=description>Description</h2><ul><li>Les routes ont pour responsabilité d&rsquo;autoriser le déplacement des trains dans l&rsquo;infrastructure. Elles doivent se terminer à un point où l&rsquo;arrêt du train est prévu (en terme de signalisation, pas voyageur).</li><li>Les routes sont assimilables à des itinéraires, ou à des suites d&rsquo;itinéraires et d&rsquo;installations de pleine voie.</li><li>Les routes n&rsquo;ont pas de lien direct avec le cantonnement et la signalisation. Elles nourissent des informations sur la disponibilité des voies qui sont utilisées par le cantonnement et la signalisation.</li><li>Une route est un chemin de détecteur en détecteur. Elle représente une portion de chemin qu&rsquo;il est sûr pour un train d&rsquo;emprunter.</li><li>Les routes ont des points de libération, qui sont des détecteurs qui délimitent quand détruire l&rsquo;itinéraire, ce qui permet d&rsquo;implémenter transit souple, rigide, et entre-deux.</li><li>Une route peut être à nouveau formée alors qu&rsquo;un train est déjà en train de la parcourir. Cela permet à plusieurs trains de se suivre sur la même route.</li></ul><h3 id=cycle-de-vie-dune-route>Cycle de vie d&rsquo;une route</h3><p>Les routes n&rsquo;ont pas d&rsquo;état, mais leur commande donne lieu à une suite d&rsquo;événements systématique :</p><ul><li>le système commande toutes les routes sur le trajet du train dans l&rsquo;ordre, sans attendre<ul><li>la commande doit être acceptée par le <strong>régulateur</strong></li></ul></li><li>lorsque le régulateur accepte la commande, la <strong>formation</strong> commence<ul><li>le droit d&rsquo;action de chaque zone de la route est acquis, selon un ordre global</li><li>en parallèle pour toutes les zones:<ul><li>si la zone n’est pas dans la configuration souhaitée:<ul><li>si elle est déjà réservée, attendre que les réservations expirent</li><li>sinon, la mettre dans la configuration souhaitée en déplaçant les aiguilles</li></ul></li><li>pré-réserver la zone pour le passage du train</li><li>le droit d&rsquo;action de la zone est cédé</li></ul></li></ul></li><li>une fois que la formation est terminée, la route est <strong>établie</strong><ul><li>pour chaque zone, transformer la pré-réservation du train en réservation</li></ul></li><li>dès que la route est établie, un processus de <strong>destruction de la route</strong> commence<ul><li>pour chaque zone de la route donnant lieu à une libération<ul><li>attendre que le train quitte la zone (que la réservation passe de l&rsquo;état <code>OCCUPIED</code> à l&rsquo;état <code>PENDING_RELEASE</code>)</li><li>libérer la réservation des zones du début de la route jusqu&rsquo;à la zone actuelle</li></ul></li></ul></li></ul><div class="alert alert-info" role=alert><h4 class=alert-heading>Piste d'évolution</h4>Certains postes d&rsquo;aiguillages ont un enclenchement entre itinéraires de sens contraire (affrontement) qui empêche l&rsquo;activation d&rsquo;une route en menant à une zone avec un transit en sens contraire. Il serait envisageable de réserver une zone supplémentaire à la fin du chemin protégé par la route, par sécurité.</div><div class="alert alert-info" role=alert><h4 class=alert-heading>Piste d'évolution</h4>Certains itinéraires en gare ne permettent pas le partage du chemin par plusieurs trains</div><div class="alert alert-info" role=alert><h4 class=alert-heading>Piste d'évolution</h4>En pratique, il pourrait être intéressant d&rsquo;introduire une notion de route partielle afin de réduire le nombre de routes nécessaires: une route partielle est une portion de route qu&rsquo;il n&rsquo;est pas sûr d&rsquo;activer indépendament.</div><h2 id=exigences-de-conception>Exigences de conception</h2><p>Le système doit, indirectement ou directement:</p><ul><li>permettre à la <strong>signalisation</strong> de déterminer si une section de voie est <strong>prête à être empruntée</strong>.</li><li>permettre l&rsquo;<strong>ordonnancement</strong> des trains selon des critères configurables.</li><li>permettre la destruction progressive (<strong>transit souple</strong>) de l&rsquo;itinéraire après le passage du train.</li><li>il doit être possible d&rsquo;avoir plusieurs processus de commande actifs au même moment pour la même route, afin de supporter des trains qui se suivent</li></ul><h2 id=dépendances>Dépendances</h2><ul><li><p><code>statique</code> le chemin des routes de détecteur à détecteur</p></li><li><p><code>statique</code> la position requise des aiguilles, par zone</p></li><li><p><code>statique</code> les points de libération des zones (qui implémentent le transit souple / rigide)</p></li><li><p><code>dynamique</code> <code>régulateur</code> soumettre des commandes</p></li><li><p><code>dynamique</code> <code>réservation</code> acquérir et relacher un droit d&rsquo;action par zone</p></li><li><p><code>dynamique</code> <code>réservation</code> attendre que les réservations d&rsquo;une zone expirent</p></li><li><p><code>dynamique</code> <code>éléments mobiles</code> déplacer des aiguilles</p></li><li><p><code>dynamique</code> <code>réservation</code> pré-réserver une zone</p></li><li><p><code>dynamique</code> <code>réservation</code> promouvoir une pré-réservation en réservation</p></li><li><p><code>dynamique</code> <code>réservation</code> lors de la destruction de la route, attendre qu&rsquo;une réservation passe en <code>PENDING_RELEASE</code></p></li><li><p><code>dynamique</code> <code>réservation</code> libérer une réservation</p></li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>commander une route</strong>: démarre un processus asynchrone qui ne se terminera que lorsque la route aura été établie. <strong>Un processus de destruction doit démarrer dès que la route est établie</strong>.</li></ul><h2 id=notes-de-conception>Notes de conception</h2><p>Ces notes permettent d&rsquo;expliquer les décisions qui ont été prises, afin de pouvoir plus aisément les comprendre et évoluer.</p><h3 id=informer-la-signalisation>Informer la signalisation</h3><p>Sachant que:</p><ul><li>il peut y avoir beaucoup de zones partant d&rsquo;un même point, il est préférable d&rsquo;éviter de contraindre les signaux à observer une liste de routes</li><li>il est potentiellement difficile d&rsquo;associer un état clair à chaque route</li></ul><p>Il en ressort plusieurs manières d&rsquo;informer la signalisation de la navigabilité des voies:</p><ul><li>soit <strong>directement</strong>, en faisant observer à la signalisation les points d&rsquo;entrée des routes. Si plusieurs routes partent du même endroit, elles partageraient un objet entrée:<ul><li>moins de complexité dans la couche de réservation, plus de complexité dans la couche de routage</li></ul></li><li>soit <strong>indirectement</strong>, via la couche de réservation des zones, qui auraient un état supplémentaire pour marquer leur navigabilité:<ul><li>moins de complexité dans la couche de routage, plus de complexité dans la couche de réservation</li><li><code>avantage</code> le processus d&rsquo;activation des routes n&rsquo;aurait pas besoin d&rsquo;attendre l&rsquo;arrivée du train, la couche de réservation s&rsquo;en occuperait.</li><li><code>avantage</code> découplage entre routage et cantonnement / signalisation.</li></ul></li></ul><p>La seconde option a été choisie, car :</p><ul><li>elle permet d&rsquo;avoir un couplage moins fort entre la signalisation et les routes.</li><li>elle évite aussi au processus d&rsquo;activation des routes d&rsquo;attendre le passage du train alors que la couche de réservation le fait déjà.</li></ul><h3 id=cycle-de-vie-des-routes-et-état-des-zones>Cycle de vie des routes et état des zones</h3><p>Plusieurs enjeux motivent le cycle de vie des routes et l&rsquo;état des zones :</p><ul><li>d&rsquo;une part, l&rsquo;état des zones est au coeur de la détection de conflit : il doit être possible d&rsquo;extraire d&rsquo;une simulation d&rsquo;un train seul ses besoins en ressources</li><li>d&rsquo;autre part, il faut qu&rsquo;une simulation multi-train fonctionne correctement : le temps de déplacement des aiguilles selon la configuration actuellement en place, en particulier, est un point de friction important</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d84f7d18068af2c677e12c6761184b2f>2.1.5 - Ordonnancement</h1><div class=lead>Décide de l&rsquo;ordre de formation des itinéraires</div><div class="alert alert-warning" role=alert>Cette page est une ébauche, contribuez-y!</div><h2 id=définition>Définition</h2><p>La couche d&rsquo;ordonnancement a pour responsabilité d&rsquo;établir l&rsquo;ordre de commande des itinéraires, et par conséquent, l&rsquo;ordre de passage des trains.
La méthode exacte utilisée pour prendre cette décision n&rsquo;importe pas, du moment qu&rsquo;elle garanti que la simulation se termine (elle ne doit pas amener de trains en nez-à-nez, ou créer d&rsquo;autre cas de figure de blocage).</p><p>Il est possible d&rsquo;implémenter un module d&rsquo;ordonnancement via des tableaux d&rsquo;ordre de succession des trains aux aiguilles.</p><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Il doit être possible de connecter n&rsquo;importe quel algorithme d&rsquo;ordonnancement</li><li>Le module d&rsquo;ordonnancement doit approuver les commandes de routes.</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>train</strong>: Des itinéraires sont <strong>commandés</strong> pour chaque trains, aussi loin et aussi tôt que possible. L&rsquo;approbation de la commande est soumise au régulateur, qui peut la retarder indéfiniment, selon des critères de son choix.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-7430cbed022a567839d982205fb6211d>2.1.6 - Train</h1><div class=lead>Représente un train dans la simulation</div><h2 id=description>Description</h2><p>Les contraintes sur ce qu&rsquo;est un train sont relativement faibles.
Il doit seulement avoir un identifiant, qui permet aux autres systèmes de garder des références vers des trains.</p><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Les trains <strong>occupent les zones</strong>.</li><li>Les trains doivent être <strong>suivis</strong> pour préserver leur <strong>ordre de passage</strong>.</li><li>Les trains ont pour responsabilité de <strong>demander les itinéraires</strong> devant eux.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-91414828f61d97b52f2ae39b3f79bf94>2.2 - Signalisation</h1><div class=lead>Décrit la modèle de signalisation</div><div class="pageinfo pageinfo-warning"><p>Ce document est en attente de revue</p></div><h2 id=description>Description</h2><p>La couche de signalisation comprend l&rsquo;ensemble des signaux, qui réagissent au cantonnement et à la réservation.
Les signaux peuvent être de différent types, et sont chargés de manière modulaire. Seul importe leur comportement
vis-à-vis de l&rsquo;état de l&rsquo;infrastructure, et la réaction des trains à la signalisation.</p><p>Les signaux sont reliés entre eux par des cantons. Les cantons définissent les mouvements autorisés par la signalisation.</p><h2 id=objectifs>Objectifs</h2><p>Le système de signalisation est à la croisée de nombreux besoins:</p><ul><li>il doit permettre de simuler la signalisation de manière réaliste, dans une simulation multi-trains</li><li>il doit permettre au système de détection de conflits de déterminer quelles ressources sont requises pour le train</li><li>il doit permettre aux utilisateurs de l&rsquo;application d&rsquo;éditer et d&rsquo;afficher les signaux</li><li>il doit permettre de visualiser les signaux sur une carte</li></ul><h2 id=exigences-de-conception>Exigences de conception</h2><p>Les données statiques :</p><ul><li>doivent permettre au front de réprésenter les signaux (choisir une image)</li><li>doivent permettre à l&rsquo;éditeur de configurer les signaux</li><li>doivent permettre au back de simuler les signaux</li><li>doivent être proches du métier</li><li>doivent permettre de modéliser des signaux composites, qui représentent en un seul signal physique plusieurs signaux logiques</li></ul><p>Pour la simulation de la signalisation :</p><ul><li>des cantons doivent être générés, à la fois pour l&rsquo;utilisateur et la <strong>compatibilité pathfinding</strong></li><li>chaque signal doit connaître le <strong>prochain signal compatible</strong></li><li>chaque signal doit connaître les <strong>zones qu&rsquo;il protège</strong></li><li>fournir aux modules de signalisation le <strong>minimum d&rsquo;information nécessaire</strong> à leur fonctionnement</li><li>pouvoir utiliser un module de signalisation sans avoir à instancier une simulation complète</li><li>pouvoir avoir des modules qu&rsquo;on puisse charger dans un ordre indépendant</li></ul><h2 id=présupposés>Présupposés</h2><ul><li>chaque signal physique peut être décomposé en une liste de signaux logiques, qui sont tous associés à un système de signalisation</li><li>les cantons ont un type</li><li>il est possible de déterminer étant donné le seul signal, ses propriétés de cantonnement</li><li>il n&rsquo;existe pas de cantons qui chevauchent une fin ou un début de route</li><li>les cantons qui ne sont pas couverts par des routes n&rsquo;existent pas ou peuvent être ignorés</li><li>un train n&rsquo;utilise qu&rsquo;un seul système de signalisation capable de transmettre la MA à la fois</li></ul><h2 id=design-des-systèmes-de-signalisation>Design des systèmes de signalisation</h2><p>Chaque système de signalisation a :</p><ul><li>un identifiant unique (une chaine de caractères)</li><li>un ensemble de rôles :<ul><li>transmission de la MA</li><li>transmission des limites de vitesse</li></ul></li><li>son type d&rsquo;état de signal, qui doit permettre de :<ul><li>savoir s&rsquo;il est contraignant à cause d&rsquo;une MA réduite</li><li>déterminer une représentation graphique de ce signal</li><li>faire réagit un train à ce signal</li></ul></li><li>les paramètres du signal, qui sont utilisés à la fois dans le front pour le configurer et dans le back pour déterminer les informations de cantonnement liées au signal</li><li>la condition de cantonnement, qui permet de savoir si un signal délimite un canton</li></ul><p>Il est à noter que si un système de signalisation a un double rôle transmission de MA et des limites de vitesse, tous les signaux dans ce système ne sont pas forcément chargés de transmettre des informations de limite de vitesse.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># unique identifier for the signaling system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;id&#34;: </span><span style=color:#4e9a06>&#34;BAL&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;version&#34;: </span><span style=color:#4e9a06>&#34;1.0&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># a list of roles the system assumes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;roles&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;MA&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;SPEED_LIMITS&#34;</span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># the schema of the dynamic state of signals of this type</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;signal_state&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;enum&#34;, &#34;field_name&#34;: </span><span style=color:#4e9a06>&#34;aspect&#34;</span><span style=color:#204a87;font-weight:700>, values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;VL&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;A&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;S&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;C&#34;</span><span style=color:#000;font-weight:700>]</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: </span><span style=color:#4e9a06>&#34;ralen30&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: </span><span style=color:#4e9a06>&#34;ralen60&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: </span><span style=color:#4e9a06>&#34;ralen_rappel&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># the schema of the settings signals of this type can read</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;signal_settings&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;Nf&#34;, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Non-franchissable&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;has_ralen30&#34;, &#34;default&#34;: false, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Ralen 30&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;has_rappel30&#34;, &#34;default&#34;: false, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Rappel 30&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;has_ralen60&#34;, &#34;default&#34;: false, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Ralen 60&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;has_rappel60&#34;, &#34;default&#34;: false, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Rappel 60&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># these are C-like boolean expressions:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># true, false, &lt;flag&gt;, &lt;enum&gt; == value, &amp;&amp;, || and ! can be used</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># used to evaluate whether a signal is a block boundary.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;block_boundary_when&#34;: </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># used for conflict detection. </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;constraining_ma_when&#34;: </span><span style=color:#4e9a06>&#34;aspect != VL&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=design-des-cantons>Design des cantons</h2><p>Les cantons ont plusieurs attributs:</p><ul><li>un système de signalisation qui correspond à celui affiché par son premier signal.</li><li>un <strong>chemin</strong>, qui représente les zones protégées par le canton, et leur état attendu (au même format que le chemin des routes)</li><li>un <strong>signal d&rsquo;entrée</strong>, (optionnel quand le canton pars d&rsquo;un butoir)</li><li>des <strong>signaux intermédiaires</strong> éventuels (c&rsquo;est utilisé avec des systèmes du style BAPR)</li><li>un <strong>signal de sortie</strong>, (optionnel quand le canton se termine à un butoir)</li></ul><p>Le chemin est exprimé de détecteur en détecteur afin de pouvoir faire un rapprochement avec le graphe des routes.</p><p>Quelques remarques:</p><ul><li>il peut y avoir plusieurs systèmes de signalisation superposés sur la même infrastructure. le modèle pars du principe qu&rsquo;un seul système à la fois est actif pour la gestion de la MA</li><li>un canton n&rsquo;a pas d&rsquo;état: on peut se reposer sur l&rsquo;état dynamique des zones qui le compose</li><li>les signaux utilisent les cantons pour savoir quelles zones sont à protéger à un instant donné</li></ul><h2 id=design-des-signaux>Design des signaux</h2><p>Chaque signal physique est composé d&rsquo;un ou plusieurs signaux logique, dont les aspects sont combinés pour être représentés sur le terrain. Lors de la simulation, les signaux logiques sont traités comme des signaux différents.</p><p>Chaque signal logique est associé à un système de signalisation, qui définit si le signal transmet
Chaque signal logique peut avoir un certain nombre de pilotes. Les</p><h3 id=signal-non-chargé>Signal non chargé</h3><p>Un <strong>signal non chargé</strong> correspond à l&rsquo;objet capable de transmettre de l&rsquo;information au train. Les signaux non chargés portent :</p><ul><li>un système de signalisation</li><li>des paramètres spécifiques à leur système de signalisation (comme <code>Nf</code> et <code>has_ralen30</code> pour bal)</li></ul><p>Les signaux non chargés sont utilisés pour décrire statiquement l&rsquo;infrastructure, et sont pensés pour être édités par l&rsquo;utilisateur.</p><p>En fonction du contexte, différents mécanismes peuvent être à la source de cette information : ce sont des <strong>pilotes</strong> (<code>drivers</code>). Chaque signal peut porter plusieurs pilotes. Par exemple, un signal BAL qui est à la fois un départ de canton TVM et un départ de canton BAL aura deux pilotes: <code>bal-bal</code> et <code>bal-TVM</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># signals must have location data.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># this data is omited as its format is irrelevant to how signals behave</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;logical_signals&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the signaling system shown by the signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bal&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the settings for this signal, as defined in the signaling system manifest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;settings&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;has_ralen30=true&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Nf=true&#34;</span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># all the ways the signal can be driven</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># optional: if not present, we determine the drivers automatically</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;drivers&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the signal can react to a following bal signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#204a87;font-weight:700>&#34;next_signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bal&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the signal can react to a following TVM signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#204a87;font-weight:700>&#34;next_signaling_system&#34;: </span><span style=color:#4e9a06>&#34;TVM&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># signals must have location data.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># this data is omited as its format is irrelevant to how signals behave</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;logical_signals&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the signaling system shown by the signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bal&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the settings for this signal, as defined in the signaling system manifest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;settings&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;has_ralen30=true&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Nf=true&#34;</span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># all the ways the signal can be driven</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;drivers&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the signal can react to a following bal signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#204a87;font-weight:700>&#34;next_signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bal&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the signaling system shown by the signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bapr&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># all the ways the signal can be driven</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;drivers&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the signal can react to a following bal signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#204a87;font-weight:700>&#34;next_signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bapr&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Une chaine de charactère simplifiée de description du type de signal peut être généré. Ici: <code>bal[Nf=true,ralen30=true]+bapr</code>.</p><h3 id=chargement-des-paramètres-du-signal>Chargement des paramètres du signal</h3><p>La première étape du chargement du signal est de charactériser le signal dans le système de signalisation.
Cette étape produit un objet qui décrit le signal.</p><p>Lors du chargement du signal :</p><ul><li>le système de signalisation correspondant au nom fourni est identifié</li><li>les paramètres du signal sont chargés et validés suivant la spec du système de signalisation</li><li>le rôle de cantonnement du signal est évalué à partir de l&rsquo;expression</li></ul><h3 id=chargement-du-signal>Chargement du signal</h3><p>Une fois que les paramètres du signal sont chargés, il devient possible de charger ses pilotes. Pour chaque pilote :</p><ul><li>l&rsquo;implémentation du pilote est identifiée à partir de la paire <code>(signaling_system, next_signaling_system)</code></li><li>on vérifie que le système de signalisation sortant du pilote correspond à celui du signal</li><li>on vérifie qu&rsquo;il n&rsquo;existe pas déjà de pilote pour le système de signalisation entrant du pilote</li></ul><p>Cette étape produit une <code>Map&lt;SignalingSystem, SignalDriver></code>, où le système de signalisation est celui en entrée du signal.
Il devient ensuite possible de construire le signal chargé.</p><h3 id=construction-des-cantons>Construction des cantons</h3><ul><li>le framework crée des cantons entre les signaux en suivant les routes présentes dans l&rsquo;infrastructure, et les propriétés de cantonnement des signaux</li><li>des vérifications sont faites sur le graphe de cantons créé : il doit toujours pouvoir être possible de choisir un canton pour chaque signal et chaque état de l&rsquo;infrastructure</li></ul><h3 id=limites-de-vitesse>Limites de vitesse</h3><p>Les limites de vitesse sont représentées comme des ranges sur des itinéraires.
Elles commencent leur vie comme des ranges sur des track sections, et sont liftées en ranges sur des itinéraires de la manière suivante :</p><ul><li>Les limites de vitesse directionnelles par track sont remontées sur les itinéraires. La même limite de vitesse peut être sur plusieurs itinéraires.</li><li>Pour chaque limite de vitesse, le graphe des itinéraires est parcouru à l&rsquo;envers à la recherche de signaux capable de gérer la limite :<ul><li>Seules les limites de vitesse qui ne sont pas précédées par une autre limite aux propriétés identiques sont prises en compte</li><li>Chaque signal doit signaler son intérêt par rapport à une limite de vitesse: Pas concerné, Concerné mais devant être annoncé par un autre signal, ou concerné et terminal.</li></ul></li><li>pour chaque limite de vitesse prévue sur le chemin du train, les signaux dans la chaîne d&rsquo;annonce sont ajoutés à la liste de ceux qui seront simulés pour le train</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>SpeedLimitHandling</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/** This signal isn&#39;t supposed to announce this limit */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Ignore</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/** This signal should announce this limit, but cannot */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Error</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/** This signal can announce this limit, and is part of an ongoing chain */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Chain</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/** This signal can announce this limit, and ends the chain */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>EndChain</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>handles_speed_limit</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#3465a4>self</span>: <span style=color:#000>SignalSettings</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>speed_limit</span>: <span style=color:#000>SpeedLimit</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>distance_mm</span>: <span style=color:#204a87;font-weight:700>u64</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#000>SpeedLimitHandling</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>handles_speed_limit_chain</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#3465a4>self</span>: <span style=color:#000>SignalSettings</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>speed_limit</span>: <span style=color:#000>SpeedLimit</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>chain_signal</span>: <span style=color:#000>Signal</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>distance_mm</span>: <span style=color:#204a87;font-weight:700>u64</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#000>SpeedLimitHandling</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=validation-des-cantons>Validation des cantons</h3><p>La validation permet de signaler des configurations invalides en terme de signalisation et de cantonnement.
Les cas de figure de validation que l&rsquo;on souhaite supporter sont les suivants:</p><ul><li>le système de signalisation peut vouloir valider, sachant si le canton pars / se termine sur un butoir :<ul><li>la longueur du canton</li><li>l&rsquo;espacement entre les signaux du canton, premier signal exclu</li></ul></li><li>chaque signal du canton peut avoir des informations specifiques s&rsquo;il est un signal de transition. Par conséquent, tout les drivers de signaux participent a la validation.</li></ul><p>En pratique, il existe deux mécanismes distincts pour répondre à ces deux besoins :</p><ul><li>le <strong>module de système de signalisation</strong> s&rsquo;occupe de valider la signalisation <strong>dans le canton</strong></li><li>les <strong>pilote de signaux</strong>, s&rsquo;occupe de valider les <strong>transitions entre cantons</strong></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>extern</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>report_warning</span><span style=color:#000;font-weight:700>(</span><span style=color:#8f5902;font-style:italic>/* TODO */</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>extern</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>report_error</span><span style=color:#000;font-weight:700>(</span><span style=color:#8f5902;font-style:italic>/* TODO */</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>Block</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>startsAtBufferStop</span>: <span style=color:#204a87;font-weight:700>bool</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>stopsAtBufferStop</span>: <span style=color:#204a87;font-weight:700>bool</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>signalTypes</span>: <span style=color:#204a87>Vec</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>SignalingSystemId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>signalSettings</span>: <span style=color:#204a87>Vec</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>SignalSettings</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>signalPositions</span>: <span style=color:#204a87>Vec</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Distance</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>length</span>: <span style=color:#000>Distance</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>/// Runs in the signaling system module
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>check_block</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>block</span>: <span style=color:#000>Block</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>/// Runs in the signal driver module
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>check_signal</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>signal</span>: <span style=color:#000>SignalSettings</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>block</span>: <span style=color:#000>Block</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// The partial block downstream of the signal - no signal can see backward
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=cycle-de-vie-des-signaux>Cycle de vie des signaux</h3><p>Avant le départ d&rsquo;un train:</p><ul><li>le chemin d&rsquo;un train peut être exprimé soit en routes soit en cantons. Ces deux chemins doivent être superposés</li><li>la file de signaux que le train va rencontrer est établie</li></ul><p>Lors de la simulation :</p><ul><li>au fil du déplacement du train, les informations d&rsquo;occupation des voies devant lui sont synthétisées</li><li>lorsqu&rsquo;un train observe un signal, son état est évalué</li></ul><h3 id=évaluation-de-létat-des-signaux>Évaluation de l&rsquo;état des signaux</h3><p>Les signaux sont modélisés comme une fonction d&rsquo;évaluation, qui consomme les paramètres pouvant influencer son comportement, et retourne l&rsquo;état actuel du signal.</p><p>La fonction d&rsquo;évaluation prend en paramètres, la vue est choisie pour le moment, car plus flexible.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>ZoneStatus</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>/** The zone is clear to be used by the train */</span>
</span></span><span style=display:flex><span>   <span style=color:#000>CLEAR</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>/** The zone is occupied by another train, but otherwise clear to use */</span>
</span></span><span style=display:flex><span>   <span style=color:#000>OCCUPIED</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>/** The zone is incompatible. There may be another train as well */</span>
</span></span><span style=display:flex><span>   <span style=color:#000>INCOMPATIBLE</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>MAView</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** Combined status of the zones protected by the current signal */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>protectedZoneStatus</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>ZoneStatus</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>nextSignalState</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SignalState</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>nextSignalSettings</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SignalSettings</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>DirectSpeedLimit</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** Distance between the signal and the speed limit */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>distance</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Distance</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>speed</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Speed</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>IndirectSpeedLimit</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>distanceToNextSignal</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Distance</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>nextSignalState</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SignalState</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>nextSignalSettings</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SignalSettings</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>SpeedLimitView</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** A list of speed limits directly downstream of the signal */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>directSpeedLimits</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>List</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>DirectSpeedLimit</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** A list of speed limits which need to be announced in a signal chain */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>indirectSpeedLimits</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>List</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>IndirectSpeedLimit</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fun</span> <span style=color:#000>signal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>maView</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>MAView</span><span style=color:#000;font-weight:700>?,</span> <span style=color:#000>limitView</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SpeedLimitView</span><span style=color:#000;font-weight:700>?):</span> <span style=color:#000>SignalState</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>La vue doit permettre d&rsquo;accéder aux données suivantes :</p><ul><li>une synthèse de l&rsquo;état des zones en aval jusqu&rsquo;à la MA du train</li><li>la chaine de cantons</li><li>l&rsquo;état des signaux en aval présents dans la chaine de cantons du train</li></ul><h4 id=chemin-de-la-vue-signalisation>Chemin de la vue signalisation</h4><p>Le chemin de la vue signalisation est exprimé en cantons :</p><ul><li>des cantons peuvent être rajouter pour étendre la vue</li><li>la vue peut être réduite en supprimant des cantons</li></ul><h4 id=simulation-hors-chemin-du-train>Simulation hors chemin du train</h4><p>Il est possible de simuler la signalisation hors du chemin du train :</p><ul><li>si un signal donne sur des cantons empruntant des chemins différents, il est simulé comme s&rsquo;il était en bout d&rsquo;itinéraire, et sera donc au carré</li><li>si un signal donne sur des cantons empruntant le même chemin, il est simulé avec les autres signaux de la suite, dans une vue construite à cet effet</li></ul><h2 id=dépendances>Dépendances</h2><p>Pour la génération du graphe de cantons :</p><ul><li>graphe des routes. Pour chaque route :<ul><li><code>waypoints: List&lt;DiDetector></code></li><li><code>signals: OrderedMap&lt;Position, UnloadedSignal></code></li><li><code>speed_limits: RangeMap&lt;Position, SpeedLimit></code>, y compris la logique de limite par categorie de train</li></ul></li><li>systèmes de signalisation</li><li>pilotes</li></ul><p>Pour l&rsquo;évaluation :</p><ul><li>chemin du train en cantons</li><li>portion du chemin à évaluer</li><li>pilotes</li><li>état des zones dans la section à évaluer</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>instancier une vue</strong> crée un cadre dans lequel observer des signaux</li><li><strong>prévoir le chemin</strong> signaler à la vue les cantons qui seront empruntés par le train</li><li><strong>observer un signal</strong> s&rsquo;abonner à l&rsquo;état d&rsquo;un signal (via la vue)</li><li><strong>dépasser un signal</strong> signaler qu&rsquo;un signal a été dépassé par le train (via la vue)</li></ul><h2 id=annexes>Annexes</h2><h3 id=questions-de-recherche>Questions de recherche</h3><ul><li><p>est-ce qu&rsquo;il existe des cantons qui chevauchent une fin de route ? non (loic)</p></li><li><p>est-ce qu&rsquo;il existe des existe des signaux LL(2) ? non en france</p></li><li><p>est-ce qu&rsquo;il existe des signaux qui changent de comportement en fonction du canton actif devant eux ? oui, pour les ralentissements</p></li><li><p>est-ce qu&rsquo;il existe des signaux qui sont le départ de cantons de types différents (bal et bapr par exemple) ? OUI LOL, tvm meme</p></li><li><p>est-ce que le comportement d&rsquo;un signal peut déprendre de quel canton est actif après le signal de fin du canton actuel ? oui, avec les ralentissements ou jaune cli</p></li><li><p>est-ce que certains de signalisation ont besoin d&rsquo;avoir des informations supplémentaires dans les cantons ? mouais, y&rsquo;a des ralentissements, mais c&rsquo;est pas spécialement porté par le canton</p></li><li><p>est-il nominal qu&rsquo;un train aie plusieurs systèmes de signalisation actifs simultanément ? non</p></li><li><p>quand et par qui les cantons sont-ils générés ?</p></li><li><p>quelles sont les données nécessaires à la génération des cantons ?</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2a67b560f64e237130e37a54280c81f6>2.3 - Recherche de sillons de dernière minute (STDCM)</h1><p>OSRD permet d&rsquo;ajouter un nouveau train dans une grille horaire déjà établie,
sans générer aucun conflit avec les autres trains. L&rsquo;application directe de cette fonctionnalité
est appelée la <strong>recherche de sillon de dernière minute</strong>.</p><p>L&rsquo;acronyme STDCM (Short Term Digital Capacity Management) est utilisé
pour parler du concept en général.</p></div><div class=td-content><h1 id=pg-5e6a8c58f44ec33565becd41e00148ef>2.3.1 - Contexte métier</h1><p>Quelques définitions :</p><h3 id=la-capacité>La capacité</h3><p>La <strong>capacité</strong>, dans ce contexte, correspond à la possibilité de
réserver des éléments d&rsquo;infrastructure pour permettre le passage
d&rsquo;un train.</p><p>La capacité s&rsquo;exprime en fonction de l&rsquo;espace et du temps :
la réservation d&rsquo;un élément peut bloquer une zone précise
qui devient inaccessible aux autres trains, et cette réservation
se fait sur un intervalle de temps.</p><p>On peut la représenter
sur un graphique, avec le temps en abscisse et la distance parcourue
sur un chemin en ordonnée.</p><p><img src=space_time_chart.png alt="Graphique espace temps"></p><blockquote><p>Exemple d&rsquo;un graphique espace-temps montrant le passage d&rsquo;un train.</p><p>Les couleurs représentent ici les aspects des signaux, mais
montrent également une consommation de la capacité :
quand ces blocs se superposent pour deux trains, ils sont en conflit.</p></blockquote><p>Deux trains d&rsquo;une grille horaire sont en <strong>conflit</strong>
quand ils réservent en même temps un même objet, dans des
configurations incompatibles.</p><p><img src=conflict.png alt="Graphique espace temps avec conflit"></p><blockquote><p>Exemple d&rsquo;un graphique espace-temps avec conflit : le second train
est plus rapide que le premier, ils sont en conflit sur la fin du trajet,
quand les rectangles se superposent.</p><p>En essayant de simuler cette grille horaire, le second train serait
ralentis par des signaux indiquant de ralentir, provoqués par la
présence du premier train.</p></blockquote><p>La consommation de capacité est souvent représentée sous la forme de
rectangles car, dans les systèmes de signalisation les plus simples,
il s&rsquo;agit de réservations d&rsquo;une zone fixe dans l&rsquo;espace pendant un intervalle de temps donné.</p><h3 id=les-sillons-horaires>Les sillons horaires</h3><p>Un <strong>sillon</strong> correspond à une réservation de capacité pour le
passage d&rsquo;un train. Il est fixé dans l&rsquo;espace et dans le temps :
le temps de départ et le chemin emprunté sont connus.
Sur les graphiques espace-temps de cette page, un sillon correspond
à l&rsquo;ensemble des blocs pour un train.</p><p>Dans un fonctionnement habituel, le gestionnaire d&rsquo;infrastructure
(ex : SNCF Réseau) propose des sillons à la vente pour les entreprises
ferroviaires (ex : SNCF Voyageurs).</p><p>À une date donnée avant le jour de
circulation prévu, tous les sillons sont attribués. Mais <strong>il peut rester
assez de capacité pour faire rouler plus de trains</strong>. Il est
possible de placer des trains entre les sillons déjà établis,
quand ces derniers sont suffisamment espacés ou n&rsquo;ont pas
trouvé d&rsquo;acheteurs.</p><p>La capacité restante après l&rsquo;attribution des sillons est appelée
la <strong>capacité résiduelle</strong>. Le problème traité ici est la recherche
de sillons dans celle-ci.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-43ea4c19a1c68f9d3854a75420fe7d2b>2.3.2 - Module de recherche de sillons</h1><p>Ce module gère la recherche de solution.</p><p>Les entrées et sorties sont fortement simplifiées et abstraites
pour simplifier le problème au maximum et permettre des tests efficaces.</p><p>Pour décrire son fonctionnement en quelques phrases :
l&rsquo;espace de solutions est représenté sous forme d&rsquo;un graphe qui encode le temps,
la position et la vitesse. Une recherche de chemin est ensuite effectuée
dans ce graphe pour trouver une solution. Le graphe est calculé
au fil de son exploration.</p><p>Ce graphe peut d&rsquo;une certaine manière être vu comme une forme
d&rsquo;arbre de décision, si différents chemins peuvent mener au même noeud.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-00f3695c563557ce911133a4e0d319ff>2.3.2.1 - Description du format d'entrée</h1><p>Ce module prend plusieurs entrées pour effectuer une recherche de chemin :</p><ul><li>Un graphe décrivant l&rsquo;infrastructure physique</li><li>Des zones non disponibles selon des intervalles de temps</li><li>Des points de départ et d&rsquo;arrivée</li><li>Une fenêtre de départ</li><li>Un temps de parcours maximal</li><li>Des données de simulation (matériel roulant, time step, marges, etc)</li></ul><p>Parmi ces entrées, les deux premières méritent d&rsquo;être détaillées.</p><h4 id=graphe-dinfrastructure>Graphe d&rsquo;infrastructure</h4><p>Aujourd&rsquo;hui, le graphe donné en entrée correspond au graphe
des <code>SignalingRoutes</code>. Mais il peut s&rsquo;agir de n&rsquo;importe quel graphe
orienté permettant de naviguer l&rsquo;infrastructure physique.</p><p>Les seules contraintes sont : les arêtes doivent avoir une longueur,
et il doit être possible d&rsquo;effectuer un calcul de marche sur des
sections d&rsquo;arêtes.</p><h4 id=zones-non-disponibles>Zones non disponibles</h4><p>Cette entrée représente les zones inaccessibles à cause de contraintes
de capacité.</p><p>À chaque arête du graphe est associé un ensemble de &ldquo;bloc d&rsquo;occupation&rdquo;.
Un bloc est composé d&rsquo;une distance de début et de fin (relative
au début de l&rsquo;arête), et un temps de début et de fin.
Il est considéré que la <em>tête</em> du train ne peut pas se trouver dans cette
zone dans l&rsquo;intervalle de temps donné.</p><p>Ces blocs encodent également la marge de grille : s&rsquo;il faut rajouter
<code>x</code> secondes de marges avant le train, chaque bloc est agrandi de
<code>x</code> secondes dans un sens.</p><p>Pour donner un exemple, avec la grille horaire suivante, en
supposant une arête par canton, un train de 42m et
une distance de visibilité de 10m :</p><p><img src=unavailable_sections.svg alt="Exemple de sections non disponibles"></p><ul><li><p>L&rsquo;occupation du canton 1 de t=0 à t=300 le rend non disponible
dans sa globalité pendant cette période.</p></li><li><p>Les 10 derniers mètres du canton 1 sont non disponibles de t=300 à t=360,
car le signal en début de canton 2 doit être vert quand le conducteur le voit.
Il est possible de considérer que ce bloc-ci commence à t=130
(quand le canton du signal suivant n&rsquo;affiche plus de vert),
une superposition
de blocs n&rsquo;étant pas problématique.</p></li><li><p>L&rsquo;occupation du canton 2 de t=130 à t=360 le rend non disponible
pendant cette période. Il est également non disponible à partir de
t=0, car la présence d&rsquo;un train provoquerait un avertissement sur
le canton 1 quand il est utilisé par le train déjà planifié.</p></li><li><p>Les 42 premiers mètres du canton 3 sont non disponibles de t=0 à t=360,
car la queue du train doit avoir libéré le second canton.</p></li><li><p>Le reste du canton 3 est non disponible dans sa globalité
de t=280 à t=360.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0b86147cbfa958e9f4364f4ce2ba795b>2.3.2.2 - Représentation de l'espace de solutions</h1><h4 id=principe-général>Principe général</h4><p>Le problème reste une recherche de graphe. En représentant
l&rsquo;espace de solution sous forme de graphe, il est possible de réutiliser
nos outils déjà existants de recherche de chemin.</p><p>Le <em>graphe produit</em> de la position, du temps, et de la vitesse est utilisé.
Autrement dit, chaque élément du graphe contient (entre autres) ces
3 variables.</p><p>Chaque arête du graphe est calculée avec un
<a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/ title="calcul de marche">calcul de marche</a>
pour connaître l&rsquo;évolution de la vitesse et de la position dans le temps.</p><h4 id=représentation-visuelle>Représentation visuelle</h4><p>Le graphe de départ représente l&rsquo;infrastructure physique</p><p><img src=routes_time_1.png alt="Graphe produit (1/3)"></p><p>Il est ensuite &ldquo;dupliqué&rdquo; à des temps différents</p><p><img src=routes_time_2.png alt="Graphe produit (2/3)"></p><p>Puis des nœuds sont reliés de manière à refléter le temps de parcours</p><p><img src=routes_time_3.png alt="Graphe produit (3/3)"></p><h4 id=précisions>Précisions</h4><ul><li>Le graphe est construit <em>au fil de l&rsquo;exploration</em>.</li><li>Une discrétisation est faite au niveau du temps, uniquement pour
évaluer ce qui a déjà été visité. Si le même emplacement est visité une
seconde fois, il faut une certaine différence de temps pour estimer
qu&rsquo;il n&rsquo;est pas déjà visité.</li><li>Toutes les arêtes sont réalisées avec des calculs de marche</li><li>La vitesse n&rsquo;est pas discrétisée ni utilisée pour estimer quel
emplacement est déjà visité, mais elle fait partie des calculs.</li><li>Par défaut, tous les calculs sont faits en allant à la vitesse maximale.
Les ralentissements sont ajoutés seulement quand ils sont nécessaires.</li></ul><h4 id=exemple>Exemple</h4><p>Par exemple, avec l&rsquo;infrastructure suivante en se basant sur
le graphe des voies :
<img src=example_infra.svg alt="Infra d&amp;rsquo;exemple"></p><p>Explorer le graphe des sillons possibles peut donner ce
type de résultat :
<img src=example_graph.svg alt="Représentation du graphe"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4cbbf502b73f6a39d1784fb6ef5fc8bf>2.3.2.3 - Discontinuités et retours en arrière</h1><h4 id=le-problème-des-discontinuités>Le problème des discontinuités</h4><p>Au moment d&rsquo;explorer une arête du graphe, on effectue un calcul de
marche pour connaître l&rsquo;évolution de la vitesse.
Mais il n&rsquo;est pas possible de voir plus loin que l&rsquo;arête en question,
ce qui est gênant pour calculer les courbes de freinages qui peuvent
nécessiter de commencer à freiner plusieurs kilomètres avant l&rsquo;arrivée.</p><p><img src=discontinuity.png alt=Discontinuité></p><blockquote><p>Cet exemple illustre le problème : par défaut
la première arête est explorée en allant à la vitesse maximale.
C&rsquo;est seulement en explorant la seconde arête que la destination devient visible,
sans que la distance restante soit suffisante pour s&rsquo;arrêter.</p></blockquote><h4 id=la-solution--revenir-en-arrière>La solution : revenir en arrière</h4><p>Pour régler ce problème, lorsqu&rsquo;une arête est générée avec une discontinuité
dans les courbes de vitesse, l&rsquo;algorithme revient sur les arêtes précédentes
pour en créer des nouvelles qui incluent les décélérations.</p><p>Pour donner un exemple simplifié, sur un chemin de 4 routes
où le train peut accélérer ou décélérer de 10km/h par route :</p><p><img src=backtracking_1.png alt="Discontinuité (version arêtes, 1/2)"></p><p>Pour que le train s&rsquo;arrête à la fin de la route 4, il doit être au plus à 10km/h
à la fin de la route 3. Une nouvelle arête est alors créée sur la route
3 qui finit à 10km/h. Une décélération est ensuite calculée à rebours de la fin de la route
vers le début, jusqu&rsquo;à retrouver la courbe d&rsquo;origine (ou le début
de l&rsquo;arrête).</p><p>Dans cet exemple, la discontinuité a seulement été déplacée vers la
transition entre les routes 2 et 3. Le procédé est ensuite réitéré
sur la route 2, ce qui donne le résultat suivant :</p><p><img src=backtracking_2.png alt="Discontinuité (version arêtes, 2/2)"></p><p>Les anciennes arêtes sont toujours présentes dans le graphe, elles
peuvent mener à d&rsquo;autres solutions.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-86a0f2f4d5cb5405bb586c1fba4d4c0a>2.3.2.4 - Contourner les conflits</h1><p>En explorant le graphe, il arrive souvent de tomber sur des situations
qui mèneraient à des conflits. Il faut être en mesure de rajouter du délai
pour les éviter.</p><h4 id=décalage-du-temps-de-départ>Décalage du temps de départ</h4><p>Dans les paramètres de l&rsquo;algorithme, le temps de départ est donné
sous la forme d&rsquo;une fenêtre : un temps de départ au plus tôt et au plus tard.
Tant que c&rsquo;est possible, il est toujours préférable de décaler le temps
de départ pour éviter les conflits.</p><blockquote><p>Par exemple : un train doit partir entre 10:00 et 11:00. En partant
à 10:00, cela provoque un conflit, le train doit entrer en gare
d&rsquo;arrivée 15 minutes plus tard. Il suffit de faire partir le train à
10:15 pour régler le problème.</p></blockquote><p>Dans OSRD, cette fonctionnalité est gérée en gardant une trace,
à chaque arête, du décalage maximal du temps de départ qui pourra
être ajouté sur la suite du parcours. Tant que cette valeur est suffisante,
tous les conflits sont évités par ce moyen.</p><p>Le décalage du temps de départ est une valeur stockée sur chaque arête
et additionnée à la fin de la recherche de chemin.</p><blockquote><p>Par exemple :</p><ul><li>un train doit partir entre 10:00 et 11:00. La recherche
commence avec un délai maximal de 1:00.</li><li>Après quelques arêtes, une non-disponibilité est constatée
20 minutes après notre passage. La valeur passe donc à
20 minutes pour la suite du parcours.</li><li>Le temps de départ est ensuite décalé de 5 minutes pour contourner
un conflit, modifiant le décalage maximal à 15 minutes.</li><li>Ce procédé continue jusqu&rsquo;à arriver à la fin du trajet, ou
jusqu&rsquo;au point où il faut ajouter plus de délai.</li></ul></blockquote><h4 id=marges-de-construction>Marges de construction</h4><p>Quand la valeur de décalage maximal du temps de départ tombe à 0,
il faut rajouter du délai entre deux points du parcours du train.</p><p><img src=engineering_allowance.png alt="Marge de construction (1/2)"></p><p>Le principe est le même que pour régler les discontinuités de vitesse :
le graphe est parcouru en arrière pour créer de nouvelles arêtes.</p><p><img src=engineering_allowance_edges.png alt="Marge de construction (2/2)"></p><p>La <a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/allowances/ title=marges>marge de construction</a>
est une fonctionnalité du calcul de marche
permettant d&rsquo;ajouter un délai donné entre deux point du parcours.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-878a5654bd8bd9fb14457386180665c4>2.3.2.5 - Marge de régularité</h1><p>Une des fonctionnalités qui doit être supportée par STDCM est la
<a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/allowances/ title="marge de régularité">marge de régularité</a>.
L&rsquo;utilisateur doit pouvoir indiquer une valeur
de marge, exprimée en fonction de la distance ou du temps de parcours,
et cette marge doit être ajoutée au trajet.</p><blockquote><p>Par exemple : l&rsquo;utilisateur peut indiquer une marge de 5 minutes au
100km. Sur un trajet de 42km, un trajet de 10 minutes au plus rapide
doit maintenant durer 12 minutes et 6 secondes.</p></blockquote><p>Le problème se situe au niveau de la détection de conflits.
En effet, ralentir le train décale l&rsquo;ensemble du sillon dans le temps
et augmente la capacité consommée.
La marge doit donc être prise en compte pendant l&rsquo;exploration
pour détecter correctement les conflits.</p><p>Pour plus de difficulté, la marge doit suivre le modèle
<a href=/pdf/MARECO.pdf>MARECO</a>.
La marge n&rsquo;est pas répartie uniformément sur le trajet, mais selon
un calcul qui nécessite de connaître l&rsquo;ensemble du trajet.</p><h4 id=marge-linéaire-exprimée-en-fonction-du-temps-de-parcours>Marge linéaire exprimée en fonction du temps de parcours</h4><p>Pour commencer, le problème est résolu avec une marge linéaire,
c&rsquo;est-à-dire répartie uniformément sur le parcours du train.
La vitesse est simplement multipliée par un facteur constant.</p><p>Les <a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/envelopes_system/ title=enveloppes>enveloppes</a>.
calculées pendant l&rsquo;exploration du graphe ne sont
pas modifiées, celles-ci sont toujours à vitesse maximale.
Mais elles sont accompagnées du facteur de vitesse, qui est utilisé
pour calculer les temps de parcours et les conflits.</p><p>C&rsquo;est seulement quand le chemin est trouvé que la marge est appliquée à
l&rsquo;enveloppe finale. Parce qu&rsquo;il s&rsquo;agit uniquement de multiplication par un
facteur, les conflits ne peuvent pas apparaître ici.</p><h4 id=marge-linéaire-exprimée-en-fonction-de-la-distance>Marge linéaire exprimée en fonction de la distance</h4><p>Le principe ici est généralement similaire, mais avec une difficulté
supplémentaire : le facteur n&rsquo;est pas constant au long du trajet.
En effet, un train roulant à faible vitesse parcours moins de distance
dans un même intervalle de temps qu&rsquo;un train à pleine vitesse.
La vitesse est réduite d&rsquo;un facteur plus faible quand le train
roule moins vite.</p><p>Comme le train ne roule pas à vitesse constante pendant son trajet,
le facteur de vitesse évolue d&rsquo;une arête à l&rsquo;autre.
Cela provoque des courbes de vitesse irrégulières.</p><h4 id=marge-mareco>Marge mareco</h4><p>Il s&rsquo;agit ici exclusivement d&rsquo;un post-traitement, car il est impossible
de calculer une courbe mareco sans connaître l&rsquo;intégralité du trajet.
La détection de conflit pendant l&rsquo;exploration se base exclusivement
sur la courbe avec une marge linéaire.</p><p>Cela implique que des conflits peuvent apparaître pendant cette étape.
Pour les éviter, la procédure suivante est appliquée :</p><ol><li>Une marge est appliquée à la courbe sur l&rsquo;ensemble du trajet
avec l&rsquo;algorithme mareco</li><li>Le premier conflit provoqué par le changement est recherché</li><li>S&rsquo;il existe, <em>l&rsquo;application de mareco sera séparée en deux
intervalles</em>. Le point à la position du conflit est alors fixé
dans l&rsquo;espace-temps par rapport à la courbe avec une marge linéaire,
qui elle ne génère pas de conflit.</li><li>Le procédé est répété itérativement jusqu&rsquo;à une absence de conflit.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-9789474a8d15fe1be9951465d5eb1361>2.3.2.6 - Détails d'implémentation</h1><p>Cette page précise certains détails d&rsquo;implémentation.
Sa lecture n&rsquo;est pas nécessaire pour comprendre les principes
généraux, mais peut aider avant de se plonger dans le code.</p><h4 id=stdcmedgebuilder>STDCMEdgeBuilder</h4><p>Cette classe est utilisée pour simplifier la création d&rsquo;instances de <code>STDCMEdge</code>,
les arêtes du graphe. Celles-ci contiennent de nombreux attributs,
la plupart pouvant être déterminés en fonction du contexte (comme
le nœud précédent). La classe <code>STDCMEdgeBuilder</code> permet de rendre
certains attributs optionnels et en calcule d&rsquo;autres.</p><p>Une fois instancié et paramétré, un <code>EdgeBuilder</code> a deux méthodes :</p><ul><li><p><code>Collection&lt;STDCMEdge> makeAllEdges()</code> permet de créer toutes
les arêtes possibles dans le contexte donné pour une route donnée.
S&rsquo;il y a plusieurs &ldquo;ouvertures&rdquo; entre des blocks d&rsquo;occupation,
une arête est créée par ouverture. Tous les conflits, leurs
évitements et les attributs associés sont déterminés ici.</p></li><li><p><code>STDCMEdge findEdgeSameNextOccupancy(double timeNextOccupancy)</code> :
Cette méthode permet d&rsquo;obtenir l&rsquo;arête passant par une certaine
&ldquo;ouverture&rdquo; (quand elle existe), identifiée ici par le temps
de la prochaine occupation sur la route. Elle est utilisée à chaque
fois qu&rsquo;une arête doit être re-créée dans un contexte différent,
comme pour appliquer une marge ou corriger une discontinuité.
Elle appelle la méthode précédente.</p></li></ul><h3 id=recherche-de-chemin>Recherche de chemin</h3><h4 id=evaluation-des-distances>Evaluation des distances</h4><p>La fonction utilisée pour déterminer la distance (au sens
de la recherche de chemin) détermine quel chemin sera privilégié.
Le chemin obtenu sera toujours le plus court en fonction du critère
donné.</p><p>Ici, deux paramètres sont utilisés : le temps de parcours total
et l&rsquo;heure de départ. Le second a un poids très faible par rapport
au premier, pour sélectionner en priorité le chemin le plus rapide.
Les détails du calcul sont indiqués dans les commentaires des
méthodes concernées.</p><h4 id=heuristiques>Heuristiques</h4><p>L&rsquo;algorithme de recherche de chemin dans le graphe est un A*,
avec une heuristique basée sur les coordonnées géographiques.</p><p>Cependant, la géométrie des infrastructures générées sont arbitraires,
elle ne correspond pas aux distances indiquées sur les voies.
Il est donc possible que, sur ces infrastructures, les chemins
obtenus ne soient pas les plus courts.</p><p>Il est en théorie possible d&rsquo;utiliser cette heuristique pour
déterminer si le chemin en cours d&rsquo;exploration pourra mener à une
solution dont le temps de parcours ne dépasse pas le maximum.
Mais pour la même raison, ajouter ce critère rend STDCM
inutilisable sur les infrastructures générées.
Plus de détails dans
<a href=https://github.com/osrd-project/osrd/issues/2818>cette issue</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0b00093315849c9bfa952c90dbea33c0>2.3.3 - Interface avec la signalisation</h1><p>Cette interface est encore en cours de conception.</p><h4 id=objectifs-et-contraintes>Objectifs et contraintes</h4><p>L&rsquo;interface doit respecter plusieurs critères :</p><ul><li>Les calculs se basent sur le nouveau modèle de signalisation,
avec la notion de réservations d&rsquo;objets capacitaires</li><li>Les sillons générés ne doivent jamais générer de nouveaux conflits :
l&rsquo;interface peut être pessimiste sur les possibilités, mais jamais
plus permissive que la réalité.</li><li>Idéalement, le module de recherche de sillon devrait rester
un bloc indépendant avec un minimum de changements (dans la mesure
du possible).</li></ul><p>L&rsquo;objectif serait donc d&rsquo;interpréter le modèle de signalisation,
pour générer des entrées valides pour le module de recherche
de sillon : un graphe d&rsquo;infrastructure et des intervalles
de disponibilités de sections.</p><h4 id=difficultés>Difficultés</h4><p>La plupart des contraintes établies par la signalisation peuvent
facilement s&rsquo;exprimer sous la forme de sections non disponibles,
sauf dans un cas : le comportement de la signalisation peut dépendre
du chemin emprunté par le train. Pour être capable d&rsquo;exprimer les
disponibilités sur une zone, il peut être nécessaire de devoir
anticiper la direction du train.</p><h4 id=solution-proposée>Solution proposée</h4><p>La proposition est d&rsquo;écrire un nouveau module qui se brancherait au module
de signalisation pour gérer les entrées pour la recherche
de sillon. Il effectuerait un parcours du graphe des itinéraires
pour construire progressivement un graphe avec occupations au bon
format.</p><p>À chaque itinéraire visité, l&rsquo;algorithme regarde jusqu&rsquo;où il est possible
de déterminer l&rsquo;ensemble des occupations, c&rsquo;est-à-dire quel
est le premier signal dont l&rsquo;état dépend du prochain choix
d&rsquo;itinéraire du train. Une arête est alors générée jusqu&rsquo;à ce point,
avec les occupations.</p><p>La partie restante de l&rsquo;itinéraire n&rsquo;est pas encore considérée.
C&rsquo;est seulement lorsque le graphe est exploré un niveau plus loin,
avec l&rsquo;itinéraire suivant, que la fin de l&rsquo;itinéraire précédent
est intégrée. Elle fait alors partie de l&rsquo;arête suivante,
car à ce moment davantage d&rsquo;informations sont disponibles sur le
trajet du train.</p><p>Par exemple :</p><p><img src=example_interface_signaling_1.svg alt="Configuration nécessitant d&amp;rsquo;anticiper"></p><p>Dans cette configuration en BAL3, il est possible de déterminer
l&rsquo;absence de conflit des signaux 1 à 4. Mais l&rsquo;état du signal
5 dépend de l&rsquo;itinéraire emprunté par le train : s&rsquo;il va vers
le haut, le signal 5 affiche un avertissement. Dans le cas
contraire, il affiche un &ldquo;voie libre&rdquo;.</p><p><img src=example_interface_signaling_2.svg alt="Arêtes générées"></p><p>Dans cet exemple, une première arrête est alors générée, allant
du premier signal jusqu&rsquo;à la première incertitude : le point
où le signal 5 est visible.</p><p>Dans un second temps, une nouvelle arête est générée pour chaque itinéraire
accessible depuis la fin du précédent : un vers A, l&rsquo;autre vers B.
La zone entre le signal 5 et l&rsquo;aiguille sera donc dupliquée
entre les deux arêtes, mais les occupations dans cette région seront
différentes.</p><p>Ce graphe peut être généré au fil de l&rsquo;exploration, sans surcoût
initial.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2a332266a38ba0b364467fca3fea9588>3 - APIs</h1><div class=lead>Spécification des interfaces de programmation</div></div><div class=td-content><h1 id=pg-6c6648284a8f498a5c7d1c23b0747863>3.1 - API</h1><div class=lead>Référence pour l&rsquo;API du service API</div><div id=docsy_swagger_ui></div><script>window.onload=function(){const e=SwaggerUIBundle({url:"/openapi/api.yaml",dom_id:"#docsy_swagger_ui",presets:[SwaggerUIBundle.presets.apis,SwaggerUIStandalonePreset]});window.ui=e}</script></div><div class=td-content style=page-break-before:always><h1 id=pg-b82726558bc79465332a6e9c939ccbf4>3.2 - Chartos</h1><div class=lead>Référence pour l&rsquo;API du service Chartos</div><div id=docsy_swagger_ui></div><script>window.onload=function(){const e=SwaggerUIBundle({url:"/openapi/chartos.yaml",dom_id:"#docsy_swagger_ui",presets:[SwaggerUIBundle.presets.apis,SwaggerUIStandalonePreset]});window.ui=e}</script></div><div class=td-content style=page-break-before:always><h1 id=pg-3c08243c3e7bb0294640211d13991640>3.3 - Core</h1><div class=lead>Référence pour l&rsquo;API du service Core</div><div id=docsy_swagger_ui></div><script>window.onload=function(){const e=SwaggerUIBundle({url:"/openapi/core.yaml",dom_id:"#docsy_swagger_ui",presets:[SwaggerUIBundle.presets.apis,SwaggerUIStandalonePreset]});window.ui=e}</script></div><div class=td-content style=page-break-before:always><h1 id=pg-d975f6d361d3dce86194fedde84e54b7>3.4 - Editoast</h1><div class=lead>Référence pour l&rsquo;API du service Editoast</div><div id=docsy_swagger_ui></div><script>window.onload=function(){const e=SwaggerUIBundle({url:"/openapi/editoast.yaml",dom_id:"#docsy_swagger_ui",presets:[SwaggerUIBundle.presets.apis,SwaggerUIStandalonePreset]});window.ui=e}</script></div><div class=td-content style=page-break-before:always><h1 id=pg-c52def2602c6ac6be920ccaddf5c35a0>3.5 - JSON Schemas</h1><script src=https://cdn.rawgit.com/caldwell/renderjson/master/renderjson.js></script><div id=container><h1>Infrastructure</h1></div><script>var infra={};tmp=$.ajax({url:"/schemas/infra_schema.json",async:!1,dataType:"json",success:function(e){infra=e}}),document.getElementById("container").appendChild(renderjson(infra))</script><div id=container2><h1>Rolling Stock</h1></div><script>var rolling_stock={};tmp=$.ajax({url:"/schemas/rolling_stock_schema.json",async:!1,dataType:"json",success:function(e){rolling_stock=e}}),document.getElementById("container2").appendChild(renderjson(rolling_stock))</script><style>#container,#container2{text-shadow:none;background:;padding:1em}.renderjson a{text-decoration:none}.renderjson .disclosure{color:#aa026d;font-size:150%}.renderjson .syntax{color:grey}.renderjson .string{color:#000}.renderjson .number{color:cyan}.renderjson .boolean{color:plum}.renderjson .key{color:#aa026d}.renderjson .keyword{color:#fafad2}.renderjson .object.syntax{color:#20b2aa}.renderjson .array.syntax{color:#ffa07a}</style></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/osrd-project/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2023 Contributeurs à OSRD. Tous droits réservés</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js integrity="sha512-ku2nmBrzAXY5YwohzTqLYH1/lvyMrpTVxgQKrvTabd/b/uesqltLORdmpVapYv6QhZVCLUX6wkvFaKOAY4xpUA==" crossorigin=anonymous></script>
<script src=/js/main.min.5404506dfd9918beab9a633f4e39d532a1f579241ec5d6161a67fa4c13fb47fa.js integrity="sha256-VARQbf2ZGL6rmmM/TjnVMqH1eSQexdYWGmf6TBP7R/o=" crossorigin=anonymous></script>
<script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>