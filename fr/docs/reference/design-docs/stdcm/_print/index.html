<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=fr class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.100.2"><link rel=canonical type=text/html href=https://osrd.fr/fr/docs/reference/design-docs/stdcm/><link rel=alternate type=application/rss+xml href=https://osrd.fr/fr/docs/reference/design-docs/stdcm/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Recherche de sillons de dernière minute (STDCM) | OSRD</title><meta name=description content="OSRD permet d&rsquo;ajouter un nouveau train dans une grille horaire déjà établie,
sans générer aucun conflit avec les autres trains. …"><meta property="og:title" content="Recherche de sillons de dernière minute (STDCM)"><meta property="og:description" content="Open Source Railway Designer"><meta property="og:type" content="website"><meta property="og:url" content="https://osrd.fr/fr/docs/reference/design-docs/stdcm/"><meta property="og:site_name" content="OSRD"><meta itemprop=name content="Recherche de sillons de dernière minute (STDCM)"><meta itemprop=description content="Open Source Railway Designer"><meta name=twitter:card content="summary"><meta name=twitter:title content="Recherche de sillons de dernière minute (STDCM)"><meta name=twitter:description content="Open Source Railway Designer"><link rel=preload href=/scss/main.min.2630e74a757979ae8749757fe871a2cda0da39b3bb48e31e858fd5b3e754a6f7.css as=style><link href=/scss/main.min.2630e74a757979ae8749757fe871a2cda0da39b3bb48e31e858fd5b3e754a6f7.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/fr/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" id="svg36" width="110.767" height="22"><style id="style1">.st9{fill:#fff}</style><g id="ok" transform="scale(.1918)"><g id="g36"><g id="g29"><path id="path23" d="M38.5 83.4c-1.9 8.2-2.9 17-2.9 26.5v4.8h16.6c-2.8-13.2-7.8-23.4-13.7-31.3z" class="st9"/><path id="path24" d="M0 57.5v19.9c3.1 1.2 6.3 2.7 9.5 4.6 8.5 5.2 15 12.6 19.4 21.8v-31c-3.4-3-6.9-5.5-10.3-7.5-6.5-3.7-13-6.2-18.6-7.8z" class="st9"/><path id="path25" d="M35.6 69.9c4.3-11.3 10.6-21.1 18.9-29.4V0H35.6z" class="st9"/><path id="path26" d="M40.8 75.4c5.3 6.2 10.1 13.8 13.7 23.3V50.6C48.6 57.8 44 66.1 40.8 75.4z" class="st9"/><path id="path27" d="M100.7.0H61.3v34.5C73.1 25.2 86 20 96.9 17.2c1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-11.4 2.9-25.3 8.6-37.2 19.7v31.8c2.9-6.3 6.7-11.7 11.4-16.4 9.4-9.3 21-14.1 30.5-16.6 1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-4.7 1.2-10.1 3.1-15.3 6-19 10.3-28.2 28.4-28.2 55.2v4.8h39.3c7.8.0 14.1-6.3 14.1-14.1V14.1C114.7 6.3 108.4.0 100.7.0z" class="st9"/><path id="path28" d="M22 59.6c2.2 1.3 4.5 2.8 6.8 4.6V0H14.1C6.3.0.0 6.3.0 14.1v36.4c6.5 1.7 14.2 4.5 22 9.1z" class="st9"/><path id="path29" d="M5.4 87.5c-1.8-1.1-3.6-2-5.4-2.8v15.9c0 7.8 6.3 14.1 14.1 14.1h11.6c-3.6-12.2-10.4-21.3-20.3-27.2z" class="st9"/></g><g id="g30"><path id="path30" d="M201.7 109c-30.8.0-53.7-21.2-53.7-52.5.0-31.7 22.9-51.6 53.7-51.6 31 0 53.9 20 53.9 51.6-.1 31.3-23 52.5-53.9 52.5zm0-82.6c-16.7.0-28.2 12.8-28.2 30.1.0 17.9 11.6 30.7 28.2 30.7S230 74.4 230 56.6c0-17.3-11.6-30.2-28.3-30.2z" class="st9"/></g><g id="g32"><g id="g31"><path id="path31" d="M334.3 33.3c-4-5.2-11.4-8.5-17.6-8.5-6.2.0-13.8 2.1-13.8 9.9.0 6.6 5.9 8.7 15.2 11.6 13.4 4.3 30.7 10 30.7 29.7.0 22.7-18.3 32.9-37.8 32.9-14.1.0-28.3-5.2-37-14.2l15.6-15.9c4.7 6 13.5 10.5 21.3 10.5 7.3.0 13.7-2.8 13.7-10.7.0-7.5-7.5-9.9-20.5-14.1C291.6 60.3 279 53.9 279 36c0-21.9 19.8-31 38.2-31 11.2.0 23.7 4.2 32.4 12.1z" class="st9"/></g></g><g id="g34"><g id="g33"><path id="path32" d="m433.1 106.4-21.3-39.2h-8.1v39.2h-23.4V7.6H418c19 0 37.8 7.3 37.8 29.9.0 13.3-7.8 22.7-20.5 26.6l25.8 42.3zm-16.9-79.6h-12.7v23h11.3c7.7.0 17.3-2 17.3-12 0-9.2-8.7-11-15.9-11z" class="st9"/></g></g><g id="g35"><path id="path34" d="M522.2 106.4h-36.8V7.6H521c28 0 56.5 11.7 56.5 49.1.0 34.7-28.1 49.7-55.3 49.7zm-1.7-78.5h-11.9v57.8h11.3c17 0 32.8-7 32.8-29 0-22.2-15.8-28.8-32.2-28.8z" class="st9"/></g></g></g></svg></span><span class=font-weight-bold>OSRD</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/fr/about/><span>À propos</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/fr/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/fr/blog/><span>Blog</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Français</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/en/docs/reference/design-docs/stdcm/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Rechercher" aria-label=Rechercher autocomplete=off data-offline-search-index-json-src=/offline-search-index.15b56c262fb61a8ecfeb6d712f741a3b.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Version imprimable multipages.
<a href=# onclick="return print(),!1">Cliquer ici pour imprimer</a>.</p><p><a href=/fr/docs/reference/design-docs/stdcm/>Retour à la version par défaut</a>.</p></div><h1 class=title>Recherche de sillons de dernière minute (STDCM)</h1><ul><li>1: <a href=#pg-5e6a8c58f44ec33565becd41e00148ef>Contexte métier</a></li><li>2: <a href=#pg-43ea4c19a1c68f9d3854a75420fe7d2b>Module de recherche de sillons</a></li><ul><li>2.1: <a href=#pg-00f3695c563557ce911133a4e0d319ff>Description du format d'entrée</a></li><li>2.2: <a href=#pg-0b86147cbfa958e9f4364f4ce2ba795b>Représentation de l'espace de solutions</a></li><li>2.3: <a href=#pg-4cbbf502b73f6a39d1784fb6ef5fc8bf>Discontinuités et retours en arrière</a></li><li>2.4: <a href=#pg-86a0f2f4d5cb5405bb586c1fba4d4c0a>Contourner les conflits</a></li><li>2.5: <a href=#pg-878a5654bd8bd9fb14457386180665c4>Marge de régularité</a></li><li>2.6: <a href=#pg-9789474a8d15fe1be9951465d5eb1361>Détails d'implémentation</a></li></ul><li>3: <a href=#pg-0b00093315849c9bfa952c90dbea33c0>Interface avec la signalisation</a></li></ul><div class=content><p>OSRD permet d&rsquo;ajouter un nouveau train dans une grille horaire déjà établie,
sans générer aucun conflit avec les autres trains. L&rsquo;application directe de cette fonctionnalité
est appelée la <strong>recherche de sillon de dernière minute</strong>.</p><p>L&rsquo;acronyme STDCM (Short Term Digital Capacity Management) est utilisé
pour parler du concept en général.</p></div></div><div class=td-content><h1 id=pg-5e6a8c58f44ec33565becd41e00148ef>1 - Contexte métier</h1><p>Quelques définitions :</p><h3 id=la-capacité>La capacité</h3><p>La <strong>capacité</strong>, dans ce contexte, correspond à la possibilité de
réserver des éléments d&rsquo;infrastructure pour permettre le passage
d&rsquo;un train.</p><p>La capacité s&rsquo;exprime en fonction de l&rsquo;espace et du temps :
la réservation d&rsquo;un élément peut bloquer une zone précise
qui devient inaccessible aux autres trains, et cette réservation
se fait sur un intervalle de temps.</p><p>On peut la représenter
sur un graphique, avec le temps en abscisse et la distance parcourue
sur un chemin en ordonnée.</p><p><img src=space_time_chart.png alt="Graphique espace temps"></p><blockquote><p>Exemple d&rsquo;un graphique espace-temps montrant le passage d&rsquo;un train.</p><p>Les couleurs représentent ici les aspects des signaux, mais
montrent également une consommation de la capacité :
quand ces blocs se superposent pour deux trains, ils sont en conflit.</p></blockquote><p>Deux trains d&rsquo;une grille horaire sont en <strong>conflit</strong>
quand ils réservent en même temps un même objet, dans des
configurations incompatibles.</p><p><img src=conflict.png alt="Graphique espace temps avec conflit"></p><blockquote><p>Exemple d&rsquo;un graphique espace-temps avec conflit : le second train
est plus rapide que le premier, ils sont en conflit sur la fin du trajet,
quand les rectangles se superposent.</p><p>En essayant de simuler cette grille horaire, le second train serait
ralentis par des signaux indiquant de ralentir, provoqués par la
présence du premier train.</p></blockquote><p>La consommation de capacité est souvent représentée sous la forme de
rectangles car, dans les systèmes de signalisation les plus simples,
il s&rsquo;agit de réservations d&rsquo;une zone fixe dans l&rsquo;espace pendant un intervalle de temps donné.</p><h3 id=les-sillons-horaires>Les sillons horaires</h3><p>Un <strong>sillon</strong> correspond à une réservation de capacité pour le
passage d&rsquo;un train. Il est fixé dans l&rsquo;espace et dans le temps :
le temps de départ et le chemin emprunté sont connus.
Sur les graphiques espace-temps de cette page, un sillon correspond
à l&rsquo;ensemble des blocs pour un train.</p><p>Dans un fonctionnement habituel, le gestionnaire d&rsquo;infrastructure
(ex : SNCF Réseau) propose des sillons à la vente pour les entreprises
ferroviaires (ex : SNCF Voyageurs).</p><p>À une date donnée avant le jour de
circulation prévu, tous les sillons sont attribués. Mais <strong>il peut rester
assez de capacité pour faire rouler plus de trains</strong>. Il est
possible de placer des trains entre les sillons déjà établis,
quand ces derniers sont suffisamment espacés ou n&rsquo;ont pas
trouvé d&rsquo;acheteurs.</p><p>La capacité restante après l&rsquo;attribution des sillons est appelée
la <strong>capacité résiduelle</strong>. Le problème traité ici est la recherche
de sillons dans celle-ci.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-43ea4c19a1c68f9d3854a75420fe7d2b>2 - Module de recherche de sillons</h1><p>Ce module gère la recherche de solution.</p><p>Les entrées et sorties sont fortement simplifiées et abstraites
pour simplifier le problème au maximum et permettre des tests efficaces.</p><p>Pour décrire son fonctionnement en quelques phrases :
l&rsquo;espace de solutions est représenté sous forme d&rsquo;un graphe qui encode le temps,
la position et la vitesse. Une recherche de chemin est ensuite effectuée
dans ce graphe pour trouver une solution. Le graphe est calculé
au fil de son exploration.</p><p>Ce graphe peut d&rsquo;une certaine manière être vu comme une forme
d&rsquo;arbre de décision, si différents chemins peuvent mener au même noeud.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-00f3695c563557ce911133a4e0d319ff>2.1 - Description du format d'entrée</h1><p>Ce module prend plusieurs entrées pour effectuer une recherche de chemin :</p><ul><li>Un graphe décrivant l&rsquo;infrastructure physique</li><li>Des zones non disponibles selon des intervalles de temps</li><li>Des points de départ et d&rsquo;arrivée</li><li>Une fenêtre de départ</li><li>Un temps de parcours maximal</li><li>Des données de simulation (matériel roulant, time step, marges, etc)</li></ul><p>Parmi ces entrées, les deux premières méritent d&rsquo;être détaillées.</p><h4 id=graphe-dinfrastructure>Graphe d&rsquo;infrastructure</h4><p>Aujourd&rsquo;hui, le graphe donné en entrée correspond au graphe
des <code>SignalingRoutes</code>. Mais il peut s&rsquo;agir de n&rsquo;importe quel graphe
orienté permettant de naviguer l&rsquo;infrastructure physique.</p><p>Les seules contraintes sont : les arêtes doivent avoir une longueur,
et il doit être possible d&rsquo;effectuer un calcul de marche sur des
sections d&rsquo;arêtes.</p><h4 id=zones-non-disponibles>Zones non disponibles</h4><p>Cette entrée représente les zones inaccessibles à cause de contraintes
de capacité.</p><p>À chaque arête du graphe est associé un ensemble de &ldquo;bloc d&rsquo;occupation&rdquo;.
Un bloc est composé d&rsquo;une distance de début et de fin (relative
au début de l&rsquo;arête), et un temps de début et de fin.
Il est considéré que la <em>tête</em> du train ne peut pas se trouver dans cette
zone dans l&rsquo;intervalle de temps donné.</p><p>Ces blocs encodent également la marge de grille : s&rsquo;il faut rajouter
<code>x</code> secondes de marges avant le train, chaque bloc est agrandi de
<code>x</code> secondes dans un sens.</p><p>Pour donner un exemple, avec la grille horaire suivante, en
supposant une arête par canton, un train de 42m et
une distance de visibilité de 10m :</p><p><img src=unavailable_sections.svg alt="Exemple de sections non disponibles"></p><ul><li><p>L&rsquo;occupation du canton 1 de t=0 à t=300 le rend non disponible
dans sa globalité pendant cette période.</p></li><li><p>Les 10 derniers mètres du canton 1 sont non disponibles de t=300 à t=360,
car le signal en début de canton 2 doit être vert quand le conducteur le voit.
Il est possible de considérer que ce bloc-ci commence à t=130
(quand le canton du signal suivant n&rsquo;affiche plus de vert),
une superposition
de blocs n&rsquo;étant pas problématique.</p></li><li><p>L&rsquo;occupation du canton 2 de t=130 à t=360 le rend non disponible
pendant cette période. Il est également non disponible à partir de
t=0, car la présence d&rsquo;un train provoquerait un avertissement sur
le canton 1 quand il est utilisé par le train déjà planifié.</p></li><li><p>Les 42 premiers mètres du canton 3 sont non disponibles de t=0 à t=360,
car la queue du train doit avoir libéré le second canton.</p></li><li><p>Le reste du canton 3 est non disponible dans sa globalité
de t=280 à t=360.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0b86147cbfa958e9f4364f4ce2ba795b>2.2 - Représentation de l'espace de solutions</h1><h4 id=principe-général>Principe général</h4><p>Le problème reste une recherche de graphe. En représentant
l&rsquo;espace de solution sous forme de graphe, il est possible de réutiliser
nos outils déjà existants de recherche de chemin.</p><p>Le <em>graphe produit</em> de la position, du temps, et de la vitesse est utilisé.
Autrement dit, chaque élément du graphe contient (entre autres) ces
3 variables.</p><p>Chaque arête du graphe est calculée avec un
<a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/ title="calcul de marche">calcul de marche</a>
pour connaître l&rsquo;évolution de la vitesse et de la position dans le temps.</p><h4 id=représentation-visuelle>Représentation visuelle</h4><p>Le graphe de départ représente l&rsquo;infrastructure physique</p><p><img src=routes_time_1.png alt="Graphe produit (1/3)"></p><p>Il est ensuite &ldquo;dupliqué&rdquo; à des temps différents</p><p><img src=routes_time_2.png alt="Graphe produit (2/3)"></p><p>Puis des nœuds sont reliés de manière à refléter le temps de parcours</p><p><img src=routes_time_3.png alt="Graphe produit (3/3)"></p><h4 id=précisions>Précisions</h4><ul><li>Le graphe est construit <em>au fil de l&rsquo;exploration</em>.</li><li>Une discrétisation est faite au niveau du temps, uniquement pour
évaluer ce qui a déjà été visité. Si le même emplacement est visité une
seconde fois, il faut une certaine différence de temps pour estimer
qu&rsquo;il n&rsquo;est pas déjà visité.</li><li>Toutes les arêtes sont réalisées avec des calculs de marche</li><li>La vitesse n&rsquo;est pas discrétisée ni utilisée pour estimer quel
emplacement est déjà visité, mais elle fait partie des calculs.</li><li>Par défaut, tous les calculs sont faits en allant à la vitesse maximale.
Les ralentissements sont ajoutés seulement quand ils sont nécessaires.</li></ul><h4 id=exemple>Exemple</h4><p>Par exemple, avec l&rsquo;infrastructure suivante en se basant sur
le graphe des voies :
<img src=example_infra.svg alt="Infra d&amp;rsquo;exemple"></p><p>Explorer le graphe des sillons possibles peut donner ce
type de résultat :
<img src=example_graph.svg alt="Représentation du graphe"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4cbbf502b73f6a39d1784fb6ef5fc8bf>2.3 - Discontinuités et retours en arrière</h1><h4 id=le-problème-des-discontinuités>Le problème des discontinuités</h4><p>Au moment d&rsquo;explorer une arête du graphe, on effectue un calcul de
marche pour connaître l&rsquo;évolution de la vitesse.
Mais il n&rsquo;est pas possible de voir plus loin que l&rsquo;arête en question,
ce qui est gênant pour calculer les courbes de freinages qui peuvent
nécessiter de commencer à freiner plusieurs kilomètres avant l&rsquo;arrivée.</p><p><img src=discontinuity.png alt=Discontinuité></p><blockquote><p>Cet exemple illustre le problème : par défaut
la première arête est explorée en allant à la vitesse maximale.
C&rsquo;est seulement en explorant la seconde arête que la destination devient visible,
sans que la distance restante soit suffisante pour s&rsquo;arrêter.</p></blockquote><h4 id=la-solution--revenir-en-arrière>La solution : revenir en arrière</h4><p>Pour régler ce problème, lorsqu&rsquo;une arête est générée avec une discontinuité
dans les courbes de vitesse, l&rsquo;algorithme revient sur les arêtes précédentes
pour en créer des nouvelles qui incluent les décélérations.</p><p>Pour donner un exemple simplifié, sur un chemin de 4 routes
où le train peut accélérer ou décélérer de 10km/h par route :</p><p><img src=backtracking_1.png alt="Discontinuité (version arêtes, 1/2)"></p><p>Pour que le train s&rsquo;arrête à la fin de la route 4, il doit être au plus à 10km/h
à la fin de la route 3. Une nouvelle arête est alors créée sur la route
3 qui finit à 10km/h. Une décélération est ensuite calculée à rebours de la fin de la route
vers le début, jusqu&rsquo;à retrouver la courbe d&rsquo;origine (ou le début
de l&rsquo;arrête).</p><p>Dans cet exemple, la discontinuité a seulement été déplacée vers la
transition entre les routes 2 et 3. Le procédé est ensuite réitéré
sur la route 2, ce qui donne le résultat suivant :</p><p><img src=backtracking_2.png alt="Discontinuité (version arêtes, 2/2)"></p><p>Les anciennes arêtes sont toujours présentes dans le graphe, elles
peuvent mener à d&rsquo;autres solutions.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-86a0f2f4d5cb5405bb586c1fba4d4c0a>2.4 - Contourner les conflits</h1><p>En explorant le graphe, il arrive souvent de tomber sur des situations
qui mèneraient à des conflits. Il faut être en mesure de rajouter du délai
pour les éviter.</p><h4 id=décalage-du-temps-de-départ>Décalage du temps de départ</h4><p>Dans les paramètres de l&rsquo;algorithme, le temps de départ est donné
sous la forme d&rsquo;une fenêtre : un temps de départ au plus tôt et au plus tard.
Tant que c&rsquo;est possible, il est toujours préférable de décaler le temps
de départ pour éviter les conflits.</p><blockquote><p>Par exemple : un train doit partir entre 10:00 et 11:00. En partant
à 10:00, cela provoque un conflit, le train doit entrer en gare
d&rsquo;arrivée 15 minutes plus tard. Il suffit de faire partir le train à
10:15 pour régler le problème.</p></blockquote><p>Dans OSRD, cette fonctionnalité est gérée en gardant une trace,
à chaque arête, du décalage maximal du temps de départ qui pourra
être ajouté sur la suite du parcours. Tant que cette valeur est suffisante,
tous les conflits sont évités par ce moyen.</p><p>Le décalage du temps de départ est une valeur stockée sur chaque arête
et additionnée à la fin de la recherche de chemin.</p><blockquote><p>Par exemple :</p><ul><li>un train doit partir entre 10:00 et 11:00. La recherche
commence avec un délai maximal de 1:00.</li><li>Après quelques arêtes, une non-disponibilité est constatée
20 minutes après notre passage. La valeur passe donc à
20 minutes pour la suite du parcours.</li><li>Le temps de départ est ensuite décalé de 5 minutes pour contourner
un conflit, modifiant le décalage maximal à 15 minutes.</li><li>Ce procédé continue jusqu&rsquo;à arriver à la fin du trajet, ou
jusqu&rsquo;au point où il faut ajouter plus de délai.</li></ul></blockquote><h4 id=marges-de-construction>Marges de construction</h4><p>Quand la valeur de décalage maximal du temps de départ tombe à 0,
il faut rajouter du délai entre deux points du parcours du train.</p><p><img src=engineering_allowance.png alt="Marge de construction (1/2)"></p><p>Le principe est le même que pour régler les discontinuités de vitesse :
le graphe est parcouru en arrière pour créer de nouvelles arêtes.</p><p><img src=engineering_allowance_edges.png alt="Marge de construction (2/2)"></p><p>La <a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/allowances/ title=marges>marge de construction</a>
est une fonctionnalité du calcul de marche
permettant d&rsquo;ajouter un délai donné entre deux point du parcours.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-878a5654bd8bd9fb14457386180665c4>2.5 - Marge de régularité</h1><p>Une des fonctionnalités qui doit être supportée par STDCM est la
<a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/allowances/ title="marge de régularité">marge de régularité</a>.
L&rsquo;utilisateur doit pouvoir indiquer une valeur
de marge, exprimée en fonction de la distance ou du temps de parcours,
et cette marge doit être ajoutée au trajet.</p><blockquote><p>Par exemple : l&rsquo;utilisateur peut indiquer une marge de 5 minutes au
100km. Sur un trajet de 42km, un trajet de 10 minutes au plus rapide
doit maintenant durer 12 minutes et 6 secondes.</p></blockquote><p>Le problème se situe au niveau de la détection de conflits.
En effet, ralentir le train décale l&rsquo;ensemble du sillon dans le temps
et augmente la capacité consommée.
La marge doit donc être prise en compte pendant l&rsquo;exploration
pour détecter correctement les conflits.</p><p>Pour plus de difficulté, la marge doit suivre le modèle
<a href=/pdf/MARECO.pdf>MARECO</a>.
La marge n&rsquo;est pas répartie uniformément sur le trajet, mais selon
un calcul qui nécessite de connaître l&rsquo;ensemble du trajet.</p><h4 id=marge-linéaire-exprimée-en-fonction-du-temps-de-parcours>Marge linéaire exprimée en fonction du temps de parcours</h4><p>Pour commencer, le problème est résolu avec une marge linéaire,
c&rsquo;est-à-dire répartie uniformément sur le parcours du train.
La vitesse est simplement multipliée par un facteur constant.</p><p>Les <a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/envelopes_system/ title=enveloppes>enveloppes</a>.
calculées pendant l&rsquo;exploration du graphe ne sont
pas modifiées, celles-ci sont toujours à vitesse maximale.
Mais elles sont accompagnées du facteur de vitesse, qui est utilisé
pour calculer les temps de parcours et les conflits.</p><p>C&rsquo;est seulement quand le chemin est trouvé que la marge est appliquée à
l&rsquo;enveloppe finale. Parce qu&rsquo;il s&rsquo;agit uniquement de multiplication par un
facteur, les conflits ne peuvent pas apparaître ici.</p><h4 id=marge-linéaire-exprimée-en-fonction-de-la-distance>Marge linéaire exprimée en fonction de la distance</h4><p>Le principe ici est généralement similaire, mais avec une difficulté
supplémentaire : le facteur n&rsquo;est pas constant au long du trajet.
En effet, un train roulant à faible vitesse parcours moins de distance
dans un même intervalle de temps qu&rsquo;un train à pleine vitesse.
La vitesse est réduite d&rsquo;un facteur plus faible quand le train
roule moins vite.</p><p>Comme le train ne roule pas à vitesse constante pendant son trajet,
le facteur de vitesse évolue d&rsquo;une arête à l&rsquo;autre.
Cela provoque des courbes de vitesse irrégulières.</p><h4 id=marge-mareco>Marge mareco</h4><p>Il s&rsquo;agit ici exclusivement d&rsquo;un post-traitement, car il est impossible
de calculer une courbe mareco sans connaître l&rsquo;intégralité du trajet.
La détection de conflit pendant l&rsquo;exploration se base exclusivement
sur la courbe avec une marge linéaire.</p><p>Cela implique que des conflits peuvent apparaître pendant cette étape.
Pour les éviter, la procédure suivante est appliquée :</p><ol><li>Une marge est appliquée à la courbe sur l&rsquo;ensemble du trajet
avec l&rsquo;algorithme mareco</li><li>Le premier conflit provoqué par le changement est recherché</li><li>S&rsquo;il existe, <em>l&rsquo;application de mareco sera séparée en deux
intervalles</em>. Le point à la position du conflit est alors fixé
dans l&rsquo;espace-temps par rapport à la courbe avec une marge linéaire,
qui elle ne génère pas de conflit.</li><li>Le procédé est répété itérativement jusqu&rsquo;à une absence de conflit.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-9789474a8d15fe1be9951465d5eb1361>2.6 - Détails d'implémentation</h1><p>Cette page précise certains détails d&rsquo;implémentation.
Sa lecture n&rsquo;est pas nécessaire pour comprendre les principes
généraux, mais peut aider avant de se plonger dans le code.</p><h4 id=stdcmedgebuilder>STDCMEdgeBuilder</h4><p>Cette classe est utilisée pour simplifier la création d&rsquo;instances de <code>STDCMEdge</code>,
les arêtes du graphe. Celles-ci contiennent de nombreux attributs,
la plupart pouvant être déterminés en fonction du contexte (comme
le nœud précédent). La classe <code>STDCMEdgeBuilder</code> permet de rendre
certains attributs optionnels et en calcule d&rsquo;autres.</p><p>Une fois instancié et paramétré, un <code>EdgeBuilder</code> a deux méthodes :</p><ul><li><p><code>Collection&lt;STDCMEdge> makeAllEdges()</code> permet de créer toutes
les arêtes possibles dans le contexte donné pour une route donnée.
S&rsquo;il y a plusieurs &ldquo;ouvertures&rdquo; entre des blocks d&rsquo;occupation,
une arête est créée par ouverture. Tous les conflits, leurs
évitements et les attributs associés sont déterminés ici.</p></li><li><p><code>STDCMEdge findEdgeSameNextOccupancy(double timeNextOccupancy)</code> :
Cette méthode permet d&rsquo;obtenir l&rsquo;arête passant par une certaine
&ldquo;ouverture&rdquo; (quand elle existe), identifiée ici par le temps
de la prochaine occupation sur la route. Elle est utilisée à chaque
fois qu&rsquo;une arête doit être re-créée dans un contexte différent,
comme pour appliquer une marge ou corriger une discontinuité.
Elle appelle la méthode précédente.</p></li></ul><h3 id=recherche-de-chemin>Recherche de chemin</h3><h4 id=evaluation-des-distances>Evaluation des distances</h4><p>La fonction utilisée pour déterminer la distance (au sens
de la recherche de chemin) détermine quel chemin sera privilégié.
Le chemin obtenu sera toujours le plus court en fonction du critère
donné.</p><p>Ici, deux paramètres sont utilisés : le temps de parcours total
et l&rsquo;heure de départ. Le second a un poids très faible par rapport
au premier, pour sélectionner en priorité le chemin le plus rapide.
Les détails du calcul sont indiqués dans les commentaires des
méthodes concernées.</p><h4 id=heuristiques>Heuristiques</h4><p>L&rsquo;algorithme de recherche de chemin dans le graphe est un A*,
avec une heuristique basée sur les coordonnées géographiques.</p><p>Cependant, la géométrie des infrastructures générées sont arbitraires,
elle ne correspond pas aux distances indiquées sur les voies.
Il est donc possible que, sur ces infrastructures, les chemins
obtenus ne soient pas les plus courts.</p><p>Il est en théorie possible d&rsquo;utiliser cette heuristique pour
déterminer si le chemin en cours d&rsquo;exploration pourra mener à une
solution dont le temps de parcours ne dépasse pas le maximum.
Mais pour la même raison, ajouter ce critère rend STDCM
inutilisable sur les infrastructures générées.
Plus de détails dans
<a href=https://github.com/osrd-project/osrd/issues/2818>cette issue</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0b00093315849c9bfa952c90dbea33c0>3 - Interface avec la signalisation</h1><p>Cette interface est encore en cours de conception.</p><h4 id=objectifs-et-contraintes>Objectifs et contraintes</h4><p>L&rsquo;interface doit respecter plusieurs critères :</p><ul><li>Les calculs se basent sur le nouveau modèle de signalisation,
avec la notion de réservations d&rsquo;objets capacitaires</li><li>Les sillons générés ne doivent jamais générer de nouveaux conflits :
l&rsquo;interface peut être pessimiste sur les possibilités, mais jamais
plus permissive que la réalité.</li><li>Idéalement, le module de recherche de sillon devrait rester
un bloc indépendant avec un minimum de changements (dans la mesure
du possible).</li></ul><p>L&rsquo;objectif serait donc d&rsquo;interpréter le modèle de signalisation,
pour générer des entrées valides pour le module de recherche
de sillon : un graphe d&rsquo;infrastructure et des intervalles
de disponibilités de sections.</p><h4 id=difficultés>Difficultés</h4><p>La plupart des contraintes établies par la signalisation peuvent
facilement s&rsquo;exprimer sous la forme de sections non disponibles,
sauf dans un cas : le comportement de la signalisation peut dépendre
du chemin emprunté par le train. Pour être capable d&rsquo;exprimer les
disponibilités sur une zone, il peut être nécessaire de devoir
anticiper la direction du train.</p><h4 id=solution-proposée>Solution proposée</h4><p>La proposition est d&rsquo;écrire un nouveau module qui se brancherait au module
de signalisation pour gérer les entrées pour la recherche
de sillon. Il effectuerait un parcours du graphe des itinéraires
pour construire progressivement un graphe avec occupations au bon
format.</p><p>À chaque itinéraire visité, l&rsquo;algorithme regarde jusqu&rsquo;où il est possible
de déterminer l&rsquo;ensemble des occupations, c&rsquo;est-à-dire quel
est le premier signal dont l&rsquo;état dépend du prochain choix
d&rsquo;itinéraire du train. Une arête est alors générée jusqu&rsquo;à ce point,
avec les occupations.</p><p>La partie restante de l&rsquo;itinéraire n&rsquo;est pas encore considérée.
C&rsquo;est seulement lorsque le graphe est exploré un niveau plus loin,
avec l&rsquo;itinéraire suivant, que la fin de l&rsquo;itinéraire précédent
est intégrée. Elle fait alors partie de l&rsquo;arête suivante,
car à ce moment davantage d&rsquo;informations sont disponibles sur le
trajet du train.</p><p>Par exemple :</p><p><img src=example_interface_signaling_1.svg alt="Configuration nécessitant d&amp;rsquo;anticiper"></p><p>Dans cette configuration en BAL3, il est possible de déterminer
l&rsquo;absence de conflit des signaux 1 à 4. Mais l&rsquo;état du signal
5 dépend de l&rsquo;itinéraire emprunté par le train : s&rsquo;il va vers
le haut, le signal 5 affiche un avertissement. Dans le cas
contraire, il affiche un &ldquo;voie libre&rdquo;.</p><p><img src=example_interface_signaling_2.svg alt="Arêtes générées"></p><p>Dans cet exemple, une première arrête est alors générée, allant
du premier signal jusqu&rsquo;à la première incertitude : le point
où le signal 5 est visible.</p><p>Dans un second temps, une nouvelle arête est générée pour chaque itinéraire
accessible depuis la fin du précédent : un vers A, l&rsquo;autre vers B.
La zone entre le signal 5 et l&rsquo;aiguille sera donc dupliquée
entre les deux arêtes, mais les occupations dans cette région seront
différentes.</p><p>Ce graphe peut être généré au fil de l&rsquo;exploration, sans surcoût
initial.</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/osrd-project/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Contributeurs à OSRD. Tous droits réservés</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin=anonymous></script><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.928c8c2d8b4f463998503da833bc465b748d40b80287e0398a7e1a38ab1c87a2.js integrity="sha256-koyMLYtPRjmYUD2oM7xGW3SNQLgCh+A5in4aOKsch6I=" crossorigin=anonymous></script></body></html>