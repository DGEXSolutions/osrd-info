<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=fr class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.100.2"><link rel=canonical type=text/html href=https://osrd.fr/fr/docs/><link rel=alternate type=application/rss+xml href=https://osrd.fr/fr/docs/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Documentation | OSRD</title><meta name=description content="Vous souhaitez utiliser OSRD, y contribuer, ou simplement en comprendre le fonctionnement ? Cette documentation est pour vous !
"><meta property="og:title" content="Documentation"><meta property="og:description" content="Open Source Railway Designer"><meta property="og:type" content="website"><meta property="og:url" content="https://osrd.fr/fr/docs/"><meta property="og:image" content="https://osrd.fr/fr/docs/_print/featured-background.jpg"><meta property="og:site_name" content="OSRD"><meta itemprop=name content="Documentation"><meta itemprop=description content="Open Source Railway Designer"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://osrd.fr/fr/docs/_print/featured-background.jpg"><meta name=twitter:title content="Documentation"><meta name=twitter:description content="Open Source Railway Designer"><link rel=preload href=/scss/main.min.f03845650927da20a5e2e1fdc5e543de4fa1a463e0acedaca071fac4e82a8bf4.css as=style><link href=/scss/main.min.f03845650927da20a5e2e1fdc5e543de4fa1a463e0acedaca071fac4e82a8bf4.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/fr/><span class=navbar-logo><svg id="Calque_1" data-name="Calque 1" viewBox="0 0 64 64" sodipodi:docname="logo_osrd_seul_blanc.svg" width="64" height="64" inkscape:version="1.1.2 (0a00cf5339, 2022-02-04)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="3440" inkscape:window-height="1380" id="namedview47" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="3.0016455" inkscape:cx="12.992873" inkscape:cy="71.294228" inkscape:window-x="0" inkscape:window-y="32" inkscape:window-maximized="1" inkscape:current-layer="Calque_1" inkscape:pagecheckerboard="0"/><defs id="defs4"><style id="style2">.cls-1,.cls-2,.cls-3,.cls-4,.cls-7{fill:none;stroke-linecap:round;stroke-linejoin:round}.cls-1,.cls-4{stroke:#aa026d}.cls-1,.cls-2{stroke-width:10px}.cls-2,.cls-3{stroke:#71196f}.cls-3,.cls-4{stroke-width:5px}.cls-5,.cls-6{font-size:119.48px}.cls-5{fill:#71196f;font-family:AvenirLTStd-Heavy,Avenir LT Std}.cls-6{fill:#aa026d;font-family:AvenirLTStd-Medium,Avenir LT Std}.cls-7{stroke:#fff;stroke-width:.75px}</style></defs><title id="title6">logo-OSRD_</title><g id="g847" transform="matrix(0.09645818,0,0,0.09645818,7.1489968,-1.215e-6)"><path inkscape:connector-curvature="0" class="cls-1" d="m389.52 658.5v-88c0-199.26-91.83-331.42-279.82-362" id="path8" style="stroke:#f2f2f2;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-1" d="m298.5 658.5v-87.07c0-156.89-75.34-258.73-229.71-276" id="path10" style="stroke:#f2f2f2;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-2" d="m216.77 658.5v-70.49c0-121.76-58.68-200.64-178.91-213.6" id="path12" style="stroke:#a0a0a0;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-2" d="M125.74 658.5V617.36C125.74 533.21 86.13 478 5 466.95" id="path14" style="stroke:#a0a0a0;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-2" d="m125.74 658.5v-88c0-199.26 91.84-331.42 279.83-362" id="path16" style="stroke:#a0a0a0;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-2" d="m216.77 658.5v-87.07c0-156.89 75.34-258.73 229.71-276" id="path18" style="stroke:#a0a0a0;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-1" d="m298.5 658.5v-70.49c0-121.76 58.68-200.64 178.91-213.6" id="path20" style="stroke:#f2f2f2;stroke-opacity:1"/><path inkscape:connector-curvature="0" class="cls-1" d="m389.52 658.5v-41.14c0-84.15 39.62-139.36 120.75-150.41" id="path22" style="stroke:#f2f2f2;stroke-opacity:1"/><line class="cls-3" x1="126" y1="642.5" x2="126" y2="122.5" id="line24" style="stroke:#a0a0a0;stroke-opacity:1"/><line class="cls-3" x1="217" y1="642.5" x2="217" y2="2.5" id="line26" style="stroke:#a0a0a0;stroke-opacity:1"/><line class="cls-4" x1="299" y1="642.5" x2="299" y2="2.5" id="line28" style="stroke:#f7f7f7;stroke-opacity:1"/><line class="cls-4" x1="390" y1="642.5" x2="390" y2="122.5" id="line30" style="stroke:#f2f2f2;stroke-opacity:1"/></g></svg></span><span class=font-weight-bold>OSRD</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/fr/about/><span>À propos</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/fr/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/fr/blog/><span>Blog</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Français</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/en/docs/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Rechercher" aria-label=Rechercher autocomplete=off data-offline-search-index-json-src=/offline-search-index.462b56d3e1e57121fe9cadd0d42b1a37.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>Version imprimable multipages.
<a href=# onclick="return print(),!1">Cliquer ici pour imprimer</a>.</p><p><a href=/fr/docs/>Retour à la version par défaut</a>.</p></div><h1 class=title>Documentation</h1><ul><li>1: <a href=#pg-484aa42ba43d88e768565b44eb3155b7>Tutoriels</a></li><ul></ul><li>2: <a href=#pg-0064012a1450ecd948522bf83fe7b26a>Explications</a></li><ul><li>2.1: <a href=#pg-5f32d80477ead6a736f223bec2203025>Données d'infrastructure</a></li><li>2.2: <a href=#pg-1fb257de0b4d19a8a1b31c950ac27f16>Calcul de marche</a></li><ul><li>2.2.1: <a href=#pg-61cab231921ddee36c8a138e2a6605b8>Modélisation physique</a></li><li>2.2.2: <a href=#pg-e1f75b5e8521a11c3f55859a7e224607>Intégration numérique</a></li><li>2.2.3: <a href=#pg-8adca5807826313222b06ebdda200d27>Le système d'enveloppes</a></li><li>2.2.4: <a href=#pg-396e33d6479b448e3938369013852b4a>Le processus de calcul de marche</a></li><li>2.2.5: <a href=#pg-aa03910eecb13f5d3e9053a632348bc2>Les marges</a></li></ul></ul><li>3: <a href=#pg-7fc460a5aae16da64f26856e729d27cc>Guides pratiques</a></li><ul><li>3.1: <a href=#pg-d15f2fe4998ef00156d730fe852f9a26>Contribuer à OSRD</a></li><ul><li>3.1.1: <a href=#pg-987ae2aead487e6aad8654531bf0e679>Signaler des problèmes</a></li><li>3.1.2: <a href=#pg-36fd9d9c7b9062f338d5605e7f31eec2>Contribuer du code</a></li><li>3.1.3: <a href=#pg-4b20998c4cff1069b7056c902d0828a6>Conventions</a></li><li>3.1.4: <a href=#pg-bb9e59bd21eff9466389bb1ebb38e3bd>Passer du code en revue</a></li></ul></ul><li>4: <a href=#pg-832f909b334141dbaf6f1870b993b367>Référence technique</a></li><ul><li>4.1: <a href=#pg-b5e4bdbf196beb2ab115d04daf58146b>Architecture</a></li><ul><li>4.1.1: <a href=#pg-21c6725e49c5e2766b8042790b5db698>Flux des données</a></li><li>4.1.2: <a href=#pg-edf52d1d45d4337614b654cb14e38066>Services</a></li></ul><li>4.2: <a href=#pg-4f5886dd5946f64520e4862a078500b8>Documents de conception</a></li><ul><li>4.2.1: <a href=#pg-7f1a0daf0354ed2b782628a3f5c6f5c4>Poste d'aiguillage</a></li><ul><li>4.2.1.1: <a href=#pg-ee6003e9414db3f0e05978636a844345>Éléments mobiles</a></li><li>4.2.1.2: <a href=#pg-f9ae9ad8e8b03f8f0fcbef3b7d4be0b9>Localisation</a></li><li>4.2.1.3: <a href=#pg-102b27462f1d7abc5a5824a7ba5d0b82>Reservation</a></li><li>4.2.1.4: <a href=#pg-db83f9bbda0f6a9be54f5872c94185f4>Routage</a></li><li>4.2.1.5: <a href=#pg-d84f7d18068af2c677e12c6761184b2f>Ordonnancement</a></li><li>4.2.1.6: <a href=#pg-7430cbed022a567839d982205fb6211d>Train</a></li></ul><li>4.2.2: <a href=#pg-91414828f61d97b52f2ae39b3f79bf94>Signalisation</a></li><li>4.2.3: <a href=#pg-2a67b560f64e237130e37a54280c81f6>Recherche de sillons de dernière minute (STDCM)</a></li><ul><li>4.2.3.1: <a href=#pg-5e6a8c58f44ec33565becd41e00148ef>Contexte métier</a></li><li>4.2.3.2: <a href=#pg-43ea4c19a1c68f9d3854a75420fe7d2b>Module de recherche de sillons</a></li><ul><li>4.2.3.2.1: <a href=#pg-00f3695c563557ce911133a4e0d319ff>Description du format d'entrée</a></li><li>4.2.3.2.2: <a href=#pg-0b86147cbfa958e9f4364f4ce2ba795b>Représentation de l'espace de solutions</a></li><li>4.2.3.2.3: <a href=#pg-4cbbf502b73f6a39d1784fb6ef5fc8bf>Discontinuités et retours en arrière</a></li><li>4.2.3.2.4: <a href=#pg-86a0f2f4d5cb5405bb586c1fba4d4c0a>Contourner les conflits</a></li><li>4.2.3.2.5: <a href=#pg-878a5654bd8bd9fb14457386180665c4>Marge de régularité</a></li><li>4.2.3.2.6: <a href=#pg-9789474a8d15fe1be9951465d5eb1361>Détails d'implémentation</a></li></ul><li>4.2.3.3: <a href=#pg-0b00093315849c9bfa952c90dbea33c0>Interface avec la signalisation</a></li></ul></ul><li>4.3: <a href=#pg-2a332266a38ba0b364467fca3fea9588>APIs</a></li><ul><li>4.3.1: <a href=#pg-6c6648284a8f498a5c7d1c23b0747863>API</a></li><li>4.3.2: <a href=#pg-b82726558bc79465332a6e9c939ccbf4>Chartos</a></li><li>4.3.3: <a href=#pg-3c08243c3e7bb0294640211d13991640>Core</a></li><li>4.3.4: <a href=#pg-d975f6d361d3dce86194fedde84e54b7>Editoast</a></li><li>4.3.5: <a href=#pg-c52def2602c6ac6be920ccaddf5c35a0>JSON Schemas</a></li><ul></ul></ul></ul><li>5: <a href=#pg-7a585f383d81df4336087f08f7141938>Wiki Ferroviaire</a></li><ul><li>5.1: <a href=#pg-9767a159f160b01b0c4769a4188a4a71>Glossaire</a></li><ul></ul><li>5.2: <a href=#pg-b8498fef395f671d9c20ef3d378cbf84>Signalisation</a></li><ul><li>5.2.1: <a href=#pg-0242f111128bfeecd8a15f62e48fed99>Les risques ferroviaires</a></li><ul></ul><li>5.2.2: <a href=#pg-816196fb20330c2d2e5cc330e95068f2>Les signaux</a></li><ul></ul><li>5.2.3: <a href=#pg-3e88a74c4b63b0388ddd2014235fd061>Les régimes d’exploitation des lignes</a></li><ul><li>5.2.3.1: <a href=#pg-4553310b37b0f2879067a1ff6377a00b>Les lignes à une seule voie</a></li><ul><li>5.2.3.1.1: <a href=#pg-d04b616249d69417d9463a69fe2ebd94>La voie unique</a></li><li>5.2.3.1.2: <a href=#pg-672f32830266b0c52e2bc79901384f62>La voie unique à signalisation simplifiée (VUSS)</a></li><li>5.2.3.1.3: <a href=#pg-b6fee3b4e749fe1de7e2a7eeffc625c0>La voie unique à trafic restreint (VUTR)</a></li><li>5.2.3.1.4: <a href=#pg-0ff65d5051367f2b61cb55feb2bff978>L’exploitation en navette</a></li><li>5.2.3.1.5: <a href=#pg-62525524c01cf2d4c85bca48aaa460a7>La voie banalisée</a></li></ul><li>5.2.3.2: <a href=#pg-48dc1dd207490ac055b30be6533083df>La double voie</a></li><ul><li>5.2.3.2.1: <a href=#pg-f03636b6aca18721edac60c4b7f52941>Les installations de contresens (ICS)</a></li><li>5.2.3.2.2: <a href=#pg-f1b4a742a904e1621e55646fe6046843>La voie unique temporaire à caractère permanent (VUTP)</a></li><li>5.2.3.2.3: <a href=#pg-6d17688af3b127a1d4343b09d6d4d57f>La voie unique temporaire (VUT)</a></li><li>5.2.3.2.4: <a href=#pg-8b3cf8b8935791d7f9ff6566c734c620>Mouvement à contre-voie</a></li></ul></ul><li>5.2.4: <a href=#pg-4226b00c3d9290eac2107f26e66081a0>Les systèmes d'espacement des trains</a></li><ul><li>5.2.4.1: <a href=#pg-36329fee32fa9963fa1ddf7ec4c614f7>BA</a></li><ul><li>5.2.4.1.1: <a href=#pg-08b5addab59fe72a885332dbf065460a>BAL</a></li><li>5.2.4.1.2: <a href=#pg-b5e7441819b3b64284fbe4d4e890de77>BAPR</a></li></ul><li>5.2.4.2: <a href=#pg-89e71c403e165f25cd4f5d4d5f242194>ERTMS</a></li><ul><li>5.2.4.2.1: <a href=#pg-b91b9453a9d5ab3d563706ebc34c7d43>ETCS</a></li><li>5.2.4.2.2: <a href=#pg-6988544024b60acd07fb520b7bfc0e09>GSM-R</a></li><li>5.2.4.2.3: <a href=#pg-012e5ac62f6e0b2510c489c37be9be3c>GPRS</a></li><li>5.2.4.2.4: <a href=#pg-9280c524af6ef8f312009fd261a14b08>FRMCS</a></li><li>5.2.4.2.5: <a href=#pg-838697130cc09115244a64c389c36a13>ETML</a></li></ul></ul></ul></ul></ul><div class=content><p>Vous souhaitez utiliser OSRD, y contribuer, ou simplement en comprendre le fonctionnement ? Cette documentation est pour vous !</p></div></div><div class=td-content><h1 id=pg-484aa42ba43d88e768565b44eb3155b7>1 - Tutoriels</h1><div class=lead>Guides pas-à-pas et de bout en bout</div><p>Les tutoriels vous guident pas-à-pas et de bout en bout dans votre découverte de l&rsquo;application. Commencez par là si vous débutez avec OSRD.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0064012a1450ecd948522bf83fe7b26a>2 - Explications</h1><div class=lead>Comprendre les concepts clés</div><p>Les explications abordent des thèmes et concepts clés d’un point de vue général et fournissent des informations et explications détaillées sur les éléments fondamentaux.</p></div><div class=td-content><h1 id=pg-5f32d80477ead6a736f223bec2203025>2.1 - Données d'infrastructure</h1><div class=lead>Explique par l&rsquo;exemple comment les données d&rsquo;infrastructure sont structurées</div><font color=#aa026d><h3 id=introduction>Introduction</h3></font><p>Cette page donne un exemple de la manière dont les formats de données sont utilisés pour décrire une infrastructure dans <strong>OSRD</strong>.</p><p>À cette fin, prenons comme exemple l&rsquo;infrastructure-jouet suivante :</p><p><img src=svg_diagrams/small_infra_diagram.drawio.svg alt="Diagramme de l&amp;rsquo;Infrastructure"></p><div class="alert alert-info" role=alert><h4 class=alert-heading>Conseil</h4>Pour zoomer sur un diagramme, cliquez sur le bouton d&rsquo;édition qui apparaît au survol de celui-ci.</div><p>Ce diagramme est un aperçu de l&rsquo;infrastructure avec les lignes et les stations uniquement.</p><p>Cette infrastructure ne se veut pas réaliste, mais plutôt destinée à illustrer le modèle de données de l&rsquo;OSRD.
Cet exemple sera créé étape par étape et expliqué en cours de route.</p><h4 id=le-générateur-dinfrastructures>Le générateur d&rsquo;infrastructures</h4><p>Dans le <a href=https://github.com/osrd-project/osrd>dépôt <em>OSRD</em></a> se trouve une <a href=https://github.com/osrd-project/osrd/tree/dev/core/examples/generated>bibliothèque python</a> conçue pour aider à générer des infrastructures dans un format compris par <em>OSRD</em>.</p><p>L&rsquo;infrastructure discutée dans cette section peut être générée grâce au fichier <a href=https://github.com/osrd-project/osrd/blob/dev/core/examples/generated/scripts/small_infra.py>small_infra.py</a>. Pour en savoir plus sur les scripts de génération, vous pouvez consulter le <a href=https://github.com/osrd-project/osrd/blob/dev/core/examples/generated/README.md>README</a> correspondant.</p><font color=#aa026d><h3 id=pistes>Pistes</h3></font><h4 id=sections-de-piste-track-sections>Sections de piste (Track Sections)</h4><p>Les premiers objets que nous devons définir sont les <code>TrackSections</code>. La plupart des autres objets sont positionnés par rapport aux sections de voie.</p><p>Une section de voie est une section de rail (sans les aiguillages). On peut choisir de diviser les voies de son infrastructure en autant de sections qu&rsquo;on le souhaite. Ici, nous avons choisi d&rsquo;utiliser les sections de voie les plus longues possibles, ce qui signifie qu&rsquo;entre deux aiguillages, il y a toujours une seule section de voie.</p><p>Les sections de voie sont ce sur quoi les trains simulés roulent. Ils sont l&rsquo;équivalent abstrait des sections de rails physiques. Les sections de voie sont bidirectionnelles.</p><p>Dans cet exemple, nous définissons deux voies pour la ligne entre les stations Ouest et Nord-Est. Nous avons également des voies de contournement aux stations Nord et Centre-Ouest pour plus de réalisme. Enfin, nous avons trois voies distinctes dans la station Ouest, puisqu&rsquo;il s&rsquo;agit d&rsquo;une plaque tournante majeure dans notre infrastructure imaginaire.</p><p><img src=svg_diagrams/small_infra_rails.drawio.en.svg alt="Diagramme des sections de voies"></p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><p>Les <code>TrackSections</code> sont représentées par des flèches dans ce diagramme pour souligner le fait qu&rsquo;elles ont un <strong>début</strong> et une <strong>fin</strong>. C&rsquo;est important car les objets positionnés sur les sections de voie sont localisés en fonction de leur distance par rapport au <strong>début</strong> de leur section de voie.</p><p>Par conséquent, pour placer un objet au début de sa section de piste, définissez son décalage à 0. Pour le déplacer à la fin de sa section de piste, définissez son décalage à la <code>length</code> de la section de piste.</p></div><p>Ces attributs sont nécessaires pour que la section de voie soit complète :</p><ul><li><code>length</code> : la longueur de la section de piste en mètres.</li><li><code>geo</code> : les coordonnées dans la vie réelle (geo pour géographique), au format <a href=https://en.wikipedia.org/wiki/GeoJSON>GeoJSON</a>.</li><li><code>sch</code> : les coordonnées dans la vue schématique (sch pour schematic), également au format <a href=https://en.wikipedia.org/wiki/GeoJSON>GeoJSON</a>.</li><li>attributs cosmétiques : <code>line_name</code>, <code>track_name</code>, <code>track_number</code> qui sont utilisés pour indiquer le nom et les étiquettes qui ont été donnés aux pistes / lignes dans la vie réelle.</li></ul><p>Pour toutes les sections de voies de notre infrastructure, les attributs <code>geo</code> et <code>sch</code> sont identiques, et ressemblent beaucoup au schéma donné.</p><p>Pour la plupart des sections de voies, leur &ldquo;longueur&rdquo; est proportionnelle à ce que l&rsquo;on peut voir sur le diagramme. Pour préserver la lisibilité, des exceptions ont été faites pour <em>TA6</em>, <em>TA7</em>, <em>TD0</em> et <em>TD1</em> (qui font 10km et 25km).</p><h4 id=liens-de-sections-de-voies>Liens de sections de voies</h4><p>Pour le moment, nous n&rsquo;avons créé que des sections de voies, qui ne sont pas connectées entre elles (les données géospatiales ne sont pas utilisées pour déduire quelles voies sont connectées).</p><p>Les <code>TrackSectionLinks</code> sont utilisés pour connecter deux sections de voie ensemble, tout comme un joint de soudure le ferait dans la vie réelle. Dans une simulation OSRD, un train ne peut passer d&rsquo;une section de voie à une autre que si elles sont reliées par un <code>TrackSectionLink</code> (ou par un <code>Switch</code>).</p><p>Pour connecter plus de deux <code>TrackSections</code> ensemble, utilisez les <a href=#aiguillages><code>Switches</code></a>.</p><p>Dans notre infrastructure, comme nous avons choisi d&rsquo;avoir des sections de voie aussi longues que possible, nous n&rsquo;avons pas besoin d&rsquo;utiliser les <code>TrackSectionLinks</code>.
Les <code>TrackSectionLinks</code> sont toujours optionnels : deux sections de voies reliées par un lien se comportent comme une seule section de voie.</p><h4 id=aiguillages>Aiguillages</h4><p>Un <code>Switch</code> représente ce à quoi vous vous attendez : des aiguillages ferroviaires.</p><p>Les aiguillages peuvent être vus comme une collection de liens de sections de voies, partitionnés en groupes. Chaque groupe représente un état de l&rsquo;aiguillage. L&rsquo;aiguillage d&rsquo;un groupe peut prendre du temps, et au maximum un lien peut être prêt à être utilisé à la fois.</p><p>Dans le monde réel, les aiguillages ne sont pas uniques, mais plutôt des instances de modèles existants.
Ainsi, les liens et les groupes ne font pas partie du switch lui-même, mais d&rsquo;un objet <code>SwitchType</code>, qui est partagé par les switches du même modèle.</p><h5 id=types-daiguilles>Types d&rsquo;aiguilles</h5><p>Les <code>SwitchTypes</code> ont deux attributs obligatoires :</p><ul><li><code>ports</code> : Une liste de noms de ports. Un port est un point d&rsquo;extrémité qui peut être connecté à une section de voie.</li><li><code>groups</code> : Une correspondance entre les noms de groupes et les listes de liens entre deux ports.</li></ul><p>A tout moment, toutes les aiguilles ont un groupe actif, et peuvent avoir un lien actif, qui appartient toujours au groupe actif. S&rsquo;il y a un lien actif, il est actif dans une direction donnée. Pendant une simulation, le changement de lien actif à l&rsquo;intérieur d&rsquo;un groupe est instantané, mais le changement de lien actif entre les groupes prend un temps configurable.
Ceci est dû au fait qu&rsquo;un switch est un objet physique, et que le changement de lien actif peut impliquer le déplacement de certaines de ses parties. Les <code>Groupes</code> sont conçus pour représenter les différentes positions qu&rsquo;un switch peut avoir. Chaque <code>groupe</code> contient les liens qui peuvent être utilisés dans la position du switch associé.</p><p>La durée nécessaire pour changer de groupe est stockée à l&rsquo;intérieur du <code>Switch</code>, car elle peut varier en fonction de l&rsquo;implémentation physique de l&rsquo;interrupteur.</p><p>Nos exemples utilisent actuellement trois types de switch. Les types d&rsquo;interrupteurs sont comme les autres objets, et peuvent facilement être ajoutés si nécessaire.</p><p><strong>1) L&rsquo;aiguillage</strong></p><p>L&rsquo;omniprésent aiguillage en Y, qui peut être considéré comme la fusion de deux voies ou la séparation d&rsquo;une voie.</p><p>Ce type d&rsquo;aiguillage possède trois ports : <em>base</em>, <em>gauche</em> et <em>droite</em>.</p><p><img src=svg_diagrams/point_switch.en.svg alt="Diagramme d&amp;rsquo;aiguillage"></p><p>Il y a deux groupes, chacun avec une connexion dans leur liste : <code>LEFT</code>, qui connecte <em>base</em> à <em>gauche</em>, et <code>RIGHT</code> qui connecte <em>base</em> à <em>droite</em>.</p><p>Ainsi, à tout moment, un train peut aller de la <em>base</em> à la <em>gauche</em> ou de la <em>base</em> à la <em>droite</em> mais jamais aux deux en même temps. Un train ne peut pas aller de <em>gauche</em> à <em>droite</em>.</p><p>Un aiguillage n&rsquo;a que deux positions :</p><p><img src=svg_diagrams/point_switch_positions.en.svg alt="Diagramme des positions de l&amp;rsquo;aiguillage"></p><p><strong>2) L&rsquo;aiguillage de croisement</strong></p><p>Il s&rsquo;agit simplement de deux voies qui se croisent.</p><p>Ce type a quatre ports : <em>nord</em>, <em>sud</em>, <em>est</em> et <em>ouest</em>.</p><p><img src=svg_diagrams/cross_switch.en.svg alt="Diagramme de l&amp;rsquo;aiguillage croisé"></p><p>Il ne comporte qu&rsquo;un seul groupe contenant deux connexions : <em>nord</em> vers <em>sud</em> et <em>ouest</em> vers <em>est</em>. En effet, ce type d&rsquo;interrupteur est <em>passif</em> : il n&rsquo;a pas de pièces mobiles. Bien qu&rsquo;il n&rsquo;ait qu&rsquo;un seul groupe, il est tout de même utilisé par la simulation pour faire respecter les réservations de route.</p><p>Voici les deux connexions différentes que ce type d&rsquo;interrupteur possède :</p><p><img src=svg_diagrams/cross_switch_positions.en.svg alt="Diagramme des positions des aiguilles croisés"></p><p><strong>3) L&rsquo;interrupteur en croix double</strong></p><p>Celui-ci ressemble plus à deux interrupteurs à pointe dos à dos. Il possède quatre ports : <em>sud1</em>, <em>sud2</em>, <em>nord1</em> et <em>nord2</em>.</p><p><img src=../svg_diagrammes/double_cross_switch.en.svg alt="Diagramme d&amp;rsquo;un interrupteur à double croix"></p><p>Cependant, il comporte quatre groupes, chacun avec une connexion. Les quatre groupes sont représentés dans le diagramme suivant :</p><p><img src=../svg_diagrammes/double_cross_switch_positions.en.svg alt="Diagramme des positions de l&amp;rsquo;interrupteur croisé double"></p><h5 id=retour-aux-aiguilles>Retour aux aiguilles</h5><p>Un <code>Switch</code> possède trois attributs :</p><ul><li><code>switch_type</code> : l&rsquo;identifiant <a href=#types-daiguilles><code>SwitchType</code></a> de cette aiguille.</li><li><code>ports</code> : une correspondance entre les noms de port et les extrémités des sections de piste.</li><li><code>group_change_delay</code> : le temps qu&rsquo;il faut pour changer le groupe de l&rsquo;aiguillage qui est activé.</li></ul><p>Les noms des ports doivent correspondre aux ports du type d&rsquo;aiguillage choisi. Les extrémités de la section de voie peuvent être de début ou de fin, faites attention à choisir les bonnes.</p><p>La plupart des aiguillages de notre exemple sont des aiguillages réguliers. Le chemin de la gare du Nord à la gare du Sud a deux aiguillages de croisement, et il y a un double aiguillage de croisement juste avant que la ligne principale ne se divise en lignes Nord-Est et Sud-Est.</p><p><img src=svg_diagrams/small_infra_rails_n_points.drawio.en.svg alt="Diagramme des sections de voie et des aiguillages"></p><h4 id=courbes-et-pentes>Courbes et pentes</h4><p>Les <code>Courbes</code> et les <code>Pentes</code> sont essentielles pour des simulations réalistes. Ces objets sont définis comme une plage entre un décalage de <code>début</code> et de <code>fin</code> d&rsquo;une section de voie. Si une courbe / pente s&rsquo;étend sur plus d&rsquo;une section de voie, elle doit être ajoutée à toutes les sections.</p><p>Les valeurs des courbes / pentes sont constantes sur toute leur étendue. Pour des courbes / pentes variables, il faut créer plusieurs objets.</p><p>Les valeurs de pente sont mesurées en <em>mètres par kilomètres</em>, et les valeurs de courbe sont mesurées en <em>mètres</em> (le rayon de la courbe).</p><div class="alert alert-primary" role=alert>N&rsquo;oubliez pas que la valeur de début doit toujours être inférieure à la valeur de fin. C&rsquo;est pourquoi les valeurs de courbe/pente peuvent être négatives : une pente ascendante de 1 allant du décalage 10 à 0 est identique à une pente descendante de -1 allant des décalages 0 à 10.</div><p>Dans le fichier <a href=https://github.com/osrd-project/osrd/blob/dev/core/examples/generated/scripts/small_infra.py>small_infra.py</a>, nous avons des pentes sur les sections de piste <em>TA6</em>, <em>TA7</em>, <em>TD0</em> et <em>TD1</em>.</p><p>Il y a également des courbes sur les sections de voie <em>TE0</em>, <em>TE1</em>, <em>TE3</em> et <em>TF1</em>.</p><font color=#aa026d><h3 id=enclenchement>Enclenchement</h3></font><p>Jusqu&rsquo;à présent, tous les objets ont contribué à la topologie (forme) des voies. La topologie serait suffisante pour que les trains puissent naviguer sur le réseau, mais pas assez pour le faire en toute sécurité. pour assurer la sécurité, deux systèmes collaborent :</p><ul><li>L&rsquo;enclenchement garantit que les trains sont autorisés à avancer</li><li>La signalisation est le moyen par lequel l&rsquo;enclenchement communique avec le train</li></ul><h4 id=détecteurs>Détecteurs</h4><p>Ces objets sont utilisés pour créer des sections TVD (Track Vacancy Detection section) : la zone de la voie située entre les détecteurs est une section TVD. Lorsqu&rsquo;un train rencontre un détecteur, la section dans laquelle il entre est occupée. La seule fonction des sections TVD est de localiser les trains.</p><p>Dans la réalité, les détecteurs peuvent être des <a href=https://en.wikipedia.org/wiki/Axle_counter>compteurs d&rsquo;essieux</a> ou des <a href=https://en.wikipedia.org/wiki/Track_circuit>circuits de voie</a> par exemple.</p><p>Pour que cette méthode de localisation soit efficace, les détecteurs doivent être placés régulièrement le long de vos voies, pas trop nombreux pour des raisons de coût, mais pas trop peu, car les sections TVD seraient alors très grandes et les trains devraient être très éloignés les uns des autres pour être distingués, ce qui réduirait la capacité.</p><p>Il y a souvent des détecteurs à proximité de tous les côtés des aiguillages. De cette façon, l&rsquo;enclenchement est averti presque immédiatement lorsqu&rsquo;un aiguillage est libéré, qui est alors libre d&rsquo;être utilisé à nouveau.</p><div class="alert alert-info" role=alert>Prenons l&rsquo;exemple d&rsquo;un aiguillage de croisement : si le train A le franchit du <em>nord</em> au <em>sud</em> et que le train B vient le franchir de l&rsquo;<em>ouest</em> à l&rsquo;<em>est</em>, dès que le dernier wagon du train A a franchi l&rsquo;aiguillage, B devrait pouvoir partir, puisque A se trouve maintenant sur une section de voie complètement indépendante.</div><p>Dans <em>OSRD</em>, les détecteurs sont des objets ponctuels, donc tous les attributs dont ils ont besoin sont leur <code>id</code>, et la localisation de la voie (<code>track</code> et <code>offset</code>).</p><p><img src=svg_diagrams/small_infra_detectors.drawio.en.svg alt="Diagramme infrarouge avec tous les détecteurs"></p><div class="alert alert-info" role=alert>Les carrés agglutinés représentent plusieurs détecteurs à la fois. En effet, certains tronçons de voie n&rsquo;étant pas représentés sur toute leur longueur, nous n&rsquo;avons pas pu représenter tous les détecteurs du tronçon de voie correspondant.</div><p>Quelques notes :</p><ul><li>Entre certains points, nous n&rsquo;avons ajouté qu&rsquo;un seul détecteur (et non pas deux), car ils étaient très proches les uns des autres, et cela n&rsquo;aurait eu aucun sens de créer un minuscule TVDS entre les deux. Cette situation s&rsquo;est produite sur des sections de voies (<em>TA3</em>, <em>TA4</em>, <em>TA5</em>, <em>TF0</em> et <em>TG3</em>).</li><li>Dans notre infrastructure, il y a relativement peu de sections de voie qui sont assez longues pour nécessiter plus de détecteurs que ceux liés aux aiguillages. A savoir, <em>TA6</em>, <em>TA7</em>, <em>TDO</em>, <em>TD1</em>, <em>TF1</em>, <em>TG1</em> et <em>TH1</em>. Par exemple, <em>TD0</em>, qui mesure 25 km, compte en fait 17 détecteurs au total.</li></ul><h4 id=arrêts-tampons>Arrêts tampons</h4><p>Les <code>BufferStops</code> sont des obstacles destinés à empêcher les trains de glisser dans des culs-de-sac.</p><p>Dans notre infrastructure, il y a un butoir sur chaque section de voie qui a un cul-de-sac. Il y a donc 8 butoirs au total.</p><p>Avec les détecteurs, ils définissent les limites des sections <a href="https://ressources.data.sncf.com/explore/dataset/lexique-des-acronymes-sncf/table/?sort=abreviation&q=TVD">TVD</a> (voir <a href=#d%C3%A9tecteurs>Detectors</a>).</p><h4 id=itinéraires>Itinéraires</h4><p>Une <code>Route</code> est un itinéraire dans l&rsquo;infrastructure. Un sillon est une séquence de routes. Les itinéraires sont utilisés pour réserver des sections de sillon avec l&rsquo;enclenchement. Voir la <a href=/fr/developers/internals/simulation-model/>documentation dédiée</a>.</p><p>Il est représenté avec les attributs suivants :</p><ul><li><code>entry_point</code> et <code>exit_point</code> : Références de détecteurs ou de butées qui marquent le début et la fin de l&rsquo;itinéraire.</li><li><code>entry_point_direction</code> : Direction à prendre sur la section de voie depuis <code>entry_point</code> pour commencer l&rsquo;itinéraire.</li><li><code>switches_direction</code> : Un ensemble de directions à suivre lorsqu&rsquo;on rencontre une aiguille sur notre itinéraire, de manière à reconstituer cet itinéraire de <code>entry_point</code> jusqu&rsquo;à <code>exit_point</code>.</li><li><code>release_detectors</code> : Lorsqu&rsquo;un train franchit un détecteur de libération, les ressources réservées depuis le début de la route jusqu&rsquo;à ce détecteur sont libérées.</li></ul><font color=#aa026d><h3 id=signalisation>Signalisation</h3></font><p>Thanks to interlocking, trains are located and allowed to move. It&rsquo;s a good start, but meaningless until trains are made aware of it. C&rsquo;est là que les &ldquo;signaux&rdquo; entrent en jeu : les signaux réagissent aux enclenchements et peuvent être vus par les trains.</p><p>La façon dont les trains réagissent aux signaux dépend de l&rsquo;aspect, du type de signal et du système de signalisation.</p><p>Voici les attributs les plus importants des signaux :</p><ul><li><code>linked_detector</code> : Le [détecteur] lié (#détecteurs).</li><li><code>type_code</code> : Le type de signal.</li><li><code>direction</code> : La direction qu&rsquo;il protège, qui peut être simplement interprétée comme la façon dont il peut être vu par un train entrant (puisqu&rsquo;il n&rsquo;y a des feux que d&rsquo;un côté&mldr;). La direction est relative à l&rsquo;orientation de la section de voie.</li><li>Des attributs cosmétiques comme <code>angle_geo</code> and <code>side</code> qui contrôlent la manière dont les signaux sont affichés dans le front-end.</li></ul><p>Voici une visualisation de comment on peut représenter un signal, et quelle direction il protège.</p><p><img src=svg_diagrams/signal_dir.en.svg alt="Exemple de signal de direction"></p><br><p>La manière dont les signaux sont disposés dépend fortement du système de signalisation et du gestionnaire de l&rsquo;infrastructure.</p><p>Voici les règles de base utilisées pour cet exemple d&rsquo;infrastructure :</p><ul><li>Nous ajoutons deux signaux d&rsquo;espacement (un par direction) pour chaque détecteur qui découpe une longue section de TVD en plus petites sections.</li><li>Les entrées d&rsquo;aiguillage où un train pourrait devoir s&rsquo;arrêter sont protégées par un signal (qui est situé à l&rsquo;extérieur de la section TVD de l&rsquo;aiguillage). Il doit être visible depuis la direction utilisée pour approcher l&rsquo;aiguillage. Lorsqu&rsquo;il y a plusieurs aiguillages dans une rangée, seul le premier a généralement besoin d&rsquo;être protégé, car l&rsquo;enclenchement est généralement conçu pour ne pas encourager les trains à s&rsquo;arrêter au milieu des intersections.</li></ul><p>Notez que les détecteurs liés à au moins un signal ne sont pas représentés, car il n&rsquo;y a pas de signaux sans détecteurs associés dans cet exemple.
Pour obtenir le <code>id</code> d&rsquo;un détecteur lié à un signal, prenez le <code>id</code> du signal et remplacez <em>S</em> par <em>D</em> (par exemple SA0 -> DA0).</p><p><img src=svg_diagrams/small_infra_signals.drawio.en.svg alt="Diagramme infrarouge avec tous les signaux"></p><div class="alert alert-info" role=alert>Sur <em>TA6</em>, <em>TA7</em>, <em>TD0</em> et <em>TD1</em> nous n&rsquo;avons pas pu représenter tous les signaux car ces sections de voie sont très longues et comportent de nombreux détecteurs, donc de nombreux signaux.</div><font color=#aa026d><h2 id=divers>Divers</h2></font><h4 id=points-opérationnels>Points opérationnels</h4><p>Les <code>OperationalPoints</code> sont des collections de points (<code>OperationalPointParts</code>) d&rsquo;intérêt.</p><p>Par exemple, il peut être pratique de stocker l&rsquo;emplacement des plateformes en tant que parties et de les regrouper par station dans des points opérationnels.</p><p>Dans l&rsquo;exemple de l&rsquo;infrastructure, nous n&rsquo;avons utilisé que des points opérationnels pour représenter les stations. Les parties de points opérationnels sont représentées par des diamants violets. Gardez à l&rsquo;esprit qu&rsquo;un seul point opérationnel peut contenir plusieurs parties.</p><p><img src=svg_diagrams/small_infra_op_points.drawio.en.svg alt="Exemples de points opérationnels"></p><h4 id=limites-de-gabarit-de-chargement>Limites de gabarit de chargement</h4><p>Ces objets s&rsquo;apparentent aux <code>Pentes</code> et aux <code>Courbes</code> : ils couvrent une plage de section de voie, avec un décalage de <code>début</code> et de <code>fin</code>. Il représente une restriction sur les trains qui peuvent circuler sur la plage donnée, par poids ou par type de train (fret ou passagers).</p><p>Nous n&rsquo;en avons pas mis dans nos exemples.</p><h4 id=sections-de-vitesse>Sections de vitesse</h4><p>Les <code>SpeedSections</code> représentent les limites de vitesse (en mètres par seconde) qui sont appliquées sur certaines parties des voies. Une <code>SpeedSection</code> peut s&rsquo;étendre sur plusieurs sections de voie, et ne couvre pas nécessairement la totalité des sections de voie. Les sections de vitesse peuvent se chevaucher.</p><p>Dans notre exemple d&rsquo;infrastructure, nous avons une section de vitesse couvrant l&rsquo;ensemble de l&rsquo;infrastructure, limitant la vitesse à 300 km/h. Sur une plus petite partie de l&rsquo;infrastructure, nous avons appliqué des sections de vitesse plus restrictives.</p><p><img src=svg_diagrams/speed_sections.en.svg alt="Exemples de sections de vitesse"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-1fb257de0b4d19a8a1b31c950ac27f16>2.2 - Calcul de marche</h1><p>OSRD peut être utilisé pour effectuer deux types de calculs :</p><ul><li><strong>Calcul de marche</strong> (standalone train simulation) : calcul du temps de parcours d&rsquo;un train sur un trajet donné,effectué sans interaction entre le train et le système de signalisation.</li><li><strong>Simulation</strong> : calcul &ldquo;dynamique&rdquo; de plusieurs trains interagissant entre eux via le système de signalisation.</li></ul><h4 id=1---les-données-dentrée>1 - Les données d&rsquo;entrée</h4><p>Un calcul de marche est basé sur 5 entrées :</p><ul><li><strong>L&rsquo;infrastructure :</strong> Topologie des lignes et des voies, position des gares et bâtiments voyageurs, position et type des aiguilles, signaux, vitesses maximales de ligne, profil de ligne corrigée (pentes, rampes et virages).</li></ul><p><img src=infrastructure.png alt=Infrastructure></p><blockquote><p>L’histogramme bleu est une représentation des déclivités en [‰] par position en [m]. Les déclivités sont positives pour les rampes et négatives pour les pentes.</p><p>La ligne orange représente le profil cumulé, c&rsquo;est-à-dire l&rsquo;altitude relative par rapport au point de départ.</p><p>La ligne bleue est une représentation des virages en termes de rayons des courbures en [m].</p></blockquote><ul><li><strong>Le matériel roulant :</strong> Dont les caractéristiques nécessaires pour effectuer la simulation sont représentées ci-dessous.</li></ul><p><img src=mat_roulant.png alt="Matériel roulant"></p><blockquote><p>La courbe orange, appelée courbe effort-vitesse du matériel, représente l&rsquo;effort moteur maximal en fonction de la
vitesse de circulation.</p><p>La longueur, la masse, et la vitesse max du train sont représentées en bas de l&rsquo;encadré.</p></blockquote><ul><li><p><strong>L&rsquo;horaire de départ</strong> permettant ensuite de calculer les horaires de passage aux différents points remarquables (dont gares).</p></li><li><p><strong>Les marges :</strong> Temps ajouté au trajet du train pour détendre sa marche (voir <a href=./allowances>page sur les marges</a>).</p></li></ul><p><img src=marges.png alt=Marge></p><ul><li><strong>Le pas de temps</strong> pour le calcul de <a href=./numerical_integration>l&rsquo;intégration numérique</a>.</li></ul><h4 id=2---les-résultats>2 - Les résultats</h4><p>Les résultats d&rsquo;un calcul de marche peuvent se représenter sous différentes formes :</p><ul><li><strong>Le graphique espace/temps (GET) :</strong> représente le parcours des trains dans l&rsquo;espace et dans le temps, sous la forme de traits globalement diagonaux dont la pente est la vitesse. Les arrêts apparaissent sous la forme de plateaux horizontaux.</li></ul><p><img src=graph_espace_temps.jpg alt="Graphique Espace/Temps"></p><blockquote><p>Exemple de GET avec plusieurs trains espacés d&rsquo;environ 30mn.</p><p>L’axe <strong>x</strong> est l’horaire de passage du train, l’axe <strong>y</strong> est la position du train en [m].</p><p>La ligne bleue représente le calcul de marche le plus tendu pour le train, la ligne verte représente un calcul de marche détendu, dit « économique ».</p><p>Les rectangles pleins entourant les trajets représentent les portions de la voie successivement reservées au passage du train (appelées cantons).</p></blockquote><ul><li><strong>Le graphique espace/vitesse (GEV) :</strong> représente le parcours d&rsquo;un seul train, cette fois-ci en terme de vitesse. Les arrêts apparaissent donc sous forme de décrochages de la courbe jusqu&rsquo;à zéro, suivis d&rsquo;un réaccélération.</li></ul><p><img src=graph_espace_vitesse.png alt="Graphique Espace/Vitesse"></p><blockquote><p>L’axe <strong>x</strong> est la position du train en [m], l’axe <strong>y</strong> est la vitesse du train en [km/h] .</p><p>La ligne violette représente la vitesse maximale autorisée.</p><p>La ligne bleue représente la vitesse dans le cas du calcul de marche le plus tendu.</p><p>La ligne verte représente la vitesse dans le cas du calcul de marche « économique ».</p></blockquote><ul><li><strong>Les horaires de passage du train aux différents points remarquables</strong></li></ul><p><img src="timetables.png?style=time" alt="Horaire de départ"></p><style>img[src$=time]{height:70%;width:70%}</style></div><div class=td-content style=page-break-before:always><h1 id=pg-61cab231921ddee36c8a138e2a6605b8>2.2.1 - Modélisation physique</h1><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><p>La modélisation physique joue un rôle important dans le cœur de calcul d&rsquo;OSRD. C&rsquo;est elle qui nous permet de simuler la circulation des trains, et elle doit être aussi réaliste que possible.</p><font color=#aa026d><h3 id=bilan-des-forces>Bilan des forces</h3></font><p>Pour calculer le déplacement du train au cours du temps, il faut d&rsquo;abord calculer sa vitesse à chaque instant.
Une manière simple d&rsquo;obtenir cette vitesse est de passer par le calcul de l&rsquo;accélération.
Grâce au principe fondamental de la dynamique, l&rsquo;accélération du train à chaque instant est directement dépendant
des différentes forces qui lui sont appliquées : $$ \sum \vec{F}=m\vec{a} $$</p><p><img src=../forces.png alt=Marche></p><ul><li><p><strong>Traction</strong> : La valeur de la force de traction \(F_{mot}\) dépend de plusieurs facteurs :</p><ul><li>du matériel roulant</li><li>de la vitesse du train \(v^{\prime}x\), selon la courbe effort-vitesse ci-dessous :</li></ul><p>$$ {\vec{F_{mot}}(v_{x^{\prime}}, x^{\prime})=F_{mot}(v_{x^{\prime}}, x^{\prime})\vec{e_x^{\prime}}} $$</p><p><img src=../effort-vitesse.png alt=Marche title="Exemple de courbe effort-vitesse d'un train"></p><blockquote><p>L&rsquo;axe <strong>x</strong> représente la vitesse du train en [km/h], l&rsquo;axe <strong>y</strong>, la valeur de la force de traction en [kN].</p></blockquote><ul><li>de l&rsquo;action du conducteur, qui accélère plus ou moins fort en fonction de l&rsquo;endroit où il se trouve sur son trajet</li></ul></li></ul><br><ul><li><strong>Freinage</strong> : La valeur de la force de freinage \(F_{brk}\) dépend elle aussi du matériel roulant et de l&rsquo;action du conducteur mais possède une valeur constante pour un matériel donné. Dans l&rsquo;état actuel de la modélisation, le freinage est soit nul, soit à sa valeur maximale.</li></ul><p>$$ \vec{F_{brk}}(x^{\prime})=-F_{brk}(x^{\prime}){\vec{e_{x^{\prime}}}} $$</p><p>Une seconde approche de la modélisation du freinage est l&rsquo;approche dite horaire, car utilisée pour la production horaire à la SNCF. Dans ce cas, la décélération est fixe et le freinage ne dépend plus des différentes forces appliquées au train. Les valeurs de décélération typiques vont de 0.4 à 0.7m/s².</p><br><ul><li><strong>Résistance à l&rsquo;avancement</strong> : Pour modéliser la résistance à l’avancement du train on utilise la formule de Davis qui prend en compte tous les frottements et la résistance aérodynamique de l’air. La valeur de la resistance à l&rsquo;avancement dépend de la vitesse \(v^{\prime}_x\). Les coefficients \(A\), \(B\), et \(C\) dépendent du matériel roulant.</li></ul><p>$$ {\vec{R}(v_{x^{\prime}})}=-(A+Bv_{x^{\prime}}+{Cv_{x^{\prime}}}^2){\vec{e_{x^{\prime}}}} $$</p><br><ul><li><strong>Poids (pentes + virages)</strong> : La force du poids donnée par le produit entre la masse \(m\) du train et la constante gravitationnelle \(g\) est projetée sur les axes \(\vec{e_x}^{\prime}\) et \(\vec{e_y}^{\prime}\).Pour la projection, on utilise l&rsquo;angle \(i(x^{\prime})\), qui est calculé à partir de l&rsquo;angle de déclivité \(s(x^{\prime})\) corrigé par un facteur qui prend en compte l&rsquo;effet du rayon de virage \(r(x^{\prime})\).</li></ul><p>$$
\vec{P(x^{\prime})}=-mg\vec{e_y}(x^{\prime})=
-mg\Big[sin\big(i(x^{\prime})\big){\vec{e_{x^{\prime}}}(x^{\prime})}+cos\big(i(x^{\prime})\big){\vec{e_{{\prime}}}(x^{\prime})}\Big]
$$</p><p>$$ i(x^{\prime})= s(x^{\prime})+\frac{800m}{r(x^{\prime})} $$</p><br><ul><li><strong>Réaction du sol</strong> : La force de réaction du sol compense simplement la composante verticale du poids, mais n&rsquo;a pas d&rsquo;impact sur la dynamique du train car elle n&rsquo;a aucune composante selon l&rsquo;axe \({\vec{e_x}^{\prime}}\).</li></ul><p>$$ \vec{R_{gnd}}=R_{gnd}{\vec{e_{y^{\prime}}}} $$</p><font color=#aa026d><h3 id=equilibre-des-forces>Equilibre des forces</h3></font><p>L&rsquo;équation du principe fondamental de la dynamique projetée sur l&rsquo;axe \({\vec{e_x}^{\prime}}\) (dans le référentiel du train) donne l&rsquo;équation scalaire suivante :</p><p>$$
a_{x^{\prime}}(t) = \frac{1}{m}\Big
[F_{mot}(v_{x^{\prime}}, x^{\prime})-F_{brk}(x^{\prime})-(A+Bv_{x^{\prime}}+{Cv_{x^{\prime}}}^2)-mgsin(i(x^{\prime}))\Big]
$$</p><p>Celle-ci est ensuite simplifiée en considérant que malgré la pente le train se déplace sur un plan et en amalgamant
\(\vec{e_x}\) et \(\vec{e_x}^{\prime}\). La pente a toujours un impact sur le bilan des forces mais on considère que le train ne se déplace qu&rsquo;horizontalement, ce qui donne l&rsquo;équation simplifiée suivante :</p><p>$$ a_{x}(t) = \frac{1}{m}\Big[F_{mot}(v_{x}, x)-F_{brk}(x)-(A+Bv_{x}+{Cv_{x}}^2)-mgsin(i(x))\Big] $$</p><font color=#aa026d><h3 id=résolution>Résolution</h3></font><p>La force motrice et la force de freinage dépendent de l&rsquo;action du conducteur (il décide d&rsquo;accélérer ou de freiner plus ou moins fort en fonction de la situation). Cette dépendance se traduit donc par une dépendance de ces deux forces à la position du train. La composante du poids dépend elle aussi de la position du train, car provenant directement des pentes et des virages situées sous ce dernier.</p><p>De plus, la force motrice dépend de la vitesse du train (selon la courbe effort vitesse) tout comme la résistance à
l&rsquo;avancement.</p><p>Ces différentes dépendances rendent impossible la résolution analytique de cette équation, et l&rsquo;accélération du train à chaque instant doit être calculée par intégration numérique.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e1f75b5e8521a11c3f55859a7e224607>2.2.2 - Intégration numérique</h1><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<font color=#aa026d><h3 id=introduction>Introduction</h3></font><p>La modélisation physique ayant montré que l&rsquo;accélération du train était influencée par différents facteurs variant le long du trajet (pente, courbure, force de traction du moteur&mldr;), le calcul doit passer par une méthode d&rsquo;intégration numérique. Le trajet est alors séparé en étapes suffisamment courtes pour considérer tous ces facteurs comme constants, ce qui permet cette fois ci d&rsquo;utiliser l&rsquo;équation du mouvement pour calculer le déplacement et la vitesse du train.</p><p>La méthode d&rsquo;intégration numérique d&rsquo;Euler est la plus simple pour effectuer ce genre de calcul, mais elle présente un certain nombre d&rsquo;inconvénients. Cet article explique la méthode d&rsquo;Euler, pourquoi elle ne convient pas aux besoins d&rsquo;OSRD et quelle méthode d&rsquo;intégration doit être utilisée à la place.</p><font color=#aa026d><h3 id=la-méthode-deuler>La méthode d&rsquo;Euler</h3></font><p>La méthode d&rsquo;Euler appliquée à l&rsquo;intégration de l&rsquo;équation du mouvement d&rsquo;un train est :</p><p>$$v(t+dt) = a(v(t), x(t))dt + v(t)$$</p><p>$$x(t+dt) = \frac{1}{2}a(v(t), x(t))dt^2 + v(t)dt + x(t)$$</p><center><p><img src="../euler.png?style=method" alt="Méthode d&amp;rsquo;Euler"></p></center><p>&nbsp;</p><h4 id=les-avantages-de-la-méthode-deuler><strong>Les avantages de la méthode d&rsquo;Euler</strong></h4><p>La méthode d&rsquo;Euler a pour avantages d&rsquo;être très simple à implémenter et d&rsquo;avoir un calcul plutôt rapide pour un pas de temps donné, en comparaison avec d&rsquo;autres méthodes d&rsquo;intégration numérique (voir <a href=#le-choix-de-la-m%C3%A9thode-dint%C3%A9gration-pour-osrd>annexe</a>)</p><h4 id=les-inconvénients-de-la-méthode-deuler><strong>Les inconvénients de la méthode d&rsquo;Euler</strong></h4><p>La méthode d&rsquo;intégration d&rsquo;Euler présente un certain nombre de problèmes pour OSRD :</p><ul><li>Elle est relativement imprécise, et donc nécessite un faible pas de temps, ce qui génère beaucoup de données.</li><li>En intégrant dans le temps, on ne connaît que les conditions du point de départ du pas d&rsquo;intégration (pente, paramètres d&rsquo;infrastructure, etc.) car on ne peut pas prédire précisément l&rsquo;endroit où il se termine.</li><li>On ne peut pas anticiper les futurs changements de directive : le train ne réagit qu&rsquo;en comparant son état actuel à sa consigne au même instant. Pour illustrer c&rsquo;est un peu comme si le conducteur était incapable de voir devant lui, alors que dans la réalité il anticipe en fonction des signaux, pentes, virages qu&rsquo;il voit devant lui.</li></ul><font color=#aa026d><h3 id=la-méthode-runge-kutta-4>La méthode Runge-Kutta 4</h3></font><p>La méthode Runge-Kutta 4 appliquée à l&rsquo;intégration de l&rsquo;équation du mouvement d&rsquo;un train est :</p><p>$$v(t+dt) = v(t) + \frac{1}{6}(k_1 + 2k_2 + 2k_3 + k_4)dt$$</p><p>Avec :</p><p>$$k_1 = a(v(t), x(t))$$</p><p>$$k_2 = a\Big(v(t+k_1\frac{dt}{2}), x(t) + v(t)\frac{dt}{2} + k_1\frac{dt^2}{8}\Big)$$</p><p>$$k_3 = a\Big(v(t+k_2\frac{dt}{2}), x(t) + v(t)\frac{dt}{2} + k_2\frac{dt^2}{8}\Big)$$</p><p>$$k_4 = a\Big(v(t+k_3dt), x(t) + v(t)dt + k_3\frac{dt^2}{2}\Big)$$</p><center><p><img src="../rk4.png?style=method" alt="Méthode de Runge-Kutta 4"></p></center><p>&nbsp;</p><h4 id=les-avantages-de-la-méthode-de-runge-kutta-4><strong>Les avantages de la méthode de Runge Kutta 4</strong></h4><p>La méthode d&rsquo;intégration de Runge Kutta 4 permet de répondre aux différents problèmes soulevés par celle d&rsquo;Euler :</p><ul><li>Elle permet d&rsquo;anticiper les changements de directive au sein d&rsquo;un pas de calcul, représentant ainsi davantage la réalité de conduite d&rsquo;un train.</li><li>Elle est plus précise pour le même temps de calcul (voir <a href=#le-choix-de-la-m%C3%A9thode-dint%C3%A9gration-pour-osrd>annexe</a>), permettant des étapes d&rsquo;intégration plus grandes, donc moins de points de données.</li></ul><h4 id=les-inconvénients-de-la-méthode-de-runge-kutta-4><strong>Les inconvénients de la méthode de Runge Kutta 4</strong></h4><p>Le seul inconvénient notable de la méthode de Runge Kutta 4 rencontré pour l&rsquo;instant est sa difficulté d&rsquo;implémentation.</p><font color=#aa026d><h3 id=le-choix-de-la-méthode-dintégration-pour-osrd>Le choix de la méthode d&rsquo;intégration pour OSRD</h3></font><h4 id=étude-de-la-précision-et-de-la-vitesse-de-calcul><strong>Étude de la précision et de la vitesse de calcul</strong></h4><p>Différentes méthodes d&rsquo;intégration auraient pu remplacer l&rsquo;intégration d&rsquo;Euler de base dans l&rsquo;algorithme d&rsquo;OSRD. Afin de décider quelle méthode conviendrait le mieux, une étude sur la précision et la vitesse de calcul de différentes méthodes a été menée. Cette étude sert à comparé les méthodes suivantes :</p><ul><li>Euler</li><li>Euler-Cauchy</li><li>Runge-Kutta 4</li><li>Adams 2</li><li>Adams 3</li></ul><p>Toutes les explications sur ces méthodes peuvent être trouvées dans <a href=https://github.com/osrd-project/osrd/wiki/documents/integration/MethodesNumeriques_EricGoncalves.pdf>ce document</a>, et le code python utilisé pour la simulation est <a href=https://raw.githubusercontent.com/wiki/osrd-project/osrd/code/integration/Tests_precision.py>ici</a>.</p><p>La simulation calcule la position et la vitesse d&rsquo;un TGV accélérant sur une ligne droite plate.</p><h4 id=simulations-à-pas-de-temps-équivalent><strong>Simulations à pas de temps équivalent</strong></h4><p>Une courbe de référence a été simulée en utilisant la méthode d&rsquo;Euler avec un pas de temps de 0,1s, puis le même parcours a été simulé en utilisant les autres méthodes avec un pas de temps de 1s. Il est alors possible de comparer simplement chaque courbe à la courbe de référence, en calculant la valeur absolue de la différence à chaque point calculé. Voici l&rsquo;erreur absolue résultante de la position du train sur sa distance parcourue :</p><p><img src=../precisions_h_equivalent.png alt=precisions_h_equivalent></p><p>Il apparaît immédiatement que la méthode d&rsquo;Euler est moins précise que les quatre autres d&rsquo;environ un ordre de grandeur. Chaque courbe présente un pic où la précision est extrêmement élevée (erreur extrêmement faible), ce qui s&rsquo;explique par le fait que toutes les courbes commencent légèrement au-dessus de la courbe de référence, la croisent en un point et finissent légèrement en dessous, ou <em>vice versa</em>.</p><p>Comme la précision n’est pas le seul indicateur important, le temps de calcul de chaque méthode a été mesuré. Voici ce que nous obtenons pour les mêmes paramètres d’entrée :</p><table><thead><tr><th style=text-align:left>Méthode d&rsquo;intégration</th><th style=text-align:right>Temps de calcul (s)</th></tr></thead><tbody><tr><td style=text-align:left>Euler</td><td style=text-align:right>1.86</td></tr><tr><td style=text-align:left>Euler-Cauchy</td><td style=text-align:right>3.80</td></tr><tr><td style=text-align:left>Runge-Kutta 4</td><td style=text-align:right>7.01</td></tr><tr><td style=text-align:left>Adams 2</td><td style=text-align:right>3.43</td></tr><tr><td style=text-align:left>Adams 3</td><td style=text-align:right>5.27</td></tr></tbody></table><p>Ainsi, Euler-Cauchy et Adams 2 sont environ deux fois plus lents que Euler, Adams 3 est environ trois fois plus lent, et RK4 est environ quatre fois plus lent. Ces résultats ont été vérifiés sur des simulations beaucoup plus longues, et les différents ratios sont maintenus.</p><h4 id=simulation-à-temps-de-calcul-équivalent><strong>Simulation à temps de calcul équivalent</strong></h4><p>Comme les temps de calcul de toutes les méthodes dépendent linéairement du pas de temps, il est relativement simple de comparer la précision pour un temps de calcul à peu près identique. En multipliant le pas de temps d&rsquo;Euler-Cauchy et d&rsquo;Adams 2 par 2, le pas de temps d&rsquo;Adams 3 par 3, et le pas de temps de RK4 par 4, voici les courbes d&rsquo;erreur absolue résultantes :</p><p><img src=../precisions_time_equivalent.png alt=precisions_time_equivalent></p><p>Et voici les temps de calcul :</p><table><thead><tr><th style=text-align:left>Méthode d&rsquo;intégration</th><th style=text-align:right>Temps de calcul (s)</th></tr></thead><tbody><tr><td style=text-align:left>Euler</td><td style=text-align:right>1.75</td></tr><tr><td style=text-align:left>Euler-Cauchy</td><td style=text-align:right>2.10</td></tr><tr><td style=text-align:left>Runge-Kutta 4</td><td style=text-align:right>1.95</td></tr><tr><td style=text-align:left>Adams 2</td><td style=text-align:right>1.91</td></tr><tr><td style=text-align:left>Adams 3</td><td style=text-align:right>1.99</td></tr></tbody></table><p>Après un certain temps, RK4 tend à être la méthode la plus précise, légèrement plus précise que Euler-Cauchy, et toujours bien plus précise que la méthode d&rsquo;Euler.</p><font color=#aa026d><h3 id=conclusions-de-létude>Conclusions de l&rsquo;étude</h3></font><p>L&rsquo;étude de la précision et de la vitesse de calcul présentée ci-dessus montre que RK4 et Euler-Cauchy seraient de bons candidats pour remplacer l&rsquo;algorithme d&rsquo;Euler dans OSRD : les deux sont rapides, précis, et pourraient remplacer la méthode d&rsquo;Euler sans nécessiter de gros changements d&rsquo;implémentation car ils ne font que des calculs au sein du pas de temps en cours de calcul.
<strong>Il a été décidé qu&rsquo;OSRD utiliserait la méthode Runge-Kutta 4 parce qu&rsquo;elle est légèrement plus précise que Euler-Cauchy et que c&rsquo;est une méthode bien connue pour ce type de calcul, donc très adaptée à un simulateur open-source.</strong></p><style>img[src$=method]{height:50%;width:50%}</style><blockquote></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-8adca5807826313222b06ebdda200d27>2.2.3 - Le système d'enveloppes</h1><p>Le système d&rsquo;enveloppes est une interface créée spécifiquement pour le calcul de marche d&rsquo;OSRD. Il permet de manipuler différentes courbes espace/vitesse, de les découper, de les mettre bout à bout, d&rsquo;interpoler des points spécifiques, et d&rsquo;adresser beaucoup d&rsquo;autres besoins nécessaires au calcul de marche.</p><font color=#aa026d><h3 id=une-interface-spécifique-dans-le-service-osrd-core>Une interface spécifique dans le service OSRD Core</h3></font><p>Le système d&rsquo;enveloppes fait partie du service core d&rsquo;OSRD (voir <a href=../architecture/_index>l&rsquo;architecture du logiciel</a>).</p><p>Ses principaux composants sont :</p><p><strong>1 - EnvelopePart :</strong> courbe espace/vitesse, définie comme une séquence des points et possédant des métadonnées indiquant par exemple s&rsquo;il s&rsquo;agit d&rsquo;une courbe d&rsquo;accélération, de freinage, de maintien de vitesse, etc.</p><p><strong>2 - Envelope :</strong> liste d&rsquo;EnvelopeParts mises bout-à-bout et sur laquelle il est possible d&rsquo;effectuer certaines opérations :</p><ul><li>vérifier la continuité dans l’espace (obligatoire) et dans la vitesse (facultative)</li><li>chercher la vitesse minimale et/ou maximale de l&rsquo;enveloppe</li><li>couper une partie de l’enveloppe entre deux points de l&rsquo;espace</li><li>effectuer une interpolation de vitesse à une certaine position</li><li>calculer le temps écoulé entre deux positions de l’enveloppe</li></ul><p><img src=../envelopes_scheme.png alt=envelope_scheme></p><p><strong>3 - Overlays :</strong> système permettant d’ajouter des EnvelopePart plus contraignantes (c&rsquo;est-à-dire dont la vitesse est plus faible) à une enveloppe existante.</p><font color=#aa026d><h3 id=enveloppes-données-vs-enveloppes-calculées>Enveloppes données vs enveloppes calculées</h3></font><p>Pendant la simulation, le train est censé suivre certaines instructions de vitesse. Celles-ci sont modélisées dans OSRD par des enveloppes sous forme de courbes espace/vitesse. On en distingue deux types :</p><ul><li>Les enveloppes provenant <strong>des données d&rsquo;infrastructure et de matériel roulant</strong>, comme la vitesse maximale de la ligne et la vitesse maximale du train. Etant des données d&rsquo;entrée de notre calcul, elles ne correspondent pas à des courbes ayant un sens physique, car elles ne sont pas issues des résultats d&rsquo;une intégration réelle des équations physiques du mouvement.</li><li>Les enveloppes résultant <strong>d&rsquo;une intégration réelle</strong> des équations du mouvement physique. Elles correspondent à une courbe physiquement tenable par le train et contiennent également des informations sur le temps.</li></ul><p>Un exemple simple pour illustrer cette différence : si l&rsquo;on simule un trajet de TER sur une ligne de montagne, une des données d&rsquo;entrée va être une enveloppe de vitesse maximale à 160km/h, correspondant à la vitesse maximale de notre TER. Mais cette enveloppe ne correspond pas à une réalité physique, car il se peut que sur certaines portions la rampe soit trop raide pour que le train arrive effectivement à maintenir cette vitesse maximale de 160km/h. L&rsquo;enveloppe calculée présentera donc dans cet exemple un décrochage de vitesse dans les zones de fortes rampes, là où l&rsquo;enveloppe donnée était parfaitement plate.</p><font color=#aa026d><h3 id=simulation-de-plusieurs-trains>Simulation de plusieurs trains</h3></font><p>Dans le cas de la simulation de nombreux trains, le système de signalisation doit assurer <strong>la sécurité</strong>. L&rsquo;effet de la signalisation sur le calcul de marche d&rsquo;un train est reproduit en superposant des enveloppes dynamiques à l&rsquo;enveloppe statique. Une nouvelle enveloppe dynamique est introduite par exemple lorsqu&rsquo;un signal se ferme. Le train suit l&rsquo;enveloppe économique statique superposée aux enveloppes dynamiques, s&rsquo;il y en a. Dans ce mode de simulation, un contrôle du temps est effectué par rapport à un temps théorique provenant de l&rsquo;information temporelle de l&rsquo;enveloppe économique statique. Si le train est en retard par rapport à l&rsquo;heure prévue, il cesse de suivre l&rsquo;enveloppe économique et essaie d&rsquo;aller plus vite. Sa courbe espace/vitesse sera donc limitée par l&rsquo;enveloppe d&rsquo;effort maximum.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-396e33d6479b448e3938369013852b4a>2.2.4 - Le processus de calcul de marche</h1><p>Le calcul de marche dans OSRD est un processus à 4 étapes, utilisant chacune <a href=../envelopes_system>le système d&rsquo;enveloppes</a> :</p><ol><li><a href=#calcul-du-profil-de-vitesse-le-plus-restrictif>Construction du profil de vitesse le plus restrictif</a></li><li><a href=#calcul-du-profil-de-vitesse-maximale>Ajout des différentes courbes de freinage</a></li><li><a href=#calcul-du-profil-deffort-maximal>Ajout des différentes courbes d&rsquo;accélération et vérification des courbes de vitesse constante</a></li><li><a href=#application-de-marges>Application de marge(s)</a></li></ol><p>&nbsp;</p><font color=#aa026d><h3 id=calcul-du-profil-de-vitesse-le-plus-restrictif>Calcul du profil de vitesse le plus restrictif</h3></font><p>Une première enveloppe est calculée au début de la simulation en regroupant toutes les limites de vitesse statiques :</p><ul><li>vitesse maximale de la ligne</li><li>vitesse maximale du matériel roulant</li><li>limitations temporaires de vitesse (en cas de travaux sur une ligne par exemple)</li><li>limitations de vitesse par catégorie de train</li><li>limitations de vitesse selon la charge du train</li><li>limitations de vitesse correspondant à des panneaux de signalisation</li></ul><p>La longueur du train est également prise en compte pour s&rsquo;assurer que le train n&rsquo;accélère qu&rsquo;une fois sa queue ayant quitté la zone de plus faible vitesse. Un décalage est alors appliqué à la courbe en pointillée rouge. L&rsquo;enveloppe résultante (courbe noire) est appelée <strong>MRSP (Most Restricted Speed Profile)</strong> correspondant donc au profil de vitesse le plus restrictif. C&rsquo;est sur cette enveloppe que seront calculées les étapes suivantes.</p><p><img src=../mrsp.png alt="Most Restricted Speed Profile"></p><blockquote><p>La ligne pointillée rouge représente la vitesse maximale autorisée en fonction de la position.
La ligne noire représente le MRSP où la longueur du train a été prise en compte.</p></blockquote><p>Il est à noter que les différentes envelopeParts composant le MRSP sont des données d&rsquo;entrée, elles ne correspondent donc pas à des courbes avec une réalité physique.</p><font color=#aa026d><h3 id=calcul-du-profil-de-vitesse-maximale>Calcul du profil de vitesse maximale</h3></font><p>En partant du MRSP, toutes les courbes de freinage sont calculées grâce au système d&rsquo;overlay (voir <a href=../envelopes_system/#une-interface-sp%C3%A9cifique-dans-le-service-osrd-core>ici</a> pour plus de détails sur les overlays), c&rsquo;est-à-dire en créant des envelopeParts qui seront plus restrictives que le MRSP. La courbe ainsi obtenue est appelée <strong>Max Speed Profile</strong> (profil de vitesse maximale). Il s&rsquo;agit de l&rsquo;enveloppe de vitesse maximale du train, tenant compte de ses capacités de freinage.</p><p>Etant donné que les courbes de freinage ont un point de fin imposé et que l&rsquo;équation de freinage n&rsquo;a pas de solution analytique, il est impossible de prédire leur point de départ. Les courbes de freinage sont donc calculées à rebours en partant de leur point cible, c&rsquo;est-à-dire le point dans l&rsquo;espace où une certaine limite de vitesse est imposée (vitesse cible finie) ou le point d&rsquo;arrêt (vitesse cible nulle).</p><p><img src=../msp.png alt="Max Speed Profile"></p><p>Pour des raisons historiques en production horaire, les courbes de freinages sont calculées avec une décélération forfaitaire, dite décélération horaire (typiquement ~0,5m/s²) sans prendre en compte les autres forces. Cette méthode a donc également été implémentée dans OSRD, permettant ainsi de calculer les freinages de deux manières différentes : avec ce taux horaire ou avec une force de freinage qui vient simplement s&rsquo;ajouter aux autres forces.</p><font color=#aa026d><h3 id=calcul-du-profil-deffort-maximal>Calcul du profil d&rsquo;effort maximal</h3></font><p>Pour chaque point correspondant à une augmentation de vitesse dans le <strong>MRSP</strong> ou à la fin d&rsquo;une courbe de freinage d&rsquo;arrêt, une courbe d&rsquo;accélération est calculée. Les courbes d&rsquo;accélération sont calculées en tenant compte de toutes les forces actives (force de traction, résistance à l&rsquo;avancement, poids) et ont donc un sens physique.</p><p>Pour les envelopeParts dont le sens physique n&rsquo;a pas encore été vérifié (qui à ce stade sont les phases de circulation à vitesse constante, provenant toujours du MRSP), une nouvelle intégration des équations de mouvement est effectuée. Ce dernier calcul est nécessaire pour prendre en compte d&rsquo;éventuels décrochages de vitesse dans le cas où le train serait physiquement incapable de tenir sa vitesse, typiquement en présence de fortes rampes (voir <a href=../envelopes_system/#enveloppes-donn%C3%A9es-vs-enveloppes-calcul%C3%A9es>cet exemple</a>).</p><p>L&rsquo;enveloppe qui résulte de ces ajouts de courbes d&rsquo;accélérations et de la vérification des plateaux de vitesse est appelée <strong>Max Effort Profile</strong> (profil d&rsquo;effort maximal).</p><p><img src=../mep.png alt="Max Effort Profile"></p><p>A ce stade, l&rsquo;enveloppe obtenue est continue et a un sens physique du début à fin. Le train accélère au maximum, roule aussi vite que possible en fonction des différentes limites de vitesse et de ses capacités motrices, et freine au maximum. Le calcul de marche obtenu s&rsquo;appelle la <strong>marche de base</strong>. Elle correspond au trajet le plus rapide possible pour le matériel roulant donné sur le parcours donné.</p><font color=#aa026d><h3 id=application-de-marges>Application de marge(s)</h3></font><p>Après avoir effectué le calcul de la marche de base (correspondant au Max Effort Profile dans OSRD), il est possible d&rsquo;y appliquer des marges (allowances). Les marges sont des ajouts de temps supplémentaire au parcours du train. Elles servent notamment à lui permettre de rattraper son retard si besoin ou à d&rsquo;autres besoins opérationnels (plus de détails sur les marges <a href=../allowances>ici</a>).</p><p>Une nouvelle enveloppe <strong>Allowances</strong> est donc calculée grâce à des overlays pour distribuer la marge demandée par l&rsquo;utilisateur sur l&rsquo;enveloppe d&rsquo;effort maximal calculée précédemment.</p><p><img src=../allowances.png alt=Marges></p><p>Dans le calcul de marche d&rsquo;OSRD, il est possible de distribuer les marges d&rsquo;une manière linéaire, en abaissant toutes les vitesses d&rsquo;un certain facteur, ou économique, c&rsquo;est-à-dire en minimisant la consommation d&rsquo;énergie pendant le parcours du train.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-aa03910eecb13f5d3e9053a632348bc2>2.2.5 - Les marges</h1><font color=#aa026d><h3 id=la-raison-dêtre-des-marges>La raison d&rsquo;être des marges</h3></font><p>Comme expliqué dans le <a href=../pipeline/#calcul-du-profil-deffort-maximal>calcul du Max Effort Profile</a>, la <strong>marche de base</strong> représente la marche la plus tendue normalement réalisable, c&rsquo;est-à-dire le trajet le plus rapide possible du matériel donné sur le parcours donné. Le train accélère au maximum, roule aussi vite que possible en fonction des différentes limites de vitesse et de ses capacités motrices, et freine au maximum.</p><p>Cette marche de base présente un inconvénient majeur : si un train part avec 10min de retard, il arrivera au mieux avec 10min de retard, car par définition il lui est impossible de rouler plus vite que la marche de base. Par conséquent, les trains sont programmés avec un ajout d&rsquo;une ou de plusieurs marges. Les marges sont une détente du trajet du train, un ajout de temps à l&rsquo;horaire prévu, qui se traduit inévitablement par un abaissement des vitesses de circulation.</p><blockquote><p>Un train circulant en marche de base est incapable de rattraper son retard !</p></blockquote><font color=#aa026d><h3 id=le-type-de-marge>Le type de marge</h3></font><p>On distingue deux types de marges :</p><ul><li><strong>La marge de régularité</strong> : il s&rsquo;agit du temps complémentaire ajouté à la marche de base pour tenir compte de l’imprécision de la mesure de la vitesse, pour pallier les conséquences des incidents extérieurs venant perturber la marche théorique des trains, et pour maintenir la régularité de la circulation. La marge de régularité s&rsquo;applique sur l&rsquo;ensemble du trajet, bien que sa valeur puisse changer sur certains intervalles.</li><li><strong>La marge de construction</strong> : il s&rsquo;agit du temps ajouté / retiré sur un intervalle spécifique, en plus de la marge de régularité, mais cette fois pour des raisons opérationnelles (esquiver un autre train, libérer une voie plus rapidement, etc.)</li></ul><p>Une marche de base à laquelle on vient ajouter une marge de régularité donne ce que l&rsquo;on appelle une <strong>marche type</strong>.</p><font color=#aa026d><h3 id=la-distribution-de-la-marge>La distribution de la marge</h3></font><p>L&rsquo;ajout de marge se traduisant par un abaissement des vitesses le long du trajet, plusieurs marches types sont possibles. En effet, il existe une infinité de solutions aboutissant au même temps de parcours.</p><p>En guise d&rsquo;exemple simple, pour détendre la marche d&rsquo;un train de 10% de son temps de parcours, il est possible de prolonger n&rsquo;importe quel arrêt de l&rsquo;équivalent en temps de ces 10%, tout comme il est possible de rouler à 1/1,1 = 90,9% des capacités du train sur l&rsquo;ensemble du parcours, ou encore de rouler moins vite, mais seulement aux vitesses élevées&mldr;</p><p>Il y a pour l&rsquo;instant deux algorithmes de distribution de la marge dans OSRD : linéaire et économique.</p><font color=#aa026d><h3 id=la-distribution-linéaire>La distribution linéaire</h3></font><p>La distribution de marge linéaire consiste simplement à abaisser les vitesses d&rsquo;un même facteur sur la zone où l&rsquo;utilisateur applique la marge. En voici un exemple d&rsquo;application :</p><p><img src=../python_plot_linear.png alt="Python plot linear"></p><p>Cette distribution a pour avantage de répartir la marge de la même manière sur tout le trajet. Un train prenant du retard à 30% de son trajet disposera de 70% de sa marge pour les 70% de trajets restants.</p><font color=#aa026d><h3 id=la-distribution-économique>La distribution économique</h3></font><p>La distribution économique de la marge, présentée en détail dans <a href=/pdf/MARECO.pdf>ce document</a> (<strong>MARECO</strong> est un algorithme conçu par la direction de la recherche SNCF), consiste à répartir la marge de la manière la plus économe possible en énergie. Elle est basée sur deux principes :</p><ol><li>une vitesse plafond, évitant les vitesses les plus consommatrices en énergie</li><li>des zones de marche sur l&rsquo;erre, situées avant les freinages et les fortes pentes, où le train circule à moteur coupé grâce à son inertie, permettant de ne consommer aucune énergie pendant ce laps de temps</li></ol><p><img src=../python_plot_eco_w_slopes.png alt="Python plot eco with slopes"></p><blockquote><p>Un exemple de marche économique. En haut, les pentes/rampes rencontrées par le train. Les zones de marche sur l&rsquo;erre sont représentées en bleu.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-7fc460a5aae16da64f26856e729d27cc>3 - Guides pratiques</h1><div class=lead>Marches à suivre pour des tâches classiques</div><p>Les guides pratiques sont des marches à suivre. Vous êtes guidés pas-à-pas dans la résolution de problèmes, ou dans des scénarios classiques. Les connaissances requises sont plus élevées que pour les tutoriels, et le fonctionnement d&rsquo;OSRD doit être compris.</p></div><div class=td-content><h1 id=pg-d15f2fe4998ef00156d730fe852f9a26>3.1 - Contribuer à OSRD</h1><div class=lead>Comment apporter sa pierre à l&rsquo;édifice</div><p>Déjà, merci d&rsquo;avoir pris le temps de contribuer !</p><p>Si les sections suivantes forment un guide du contributeur, ce n&rsquo;est pas pour autant un ensemble de règles strictes. En fait, si vous avez déjà contribué à des gros projets opensource, la suite ne sera pas surprenante. Dans le cas contraire, elle vous sera probablement très utile !</p><h3 id=communiquer>Communiquer</h3><p>Vous pouvez gagner du temps en discutant de votre projet de contribution avec les autres contributeurs :</p><ul><li>Rejoignez le salon de messagerie instantanée sur IRC à <a href=https://web.libera.chat/#osrd>libera.chat#osrd</a></li><li><a href=https://github.com/osrd-project/osrd/issues/new/choose><strong>Créez une issue</strong></a> pour avoir un endroit un discuter de votre contribution</li></ul><h3 id=se-renseigner>Se renseigner</h3><p>Comme dans tout projet, chaque changement se repose sur ce qui a été fait par le passé.
Avant d&rsquo;apporter un changement, renseignez-vous sur l&rsquo;existant :</p><ul><li>Vous pouvez <a href=https://osrd.fr/fr/docs/>lire la documentation technique</a></li><li>Il est préférable de lire le code source de l&rsquo;application en rapport avec votre projet</li><li>Vous pouvez contacter les derniers développeurs à avoir travaillé sur les zones du code en rapport avec votre projet</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-987ae2aead487e6aad8654531bf0e679>3.1.1 - Signaler des problèmes</h1><div class=lead>Comment signaler un bug ou suggérer une amélioration</div><p><strong>N&rsquo;hésitez pas à signaler tout ce qui vous semble important !</strong></p><p>Notre outil de suivi des bugs est <a href=https://github.com/osrd-project/osrd/issues>github</a>. Il est nécessaire de s&rsquo;inscrire pour signaler un bug.</p><p>Suivez <a href=https://github.com/osrd-project/osrd/issues/new/choose>ce lien</a> et choisissez le modèle qui correspond à votre cas de figure.</p><h3 id=bugs>Bugs</h3><ul><li>Le bug doit avoir une description correcte et le modèle du bug doit être rempli avec soin.</li><li>Le bug doit être étiqueté avec (<em>pour les membres de l&rsquo;équipe</em>) :<ul><li><code>kind:bug</code></li><li>une ou plusieurs <code>area:&lt;affected_area></code> si possible (si la zone affectée n&rsquo;est pas connue, laissez-la vide et elle sera ajoutée plus tard par un autre membre de l&rsquo;équipe).</li><li>un <code>severity:&lt;bug_severity></code> si possible (si la sévérité n&rsquo;est pas connue, laissez-la vide et elle sera ajoutée plus tard par un autre membre de l&rsquo;équipe).<ul><li><code>severity:minor</code> : L&rsquo;utilisateur peut encore utiliser la fonctionnalité.</li><li><code>severity:major</code> : L&rsquo;utilisateur ne peut parfois pas utiliser la fonctionnalité.</li><li><code>severity:critical</code> : L&rsquo;utilisateur ne peut pas utiliser la fonctionnalité.</li></ul></li></ul></li><li>Les membres de l&rsquo;équipe OSRD peuvent modifier les étiquettes des problèmes (gravité, domaine, type, &mldr;).
Vous pouvez laisser un commentaire pour expliquer les changements.</li><li>Si vous travaillez sur un bug ou planifiez de travailler sur un bug, assignez vous au bug.</li><li>Les PRs qui résolvent des bugs doivent ajouter des tests de régression pour s&rsquo;assurer que le bug ne reviendra pas dans le futur.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-36fd9d9c7b9062f338d5605e7f31eec2>3.1.2 - Contribuer du code</h1><div class=lead>Apporter des modifications au code d&rsquo;OSRD</div><div class="alert alert-warning" role=alert><p>Tout le code du dépot OSRD est mis à disposition sous <a href=https://choosealicense.com/licenses/lgpl-3.0/>la licence LGPLv3</a>.
En contribuant du code, vous acceptez la redistribution de votre contribution sous cette license.</p><p>La licence LGPL interdit de modifier OSRD sans publier le code source de l&rsquo;application modifiée: profitez du travail des autres, et laissez les autres profiter de votre travail !</p><p>Cette contrainte n&rsquo;est pas contagieuse à travers les API: Il est possible d&rsquo;utiliser OSRD comme bibliothèque, framework ou serveur pour s&rsquo;interfacer avec des composants propriétaires. N&rsquo;hésitez pas à proposer des changements pour répondre à vos besoins.</p></div><h2 id=mise-en-place>Mise en place</h2><div class="alert alert-info" role=alert>La plupart des développeurs OSRD utilisent Linux. Vous pouvez utiliser Windows ou MacOS, mais pourriez rencontrer quelques problèmes.</div><h3 id=obtenir-le-code-source>Obtenir le code source</h3><ul><li>Installer <a href=https://git-scm.com/><code>git</code></a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></li><li>Ouvrir un terminal<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> dans le dossier qui contiendra le code source d&rsquo;OSRD</li><li><code>git clone git@github.com:osrd-project/osrd</code></li></ul><h3 id=lancer-lapplication-avec-docker-compose>Lancer l&rsquo;application avec docker compose</h3><p>Pendant longtemps, même dans les cas où on ne développe que sur une partie des composants de l&rsquo;application à la fois, il était necessaire de compiler, configurer et lancer les différents composants de l&rsquo;application.</p><p>L&rsquo;outil <code>docker compose</code>, sert à lancer les composants d&rsquo;OSRD.</p><ul><li>Installer <code>docker</code> et <code>docker compose</code><sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></li><li>Lancer <code>docker compose up --build</code></li></ul><h2 id=partager-vos-changements>Partager vos changements</h2><p>Ce chapitre décrit le processus aboutissant à l&rsquo;intégration de code au sein du projet. <strong>Si vous avez besoin d&rsquo;aide, ouvrez une issue ou envoyez un message instantané.</strong></p><ol><li><p>Si vous n&rsquo;être pas un habitué de Git, <a href=https://learngitbranching.js.org/>suivez ce tutoriel</a></p></li><li><p><strong>Créez une branche</strong><br>Si vous comptez contribuer régulièrement, vous pouvez demander accès au <a href=https://github.com/osrd-project/osrd>dépot principal</a>. Sinon, <a href=https://github.com/osrd-project/osrd/fork>créez un fork</a>.</p></li><li><p><strong>Ajoutez des changements sur votre branche</strong><br>Essayez de découper votre travail en étapes macroscopiques, et sauvegardez vos changements dans un commit à la fin de chaque étape. Essayez de suivre <a href=../conventions/>les conventions du projet</a>.</p></li><li><p><strong>Conservez votre branche à jour</strong></p><pre tabindex=0><code>git switch &lt;your_branch&gt;
git fetch
git rebase origin/dev
</code></pre></li><li><p><strong>Ouvrez une pull request</strong><br>Une fois que vos changements sont prêts, il est temps de proposer de les intégrer à la branche <code>dev</code>. Cela se fait <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request>dans l&rsquo;interface web de Github</a>.
Si possible, faites des PRs d&rsquo;unités logiques et atomiques également (évitez de mélanger le refactoring, les nouvelles fonctionnalités et la correction de bugs en même temps).
Ajoutez une description aux PR pour expliquer ce qu&rsquo;elles font et pourquoi.
Aidez le relecteur en suivant les conseils donnés dans <a href=https://mtlynch.io/code-review-love/>l&rsquo;article de mtlynch</a>.
Ajouter les balises <code>area:&lt;affected_area></code> pour montrer quelle partie de l&rsquo;application a été impactée.
Cela peut être fait via <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request>l&rsquo;interface web</a>.</p></li><li><p><strong>Prennez en compte les retours</strong><br>Une fois que votre pull request est ouverte, <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/about-pull-request-reviews>d&rsquo;autres contributeurs doivent donner leur avis sur votre proposition</a>:</p><ul><li>N&rsquo;importe qui peut donner son avis</li><li>Il est nécessaire d&rsquo;obtenir l&rsquo;approbation d&rsquo;un <a href=https://github.com/osrd-project/osrd/blob/dev/.github/CODEOWNERS>code owner</a> pour pouvoir intégrer le changement.</li><li>Il est d&rsquo;usage de prendre en compte tous les commentaires critiques</li><li>Les commentaires sont souvent écrits dans un style plutôt direct, dans le soucis de collaborer efficacement vers une solution acceptable par tous.</li><li>Une fois que tous les commentaires ont été pris en compte, un mainteneur intègre le changement.</li></ul><p>En tant que reviewer tentez de suivre les recommandations de <a href=https://mtlynch.io/human-code-reviews-1/>mtlynch</a>.</p></li><li><p><strong>N&rsquo;hésitez pas à relancer vos interlocuteurs, plusieurs fois si besoin.</strong></p></li></ol><h2 id=style-des-commits>Style des commits</h2><p>Le format général des commits est le suivant :</p><pre tabindex=0><code>composant: description du changement à l&#39;impératif

Description détaillée du contenu et de la motivation du changement,
si le titre n&#39;est pas complètement évident.
</code></pre><ul><li><strong>le message comme le code doit être en anglais</strong></li><li>tout en minuscule</li><li>il peut y avoir plusieurs composants, séparés par des <code>:</code> quand il y a une relation hiérarchique, ou des <code>,</code> sinon</li><li>dans l&rsquo;idéal, le corps du commit contient une description du changement.</li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Sous Linux, utilisez le gestionnaire de packet de votre distribution, comme par exemple <code>apt-get</code>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Sous Windows, ouvrez <code>Git Bash</code>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=td-content style=page-break-before:always><h1 id=pg-4b20998c4cff1069b7056c902d0828a6>3.1.3 - Conventions</h1><div class=lead>Conventions de codes et bonnes pratiques</div><p>L&rsquo;application OSRD est divisée en plusieurs services écrits dans plusieurs langues. Nous essayons de suivre les bonnes pratiques générales en matière de code et de respecter les spécificités de chaque langue lorsque cela est nécessaire.</p><h2 id=règles-générales>Règles générales</h2><ul><li>Expliquez ce que vous faites et pourquoi.</li><li>Documentez le nouveau code.</li><li>Ajoutez des tests clairs et simples.</li><li>Décomposez le travail en morceaux intelligibles.</li><li>Prenez le temps de choisir de bons noms.
Évitez les abréviations peu connues.</li><li><strong>Contrôle et cohérence de la réutilisation du code de tiers</strong> : Ajoutez une dépendance que si elle est absolument nécessaire.
Chaque dépendance ajoutée diminue notre autonomie et notre cohérence.</li><li><strong>Ne pas réinventer la roue</strong> : En opposition au point précédent, ne réinventez pas tout à tout prix.
S&rsquo;il existe une dépendance dans l&rsquo;écosystème qui est le standard &ldquo;de-facto&rdquo;, nous devrions fortement envisager de l&rsquo;utiliser.</li><li>Plus de code et de recommandations générales dans le dépôt principal <a href=https://github.com/osrd-project/osrd>CONTRIBUTING.md</a>.</li><li>Demandez toute l&rsquo;aide dont vous avez besoin !</li></ul><h3 id=python>Python</h3><p>Le code Python est utilisé pour certains paquets et pour les tests d&rsquo;intégration.</p><ul><li>Suivez le <a href=https://www.python.org/dev/peps/pep-0020/>Zen of Python</a>.</li><li>Le code est linté avec <a href=https://github.com/csachs/pyproject-flake8>flake8</a>.</li><li>Le code est formaté avec <a href=https://github.com/psf/black>Black</a>.</li><li>Les imports sont triées avec <a href=https://github.com/PyCQA/isort>Isort</a>.</li><li>Les tests sont écrits avec <a href=https://docs.pytest.org/>pytest</a>.</li></ul><h3 id=rust>Rust</h3><ul><li>Comme référence pour le développement de notre API, nous utilisons les <a href=https://rust-lang.github.io/api-guidelines/about.html>Rust API guidelines</a>.
D&rsquo;une manière générale, il convient de les respecter.</li><li>Préférer les importations granulaires aux importations globales comme <code>diesel::*</code>.</li><li>Les tests sont écrits avec le <a href=https://doc.rust-lang.org/book/ch11-01-writing-tests.html>framework de base</a>.</li><li>Utilisez l&rsquo;<a href=https://doc.rust-lang.org/rust-by-example/meta/doc.html>exemple de documentation</a> pour savoir comment formuler et formater votre documentation.</li><li>Utilisez un style de commentaire cohérent :<ul><li><code>///</code> les commentaires de la documentation sont au-dessus des invocations <code>#[derive(Trait)]</code>.</li><li>Les commentaires <code>//</code> doivent généralement être placés au-dessus de la ligne en question, plutôt qu&rsquo;en ligne.</li><li>Les commentaires commencent par des lettres majuscules.
Terminez-les par un point s&rsquo;ils ressemblent à une phrase.</li></ul></li><li>Utilisez les commentaires pour organiser des portions de code longues et complexes qui ne peuvent être raisonnablement remaniées en fonctions distinctes.</li><li>Le code est linté avec <a href=https://github.com/rust-lang/rust-clippy>clippy</a>.</li><li>Le code est formaté avec <a href=https://github.com/rust-lang/rustfmt>fmt</a>.</li></ul><h3 id=java>Java</h3><ul><li>Le code est formaté avec <a href=https://checkstyle.sourceforge.io/>checkstyle</a>.</li></ul><h3 id=javascript--typescript--front>Javascript / Typescript / Front</h3><ul><li>Lorsque vous ajoutez de nouveaux fichiers, écrivez-les en TypeScript car l&rsquo;objectif est de passer l&rsquo;ensemble du code à TypeScript.</li><li>Utiliser les endpoints générés à partir des fichiers <code>openapi.yaml</code> pour consommer le backend.</li><li>Le code a été linté avec [eslint] (<a href=https://eslint.org/)>https://eslint.org/)</a>.</li><li>Le code est formaté avec <a href=https://prettier.io/>prettier</a>.</li><li>Des tests de bout en bout sont nécessaires pour les fonctionnalités stables et critiques.
<a href=https://playwright.dev/>Playwright</a> est utilisé pour écrire ces tests.</li><li>Pour écrire des tests unitaires, utilisez <a href=https://vitest.dev/>vitest</a>.</li></ul><h3 id=tests-dintégration>Tests d&rsquo;intégration</h3><ul><li>Les tests d&rsquo;intégration sont écrits avec <a href=https://docs.pytest.org/>pytest</a> dans le dossier <code>/tests</code>.</li><li>Chaque route décrite dans les fichiers <code>openapi.yaml</code> doit avoir un test d&rsquo;intégration.</li><li>Le test doit vérifier à la fois le format et le contenu des réponses valides et invalides.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-bb9e59bd21eff9466389bb1ebb38e3bd>3.1.4 - Passer du code en revue</h1><div class=lead>Comment faire des retours constructifs</div><figure><a href=https://www.morling.dev/blog/the-code-review-pyramid/><img src=/fr/docs/guides/contribute/code-reviews/images/code_review_pyramid.svg></a></figure></div><div class=td-content style=page-break-before:always><h1 id=pg-832f909b334141dbaf6f1870b993b367>4 - Référence technique</h1><div class=lead>Machinerie interne et APIs</div><p>Les guides de référence technique contiennent des références techniques pour les API et autres aspects de la machinerie OSRD. Ils présentent son fonctionnement et la manière de l’exploiter en partant du principe que les concepts clés de base sont maîtrisés.</p></div><div class=td-content><h1 id=pg-b5e4bdbf196beb2ab115d04daf58146b>4.1 - Architecture</h1><div class=lead>Détails lié à l&rsquo;architecture de OSRD</div><p>Les documents d&rsquo;architecture permettent de comprendre comment OSRD fonctionne globalement.</p></div><div class=td-content><h1 id=pg-21c6725e49c5e2766b8042790b5db698>4.1.1 - Flux des données</h1><div class=lead>Schéma des flux des données d&rsquo;osrd</div><p><img src=data_flow.svg alt="Data-flow diagram"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-edf52d1d45d4337614b654cb14e38066>4.1.2 - Services</h1><div class=lead>Architecture des services de l&rsquo;application</div><p>Il s’agit d’une architecture multi-services où plusieurs composants logiciels interagissent entre eux. Ce choix a été fait pour assurer la modularité du code et pour garantir l’exploitabilité de certains services d’OSRD par des applications extérieures.</p><p><img src=services.fr.svg alt="Schéma des services du projet"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4f5886dd5946f64520e4862a078500b8>4.2 - Documents de conception</h1><div class=lead>Détails liés à la conceptions de solutions techniques</div><p>Les documents de conceptions décrivent comment et pourquoi un composant logiciel a été conçu, de l&rsquo;exposition du problème à la solution technique, en passant par le chemin pris pour y arriver.</p></div><div class=td-content><h1 id=pg-7f1a0daf0354ed2b782628a3f5c6f5c4>4.2.1 - Poste d'aiguillage</h1><div class=lead>Décrit le fonctionnement du poste d&rsquo;aiguillage virtuel</div><p>Le modèle de simulation définit le rôle et comportement des différents objets simulés au sein d&rsquo;OSRD.</p><p>Cette modélisation est un compromis entre de multiples enjeux:</p><ul><li>fidélité de la simulation</li><li>interprétabilité des résultats</li><li>adaptabilité du modèle à différentes technologies et usages, que cela soit en terme de signalisation, de poste d&rsquo;aiguillage, ou d&rsquo;usage des données</li></ul><p>En particulier, certaines subtilités propres aux systèmes pratiques ont été sacrifiées sur l&rsquo;autel de la compatibilité et de l&rsquo;interprétabilité:</p><ul><li>un signal doit forcément s&rsquo;addresser à un train en particulier: les signaux n&rsquo;ont pas d&rsquo;aspect par défaut; ils n&rsquo;existent que pour être vus</li><li>les itinéraires / routes sont formées à destination d&rsquo;un train en particulier</li></ul><div class="pageinfo pageinfo-info"><p>Ce document est une description du modèle de fonctionnement cible d&rsquo;OSRD.
Il a pour objectif de renseigner développeurs et experts métiers sur le fonctionnement du simulateur.
Des changements y sont apportés au fil de l&rsquo;évolution du projet.</p></div><div class="pageinfo pageinfo-warning"><p>Ce modèle est en cours d&rsquo;implémentation</p></div><h2 id=architecture>Architecture</h2><pre tabindex=0><code class=language-mermaid data-lang=mermaid>flowchart TD
    %%%% NODES

    train[Train]
    %% ↓
    signaling[Signalisation]
    %% ↓
    routing[Routage]
    ordering[Ordonnancement]
    %% ↓
    reservation[Réservation]
    %% ↓
    location[Localisation]
    movable-elements[&#34;Éléments mobiles&#34;]

    %%%% EDGES

    train -- réagit à --&gt; signaling
    train -- réclame les itinéraires --&gt; ordering
    ordering -- commande --&gt; routing
    signaling -- observe --&gt; reservation
    routing -- observe et réserve --&gt; reservation
    reservation -- observe --&gt; location
    reservation -- actionne --&gt; movable-elements
    train -- informe --&gt; location

    %%%% CLICKABLE LINKS

    click train href &#34;./train/&#34; _self
    click ordering href &#34;./ordering/&#34; _self
    click signaling href &#34;./signaling/&#34; _self
    click routing href &#34;./routing/&#34; _self
    click reservation href &#34;./reservation/&#34; _self
    click location href &#34;./location/&#34; _self
    click movable-elements href &#34;./movable-elements/&#34; _self
</code></pre><div class="alert alert-info" role=alert><h4 class=alert-heading>Pistes d'évolution</h4><ul><li>Gestion des overlaps</li></ul></div><h2 id=remerciements>Remerciements</h2><p>Par ordre alphabétique:</p><ul><li>Christophe Mémin</li><li>Djamal Bellebia</li><li>Gilles Dessagne</li><li>Nathanaël Dias</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ee6003e9414db3f0e05978636a844345>4.2.1.1 - Éléments mobiles</h1><div class=lead>Gère l&rsquo;état des organes de commande des aiguilles, passages à niveau, …</div><h2 id=description>Description</h2><p>Chaque élément mobile, aiguille ou passage à niveau, a une liste d&rsquo;états possibles.
Ces états sont mutuellement exclusifs.</p><h2 id=dépendances>Dépendances</h2><ul><li><code>statique</code> une liste d&rsquo;élements mobiles</li><li><code>statique</code> liste des états possibles de chaque élément mobile</li></ul><h2 id=opérations-possibles>Opérations possibles</h2><ul><li>observer un élément mobile</li><li>verrouiller / déverrouiller un élément mobile</li><li>bouger un élément mobile</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f9ae9ad8e8b03f8f0fcbef3b7d4be0b9>4.2.1.2 - Localisation</h1><div class=lead>Fournit les informations de position des trains sur le réseau</div><h2 id=description>Description</h2><p>La couche de localisation permet à d&rsquo;autres modules de simulation de suivre le déplacement du train dans l&rsquo;infrastructure.
L&rsquo;infrastructure ferroviaire est découpée en régions appelées zones. Quand on train entre dans une zone, ce module permet d&rsquo;en être notifié.</p><p>Les zones (ou TVDSection / DetectionSection) sont des partitions physiques des voies :</p><ul><li>capables de détecter la présence d&rsquo;un train</li></ul><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>il doit être possible de suivre les changements d&rsquo;occupation d&rsquo;une zone</li><li>il <em>devra</em> être possible de suivre les déplacements d&rsquo;un train</li><li>il <em>devra</em> être possible d&rsquo;implémenter un système de bloc mobile</li></ul><h2 id=dépendances>Dépendances</h2><ul><li><code>statique</code> une liste de zones</li></ul><h2 id=opérations>Opérations</h2><ul><li>Occuper une zone</li><li>Libérer une zone</li><li>Observer les changements d&rsquo;occupation d&rsquo;une zone</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-102b27462f1d7abc5a5824a7ba5d0b82>4.2.1.3 - Reservation</h1><div class=lead>Gère l&rsquo;état de réservation des zones</div><div class="alert alert-warning" role=alert>Le mot réservation ici a pour sens réservation de la resource itinéraire, et non le sens commande plannifiée d&rsquo;itinéraire</div><h2 id=description>Description</h2><p>Les zones (ou TVDSection / DetectionSection) sont des partitions physiques des voies :</p><ul><li>capables de détecter la présence d&rsquo;un train</li><li>qui fournissent un service de réservation à l&rsquo;usage des routes</li></ul><p>Chaque zone a un certain nombre de configurations différentes.
Par exemple, une zone sans aiguille aura deux configurations :</p><ul><li>sens pair</li><li>sens impair</li></ul><p>Une zone avec une aiguille aura 4 configurations possibles :</p><ul><li>sens pair voie principale</li><li>sens impair voie principale</li><li>sens pair voie déviation</li><li>sens impair voie déviation</li></ul><p><strong>Chaque zone ne peut être réservée que pour une configuration donnée à la fois, mais peut être réservée simultanément par plusieurs routes</strong>.
Une zone ne peut changer de configuration que lorsqu&rsquo;elle n&rsquo;est pas réservée.</p><div class="alert alert-info" role=alert><p>En discutant avec des experts métiers, vont entendrez parler d&rsquo;<a href=https://fr.wikipedia.org/wiki/Enclenchement>enclenchements</a>:
le terme viens de l&rsquo;époque où les postes de signalisations étaient entièrement mécaniques.
Les enclenchements étaient alors des objets physiques qui empêchaient certaines configurations.</p><p>Une conséquence de cet héritage historique et que beaucoup de règles ferroviaires sont exprimées par contraintes au lieu d&rsquo;être exprimées par garanties.
Un enclenchement, c&rsquo;est une garantie qu&rsquo;une situation particulière ne peut pas se produire.</p></div><h3 id=état-dynamique-dune-zone>État dynamique d&rsquo;une zone</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>ZoneState</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// A list of active reservations.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// Each reservation requires a particular configuration to be upheld.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>reservations</span>: <span style=color:#000>VecDeque</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>ZoneReservation</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>ZoneReservation</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The train which requires this reservation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>train</span>: <span style=color:#000>TrainHandle</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// The configuration required for this reservation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>requirements</span>: <span style=color:#000>ZoneRequirements</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The state of this reservation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>status</span>: <span style=color:#000>ZoneReservationStatus</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>ZoneReservationStatus</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// In the process of being reserved, but not yet ready
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>PRE_RESERVED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The train can arrive anytime
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>RESERVED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The train is inside the zone
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>OCCUPIED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// The zone is pending release
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>PENDING_RELEASE</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>ZoneRequirements</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>entry</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DirDetector</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>exit</span>: <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DirDetector</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>movable_elements</span>: <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>MovableElement</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>MovableElementConfig</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>impl</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ZoneState</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/// Get the combined requirements for all the currently active reservations
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>get_combined_requirements</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#204a87>Option</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>ZoneRequirements</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>reservations</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>map</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#000>res</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>requirements</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>.</span><span style=color:#000>reduce</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>b</span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ZoneRequirements</span>::<span style=color:#000>combine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>b</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Les zones doivent pouvoir être <strong>verrouillées</strong> dans une configuration particulière.</li><li>Il doit être possible pour plusieurs routes de <strong>partager une réservation</strong> de configuration.</li><li>Il doit être possible d&rsquo;observer l&rsquo;<strong>évolution de statut d&rsquo;une réservation</strong>.</li><li>Il doit être possible de faire évoluer le statut d&rsquo;une réservation.</li></ul><h2 id=dépendances>Dépendances</h2><ul><li><code>statique</code> les détecteurs qui délimitent chaque zone</li><li><code>statique</code> les aiguilles dans chaque zone</li><li><code>dynamique</code> capacité d&rsquo;observer l&rsquo;occupation des zones</li><li><code>dynamique</code> capacité d&rsquo;actionner les éléments mobiles</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>espacement</strong>: Observer l&rsquo;état d&rsquo;une zone</li><li><strong>routage</strong>: Verrouiller et déverrouiller la zone : permet d&rsquo;obtenir un droit d&rsquo;action. Toutes les opérations en écriture nécessitent d&rsquo;avoir acquis le verrou.</li><li><strong>routage</strong>: Attendre que toutes les réservations d&rsquo;une zone expirent</li><li><strong>routage</strong>: Pré-réserver une configuration de zone</li><li><strong>routage</strong>: Confirmer la réservation d&rsquo;une zone</li><li><strong>routage</strong>: Attendre que la réservation de la zone soit occupée par son train</li><li><strong>routage</strong>: Relacher une réservation de zone</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-db83f9bbda0f6a9be54f5872c94185f4>4.2.1.4 - Routage</h1><div class=lead>Gère le cycle des routes</div><h2 id=description>Description</h2><ul><li>Les routes ont pour responsabilité d&rsquo;autoriser le déplacement des trains dans l&rsquo;infrastructure. Elles doivent se terminer à un point où l&rsquo;arrêt du train est prévu (en terme de signalisation, pas voyageur).</li><li>Les routes sont assimilables à des itinéraires, ou à des suites d&rsquo;itinéraires et d&rsquo;installations de pleine voie.</li><li>Les routes n&rsquo;ont pas de lien direct avec le cantonnement et la signalisation. Elles nourissent des informations sur la disponibilité des voies qui sont utilisées par le cantonnement et la signalisation.</li><li>Une route est un chemin de détecteur en détecteur. Elle représente une portion de chemin qu&rsquo;il est sûr pour un train d&rsquo;emprunter.</li><li>Les routes ont des points de libération, qui sont des détecteurs qui délimitent quand détruire l&rsquo;itinéraire, ce qui permet d&rsquo;implémenter transit souple, rigide, et entre-deux.</li><li>Une route peut être à nouveau formée alors qu&rsquo;un train est déjà en train de la parcourir. Cela permet à plusieurs trains de se suivre sur la même route.</li></ul><h3 id=cycle-de-vie-dune-route>Cycle de vie d&rsquo;une route</h3><p>Les routes n&rsquo;ont pas d&rsquo;état, mais leur commande donne lieu à une suite d&rsquo;événements systématique :</p><ul><li>le système commande toutes les routes sur le trajet du train dans l&rsquo;ordre, sans attendre<ul><li>la commande doit être acceptée par le <strong>régulateur</strong></li></ul></li><li>lorsque le régulateur accepte la commande, la <strong>formation</strong> commence<ul><li>le droit d&rsquo;action de chaque zone de la route est acquis, selon un ordre global</li><li>en parallèle pour toutes les zones:<ul><li>si la zone n’est pas dans la configuration souhaitée:<ul><li>si elle est déjà réservée, attendre que les réservations expirent</li><li>sinon, la mettre dans la configuration souhaitée en déplaçant les aiguilles</li></ul></li><li>pré-réserver la zone pour le passage du train</li><li>le droit d&rsquo;action de la zone est cédé</li></ul></li></ul></li><li>une fois que la formation est terminée, la route est <strong>établie</strong><ul><li>pour chaque zone, transformer la pré-réservation du train en réservation</li></ul></li><li>dès que la route est établie, un processus de <strong>destruction de la route</strong> commence<ul><li>pour chaque zone de la route donnant lieu à une libération<ul><li>attendre que le train quitte la zone (que la réservation passe de l&rsquo;état <code>OCCUPIED</code> à l&rsquo;état <code>PENDING_RELEASE</code>)</li><li>libérer la réservation des zones du début de la route jusqu&rsquo;à la zone actuelle</li></ul></li></ul></li></ul><div class="alert alert-info" role=alert><h4 class=alert-heading>Piste d'évolution</h4>Certains postes d&rsquo;aiguillages ont un enclenchement entre itinéraires de sens contraire (affrontement) qui empêche l&rsquo;activation d&rsquo;une route en menant à une zone avec un transit en sens contraire. Il serait envisageable de réserver une zone supplémentaire à la fin du chemin protégé par la route, par sécurité.</div><div class="alert alert-info" role=alert><h4 class=alert-heading>Piste d'évolution</h4>Certains itinéraires en gare ne permettent pas le partage du chemin par plusieurs trains</div><div class="alert alert-info" role=alert><h4 class=alert-heading>Piste d'évolution</h4>En pratique, il pourrait être intéressant d&rsquo;introduire une notion de route partielle afin de réduire le nombre de routes nécessaires: une route partielle est une portion de route qu&rsquo;il n&rsquo;est pas sûr d&rsquo;activer indépendament.</div><h2 id=exigences-de-conception>Exigences de conception</h2><p>Le système doit, indirectement ou directement:</p><ul><li>permettre à la <strong>signalisation</strong> de déterminer si une section de voie est <strong>prête à être empruntée</strong>.</li><li>permettre l&rsquo;<strong>ordonnancement</strong> des trains selon des critères configurables.</li><li>permettre la destruction progressive (<strong>transit souple</strong>) de l&rsquo;itinéraire après le passage du train.</li><li>il doit être possible d&rsquo;avoir plusieurs processus de commande actifs au même moment pour la même route, afin de supporter des trains qui se suivent</li></ul><h2 id=dépendances>Dépendances</h2><ul><li><p><code>statique</code> le chemin des routes de détecteur à détecteur</p></li><li><p><code>statique</code> la position requise des aiguilles, par zone</p></li><li><p><code>statique</code> les points de libération des zones (qui implémentent le transit souple / rigide)</p></li><li><p><code>dynamique</code> <code>régulateur</code> soumettre des commandes</p></li><li><p><code>dynamique</code> <code>réservation</code> acquérir et relacher un droit d&rsquo;action par zone</p></li><li><p><code>dynamique</code> <code>réservation</code> attendre que les réservations d&rsquo;une zone expirent</p></li><li><p><code>dynamique</code> <code>éléments mobiles</code> déplacer des aiguilles</p></li><li><p><code>dynamique</code> <code>réservation</code> pré-réserver une zone</p></li><li><p><code>dynamique</code> <code>réservation</code> promouvoir une pré-réservation en réservation</p></li><li><p><code>dynamique</code> <code>réservation</code> lors de la destruction de la route, attendre qu&rsquo;une réservation passe en <code>PENDING_RELEASE</code></p></li><li><p><code>dynamique</code> <code>réservation</code> libérer une réservation</p></li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>commander une route</strong>: démarre un processus asynchrone qui ne se terminera que lorsque la route aura été établie. <strong>Un processus de destruction doit démarrer dès que la route est établie</strong>.</li></ul><h2 id=notes-de-conception>Notes de conception</h2><p>Ces notes permettent d&rsquo;expliquer les décisions qui ont été prises, afin de pouvoir plus aisément les comprendre et évoluer.</p><h3 id=informer-la-signalisation>Informer la signalisation</h3><p>Sachant que:</p><ul><li>il peut y avoir beaucoup de zones partant d&rsquo;un même point, il est préférable d&rsquo;éviter de contraindre les signaux à observer une liste de routes</li><li>il est potentiellement difficile d&rsquo;associer un état clair à chaque route</li></ul><p>Il en ressort plusieurs manières d&rsquo;informer la signalisation de la navigabilité des voies:</p><ul><li>soit <strong>directement</strong>, en faisant observer à la signalisation les points d&rsquo;entrée des routes. Si plusieurs routes partent du même endroit, elles partageraient un objet entrée:<ul><li>moins de complexité dans la couche de réservation, plus de complexité dans la couche de routage</li></ul></li><li>soit <strong>indirectement</strong>, via la couche de réservation des zones, qui auraient un état supplémentaire pour marquer leur navigabilité:<ul><li>moins de complexité dans la couche de routage, plus de complexité dans la couche de réservation</li><li><code>avantage</code> le processus d&rsquo;activation des routes n&rsquo;aurait pas besoin d&rsquo;attendre l&rsquo;arrivée du train, la couche de réservation s&rsquo;en occuperait.</li><li><code>avantage</code> découplage entre routage et cantonnement / signalisation.</li></ul></li></ul><p>La seconde option a été choisie, car :</p><ul><li>elle permet d&rsquo;avoir un couplage moins fort entre la signalisation et les routes.</li><li>elle évite aussi au processus d&rsquo;activation des routes d&rsquo;attendre le passage du train alors que la couche de réservation le fait déjà.</li></ul><h3 id=cycle-de-vie-des-routes-et-état-des-zones>Cycle de vie des routes et état des zones</h3><p>Plusieurs enjeux motivent le cycle de vie des routes et l&rsquo;état des zones :</p><ul><li>d&rsquo;une part, l&rsquo;état des zones est au coeur de la détection de conflit : il doit être possible d&rsquo;extraire d&rsquo;une simulation d&rsquo;un train seul ses besoins en ressources</li><li>d&rsquo;autre part, il faut qu&rsquo;une simulation multi-train fonctionne correctement : le temps de déplacement des aiguilles selon la configuration actuellement en place, en particulier, est un point de friction important</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d84f7d18068af2c677e12c6761184b2f>4.2.1.5 - Ordonnancement</h1><div class=lead>Décide de l&rsquo;ordre de formation des itinéraires</div><div class="alert alert-warning" role=alert>Cette page est une ébauche, contribuez-y!</div><h2 id=définition>Définition</h2><p>La couche d&rsquo;ordonnancement a pour responsabilité d&rsquo;établir l&rsquo;ordre de commande des itinéraires, et par conséquent, l&rsquo;ordre de passage des trains.
La méthode exacte utilisée pour prendre cette décision n&rsquo;importe pas, du moment qu&rsquo;elle garanti que la simulation se termine (elle ne doit pas amener de trains en nez-à-nez, ou créer d&rsquo;autre cas de figure de blocage).</p><p>Il est possible d&rsquo;implémenter un module d&rsquo;ordonnancement via des tableaux d&rsquo;ordre de succession des trains aux aiguilles.</p><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Il doit être possible de connecter n&rsquo;importe quel algorithme d&rsquo;ordonnancement</li><li>Le module d&rsquo;ordonnancement doit approuver les commandes de routes.</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>train</strong>: Des itinéraires sont <strong>commandés</strong> pour chaque trains, aussi loin et aussi tôt que possible. L&rsquo;approbation de la commande est soumise au régulateur, qui peut la retarder indéfiniment, selon des critères de son choix.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-7430cbed022a567839d982205fb6211d>4.2.1.6 - Train</h1><div class=lead>Représente un train dans la simulation</div><h2 id=description>Description</h2><p>Les contraintes sur ce qu&rsquo;est un train sont relativement faibles.
Il doit seulement avoir un identifiant, qui permet aux autres systèmes de garder des références vers des trains.</p><h2 id=exigences-de-conception>Exigences de conception</h2><ul><li>Les trains <strong>occupent les zones</strong>.</li><li>Les trains doivent être <strong>suivis</strong> pour préserver leur <strong>ordre de passage</strong>.</li><li>Les trains ont pour responsabilité de <strong>demander les itinéraires</strong> devant eux.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-91414828f61d97b52f2ae39b3f79bf94>4.2.2 - Signalisation</h1><div class=lead>Décrit la modèle de signalisation</div><div class="pageinfo pageinfo-warning"><p>Ce document est en attente de revue</p></div><h2 id=description>Description</h2><p>La couche de signalisation comprend l&rsquo;ensemble des signaux, qui réagissent au cantonnement et à la réservation.
Les signaux peuvent être de différent types, et sont chargés de manière modulaire. Seul importe leur comportement
vis-à-vis de l&rsquo;état de l&rsquo;infrastructure, et la réaction des trains à la signalisation.</p><p>Les signaux sont reliés entre eux par des cantons. Les cantons définissent les mouvements autorisés par la signalisation.</p><h2 id=objectifs>Objectifs</h2><p>Le système de signalisation est à la croisée de nombreux besoins:</p><ul><li>il doit permettre de simuler la signalisation de manière réaliste, dans une simulation multi-trains</li><li>il doit permettre au système de détection de conflits de déterminer quelles ressources sont requises pour le train</li><li>il doit permettre aux utilisateurs de l&rsquo;application d&rsquo;éditer et d&rsquo;afficher les signaux</li><li>il doit permettre de visualiser les signaux sur une carte</li></ul><h2 id=exigences-de-conception>Exigences de conception</h2><p>Les données statiques :</p><ul><li>doivent permettre au front de réprésenter les signaux (choisir une image)</li><li>doivent permettre à l&rsquo;éditeur de configurer les signaux</li><li>doivent permettre au back de simuler les signaux</li><li>doivent être proches du métier</li><li>doivent permettre de modéliser des signaux composites, qui représentent en un seul signal physique plusieurs signaux logiques</li></ul><p>Pour la simulation de la signalisation :</p><ul><li>des cantons doivent être générés, à la fois pour l&rsquo;utilisateur et la <strong>compatibilité pathfinding</strong></li><li>chaque signal doit connaître le <strong>prochain signal compatible</strong></li><li>chaque signal doit connaître les <strong>zones qu&rsquo;il protège</strong></li><li>fournir aux modules de signalisation le <strong>minimum d&rsquo;information nécessaire</strong> à leur fonctionnement</li><li>pouvoir utiliser un module de signalisation sans avoir à instancier une simulation complète</li><li>pouvoir avoir des modules qu&rsquo;on puisse charger dans un ordre indépendant</li></ul><h2 id=présupposés>Présupposés</h2><ul><li>chaque signal physique peut être décomposé en une liste de signaux logiques, qui sont tous associés à un système de signalisation</li><li>les cantons ont un type</li><li>il est possible de déterminer étant donné le seul signal, ses propriétés de cantonnement</li><li>il n&rsquo;existe pas de cantons qui chevauchent une fin ou un début de route</li><li>les cantons qui ne sont pas couverts par des routes n&rsquo;existent pas ou peuvent être ignorés</li><li>un train n&rsquo;utilise qu&rsquo;un seul système de signalisation capable de transmettre la MA à la fois</li></ul><h2 id=design-des-systèmes-de-signalisation>Design des systèmes de signalisation</h2><p>Chaque système de signalisation a :</p><ul><li>un identifiant unique (une chaine de caractères)</li><li>un ensemble de rôles :<ul><li>transmission de la MA</li><li>transmission des limites de vitesse</li></ul></li><li>son type d&rsquo;état de signal, qui doit permettre de :<ul><li>savoir s&rsquo;il est contraignant à cause d&rsquo;une MA réduite</li><li>déterminer une représentation graphique de ce signal</li><li>faire réagit un train à ce signal</li></ul></li><li>les paramètres du signal, qui sont utilisés à la fois dans le front pour le configurer et dans le back pour déterminer les informations de cantonnement liées au signal</li><li>la condition de cantonnement, qui permet de savoir si un signal délimite un canton</li></ul><p>Il est à noter que si un système de signalisation a un double rôle transmission de MA et des limites de vitesse, tous les signaux dans ce système ne sont pas forcément chargés de transmettre des informations de limite de vitesse.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># unique identifier for the signaling system</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;id&#34;: </span><span style=color:#4e9a06>&#34;BAL&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;version&#34;: </span><span style=color:#4e9a06>&#34;1.0&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># a list of roles the system assumes</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;roles&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;MA&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;SPEED_LIMITS&#34;</span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># the schema of the dynamic state of signals of this type</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;signal_state&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;enum&#34;, &#34;field_name&#34;: </span><span style=color:#4e9a06>&#34;aspect&#34;</span><span style=color:#204a87;font-weight:700>, values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;VL&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;A&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;S&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;C&#34;</span><span style=color:#000;font-weight:700>]</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: </span><span style=color:#4e9a06>&#34;ralen30&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: </span><span style=color:#4e9a06>&#34;ralen60&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: </span><span style=color:#4e9a06>&#34;ralen_rappel&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># the schema of the settings signals of this type can read</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;signal_settings&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;Nf&#34;, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Non-franchissable&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;has_ralen30&#34;, &#34;default&#34;: false, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Ralen 30&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;has_rappel30&#34;, &#34;default&#34;: false, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Rappel 30&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;has_ralen60&#34;, &#34;default&#34;: false, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Ralen 60&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#204a87;font-weight:700>&#34;kind&#34;: &#34;flag&#34;, &#34;field_name&#34;: &#34;has_rappel60&#34;, &#34;default&#34;: false, &#34;display_name&#34;: </span><span style=color:#4e9a06>&#34;Rappel 60&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># these are C-like boolean expressions:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># true, false, &lt;flag&gt;, &lt;enum&gt; == value, &amp;&amp;, || and ! can be used</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># used to evaluate whether a signal is a block boundary.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;block_boundary_when&#34;: </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># used for conflict detection. </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;constraining_ma_when&#34;: </span><span style=color:#4e9a06>&#34;aspect != VL&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=design-des-cantons>Design des cantons</h2><p>Les cantons ont plusieurs attributs:</p><ul><li>un système de signalisation qui correspond à celui affiché par son premier signal.</li><li>un <strong>chemin</strong>, qui représente les zones protégées par le canton, et leur état attendu (au même format que le chemin des routes)</li><li>un <strong>signal d&rsquo;entrée</strong>, (optionnel quand le canton pars d&rsquo;un butoir)</li><li>des <strong>signaux intermédiaires</strong> éventuels (c&rsquo;est utilisé avec des systèmes du style BAPR)</li><li>un <strong>signal de sortie</strong>, (optionnel quand le canton se termine à un butoir)</li></ul><p>Le chemin est exprimé de détecteur en détecteur afin de pouvoir faire un rapprochement avec le graphe des routes.</p><p>Quelques remarques:</p><ul><li>il peut y avoir plusieurs systèmes de signalisation superposés sur la même infrastructure. le modèle pars du principe qu&rsquo;un seul système à la fois est actif pour la gestion de la MA</li><li>un canton n&rsquo;a pas d&rsquo;état: on peut se reposer sur l&rsquo;état dynamique des zones qui le compose</li><li>les signaux utilisent les cantons pour savoir quelles zones sont à protéger à un instant donné</li></ul><h2 id=design-des-signaux>Design des signaux</h2><p>Chaque signal physique est composé d&rsquo;un ou plusieurs signaux logique, dont les aspects sont combinés pour être représentés sur le terrain. Lors de la simulation, les signaux logiques sont traités comme des signaux différents.</p><p>Chaque signal logique est associé à un système de signalisation, qui définit si le signal transmet
Chaque signal logique peut avoir un certain nombre de pilotes. Les</p><h3 id=signal-non-chargé>Signal non chargé</h3><p>Un <strong>signal non chargé</strong> correspond à l&rsquo;objet capable de transmettre de l&rsquo;information au train. Les signaux non chargés portent :</p><ul><li>un système de signalisation</li><li>des paramètres spécifiques à leur système de signalisation (comme <code>Nf</code> et <code>has_ralen30</code> pour bal)</li></ul><p>Les signaux non chargés sont utilisés pour décrire statiquement l&rsquo;infrastructure, et sont pensés pour être édités par l&rsquo;utilisateur.</p><p>En fonction du contexte, différents mécanismes peuvent être à la source de cette information : ce sont des <strong>pilotes</strong> (<code>drivers</code>). Chaque signal peut porter plusieurs pilotes. Par exemple, un signal BAL qui est à la fois un départ de canton TVM et un départ de canton BAL aura deux pilotes: <code>bal-bal</code> et <code>bal-TVM</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># signals must have location data.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># this data is omited as its format is irrelevant to how signals behave</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;logical_signals&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the signaling system shown by the signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bal&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the settings for this signal, as defined in the signaling system manifest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;settings&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;has_ralen30=true&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Nf=true&#34;</span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># all the ways the signal can be driven</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># optional: if not present, we determine the drivers automatically</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;drivers&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the signal can react to a following bal signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#204a87;font-weight:700>&#34;next_signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bal&#34;</span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the signal can react to a following TVM signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#204a87;font-weight:700>&#34;next_signaling_system&#34;: </span><span style=color:#4e9a06>&#34;TVM&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># signals must have location data.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># this data is omited as its format is irrelevant to how signals behave</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>&#34;logical_signals&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the signaling system shown by the signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bal&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the settings for this signal, as defined in the signaling system manifest</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;settings&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;has_ralen30=true&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Nf=true&#34;</span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># all the ways the signal can be driven</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;drivers&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the signal can react to a following bal signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#204a87;font-weight:700>&#34;next_signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bal&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>{<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># the signaling system shown by the signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bapr&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#8f5902;font-style:italic># all the ways the signal can be driven</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>&#34;drivers&#34;: </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#8f5902;font-style:italic># the signal can react to a following bal signal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span>{<span style=color:#204a87;font-weight:700>&#34;next_signaling_system&#34;: </span><span style=color:#4e9a06>&#34;bapr&#34;</span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Une chaine de charactère simplifiée de description du type de signal peut être généré. Ici: <code>bal[Nf=true,ralen30=true]+bapr</code>.</p><h3 id=chargement-des-paramètres-du-signal>Chargement des paramètres du signal</h3><p>La première étape du chargement du signal est de charactériser le signal dans le système de signalisation.
Cette étape produit un objet qui décrit le signal.</p><p>Lors du chargement du signal :</p><ul><li>le système de signalisation correspondant au nom fourni est identifié</li><li>les paramètres du signal sont chargés et validés suivant la spec du système de signalisation</li><li>le rôle de cantonnement du signal est évalué à partir de l&rsquo;expression</li></ul><h3 id=chargement-du-signal>Chargement du signal</h3><p>Une fois que les paramètres du signal sont chargés, il devient possible de charger ses pilotes. Pour chaque pilote :</p><ul><li>l&rsquo;implémentation du pilote est identifiée à partir de la paire <code>(signaling_system, next_signaling_system)</code></li><li>on vérifie que le système de signalisation sortant du pilote correspond à celui du signal</li><li>on vérifie qu&rsquo;il n&rsquo;existe pas déjà de pilote pour le système de signalisation entrant du pilote</li></ul><p>Cette étape produit une <code>Map&lt;SignalingSystem, SignalDriver></code>, où le système de signalisation est celui en entrée du signal.
Il devient ensuite possible de construire le signal chargé.</p><h3 id=construction-des-cantons>Construction des cantons</h3><ul><li>le framework crée des cantons entre les signaux en suivant les routes présentes dans l&rsquo;infrastructure, et les propriétés de cantonnement des signaux</li><li>des vérifications sont faites sur le graphe de cantons créé : il doit toujours pouvoir être possible de choisir un canton pour chaque signal et chaque état de l&rsquo;infrastructure</li></ul><h3 id=limites-de-vitesse>Limites de vitesse</h3><p>Les limites de vitesse sont représentées comme des ranges sur des itinéraires.
Elles commencent leur vie comme des ranges sur des track sections, et sont liftées en ranges sur des itinéraires de la manière suivante :</p><ul><li>Les limites de vitesse directionnelles par track sont remontées sur les itinéraires. La même limite de vitesse peut être sur plusieurs itinéraires.</li><li>Pour chaque limite de vitesse, le graphe des itinéraires est parcouru à l&rsquo;envers à la recherche de signaux capable de gérer la limite :<ul><li>Seules les limites de vitesse qui ne sont pas précédées par une autre limite aux propriétés identiques sont prises en compte</li><li>Chaque signal doit signaler son intérêt par rapport à une limite de vitesse: Pas concerné, Concerné mais devant être annoncé par un autre signal, ou concerné et terminal.</li></ul></li><li>pour chaque limite de vitesse prévue sur le chemin du train, les signaux dans la chaîne d&rsquo;annonce sont ajoutés à la liste de ceux qui seront simulés pour le train</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>SpeedLimitHandling</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/** This signal isn&#39;t supposed to announce this limit */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Ignore</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/** This signal should announce this limit, but cannot */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Error</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/** This signal can announce this limit, and is part of an ongoing chain */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>Chain</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/** This signal can announce this limit, and ends the chain */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>EndChain</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>handles_speed_limit</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#3465a4>self</span>: <span style=color:#000>SignalSettings</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>speed_limit</span>: <span style=color:#000>SpeedLimit</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>distance_mm</span>: <span style=color:#204a87;font-weight:700>u64</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#000>SpeedLimitHandling</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>handles_speed_limit_chain</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#3465a4>self</span>: <span style=color:#000>SignalSettings</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>speed_limit</span>: <span style=color:#000>SpeedLimit</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>chain_signal</span>: <span style=color:#000>Signal</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>distance_mm</span>: <span style=color:#204a87;font-weight:700>u64</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span>-&gt; <span style=color:#000>SpeedLimitHandling</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=validation-des-cantons>Validation des cantons</h3><p>La validation permet de signaler des configurations invalides en terme de signalisation et de cantonnement.
Les cas de figure de validation que l&rsquo;on souhaite supporter sont les suivants:</p><ul><li>le système de signalisation peut vouloir valider, sachant si le canton pars / se termine sur un butoir :<ul><li>la longueur du canton</li><li>l&rsquo;espacement entre les signaux du canton, premier signal exclu</li></ul></li><li>chaque signal du canton peut avoir des informations specifiques s&rsquo;il est un signal de transition. Par conséquent, tout les drivers de signaux participent a la validation.</li></ul><p>En pratique, il existe deux mécanismes distincts pour répondre à ces deux besoins :</p><ul><li>le <strong>module de système de signalisation</strong> s&rsquo;occupe de valider la signalisation <strong>dans le canton</strong></li><li>les <strong>pilote de signaux</strong>, s&rsquo;occupe de valider les <strong>transitions entre cantons</strong></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#204a87;font-weight:700>extern</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>report_warning</span><span style=color:#000;font-weight:700>(</span><span style=color:#8f5902;font-style:italic>/* TODO */</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>extern</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>report_error</span><span style=color:#000;font-weight:700>(</span><span style=color:#8f5902;font-style:italic>/* TODO */</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>Block</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>startsAtBufferStop</span>: <span style=color:#204a87;font-weight:700>bool</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>stopsAtBufferStop</span>: <span style=color:#204a87;font-weight:700>bool</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>signalTypes</span>: <span style=color:#204a87>Vec</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>SignalingSystemId</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>signalSettings</span>: <span style=color:#204a87>Vec</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>SignalSettings</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>signalPositions</span>: <span style=color:#204a87>Vec</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Distance</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>length</span>: <span style=color:#000>Distance</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>/// Runs in the signaling system module
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>check_block</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>block</span>: <span style=color:#000>Block</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>/// Runs in the signal driver module
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>fn</span> <span style=color:#000>check_signal</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>signal</span>: <span style=color:#000>SignalSettings</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>block</span>: <span style=color:#000>Block</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>// The partial block downstream of the signal - no signal can see backward
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=cycle-de-vie-des-signaux>Cycle de vie des signaux</h3><p>Avant le départ d&rsquo;un train:</p><ul><li>le chemin d&rsquo;un train peut être exprimé soit en routes soit en cantons. Ces deux chemins doivent être superposés</li><li>la file de signaux que le train va rencontrer est établie</li></ul><p>Lors de la simulation :</p><ul><li>au fil du déplacement du train, les informations d&rsquo;occupation des voies devant lui sont synthétisées</li><li>lorsqu&rsquo;un train observe un signal, son état est évalué</li></ul><h3 id=évaluation-de-létat-des-signaux>Évaluation de l&rsquo;état des signaux</h3><p>Les signaux sont modélisés comme une fonction d&rsquo;évaluation, qui consomme les paramètres pouvant influencer son comportement, et retourne l&rsquo;état actuel du signal.</p><p>La fonction d&rsquo;évaluation prend en paramètres, la vue est choisie pour le moment, car plus flexible.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>ZoneStatus</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>/** The zone is clear to be used by the train */</span>
</span></span><span style=display:flex><span>   <span style=color:#000>CLEAR</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>/** The zone is occupied by another train, but otherwise clear to use */</span>
</span></span><span style=display:flex><span>   <span style=color:#000>OCCUPIED</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>/** The zone is incompatible. There may be another train as well */</span>
</span></span><span style=display:flex><span>   <span style=color:#000>INCOMPATIBLE</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>MAView</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** Combined status of the zones protected by the current signal */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>protectedZoneStatus</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>ZoneStatus</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>nextSignalState</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SignalState</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>nextSignalSettings</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SignalSettings</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>DirectSpeedLimit</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** Distance between the signal and the speed limit */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>distance</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Distance</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>speed</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Speed</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>IndirectSpeedLimit</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>distanceToNextSignal</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Distance</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>nextSignalState</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SignalState</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>nextSignalSettings</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SignalSettings</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>SpeedLimitView</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** A list of speed limits directly downstream of the signal */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>directSpeedLimits</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>List</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>DirectSpeedLimit</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>/** A list of speed limits which need to be announced in a signal chain */</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>indirectSpeedLimits</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>List</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>IndirectSpeedLimit</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fun</span> <span style=color:#000>signal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>maView</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>MAView</span><span style=color:#000;font-weight:700>?,</span> <span style=color:#000>limitView</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>SpeedLimitView</span><span style=color:#000;font-weight:700>?):</span> <span style=color:#000>SignalState</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>La vue doit permettre d&rsquo;accéder aux données suivantes :</p><ul><li>une synthèse de l&rsquo;état des zones en aval jusqu&rsquo;à la MA du train</li><li>la chaine de cantons</li><li>l&rsquo;état des signaux en aval présents dans la chaine de cantons du train</li></ul><h4 id=chemin-de-la-vue-signalisation>Chemin de la vue signalisation</h4><p>Le chemin de la vue signalisation est exprimé en cantons :</p><ul><li>des cantons peuvent être rajouter pour étendre la vue</li><li>la vue peut être réduite en supprimant des cantons</li></ul><h4 id=simulation-hors-chemin-du-train>Simulation hors chemin du train</h4><p>Il est possible de simuler la signalisation hors du chemin du train :</p><ul><li>si un signal donne sur des cantons empruntant des chemins différents, il est simulé comme s&rsquo;il était en bout d&rsquo;itinéraire, et sera donc au carré</li><li>si un signal donne sur des cantons empruntant le même chemin, il est simulé avec les autres signaux de la suite, dans une vue construite à cet effet</li></ul><h2 id=dépendances>Dépendances</h2><p>Pour la génération du graphe de cantons :</p><ul><li>graphe des routes. Pour chaque route :<ul><li><code>waypoints: List&lt;DiDetector></code></li><li><code>signals: OrderedMap&lt;Position, UnloadedSignal></code></li><li><code>speed_limits: RangeMap&lt;Position, SpeedLimit></code>, y compris la logique de limite par categorie de train</li></ul></li><li>systèmes de signalisation</li><li>pilotes</li></ul><p>Pour l&rsquo;évaluation :</p><ul><li>chemin du train en cantons</li><li>portion du chemin à évaluer</li><li>pilotes</li><li>état des zones dans la section à évaluer</li></ul><h2 id=opérations>Opérations</h2><ul><li><strong>instancier une vue</strong> crée un cadre dans lequel observer des signaux</li><li><strong>prévoir le chemin</strong> signaler à la vue les cantons qui seront empruntés par le train</li><li><strong>observer un signal</strong> s&rsquo;abonner à l&rsquo;état d&rsquo;un signal (via la vue)</li><li><strong>dépasser un signal</strong> signaler qu&rsquo;un signal a été dépassé par le train (via la vue)</li></ul><h2 id=annexes>Annexes</h2><h3 id=questions-de-recherche>Questions de recherche</h3><ul><li><p>est-ce qu&rsquo;il existe des cantons qui chevauchent une fin de route ? non (loic)</p></li><li><p>est-ce qu&rsquo;il existe des existe des signaux LL(2) ? non en france</p></li><li><p>est-ce qu&rsquo;il existe des signaux qui changent de comportement en fonction du canton actif devant eux ? oui, pour les ralentissements</p></li><li><p>est-ce qu&rsquo;il existe des signaux qui sont le départ de cantons de types différents (bal et bapr par exemple) ? OUI LOL, tvm meme</p></li><li><p>est-ce que le comportement d&rsquo;un signal peut déprendre de quel canton est actif après le signal de fin du canton actuel ? oui, avec les ralentissements ou jaune cli</p></li><li><p>est-ce que certains de signalisation ont besoin d&rsquo;avoir des informations supplémentaires dans les cantons ? mouais, y&rsquo;a des ralentissements, mais c&rsquo;est pas spécialement porté par le canton</p></li><li><p>est-il nominal qu&rsquo;un train aie plusieurs systèmes de signalisation actifs simultanément ? non</p></li><li><p>quand et par qui les cantons sont-ils générés ?</p></li><li><p>quelles sont les données nécessaires à la génération des cantons ?</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2a67b560f64e237130e37a54280c81f6>4.2.3 - Recherche de sillons de dernière minute (STDCM)</h1><p>OSRD permet d&rsquo;ajouter un nouveau train dans une grille horaire déjà établie,
sans générer aucun conflit avec les autres trains. L&rsquo;application directe de cette fonctionnalité
est appelée la <strong>recherche de sillon de dernière minute</strong>.</p><p>L&rsquo;acronyme STDCM (Short Term Digital Capacity Management) est utilisé
pour parler du concept en général.</p></div><div class=td-content><h1 id=pg-5e6a8c58f44ec33565becd41e00148ef>4.2.3.1 - Contexte métier</h1><p>Quelques définitions :</p><h3 id=la-capacité>La capacité</h3><p>La <strong>capacité</strong>, dans ce contexte, correspond à la possibilité de
réserver des éléments d&rsquo;infrastructure pour permettre le passage
d&rsquo;un train.</p><p>La capacité s&rsquo;exprime en fonction de l&rsquo;espace et du temps :
la réservation d&rsquo;un élément peut bloquer une zone précise
qui devient inaccessible aux autres trains, et cette réservation
se fait sur un intervalle de temps.</p><p>On peut la représenter
sur un graphique, avec le temps en abscisse et la distance parcourue
sur un chemin en ordonnée.</p><p><img src=space_time_chart.png alt="Graphique espace temps"></p><blockquote><p>Exemple d&rsquo;un graphique espace-temps montrant le passage d&rsquo;un train.</p><p>Les couleurs représentent ici les aspects des signaux, mais
montrent également une consommation de la capacité :
quand ces blocs se superposent pour deux trains, ils sont en conflit.</p></blockquote><p>Deux trains d&rsquo;une grille horaire sont en <strong>conflit</strong>
quand ils réservent en même temps un même objet, dans des
configurations incompatibles.</p><p><img src=conflict.png alt="Graphique espace temps avec conflit"></p><blockquote><p>Exemple d&rsquo;un graphique espace-temps avec conflit : le second train
est plus rapide que le premier, ils sont en conflit sur la fin du trajet,
quand les rectangles se superposent.</p><p>En essayant de simuler cette grille horaire, le second train serait
ralentis par des signaux indiquant de ralentir, provoqués par la
présence du premier train.</p></blockquote><p>La consommation de capacité est souvent représentée sous la forme de
rectangles car, dans les systèmes de signalisation les plus simples,
il s&rsquo;agit de réservations d&rsquo;une zone fixe dans l&rsquo;espace pendant un intervalle de temps donné.</p><h3 id=les-sillons-horaires>Les sillons horaires</h3><p>Un <strong>sillon</strong> correspond à une réservation de capacité pour le
passage d&rsquo;un train. Il est fixé dans l&rsquo;espace et dans le temps :
le temps de départ et le chemin emprunté sont connus.
Sur les graphiques espace-temps de cette page, un sillon correspond
à l&rsquo;ensemble des blocs pour un train.</p><p>Dans un fonctionnement habituel, le gestionnaire d&rsquo;infrastructure
(ex : SNCF Réseau) propose des sillons à la vente pour les entreprises
ferroviaires (ex : SNCF Voyageurs).</p><p>À une date donnée avant le jour de
circulation prévu, tous les sillons sont attribués. Mais <strong>il peut rester
assez de capacité pour faire rouler plus de trains</strong>. Il est
possible de placer des trains entre les sillons déjà établis,
quand ces derniers sont suffisamment espacés ou n&rsquo;ont pas
trouvé d&rsquo;acheteurs.</p><p>La capacité restante après l&rsquo;attribution des sillons est appelée
la <strong>capacité résiduelle</strong>. Le problème traité ici est la recherche
de sillons dans celle-ci.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-43ea4c19a1c68f9d3854a75420fe7d2b>4.2.3.2 - Module de recherche de sillons</h1><p>Ce module gère la recherche de solution.</p><p>Les entrées et sorties sont fortement simplifiées et abstraites
pour simplifier le problème au maximum et permettre des tests efficaces.</p><p>Pour décrire son fonctionnement en quelques phrases :
l&rsquo;espace de solutions est représenté sous forme d&rsquo;un graphe qui encode le temps,
la position et la vitesse. Une recherche de chemin est ensuite effectuée
dans ce graphe pour trouver une solution. Le graphe est calculé
au fil de son exploration.</p><p>Ce graphe peut d&rsquo;une certaine manière être vu comme une forme
d&rsquo;arbre de décision, si différents chemins peuvent mener au même noeud.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-00f3695c563557ce911133a4e0d319ff>4.2.3.2.1 - Description du format d'entrée</h1><p>Ce module prend plusieurs entrées pour effectuer une recherche de chemin :</p><ul><li>Un graphe décrivant l&rsquo;infrastructure physique</li><li>Des zones non disponibles selon des intervalles de temps</li><li>Des points de départ et d&rsquo;arrivée</li><li>Une fenêtre de départ</li><li>Un temps de parcours maximal</li><li>Des données de simulation (matériel roulant, time step, marges, etc)</li></ul><p>Parmi ces entrées, les deux premières méritent d&rsquo;être détaillées.</p><h4 id=graphe-dinfrastructure>Graphe d&rsquo;infrastructure</h4><p>Aujourd&rsquo;hui, le graphe donné en entrée correspond au graphe
des <code>SignalingRoutes</code>. Mais il peut s&rsquo;agir de n&rsquo;importe quel graphe
orienté permettant de naviguer l&rsquo;infrastructure physique.</p><p>Les seules contraintes sont : les arêtes doivent avoir une longueur,
et il doit être possible d&rsquo;effectuer un calcul de marche sur des
sections d&rsquo;arêtes.</p><h4 id=zones-non-disponibles>Zones non disponibles</h4><p>Cette entrée représente les zones inaccessibles à cause de contraintes
de capacité.</p><p>À chaque arête du graphe est associé un ensemble de &ldquo;bloc d&rsquo;occupation&rdquo;.
Un bloc est composé d&rsquo;une distance de début et de fin (relative
au début de l&rsquo;arête), et un temps de début et de fin.
Il est considéré que la <em>tête</em> du train ne peut pas se trouver dans cette
zone dans l&rsquo;intervalle de temps donné.</p><p>Ces blocs encodent également la marge de grille : s&rsquo;il faut rajouter
<code>x</code> secondes de marges avant le train, chaque bloc est agrandi de
<code>x</code> secondes dans un sens.</p><p>Pour donner un exemple, avec la grille horaire suivante, en
supposant une arête par canton, un train de 42m et
une distance de visibilité de 10m :</p><p><img src=unavailable_sections.svg alt="Exemple de sections non disponibles"></p><ul><li><p>L&rsquo;occupation du canton 1 de t=0 à t=300 le rend non disponible
dans sa globalité pendant cette période.</p></li><li><p>Les 10 derniers mètres du canton 1 sont non disponibles de t=300 à t=360,
car le signal en début de canton 2 doit être vert quand le conducteur le voit.
Il est possible de considérer que ce bloc-ci commence à t=130
(quand le canton du signal suivant n&rsquo;affiche plus de vert),
une superposition
de blocs n&rsquo;étant pas problématique.</p></li><li><p>L&rsquo;occupation du canton 2 de t=130 à t=360 le rend non disponible
pendant cette période. Il est également non disponible à partir de
t=0, car la présence d&rsquo;un train provoquerait un avertissement sur
le canton 1 quand il est utilisé par le train déjà planifié.</p></li><li><p>Les 42 premiers mètres du canton 3 sont non disponibles de t=0 à t=360,
car la queue du train doit avoir libéré le second canton.</p></li><li><p>Le reste du canton 3 est non disponible dans sa globalité
de t=280 à t=360.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0b86147cbfa958e9f4364f4ce2ba795b>4.2.3.2.2 - Représentation de l'espace de solutions</h1><h4 id=principe-général>Principe général</h4><p>Le problème reste une recherche de graphe. En représentant
l&rsquo;espace de solution sous forme de graphe, il est possible de réutiliser
nos outils déjà existants de recherche de chemin.</p><p>Le <em>graphe produit</em> de la position, du temps, et de la vitesse est utilisé.
Autrement dit, chaque élément du graphe contient (entre autres) ces
3 variables.</p><p>Chaque arête du graphe est calculée avec un
<a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/ title="calcul de marche">calcul de marche</a>
pour connaître l&rsquo;évolution de la vitesse et de la position dans le temps.</p><h4 id=représentation-visuelle>Représentation visuelle</h4><p>Le graphe de départ représente l&rsquo;infrastructure physique</p><p><img src=routes_time_1.png alt="Graphe produit (1/3)"></p><p>Il est ensuite &ldquo;dupliqué&rdquo; à des temps différents</p><p><img src=routes_time_2.png alt="Graphe produit (2/3)"></p><p>Puis des nœuds sont reliés de manière à refléter le temps de parcours</p><p><img src=routes_time_3.png alt="Graphe produit (3/3)"></p><h4 id=précisions>Précisions</h4><ul><li>Le graphe est construit <em>au fil de l&rsquo;exploration</em>.</li><li>Une discrétisation est faite au niveau du temps, uniquement pour
évaluer ce qui a déjà été visité. Si le même emplacement est visité une
seconde fois, il faut une certaine différence de temps pour estimer
qu&rsquo;il n&rsquo;est pas déjà visité.</li><li>Toutes les arêtes sont réalisées avec des calculs de marche</li><li>La vitesse n&rsquo;est pas discrétisée ni utilisée pour estimer quel
emplacement est déjà visité, mais elle fait partie des calculs.</li><li>Par défaut, tous les calculs sont faits en allant à la vitesse maximale.
Les ralentissements sont ajoutés seulement quand ils sont nécessaires.</li></ul><h4 id=exemple>Exemple</h4><p>Par exemple, avec l&rsquo;infrastructure suivante en se basant sur
le graphe des voies :
<img src=example_infra.svg alt="Infra d&amp;rsquo;exemple"></p><p>Explorer le graphe des sillons possibles peut donner ce
type de résultat :
<img src=example_graph.svg alt="Représentation du graphe"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-4cbbf502b73f6a39d1784fb6ef5fc8bf>4.2.3.2.3 - Discontinuités et retours en arrière</h1><h4 id=le-problème-des-discontinuités>Le problème des discontinuités</h4><p>Au moment d&rsquo;explorer une arête du graphe, on effectue un calcul de
marche pour connaître l&rsquo;évolution de la vitesse.
Mais il n&rsquo;est pas possible de voir plus loin que l&rsquo;arête en question,
ce qui est gênant pour calculer les courbes de freinages qui peuvent
nécessiter de commencer à freiner plusieurs kilomètres avant l&rsquo;arrivée.</p><p><img src=discontinuity.png alt=Discontinuité></p><blockquote><p>Cet exemple illustre le problème : par défaut
la première arête est explorée en allant à la vitesse maximale.
C&rsquo;est seulement en explorant la seconde arête que la destination devient visible,
sans que la distance restante soit suffisante pour s&rsquo;arrêter.</p></blockquote><h4 id=la-solution--revenir-en-arrière>La solution : revenir en arrière</h4><p>Pour régler ce problème, lorsqu&rsquo;une arête est générée avec une discontinuité
dans les courbes de vitesse, l&rsquo;algorithme revient sur les arêtes précédentes
pour en créer des nouvelles qui incluent les décélérations.</p><p>Pour donner un exemple simplifié, sur un chemin de 4 routes
où le train peut accélérer ou décélérer de 10km/h par route :</p><p><img src=backtracking_1.png alt="Discontinuité (version arêtes, 1/2)"></p><p>Pour que le train s&rsquo;arrête à la fin de la route 4, il doit être au plus à 10km/h
à la fin de la route 3. Une nouvelle arête est alors créée sur la route
3 qui finit à 10km/h. Une décélération est ensuite calculée à rebours de la fin de la route
vers le début, jusqu&rsquo;à retrouver la courbe d&rsquo;origine (ou le début
de l&rsquo;arrête).</p><p>Dans cet exemple, la discontinuité a seulement été déplacée vers la
transition entre les routes 2 et 3. Le procédé est ensuite réitéré
sur la route 2, ce qui donne le résultat suivant :</p><p><img src=backtracking_2.png alt="Discontinuité (version arêtes, 2/2)"></p><p>Les anciennes arêtes sont toujours présentes dans le graphe, elles
peuvent mener à d&rsquo;autres solutions.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-86a0f2f4d5cb5405bb586c1fba4d4c0a>4.2.3.2.4 - Contourner les conflits</h1><p>En explorant le graphe, il arrive souvent de tomber sur des situations
qui mèneraient à des conflits. Il faut être en mesure de rajouter du délai
pour les éviter.</p><h4 id=décalage-du-temps-de-départ>Décalage du temps de départ</h4><p>Dans les paramètres de l&rsquo;algorithme, le temps de départ est donné
sous la forme d&rsquo;une fenêtre : un temps de départ au plus tôt et au plus tard.
Tant que c&rsquo;est possible, il est toujours préférable de décaler le temps
de départ pour éviter les conflits.</p><blockquote><p>Par exemple : un train doit partir entre 10:00 et 11:00. En partant
à 10:00, cela provoque un conflit, le train doit entrer en gare
d&rsquo;arrivée 15 minutes plus tard. Il suffit de faire partir le train à
10:15 pour régler le problème.</p></blockquote><p>Dans OSRD, cette fonctionnalité est gérée en gardant une trace,
à chaque arête, du décalage maximal du temps de départ qui pourra
être ajouté sur la suite du parcours. Tant que cette valeur est suffisante,
tous les conflits sont évités par ce moyen.</p><p>Le décalage du temps de départ est une valeur stockée sur chaque arête
et additionnée à la fin de la recherche de chemin.</p><blockquote><p>Par exemple :</p><ul><li>un train doit partir entre 10:00 et 11:00. La recherche
commence avec un délai maximal de 1:00.</li><li>Après quelques arêtes, une non-disponibilité est constatée
20 minutes après notre passage. La valeur passe donc à
20 minutes pour la suite du parcours.</li><li>Le temps de départ est ensuite décalé de 5 minutes pour contourner
un conflit, modifiant le décalage maximal à 15 minutes.</li><li>Ce procédé continue jusqu&rsquo;à arriver à la fin du trajet, ou
jusqu&rsquo;au point où il faut ajouter plus de délai.</li></ul></blockquote><h4 id=marges-de-construction>Marges de construction</h4><p>Quand la valeur de décalage maximal du temps de départ tombe à 0,
il faut rajouter du délai entre deux points du parcours du train.</p><p><img src=engineering_allowance.png alt="Marge de construction (1/2)"></p><p>Le principe est le même que pour régler les discontinuités de vitesse :
le graphe est parcouru en arrière pour créer de nouvelles arêtes.</p><p><img src=engineering_allowance_edges.png alt="Marge de construction (2/2)"></p><p>La <a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/allowances/ title=marges>marge de construction</a>
est une fonctionnalité du calcul de marche
permettant d&rsquo;ajouter un délai donné entre deux point du parcours.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-878a5654bd8bd9fb14457386180665c4>4.2.3.2.5 - Marge de régularité</h1><p>Une des fonctionnalités qui doit être supportée par STDCM est la
<a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/allowances/ title="marge de régularité">marge de régularité</a>.
L&rsquo;utilisateur doit pouvoir indiquer une valeur
de marge, exprimée en fonction de la distance ou du temps de parcours,
et cette marge doit être ajoutée au trajet.</p><blockquote><p>Par exemple : l&rsquo;utilisateur peut indiquer une marge de 5 minutes au
100km. Sur un trajet de 42km, un trajet de 10 minutes au plus rapide
doit maintenant durer 12 minutes et 6 secondes.</p></blockquote><p>Le problème se situe au niveau de la détection de conflits.
En effet, ralentir le train décale l&rsquo;ensemble du sillon dans le temps
et augmente la capacité consommée.
La marge doit donc être prise en compte pendant l&rsquo;exploration
pour détecter correctement les conflits.</p><p>Pour plus de difficulté, la marge doit suivre le modèle
<a href=/pdf/MARECO.pdf>MARECO</a>.
La marge n&rsquo;est pas répartie uniformément sur le trajet, mais selon
un calcul qui nécessite de connaître l&rsquo;ensemble du trajet.</p><h4 id=marge-linéaire-exprimée-en-fonction-du-temps-de-parcours>Marge linéaire exprimée en fonction du temps de parcours</h4><p>Pour commencer, le problème est résolu avec une marge linéaire,
c&rsquo;est-à-dire répartie uniformément sur le parcours du train.
La vitesse est simplement multipliée par un facteur constant.</p><p>Les <a href=https://osrd.fr/fr/docs/explanation/running_time_calculation/envelopes_system/ title=enveloppes>enveloppes</a>.
calculées pendant l&rsquo;exploration du graphe ne sont
pas modifiées, celles-ci sont toujours à vitesse maximale.
Mais elles sont accompagnées du facteur de vitesse, qui est utilisé
pour calculer les temps de parcours et les conflits.</p><p>C&rsquo;est seulement quand le chemin est trouvé que la marge est appliquée à
l&rsquo;enveloppe finale. Parce qu&rsquo;il s&rsquo;agit uniquement de multiplication par un
facteur, les conflits ne peuvent pas apparaître ici.</p><h4 id=marge-linéaire-exprimée-en-fonction-de-la-distance>Marge linéaire exprimée en fonction de la distance</h4><p>Le principe ici est généralement similaire, mais avec une difficulté
supplémentaire : le facteur n&rsquo;est pas constant au long du trajet.
En effet, un train roulant à faible vitesse parcours moins de distance
dans un même intervalle de temps qu&rsquo;un train à pleine vitesse.
La vitesse est réduite d&rsquo;un facteur plus faible quand le train
roule moins vite.</p><p>Comme le train ne roule pas à vitesse constante pendant son trajet,
le facteur de vitesse évolue d&rsquo;une arête à l&rsquo;autre.
Cela provoque des courbes de vitesse irrégulières.</p><h4 id=marge-mareco>Marge mareco</h4><p>Il s&rsquo;agit ici exclusivement d&rsquo;un post-traitement, car il est impossible
de calculer une courbe mareco sans connaître l&rsquo;intégralité du trajet.
La détection de conflit pendant l&rsquo;exploration se base exclusivement
sur la courbe avec une marge linéaire.</p><p>Cela implique que des conflits peuvent apparaître pendant cette étape.
Pour les éviter, la procédure suivante est appliquée :</p><ol><li>Une marge est appliquée à la courbe sur l&rsquo;ensemble du trajet
avec l&rsquo;algorithme mareco</li><li>Le premier conflit provoqué par le changement est recherché</li><li>S&rsquo;il existe, <em>l&rsquo;application de mareco sera séparée en deux
intervalles</em>. Le point à la position du conflit est alors fixé
dans l&rsquo;espace-temps par rapport à la courbe avec une marge linéaire,
qui elle ne génère pas de conflit.</li><li>Le procédé est répété itérativement jusqu&rsquo;à une absence de conflit.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-9789474a8d15fe1be9951465d5eb1361>4.2.3.2.6 - Détails d'implémentation</h1><p>Cette page précise certains détails d&rsquo;implémentation.
Sa lecture n&rsquo;est pas nécessaire pour comprendre les principes
généraux, mais peut aider avant de se plonger dans le code.</p><h4 id=stdcmedgebuilder>STDCMEdgeBuilder</h4><p>Cette classe est utilisée pour simplifier la création d&rsquo;instances de <code>STDCMEdge</code>,
les arêtes du graphe. Celles-ci contiennent de nombreux attributs,
la plupart pouvant être déterminés en fonction du contexte (comme
le nœud précédent). La classe <code>STDCMEdgeBuilder</code> permet de rendre
certains attributs optionnels et en calcule d&rsquo;autres.</p><p>Une fois instancié et paramétré, un <code>EdgeBuilder</code> a deux méthodes :</p><ul><li><p><code>Collection&lt;STDCMEdge> makeAllEdges()</code> permet de créer toutes
les arêtes possibles dans le contexte donné pour une route donnée.
S&rsquo;il y a plusieurs &ldquo;ouvertures&rdquo; entre des blocks d&rsquo;occupation,
une arête est créée par ouverture. Tous les conflits, leurs
évitements et les attributs associés sont déterminés ici.</p></li><li><p><code>STDCMEdge findEdgeSameNextOccupancy(double timeNextOccupancy)</code> :
Cette méthode permet d&rsquo;obtenir l&rsquo;arête passant par une certaine
&ldquo;ouverture&rdquo; (quand elle existe), identifiée ici par le temps
de la prochaine occupation sur la route. Elle est utilisée à chaque
fois qu&rsquo;une arête doit être re-créée dans un contexte différent,
comme pour appliquer une marge ou corriger une discontinuité.
Elle appelle la méthode précédente.</p></li></ul><h3 id=recherche-de-chemin>Recherche de chemin</h3><h4 id=evaluation-des-distances>Evaluation des distances</h4><p>La fonction utilisée pour déterminer la distance (au sens
de la recherche de chemin) détermine quel chemin sera privilégié.
Le chemin obtenu sera toujours le plus court en fonction du critère
donné.</p><p>Ici, deux paramètres sont utilisés : le temps de parcours total
et l&rsquo;heure de départ. Le second a un poids très faible par rapport
au premier, pour sélectionner en priorité le chemin le plus rapide.
Les détails du calcul sont indiqués dans les commentaires des
méthodes concernées.</p><h4 id=heuristiques>Heuristiques</h4><p>L&rsquo;algorithme de recherche de chemin dans le graphe est un A*,
avec une heuristique basée sur les coordonnées géographiques.</p><p>Cependant, la géométrie des infrastructures générées sont arbitraires,
elle ne correspond pas aux distances indiquées sur les voies.
Il est donc possible que, sur ces infrastructures, les chemins
obtenus ne soient pas les plus courts.</p><p>Il est en théorie possible d&rsquo;utiliser cette heuristique pour
déterminer si le chemin en cours d&rsquo;exploration pourra mener à une
solution dont le temps de parcours ne dépasse pas le maximum.
Mais pour la même raison, ajouter ce critère rend STDCM
inutilisable sur les infrastructures générées.
Plus de détails dans
<a href=https://github.com/osrd-project/osrd/issues/2818>cette issue</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0b00093315849c9bfa952c90dbea33c0>4.2.3.3 - Interface avec la signalisation</h1><p>Cette interface est encore en cours de conception.</p><h4 id=objectifs-et-contraintes>Objectifs et contraintes</h4><p>L&rsquo;interface doit respecter plusieurs critères :</p><ul><li>Les calculs se basent sur le nouveau modèle de signalisation,
avec la notion de réservations d&rsquo;objets capacitaires</li><li>Les sillons générés ne doivent jamais générer de nouveaux conflits :
l&rsquo;interface peut être pessimiste sur les possibilités, mais jamais
plus permissive que la réalité.</li><li>Idéalement, le module de recherche de sillon devrait rester
un bloc indépendant avec un minimum de changements (dans la mesure
du possible).</li></ul><p>L&rsquo;objectif serait donc d&rsquo;interpréter le modèle de signalisation,
pour générer des entrées valides pour le module de recherche
de sillon : un graphe d&rsquo;infrastructure et des intervalles
de disponibilités de sections.</p><h4 id=difficultés>Difficultés</h4><p>La plupart des contraintes établies par la signalisation peuvent
facilement s&rsquo;exprimer sous la forme de sections non disponibles,
sauf dans un cas : le comportement de la signalisation peut dépendre
du chemin emprunté par le train. Pour être capable d&rsquo;exprimer les
disponibilités sur une zone, il peut être nécessaire de devoir
anticiper la direction du train.</p><h4 id=solution-proposée>Solution proposée</h4><p>La proposition est d&rsquo;écrire un nouveau module qui se brancherait au module
de signalisation pour gérer les entrées pour la recherche
de sillon. Il effectuerait un parcours du graphe des itinéraires
pour construire progressivement un graphe avec occupations au bon
format.</p><p>À chaque itinéraire visité, l&rsquo;algorithme regarde jusqu&rsquo;où il est possible
de déterminer l&rsquo;ensemble des occupations, c&rsquo;est-à-dire quel
est le premier signal dont l&rsquo;état dépend du prochain choix
d&rsquo;itinéraire du train. Une arête est alors générée jusqu&rsquo;à ce point,
avec les occupations.</p><p>La partie restante de l&rsquo;itinéraire n&rsquo;est pas encore considérée.
C&rsquo;est seulement lorsque le graphe est exploré un niveau plus loin,
avec l&rsquo;itinéraire suivant, que la fin de l&rsquo;itinéraire précédent
est intégrée. Elle fait alors partie de l&rsquo;arête suivante,
car à ce moment davantage d&rsquo;informations sont disponibles sur le
trajet du train.</p><p>Par exemple :</p><p><img src=example_interface_signaling_1.svg alt="Configuration nécessitant d&amp;rsquo;anticiper"></p><p>Dans cette configuration en BAL3, il est possible de déterminer
l&rsquo;absence de conflit des signaux 1 à 4. Mais l&rsquo;état du signal
5 dépend de l&rsquo;itinéraire emprunté par le train : s&rsquo;il va vers
le haut, le signal 5 affiche un avertissement. Dans le cas
contraire, il affiche un &ldquo;voie libre&rdquo;.</p><p><img src=example_interface_signaling_2.svg alt="Arêtes générées"></p><p>Dans cet exemple, une première arrête est alors générée, allant
du premier signal jusqu&rsquo;à la première incertitude : le point
où le signal 5 est visible.</p><p>Dans un second temps, une nouvelle arête est générée pour chaque itinéraire
accessible depuis la fin du précédent : un vers A, l&rsquo;autre vers B.
La zone entre le signal 5 et l&rsquo;aiguille sera donc dupliquée
entre les deux arêtes, mais les occupations dans cette région seront
différentes.</p><p>Ce graphe peut être généré au fil de l&rsquo;exploration, sans surcoût
initial.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2a332266a38ba0b364467fca3fea9588>4.3 - APIs</h1><div class=lead>Spécification des interfaces de programmation</div></div><div class=td-content><h1 id=pg-6c6648284a8f498a5c7d1c23b0747863>4.3.1 - API</h1><div class=lead>Référence pour l&rsquo;API du service API</div><div id=ohpen_swagger_ui></div><script>window.onload=function(){const e=SwaggerUIBundle({url:"/openapi/api.yaml",dom_id:'#ohpen_swagger_ui',presets:[SwaggerUIBundle.presets.apis,SwaggerUIStandalonePreset]});window.ui=e}</script></div><div class=td-content style=page-break-before:always><h1 id=pg-b82726558bc79465332a6e9c939ccbf4>4.3.2 - Chartos</h1><div class=lead>Référence pour l&rsquo;API du service Chartos</div><div id=ohpen_swagger_ui></div><script>window.onload=function(){const e=SwaggerUIBundle({url:"/openapi/chartos.yaml",dom_id:'#ohpen_swagger_ui',presets:[SwaggerUIBundle.presets.apis,SwaggerUIStandalonePreset]});window.ui=e}</script></div><div class=td-content style=page-break-before:always><h1 id=pg-3c08243c3e7bb0294640211d13991640>4.3.3 - Core</h1><div class=lead>Référence pour l&rsquo;API du service Core</div><div id=ohpen_swagger_ui></div><script>window.onload=function(){const e=SwaggerUIBundle({url:"/openapi/core.yaml",dom_id:'#ohpen_swagger_ui',presets:[SwaggerUIBundle.presets.apis,SwaggerUIStandalonePreset]});window.ui=e}</script></div><div class=td-content style=page-break-before:always><h1 id=pg-d975f6d361d3dce86194fedde84e54b7>4.3.4 - Editoast</h1><div class=lead>Référence pour l&rsquo;API du service Editoast</div><div id=ohpen_swagger_ui></div><script>window.onload=function(){const e=SwaggerUIBundle({url:"/openapi/editoast.yaml",dom_id:'#ohpen_swagger_ui',presets:[SwaggerUIBundle.presets.apis,SwaggerUIStandalonePreset]});window.ui=e}</script></div><div class=td-content style=page-break-before:always><h1 id=pg-c52def2602c6ac6be920ccaddf5c35a0>4.3.5 - JSON Schemas</h1><script src=https://cdn.rawgit.com/caldwell/renderjson/master/renderjson.js></script><div id=container><h1>Infrastructure</h1></div><script>var infra={};tmp=$.ajax({url:"/schemas/infra_schema.json",async:!1,dataType:'json',success:function(e){infra=e}}),document.getElementById("container").appendChild(renderjson(infra))</script><div id=container2><h1>Rolling Stock</h1></div><script>var rolling_stock={};tmp=$.ajax({url:"/schemas/rolling_stock_schema.json",async:!1,dataType:'json',success:function(e){rolling_stock=e}}),document.getElementById("container2").appendChild(renderjson(rolling_stock))</script><style>#container,#container2{text-shadow:none;background:;padding:1em}.renderjson a{text-decoration:none}.renderjson .disclosure{color:#aa026d;font-size:150%}.renderjson .syntax{color:grey}.renderjson .string{color:#000}.renderjson .number{color:cyan}.renderjson .boolean{color:plum}.renderjson .key{color:#aa026d}.renderjson .keyword{color:#fafad2}.renderjson .object.syntax{color:#20b2aa}.renderjson .array.syntax{color:#ffa07a}</style></div><div class=td-content style=page-break-before:always><h1 id=pg-7a585f383d81df4336087f08f7141938>5 - Wiki Ferroviaire</h1><div class=lead>Wiki ferroviaire international</div><p>Ce wiki a pour objectif de rendre accessible aux développeurs des informations sur le monde ferroviaire.</p><p><strong>Cela ne peut se produire que si le contenu est ajouté lorsque nécessaire. Si quelque chose manque, contribuez !</strong></p></div><div class=td-content><h1 id=pg-9767a159f160b01b0c4769a4188a4a71>5.1 - Glossaire</h1><div class=lead>Glossaire thématique d&rsquo;OSRD et du ferroviaire</div><p>À compléter : ouvrez une issue en cas de mot manquant</p><h3 id=a>A</h3><ul><li><strong>ADV</strong> : Appareil de voie</li></ul><h3 id=b>B</h3><ul><li><strong>BA</strong> : Block automatique</li><li><strong>BAL</strong> : Block automatique lumineux</li><li><strong>BAPR</strong> : Block automatique à permissivité restreinte</li><li><strong>BM</strong> : Block manuel</li><li><strong>BMCV</strong> : BM par circuit de voie</li><li><strong>BMVU</strong> : BM de voie unique</li></ul><h3 id=c>C</h3><ul><li><strong>CAPI</strong> : Cantonnement assisté par informatique</li><li><strong>CC</strong> : Commande et contrôle</li><li><strong>COVIT</strong> : Contrôle de vitesse</li><li><strong>CT</strong> : Cantonnement téléphonique</li></ul><h3 id=d>D</h3><ul><li><strong>DAAT</strong> : Dispositif d’arrêt automatique des trains</li><li><strong>DMI</strong> : Driver machine interface : dispositif qui permet la communication entre le système bord et le conducteur</li><li><strong>DV</strong> : Double voie</li></ul><h3 id=e>E</h3><ul><li><strong>EOA</strong> : End of authority (fin d’autorisation de mouvement)</li><li><strong>EPSF</strong> : Établissement public de sécurité ferroviaire</li><li><strong>ETCS</strong> : European train control system (système européen de contrôle commande des trains)</li><li><strong>ERTMS</strong> : European rail traffic management system (système européen de gestion du trafic ferroviaire)</li><li><strong>EVC</strong> : European vital computer. (ordinateur européen de sécurité) : calculateur de bord qui supervise la marche du train en fonction des données sol et bord</li></ul><h3 id=f>F</h3><ul><li><strong>FA</strong> : Fermeture automatique</li><li><strong>FS</strong> : Full supervision (supervision complète) : mode technique dans lequel le train est supervisé en vitesse et déplacement = marche normale attribuée au train</li></ul><h3 id=g>G</h3><ul><li><strong>GI</strong> : Gestionnaire d’infrastructure</li><li><strong>GSM/GFU</strong> : Global system for mobile communication/Groupe fermé d’utilisateurs</li><li><strong>GSM-R</strong> : Global system for mobile communication railways (Système de communication téléphonique pour mobile dédié aux chemins de fer)</li><li><strong>GSM-R Data</strong> : Système de transmission de données entre les installations « sol » et les installations « bord » via le réseau GSM-R</li></ul><h3 id=i>I</h3><ul><li><strong>ICS</strong> : Installations de circulation à contre-sens</li><li><strong>IPCS</strong> : Installations permanentes de contre-sens</li><li><strong>IS</strong> : Installation de sécurité</li><li><strong>ITCS</strong> : Installations temporaires de contre-sens</li></ul><h3 id=j>J</h3><ul><li><strong>JRU</strong> : Juridical recording unit (Enregistreur des paramètres d’exploitation)</li></ul><h3 id=k>K</h3><ul><li><strong>KVB</strong> : Contrôle de vitesse par balises</li></ul><h3 id=l>L</h3><ul><li><strong>LEU</strong> : Line side electronic unit (codeur ERTMS)</li><li><strong>LGV</strong> : Ligne à grande vitesse</li></ul><h3 id=m>M</h3><ul><li><strong>MA</strong> : Movement authority : autorisation donnée à un train de circuler vers un point donné en tant que mouvement supervisé</li></ul><h3 id=n>N</h3><ul><li><strong>Nf</strong> : Non franchissable</li><li><strong>NL</strong> : Non leading (non en tête) : Mode technique de circulation utilisé pour la double traction ou la pousse</li></ul><h3 id=o>O</h3><ul><li><strong>OS</strong> : On sight (conduite à vue) : mode technique de circulation qui autorise le conducteur à s’avancer en marche à vue. En ETCS1, le mode OS accompagné du message textuel national « Voie de service » impose la marche en manoeuvre pour la réception sur voie de service</li></ul><h3 id=p>P</h3><ul><li><strong>PI ETCS</strong> : Point d’information ETCS : constitué d’une ou plusieurs balises transmettant des informations vers le bord (par exemple PI avancé ou PI signal)</li><li><strong>PL</strong> : Pleine ligne</li><li><strong>PLD</strong> : Point limite de domaine : point où une transition entre ETCS et un autre système de signalisation a lieu</li><li><strong>PN</strong> : Passage à niveau</li></ul><h3 id=r>R</h3><ul><li><strong>RBC</strong> : Radio block center : système centralisé fonctionnant avec les enclenchements afin d’établir et de contrôler l’espacement et le mouvement des trains en envoyant et recevant des informations par radio en ETCS2 ou 3</li><li><strong>RFN</strong> : Réseau Ferré National</li><li><strong>RST</strong> : Radio sol-train</li><li><strong>RT</strong> : Renseignement technique</li><li><strong>RV</strong> : Reversing (refoulement) : mode technique de circulation utilisé pour permettre au train de reculer d&rsquo;urgence sans signaux ni ordre dans une zone prédéfinie. Ce mode n&rsquo;est pas utilisé sur le RFN</li></ul><h3 id=s>S</h3><ul><li><strong>SGS</strong> : Système de gestion de la sécurité</li><li><strong>SH</strong> : Shunting (manoeuvre) : mode technique de circulation manoeuvre</li><li><strong>SN</strong> : System national : mode technique de circulation de niveau STM</li><li><strong>SR</strong> : Staff responsible (responsabilité agent) : mode technique de circulation utilisé dans les situations dégradées. Il est utilisable sous la responsabilité respective de l’agent-circulation et du conducteur</li><li><strong>STM</strong> : Specific transmission module (Module spécifique de transmission) : ce dispositif permet à l’ETCS d’utiliser un système de signalisation national</li></ul><h3 id=t>T</h3><ul><li><strong>TECS</strong> : Tableau lumineux d’entrée à contre sens</li><li><strong>TIV</strong> : Tableau indicateur de vitesse</li><li><strong>TR</strong> : Trip : mode technique de circulation entraînant une application irréversible du freinage d’urgence par le système ETCS jusqu’à l’arrêt du train</li><li><strong>TSCS</strong> : Tableau lumineux de sortie à contre sens</li><li><strong>TVM</strong> : Transmission voie machine</li></ul><h3 id=v>V</h3><ul><li><strong>VB</strong> : Voie banalisée</li><li><strong>VP</strong> : Voie principale</li><li><strong>VS</strong> : Voie de service</li><li><strong>VU</strong> : Voie unique</li><li><strong>VUT</strong> : Voie unique temporaire</li><li><strong>VUTP</strong> : Voie unique temporaire à caractère permanent</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b8498fef395f671d9c20ef3d378cbf84>5.2 - Signalisation</h1><div class=lead>Les signaux, régimes d&rsquo;exploitation des trains, et les systèmes d&rsquo;espacement des trains</div><p>Cette section est destinée à exposer les principes généraux relatifs :</p><ul><li>aux signaux</li><li>aux régimes d’exploitation des lignes (à venir)</li><li>aux différents systèmes d’espacement des trains</li></ul><p><img src=/images/docs/railway-wiki/signalling/image-001.png alt></p><p>La grande majorité des informations de cette section sont extraites du <strong><em><a href=./docs/document-pedagogique-signaux-regimes-exploitation-v1.pdf>document pédagogique de l&rsquo;Établissement Public de
Sécurité Ferroviaire (EPSF)</a></em></strong> édité le 05 juillet 2017.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0242f111128bfeecd8a15f62e48fed99>5.2.1 - Les risques ferroviaires</h1><p>Les trains doivent circuler en toute sécurité. Les risques majeurs liés aux circulations ferroviaires sont les suivants :</p><ul><li><strong>le rattrapage</strong> des trains qui circulent dans le même sens sur la même voie ;</li><li><strong>la prise en écharpe</strong>, c’est-à-dire la collision latérale de trains qui circulent sur des itinéraires convergents ;</li><li><strong>le nez à nez</strong>, c’est-à-dire la collision frontale de trains qui circulent en sens contraire sur la même voie ;</li><li><strong>le déraillement</strong> ;</li><li><strong>la collision</strong> avec un obstacle.</li></ul><p>On prévient ces risques notamment par :</p><ul><li>la mise en place d’une signalisation ;</li><li>l’établissement d’un régime d’exploitation de la ligne (double voie, voie banalisée, voie unique) ;</li><li>la mise en place d’un système d’espacement des trains ;</li><li>la mise en oeuvre de procédures d’exploitation.</li></ul><p>D’autres dispositifs techniques contribuent également à couvrir ces risques tels que :</p><ul><li>les installations de sécurité, notamment les enclenchements des postes d’aiguillage ;</li><li>le DAAT qui est un dispositif permettant d’assurer l’arrêt automatique des trains en cas de franchissement intempestif d’un point d’information avec signal d’arrêt fermé ;</li><li>le KVB, le COVIT (TVM) sont des exemples de systèmes de contrôle de la vitesse, avec contrôle de franchissement des signaux non franchissables ;</li><li>le système de contrôle commande des trains, intégré dans l’ETCS.</li></ul><p>La sécurité des circulations repose aussi sur le respect rigoureux des consignes et instructions opérationnelles par tous les agents concernés par la circulation des trains.</p><p>Ces procédures sont de la responsabilité des exploitants ferroviaires. Elles sont décrites dans le manuel du système de gestion de la sécurité (SGS) qu’ils établissent et qui fait l’objet d’une instruction par l’EPSF chargé de délivrer le certificat ou l’agrément de sécurité.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-816196fb20330c2d2e5cc330e95068f2>5.2.2 - Les signaux</h1><h3 id=principe>Principe</h3><p>Pour transmettre au conducteur des ordres et informations liées à la sécurité des circulations, il est fait usage de
signaux. Ces signaux peuvent indiquer des informations relatives aux limites de vitesse, peuvent servir à garantir
l&rsquo;espacement des trains ou donner des indications diverses telles que l&rsquo;accès à des voies de service, des ouvrages
d&rsquo;art à gabarits réduit, etc.</p><h3 id=la-signalisation-à-main>La signalisation à main</h3><p><img src=/images/docs/railway-wiki/signalling/image-009.png alt></p><h3 id=la-signalisation-au-sol>La signalisation au sol</h3><p>La signalisation au sol est normalement implantée à gauche ou au-dessus de la voie concernée.</p><h4 id=signaux-de-protection>Signaux de protection</h4><p><img src=/images/docs/railway-wiki/signalling/image-010.png alt></p><p>Les signaux de protection sont destinés à interdire l’accès à un itinéraire, à une aiguille, à un PN, etc. Ils sont
généralement manœuvrés depuis des postes par des agents de SNCF Réseau.</p><h4 id=signaux-de-cantonnement>Signaux de cantonnement</h4><p><img src=/images/docs/railway-wiki/signalling/image-011.png alt></p><p>Les signaux de cantonnement sont destinés à assurer l’espacement des circulations de même sens.</p><p>Sur les sections de lignes équipées en <a href=../spacing/automatic_block_systems/>block automatique (BA)</a>, les signaux de
cantonnement <strong>se ferment automatiquement</strong> dès l’occupation du canton et restent fermés jusqu’à sa complète libération.</p><p>Sur les sections de lignes équipées en block manuel (BM), les signaux de cantonnement sont <strong>manœuvrés depuis des postes
par des agents du service du GI chargé de la gestion des circulations</strong>.</p><h4 id=signaux-dannonce-darrêt>Signaux d’annonce d’arrêt</h4><p><img src=/images/docs/railway-wiki/signalling/image-012.png alt></p><p>Le carré, le sémaphore et le feu rouge clignotant sont normalement <strong>annoncés à distance</strong> par un <strong>avertissement</strong> qui
peut lui-même être précédé, en signalisation lumineuse, par un feu jaune clignotant.</p><p>Toutefois, les signaux qui ne peuvent être abordés qu’en marche à vue ou en marche en manœuvre ne sont normalement pas
annoncés (par exemple, le guidon d’arrêt). Il en est de même des signaux situés sur voie principale à la sortie des
gares en impasse.</p><h4 id=signaux-dindication-de-marche>Signaux d’indication de marche</h4><p><img src=/images/docs/railway-wiki/signalling/image-013.png alt></p><p>Le feu vert indique au conducteur que la circulation en marche normale est autorisée, s’y rien ne s’y oppose.</p><p>Sur les sections de ligne où la vitesse des trains est supérieure à 160 km/h, un <strong>feu vert clignotant</strong> précède
généralement l’avertissement ou le feu jaune clignotant.</p><h4 id=signaux-de-limitation-de-vitesse>Signaux de limitation de vitesse</h4><p>Ils limitent à un taux déterminé la vitesse des trains sur une partie de voie ou au franchissement de certains points
particuliers (aiguille, traversée de gare, etc.).</p><h5 id=les-limitations-permanentes-de-vitesse-en-complément-de-celles-pouvant-figurer-dans-les-rt>Les limitations permanentes de vitesse (en complément de celles pouvant figurer dans les RT)</h5><ul><li>Sur des parties de voie par tableau indicateur de vitesse (TIV) ordinaire</li></ul><p><img src=/images/docs/railway-wiki/signalling/image-014.png alt></p><ul><li><p>Au franchissement de certains points particuliers (exemple des aiguilles)</p><ul><li>Ralentissement à 30 km/h en signalisation lumineuse</li></ul><p><img src=/images/docs/railway-wiki/signalling/image-015.png alt></p><p><img src=/images/docs/railway-wiki/signalling/image-034.png alt></p><ul><li>Ralentissement à 60 km/h en signalisation lumineuse</li></ul><p><img src=/images/docs/railway-wiki/signalling/image-016.png alt></p><ul><li>TIV mobiles</li></ul><p><img src=/images/docs/railway-wiki/signalling/image-017.png alt>
Ces tableaux peuvent être lumineux ou mécaniques ; lorsqu’ils sont ouverts ils présentent une bande verticale blanche continue.</p><p>Si cela est nécessaire, l’emplacement de l’aiguille (ou de la première aiguille dans le cas d’aiguilles successives) est repéré par un chevron pointe en bas.</p><p><img src=/images/docs/railway-wiki/signalling/image-039.png alt></p><p><img src=/images/docs/railway-wiki/signalling/image-042.png alt></p></li></ul><h5 id=les-limitations-temporaires-de-vitesse>Les limitations temporaires de vitesse</h5><p>Cette signalisation s’applique sur des parties de voie (chantiers de travaux, etc.) sur lesquelles une limitation
temporaire de vitesse doit être observée.</p><p><img src=/images/docs/railway-wiki/signalling/image-045.png alt></p><h4 id=signaux-indicateurs-de-direction>Signaux indicateurs de direction</h4><p>Ils renseignent les conducteurs sur la direction géographique qui leur est donnée.</p><p><img src=/images/docs/railway-wiki/signalling/image-049.png alt></p><h4 id=signaux-caractéristiques-de-prescriptions-particulières>Signaux caractéristiques de prescriptions particulières</h4><p>Ils renseignent les conducteurs sur des particularités.</p><p>On trouve :</p><ul><li>des tableaux</li><li>des pancartes</li><li>la bande lumineuse jaune</li><li>la croix de Saint-André (annulation des signaux)</li></ul><h5 id=exemples-de-tableaux>Exemples de tableaux</h5><p><img src=/images/docs/railway-wiki/signalling/image-018.png alt></p><h5 id=exemples-de-pancartes>Exemples de pancartes</h5><p><img src=/images/docs/railway-wiki/signalling/image-019.png alt></p><h5 id=bande-lumineuse-jaune-horizontale>Bande lumineuse jaune horizontale</h5><p><img src=/images/docs/railway-wiki/signalling/image-021.png alt></p><p>La bande lumineuse jaune horizontale est utilisée en complément de l&rsquo;avertissement. Elle indique au conducteur que son
train est dirigé vers une voie à quai de courte longueur ou bien que sa longueur se trouve réduite.</p><h5 id=croix-de-saint-andré-annulation-des-signaux>Croix de Saint-André (annulation des signaux)</h5><p><img src=/images/docs/railway-wiki/signalling/image-022.png alt></p><h4 id=signalisation-de-sortie-de-certains-faisceaux-ou-groupes-de-voies-convergentes>Signalisation de sortie de certains faisceaux ou groupes de voies convergentes</h4><p>Elle peut être constituée de :</p><p><img src=/images/docs/railway-wiki/signalling/image-020.png alt></p><h3 id=la-signalisation-de-cabine>La signalisation de cabine</h3><p>Sur les lignes à signalisation de cabine, le système transmet de manière continue (ou discontinue) en cabine de conduite
des ordres et une consigne de vitesse associée éventuellement à une distance but.
La signalisation de cabine peut être complétée par une signalisation au sol dans certains cas pour :</p><ul><li><strong>repérer</strong> les points à ne pas dépasser, par exemple :</li></ul><p><img src=/images/docs/railway-wiki/signalling/image-072.png alt></p><ul><li><strong>donner</strong> des ordres de traction électrique, des informations aux points d&rsquo;entrée et de sortie du domaine de
signalisation de cabine, etc.</li></ul><p>Des pancartes ou tableaux indiquent ces ordres et informations.</p><p>Ces repères, pancartes ou tableaux sont implantés :</p><ul><li>à gauche de la voie sur les plateformes à une seule voie ;</li><li>côté piste, à l&rsquo;extérieur sur les plateformes à deux voies ;</li><li>dans le cas de plan de voie plus complexe, les pancartes ou tableaux sont fléchés.</li></ul><p>Nota : les repères ETCS et de la TVM ne sont pas fléchés du fait de leur graphisme indiquant la voie à laquelle ils s&rsquo;adressent.</p><h3 id=point-de-transition-de-signalisation-entrée-sur-lgv-armement-de-la-signalisation-de-cabine>Point de transition de signalisation (entrée sur LGV, armement de la signalisation de cabine)</h3><p>Le point de transition de signalisation (tableau CAB), ainsi que l&rsquo;armement de la signalisation de cabine, se situent à
hauteur ou immédiatement en aval du dernier signal au sol (signal carré).</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3e88a74c4b63b0388ddd2014235fd061>5.2.3 - Les régimes d’exploitation des lignes</h1><h3 id=définition>Définition</h3><p>Ensemble des règles d’exploitation, c’est-à-dire des règles appliquées pour organiser et assurer le trafic, propres à
une ligne en fonction des installations mises en œuvre pour en assurer l’exploitation.</p><p>Les principaux régimes d&rsquo;exploitation sont : la <a href=single-track-lines/single-track>voie unique</a>, la
<a href=single-track-lines/single-track-two-ways>voie banalisée</a>, la <a href=double-track-lines/>double voie</a>.</p><h3 id=principe>Principe</h3><p>Il ne faut pas confondre régime d&rsquo;exploitation et nombre de voies sur une plateforme, car il existe des plateformes à 2
voies qui ne sont pas des « double voie », des plateformes à 3 ou 4 voies qui sont des « double voie », des plateformes
à 1 seule voie qui ne sont pas des « voie unique ».</p><p>Les appellations et définitions de ces régimes d&rsquo;exploitation sont donc très importantes, car elles entraînent notamment
des contraintes particulières de conduite que ce soit en situation normale ou dégradée (implantation des signaux, marche
à vue ou règle spéciale de certains signaux par exemple).</p><p>En <a href=single-track-lines/single-track>voie unique</a>, l’organisation de la circulation des trains des deux sens sur une même voie génère un risque spécifique
de nez à nez en plus du risque de rattrapage également présent sur les lignes à double voie.</p><p>L’exploitation sous le régime de la « <a href=double-track-lines>double voie</a> » permet, par conception, d’éviter le risque de nez à nez, compte tenu
de l’affectation des trains à un sens de circulation par voie. Cependant sur certaines lignes, la circulation des trains
s’effectue selon l’un des deux régimes suivants : la <a href=single-track-lines/single-track>voie unique</a> ou la
<a href=single-track-lines/single-track-two-ways>voie banalisée</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4553310b37b0f2879067a1ff6377a00b>5.2.3.1 - Les lignes à une seule voie</h1><p>Elles sont principalement exploitées selon les dispositions du régime général d’exploitation de la
<a href=single-track>voie unique</a>, certaines d’entre elles disposant d’un minimum d’équipement de signalisation sont désignées
« <a href=single-track-with-simplified-signalling>voie unique à signalisation simplifiée</a> ».</p><p>D’autres lignes, peu fréquentées et fermées au service voyageur sont exploitées selon le régime de la <a href=single-track-with-restricted-traffic>voie unique à
trafic restreint</a>.</p><p>Il existe aussi un régime d’exploitation en <a href=single-track-shuttle>navette</a>.</p><p>Enfin d’autres lignes disposant d’installations de sécurité s’opposant notamment au nez à nez sont exploitées selon le
régime de la <a href=single-track-two-ways>voie banalisée</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d04b616249d69417d9463a69fe2ebd94>5.2.3.1.1 - La voie unique</h1><h3 id=définition>Définition</h3><p>Régime d’exploitation d’une ligne dans lequel les trains des deux sens circulent sur la même voie, les dispositions à
prendre pour éviter la rencontre de deux trains de sens contraire ne sont pas automatiques, mais résultent de procédures
à appliquer par les personnels affectés à la circulation des trains, voire par les personnels des trains dans certains
cas de lignes faiblement équipées. Ces dispositions sont définies par le gestionnaire d’infrastructure.</p><h3 id=principe>Principe</h3><h4 id=le-risque-de-nez-à-nez>Le risque de nez à nez</h4><p>Les documents horaires sont conçus en respectant des obligations fondamentales telles que le croisement obligatoire de
deux trains en gare, qui permettent d’éviter le nez à nez pour les trains de sens contraires.</p><p>Ce risque est donc avant tout couvert par le respect de l’ordre normal de circulation des trains figurant aux documents
horaires.</p><p>En effet, le principe d’exploitation d’une ligne à voie unique s’effectue selon des modalités définies par le
gestionnaire d&rsquo;infrastructure, qui prévoient notamment le respect absolu de l’ordre théorique de succession des trains
et en conséquence de l&rsquo;ordre chronologique d&rsquo;occupation de la voie unique. Une circulation qui n&rsquo;est pas à son ordre, ne
peut occuper la voie unique sans procédure.</p><p>En cas de modification de l’ordre théorique (retard, train supprimé, etc.), des procédures permettent d’organiser le
nouvel ordre de circulation des trains (procédures de reports de croisement, dépassements, etc.).</p><dl><dt>Le respect des procédures reposant sur l’humain, certaines lignes sont équipées d’une « barrière » technique de sécurité</dt><dd>le block manuel de voie unique (BMVU - voir 4.4.2.). Des moyens d’arrêt complémentaires (DAAT, GSM/GFU, RST, coupure
d’urgence si la ligne est électrifiée, …) peuvent être utilisés ou mis en place afin de réduire les conséquences d’une
erreur humaine.</dd></dl><h4 id=le-risque-de-rattrapage>Le risque de rattrapage</h4><p>Le risque de collision par rattrapage est couvert par le mode de cantonnement. Les différents modes de cantonnement
existants sont :</p><ul><li>le cantonnement téléphonique (Voir - 4.3.) ;</li><li>le cantonnement assisté par informatique (CAPI - voir 4.3.) ;</li><li>le cantonnement assisté par informatique initié en 1995 (CAPI 95 - voir 4.3.) ;</li><li>le block manuel de voie unique (BMVU - voir 4.4.2.).</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-672f32830266b0c52e2bc79901384f62>5.2.3.1.2 - La voie unique à signalisation simplifiée (VUSS)</h1><h3 id=définition>Définition</h3><p>Certaines lignes à voie unique sont désignées à la documentation d’exploitation comme « Lignes à voie unique à
signalisation simplifiée ». Par rapport au régime général de la voie unique, ce type de ligne se distingue par la mise
en œuvre d’un minimum d’équipements. Ils se limitent à une pancarte « gare » à distance et à un repère d’entrée.</p><h3 id=principe>Principe</h3><h4 id=le-risque-de-nez-à-nez>Le risque de nez à nez</h4><p>Elles sont exploitées selon les modalités du régime général d’exploitation de la voie unique (notamment le respect
de l’ordre théorique de circulation).</p><p>Leur fonctionnement repose en outre sur l’arrêt général des circulations dans toutes les gares.</p><h4 id=le-risque-de-rattrapage>Le risque de rattrapage</h4><p>La gestion de l’espacement est assurée par le cantonnement téléphonique.</p><p>Il n’y a aucune barrière technique de sécurité, toute erreur humaine peut avoir des conséquences graves. Des boucles de
rattrapage peuvent permettre de pallier ces erreurs (DAAT, CAPI, GSM/GFU, RST, coupure d’urgence si la ligne est
électrifiée, etc.).</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b6fee3b4e749fe1de7e2a7eeffc625c0>5.2.3.1.3 - La voie unique à trafic restreint (VUTR)</h1><h3 id=définition>Définition</h3><p>Ce régime concerne des lignes fermées au service voyageurs qui ne comportent normalement pas de signaux. Les règles
concernant le régime général d’exploitation de la voie unique ne sont pas applicables et sont remplacées par des
modalités particulières définies par le gestionnaire d&rsquo;infrastructure.</p><h3 id=principe>Principe</h3><p>Une consigne locale d’exploitation adaptée à chaque VUTR précise les caractéristiques d&rsquo;exploitation comme la vitesse de
la ligne, la signalisation, les établissements, les liaisons téléphoniques, les PN, etc.</p><p>Elle est complétée par un programme de circulation qui comporte les horaires des trains devant circuler et précise les
dispositions particulières concernant chaque train (trains entre lesquels l&rsquo;espacement doit être assuré, croisements,
etc.).</p><p>Ces lignes ne comportent normalement pas de signaux, les limitations de vitesse à observer sur les aiguilles ainsi que
les autres limitations permanentes de vitesse sont inscrites à la consigne locale d’exploitation de la ligne ; elles ne
sont pas rappelées par des signaux sur le terrain.</p><p>Par principe, la vitesse de circulation ne dépasse généralement pas 50 km/h.</p><p>Aucun enclenchement n’est prévu. Chaque ligne dépend d&rsquo;un agent de SNCF Réseau dénommé « chef de ligne ». La sécurité
des circulations est assurée par le chef de ligne et par les agents des trains.</p><p><em>Nota : Les VUTR ne sont pas définies dans les RT.</em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-0ff65d5051367f2b61cb55feb2bff978>5.2.3.1.4 - L’exploitation en navette</h1><h3 id=définition>Définition</h3><p>Régime d’exploitation d’une ligne sur laquelle la circulation d’un train ne peut être autorisée qu’après dégagement du
train précédemment engagé, l’engagement et le dégagement se faisant au même point.</p><h3 id=principe>Principe</h3><p>L’exploitation en navette consiste à n’autoriser la présence que d’une seule circulation sur la section de ligne
concernée, cette circulation revenant à son point de départ, ce qui par conception limite les risques de collision de
trains.</p><p>Toutefois, le programme peut inclure moyennant des procédures adaptées des mouvements de desserte, avec ou sans
possibilité de garage (desserte origine terminus ou desserte en antenne).</p><p>L’accès à la voie exploitée en navette est commandé par un signal muni du DAAT ou du KVB.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-62525524c01cf2d4c85bca48aaa460a7>5.2.3.1.5 - La voie banalisée</h1><h3 id=définition>Définition</h3><p>Régime d&rsquo;exploitation d&rsquo;une ligne à une ou plusieurs voies parcourues par les trains des deux sens. Sur ces voies,
des installations de sécurité s&rsquo;opposent à l&rsquo;expédition de deux trains de sens contraire à la rencontre l&rsquo;un de l&rsquo;autre.
Sur les lignes à plusieurs voies banalisées, les trains d&rsquo;un même sens peuvent circuler indifféremment sur l&rsquo;une
quelconque de ces voies.</p><h3 id=principe>Principe</h3><p>Une voie banalisée peut être découpée en plusieurs intervalles (points entre lesquels il n’existe aucune possibilité de
croisement ou dépassement).</p><p>Sur une voie, quel que soit le sens :</p><ul><li>les signaux sont normalement implantés à gauche ;</li><li>le découpage éventuel d’un intervalle en cantons est identique.</li></ul><h4 id=le-risque-de-nez-à-nez>Le risque de nez à nez</h4><p>Les deux extrémités d’un intervalle de voie banalisée sont équipées de signaux d’arrêt non permissifs permettant
d’arrêter et de retenir les trains se dirigeant vers l’intervalle. Elles sont reliées par un enclenchement entre
itinéraires de sens contraires.</p><p>Le risque de nez à nez est pris en charge notamment, par l&rsquo;enclenchement entre itinéraires de sens contraire. Cet
enclenchement agit directement sur le circuit de commande des signaux de protection donnant accès à l’intervalle. Il
nécessite la mise en oeuvre de circuits de voie ou de compteurs d’essieux qui interviennent en outre dans le block
automatique (cf. rattrapage ci-dessous).</p><p>Les installations de sécurité s’opposent à l’expédition de deux trains de sens contraire dans le même intervalle.
Cette interdiction est maintenue tant que l’intervalle est occupé.</p><h4 id=le-risque-de-rattrapage>Le risque de rattrapage</h4><p>L&rsquo;espacement est assuré automatiquement.
En signalisation au sol, l’espacement des trains de même sens est assuré par le block automatique par l’intermédiaire
de circuits de voie ou de compteur d’essieux. Selon l’importance du trafic, il peut s’agir de :</p><ul><li>BAPR : La longueur d’un canton de BAPR peut atteindre 15 km ou plus ;</li><li>BAL : La longueur maximale d’un canton de BAL n’excède pas généralement 2,8 km ce qui permet un écoulement de trafic
plus important.</li></ul><p>En signalisation de cabine, la TVM ou l’ETCS assurent l’espacement.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-48dc1dd207490ac055b30be6533083df>5.2.3.2 - La double voie</h1><h3 id=définition>Définition</h3><p>Régime d’exploitation d’une ligne à deux voies (ou plus) dans lequel chaque voie est normalement affectée à la
circulation des trains dans un sens déterminé.</p><h3 id=principe>Principe</h3><h4 id=le-risque-de-nez-à-nez>Le risque de nez à nez</h4><p>Sur une ligne à deux voies, les circulations empruntent normalement la <strong>voie de gauche</strong> dans le sens de la marche (<em>voie de
droite sur les lignes désignées à la documentation d’exploitation</em>).</p><p>La double voie est exploitée selon les modalités définies par SNCF Réseau qui prévoit que chaque agent du service de la
gestion des circulations doit disposer en temps utile des informations nécessaires pour assurer le service de la
circulation des trains, notamment les informations relatives à l’ordre théorique et réel de succession des trains, à
l’horaire et aux voies de circulation des trains.</p><p>Dans certains cas, il peut être nécessaire (travaux, incidents, etc.) d’organiser la circulation des trains des deux
sens sur une seule voie. Les circulations se déplaçant sur une voie en sens inverse du sens normal sont dites à
« <strong>contresens</strong> » sur une <a href=opposite-direction-installations>installation de contre sens (ICS)</a> ou sur une
<a href=temporary-single-track>voie unique temporaire (VUT)</a>. Elles sont dites à « <strong>contre-voie</strong> » dans les autres cas.</p><p>En fonction des installations et équipements en place :</p><ul><li>utilisation d’installations qui s’opposent au nez à nez :<ul><li><a href=opposite-direction-installations>installation de contre sens (ICS)</a> :
installations permanentes de contre sens (IPCS) ou installations temporaires de contresens (ITCS) ;</li><li><a href=temporary-single-track-of-permanent-nature>voie unique temporaire à caractère permanent (VUTP)</a> ;</li></ul></li><li>ou mise en place de procédures :<ul><li><a href=temporary-single-track>voie unique temporaire (VUT)</a> ;</li><li><a href=opposite-track-movement>mouvement à contre voie</a>.</li></ul></li></ul><h4 id=le-risque-de-rattrapage>Le risque de rattrapage</h4><p>L&rsquo;espacement est assuré selon les principes définis <a href=../../spacing>dans cette section</a>. Sur une voie les signaux sont
normalement implantés à gauche.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f03636b6aca18721edac60c4b7f52941>5.2.3.2.1 - Les installations de contresens (ICS)</h1><h2 id=1-les-installations-permanentes-de-contresens-ipcs>1. Les installations permanentes de contresens (IPCS)</h2><h3 id=principe>Principe</h3><p>Certaines sections de ligne comportent des installations permanentes de contresens (IPCS). Ces installations accessibles
sans arrêt des trains à l’entrée, permettent à tout moment la circulation des trains à contresens sans que les
conducteurs en soient préavisés autrement que par la signalisation.</p><h4 id=le-risque-de-nez-à-nez>Le risque de nez à nez</h4><p>Des enclenchements de sécurité s’opposent à l’expédition de deux trains de sens contraire à la rencontre l’un de l’autre.</p><h4 id=le-risque-de-rattrapage>Le risque de rattrapage</h4><p>L’espacement des trains circulant dans le sens normal est assuré dans les conditions habituelles.</p><p>L’espacement des trains à contresens est assuré automatiquement.</p><h3 id=avis-au-conducteur>Avis au conducteur</h3><p>Les sections de ligne équipées d’IPCS sont désignées aux RT.</p><p>La circulation (entrée et sortie) sur IPCS est indiquée au conducteur par la signalisation.</p><h2 id=2-les-installations-temporaires-de-contresens-itcs>2. Les installations temporaires de contresens (ITCS)</h2><h3 id=principe-1>Principe</h3><p>L’ITCS est un régime temporaire d’exploitation permettant en double voie de faire circuler sur une voie des trains en
sens inverse du sens normal.</p><p>Ces installations, accessibles sans arrêt des trains à l’entrée, permettent à tout moment la circulation des trains à
contresens. Elles sont installées en prévision de chantier de travaux qui vont nécessiter l’obstruction d’une des deux voies.</p><h4 id=le-risque-de-nez-à-nez-1>Le risque de nez à nez</h4><p>Des enclenchements de sécurité s’opposent à l’expédition de deux trains de sens contraire à la rencontre l’un de l’autre.</p><p>Les ITCS ont leurs extrémités dans les gares les plus rapprochées encadrant le chantier de travaux prévu ou bien dans des postes de pleine voie existants ou créés à cet effet, considérés dès lors comme des gares. Si le chantier se déplace, les extrémités de l’ITCS sont reportées au fur et à mesure de la progression du chantier par phases successives, chaque phase faisant l’objet d’une ITCS distincte.</p><h4 id=le-risque-de-rattrapage-1>Le risque de rattrapage</h4><p>L’espacement des trains circulant dans le sens normal est assuré dans les conditions habituelles.</p><p>L’espacement des trains à contresens est assuré automatiquement.</p><h3 id=avis-au-conducteur-1>Avis au conducteur</h3><p>Les informations nécessaires aux conducteurs sont fournies par le gestionnaire d’infrastructure aux entreprises
ferroviaires. Les particularités de signalisation et d’exploitation de l’ITCS sont mentionnées.</p><p>Un schéma adapté à ses besoins peut compléter ces informations.</p><p>La circulation (entrée et sortie) sur ITCS est indiquée au conducteur par la signalisation.</p><h2 id=3-circulation-à-contresens-sur-une-ics>3. Circulation à contresens sur une ICS</h2><p>L’entrée d’un parcours à contresens sur une ICS est repérée par un tableau lumineux d’entrée à contresens (TECS). Ce
tableau, normalement éteint, est groupé avec le panneau qui porte le carré protégeant l’aiguille d’entrée.</p><p><img src=/images/docs/railway-wiki/signalling/image-073.jpg alt></p><blockquote><p><em>Exemple d’entrée à contresens à 60 km/h sur une section de ligne où la circulation normale se fait à gauche</em></p></blockquote><p>Les signaux s’adressant aux conducteurs des trains circulant à contresens sont :</p><ul><li>implantés à droite (disposition inverse sur les lignes où la circulation se fait normalement à droite) ;</li><li>répétés sur les engins moteurs.</li></ul><p>Les ICS peuvent comporter à contresens <em>un ou plusieurs cantons</em>.</p><p><strong>La sortie d’un parcours à contresens</strong> est repérée par un <strong>tableau lumineux de sortie de contresens (TSCS)</strong>. Ce tableau
est groupé avec le panneau qui porte le signal « carré » protégeant l’aiguille de sortie.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f1b4a742a904e1621e55646fe6046843>5.2.3.2.2 - La voie unique temporaire à caractère permanent (VUTP)</h1><h3 id=principe>Principe</h3><p>Les installations de voie unique temporaire à caractère permanent (VUTP) permettent la circulation occasionnelle des
trains des deux sens sur une seule voie, entre deux gares, sans arrêt à l’entrée et sans préavis aux conducteurs.</p><p>Les sections de ligne équipées de VUTP sont désignées aux RT.</p><h4 id=le-risque-de-nez-à-nez>Le risque de nez à nez</h4><p>Des enclenchements de sécurité s’opposent à l’expédition de deux trains de sens contraire à la rencontre l’un de l’autre.</p><h4 id=le-risque-de-rattrapage>Le risque de rattrapage</h4><p>L’espacement des trains circulant dans le sens normal est assuré dans les conditions habituelles.</p><p>L’espacement des trains à contresens est assuré automatiquement.</p><h3 id=circulation-à-contresens>Circulation à contresens</h3><p>L’entrée d’un parcours à contresens est repérée par <strong>un tableau VUT</strong> groupé avec le panneau qui porte le carré protégeant
l’aiguille d’entrée.</p><p>La présentation du <strong>tableau VUT</strong> indique au conducteur :</p><ul><li>que le train est dirigé et est <strong>autorisé à s’engager à contresens</strong> ;</li><li>qu’à partir de ce tableau, <strong>les signaux qui le concernent sont implantés à droite</strong>.</li></ul><p><img src=/images/docs/railway-wiki/signalling/image-074.jpg alt></p><blockquote><p><em>Exemple d’entrée à 30 km/h sur VUTP</em></p></blockquote><p>La vitesse limite à ne pas dépasser est fixée à 70 km/h.</p><p>La sortie du parcours à contresens est repérée par <strong>un tableau « FIN de VUT »</strong> groupé avec le panneau qui porte le signal
carré protégeant l’aiguille de sortie.</p><p>La présentation du <strong>tableau « FIN de VUT »</strong> indique au conducteur :</p><ul><li>que le train est parvenu à <strong>la fin du parcours à contresens</strong> ;</li><li>qu’à partir de ce tableau, <strong>les signaux qui le concernent sont implantés à gauche</strong>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6d17688af3b127a1d4343b09d6d4d57f>5.2.3.2.3 - La voie unique temporaire (VUT)</h1><h3 id=principe>Principe</h3><p>Lorsqu’une cause quelconque (incident, exécution de travaux, etc.), interdit l’utilisation d’une voie et en l’absence
d’installations permettant la circulation dans les deux sens en sécurité sur l’autre voie (ICS, voie banalisée), la
circulation des trains est organisée par les agents du service de gestion des circulations situés aux extrémités selon
des procédures adaptées.</p><p>La VUT est donc un régime temporaire d’exploitation permettant, sur une ligne à double voie non équipée d’installation
de contresens, de faire circuler les trains des deux sens sur une seule et même voie.</p><p>Les trains devant circuler à contre sens sont <strong>arrêtés à l’entrée</strong>.</p><p>La circulation sur la VUT dans les deux sens se fait selon le principe de la demande et de l’accord de voie entre agents
du service de la gestion des circulations.</p><p>La vitesse limite à contre sens est de 70 km/h.</p><p>La sortie de la VUT est repérée soit :</p><ul><li>par un <strong>signal carré</strong> implanté à gauche, à droite ou au-dessus de la voie ;</li><li>par un <strong>signal d’arrêt à main</strong>.</li></ul><h3 id=organisation>Organisation</h3><p>La VUT est établie entre les deux changements de voies utilisables les plus rapprochés qui en constituent les extrémités.</p><p>La VUT est organisée par l’agent du service de la gestion des circulations qui expédie les trains à contresens sur cette
voie (gare B dans l’exemple ci-dessous) et qui doit aviser ou faire aviser les agents intéressés : agents des postes,
des PN gardés, agents travaillant sur la voie ou les caténaires.</p><h3 id=circulation-sur-la-vut>Circulation sur la VUT</h3><p><img src=/images/docs/railway-wiki/signalling/image-077.png alt></p><h4 id=le-risque-de-nez-à-nez>Le risque de nez à nez</h4><p>L’expédition de tout train sur la VUT est subordonnée à un accord de voie donné par l’agent du service de gestion des
circulations de l’autre extrémité de la VUT à l’agent-du service de gestion des circulations qui doit expédier le train.</p><h4 id=le-risque-de-rattrapage>Le risque de rattrapage</h4><p>Les trains de sens normal sont cantonnés dans les conditions habituelles.</p><p>Les trains circulant à contresens sont cantonnés téléphoniquement dans les conditions prévues pour la voie unique (voir 4.3.).</p><h3 id=avis-au-conducteur>Avis au conducteur</h3><p><strong>En sens normal :</strong> aucun avis n’est fait au conducteur, les trains circulent sans arrêt à l’entrée.</p><p><strong>À contre sens :</strong> le conducteur est arrêté à l’entrée de la VUT puis informé par écrit par l’agent du service de la
gestion des circulations qu’il va circuler à contresens en VUT.</p><p>Cet ordre écrit reprend les points ou zones du parcours sur lesquels le conducteur doit appliquer des prescriptions
particulières.</p><p>En effet, les installations et la signalisation ne sont généralement pas prévues pour les circulations en sens inverse
du sens normal (PN, limitations de vitesse, etc.).</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8b3cf8b8935791d7f9ff6566c734c620>5.2.3.2.4 - Mouvement à contre-voie</h1><h3 id=principe>Principe</h3><p>Lorsqu’une cause quelconque (incident, secours, travaux inopinés de courte durée, etc.), interdit l’utilisation d’une
voie, en l’absence d’installation permettant la circulation dans les deux sens sur l’autre voie (ICS, voie banalisée) et
qu’il n’est pas envisagé d’organiser une VUT (par exemple, du fait que très peu de circulations seront concernées), la
circulation d’un train n’empruntant pas le sens normal se fait alors à contre-voie sur la voie non interceptée. Les
trains devant circuler à contre-voie sont <strong>arrêtés à l’entrée</strong>.</p><p>Le mouvement à contre-voie peut être effectué :</p><ul><li>d’un point quelconque vers un point situé en amont (ces points pouvant être un point de pleine voie, une gare, un
évitement télécommandé) ;</li><li>à l’intérieur d’une gare.</li></ul><h3 id=organisation>Organisation</h3><h4 id=mouvements-à-contre-voie-à-lintérieur-dune-gare>Mouvements à contre-voie à l’intérieur d’une gare</h4><p>Lorsqu’un mouvement à contre-voie doit être effectué à l’intérieur d’une gare, il est organisé à l’initiative de l’agent
du service de gestion des circulations.</p><p>Le conducteur est avisé par l’agent du service de la gestion des circulations qu’il doit effectuer un mouvement à
contre-voie et que le mouvement s’effectue :</p><ul><li>soit comme une manœuvre. Dans ce cas le conducteur sera renseigné et guidé par des signaux de manœuvre ;</li><li>soit par la transmission d’un ordre écrit ou d’une dépêche.</li></ul><h4 id=autres-mouvements-à-contre-voie>Autres mouvements à contre-voie</h4><ul><li>d’une gare vers la gare en amont ou de la gare en avant vers un point de pleine voie
L’agent chargé d’organiser ce mouvement à contre-voie est l’agent du service de gestion des circulations de la gare
dans laquelle le mouvement a son origine.</li><li>d’un point de pleine voie vers la gare en arrière
L’agent chargé d’organiser ce mouvement à contre-voie est l’agent du service de gestion des circulations de la gare
dans laquelle le mouvement se termine.
Dans ces deux cas, l’agent du service de la gestion des circulations, après avoir obtenu l’assurance que la partie de
voie à parcourir est libre et le restera, remet un ordre écrit ou transmet une dépêche au conducteur pour circuler à contre-voie.</li><li>En pleine voie
Le conducteur est responsable de ce mouvement, lorsqu’il prend l’initiative d’exécuter ce mouvement :<ul><li>à la suite d’une rupture d’attelage lorsque le train peut être reconstitué ;</li><li>à la suite d’un léger dépassement du point d’arrêt habituel dans un établissement PL.</li></ul></li></ul><h3 id=circulation-à-contre-voie>Circulation à contre-voie</h3><p>Après arrêt du train, l’agent du service de la gestion des circulations, selon le cas, remet au conducteur un ordre
écrit ou le transmet par dépêche. Cet ordre reprend les points ou zones du parcours sur lesquels le conducteur doit
appliquer des prescriptions particulières.</p><p>En effet, les installations et la signalisation ne sont généralement pas prévues pour les circulations en sens inverse
du sens normal (PN, limitations de vitesse, etc.).</p><p>Lorsque le conducteur est en tête du mouvement, la circulation s’effectue en <strong>marche à vue</strong> sur tout le parcours effectué
à contre-voie (le conducteur peut rencontrer un obstacle non protégé).</p><p>Lorsque le conducteur n’est pas en tête, la circulation est guidée par des signaux de manœuvre.</p><p>La fin du parcours à contre voie est généralement repérée soit :</p><ul><li>par un <strong>signal carré</strong> ;</li><li>par un <strong>signal d’arrêt à main</strong>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4226b00c3d9290eac2107f26e66081a0>5.2.4 - Les systèmes d'espacement des trains</h1><h3 id=définition>Définition</h3><p>Le système d’espacement des trains de même sens, est destiné à éviter les rattrapages et consiste à fractionner la ligne
en plusieurs cantons dont l’entrée est protégée par un signal d’arrêt.</p><h3 id=principe>Principe</h3><p>Compte tenu de leur masse importante, de leur vitesse élevée, de la faible adhérence rail-roue, les trains ont besoin
d’une distance importante pour s’arrêter.</p><p>De ce fait, la distance nécessaire pour obtenir l’arrêt est généralement plus grande que la partie de voie visible par
le conducteur. Dans ces conditions, le conducteur d’un train en marche ne voyant pas à temps la queue d’un train arrêté
ou circulant à plus faible vitesse devant lui risquerait de le heurter.</p><p><img src=/images/docs/railway-wiki/signalling/image-078.png alt></p><p>Pour prévenir le risque de rattrapage : un dispositif d’espacement des trains appelé « cantonnement » est mis en place
selon les principes suivants :</p><ul><li>la ligne est divisée en portions de voie appelées « cantons »</li><li>l’entrée de chaque canton est normalement commandée par un signal</li><li>un seul train est normalement admis dans chaque canton</li><li>aucun train ne peut normalement pénétrer dans un canton occupé, du fait du maintien à la fermeture du signal d’entrée
du canton durant tout le temps de son occupation</li></ul><p>Dans certains cas particuliers, la pénétration d’un train dans un canton occupé ainsi que les modalités de
franchissement du signal d’entrée du canton sont prévues dans une procédure propre à chaque mode de cantonnement.</p><h4 id=les-différents-modes-de-cantonnement>Les différents modes de cantonnement</h4><p>On distingue :</p><ul><li>le cantonnement téléphonique</li><li>le block manuel par appareils (BM)</li><li><a href=./automatic_block_systems/>le block automatique</a> : lumineux (BAL) ou à permissivité restreinte (BAPR)</li><li>l’ETCS 1 généralement superposé à la signalisation au sol</li><li>l’espacement sur lignes à grande vitesse (TVM, <a href=./ertms/>ETCS 2</a>)</li></ul><p>Sur les sections de lignes équipées en cantonnement téléphonique ou en block manuel par appareils, les signaux de
cantonnement sont manoeuvrés au sol ou depuis des postes par des agents du service du gestionnaire d’infrastructure (GI)
chargé de la gestion des circulations dénommés « gardes ».</p><p>Sur les sections de lignes équipées en BAL ou BAPR, les signaux de cantonnement se ferment automatiquement dès
l’occupation du canton et restent fermés jusqu’à sa complète libération.</p><p>Sur les sections de lignes à signalisation de cabine, équipées en TVM ou ETCS, les informations liées à l’espacement des
trains sont données au conducteur automatiquement directement en cabine de conduite.</p><p>Pour déterminer le mode et le cas échéant les postes de cantonnement d’une section de ligne, il faut consulter les RT.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-36329fee32fa9963fa1ddf7ec4c614f7>5.2.4.1 - BA</h1><div class=lead>Block Automatique</div><h3 id=principe>Principe</h3><p>Le block automatique se caractérise en block automatique lumineux (BAL) et en block automatique à permissivité restreinte (BAPR) par :</p><ul><li>le fonctionnement entièrement automatique des signaux de cantonnement dont le changement d’état (fermeture ou ouverture) est provoqué par le passage des circulations sans aucune intervention humaine ;</li><li>l’état d’occupation de chaque canton, agissant directement sur le signal d’entrée correspondant est obtenu par le circuit de voie en BAL, généralement par un comptage d’essieu en BAPR.
Le BAL permet un débit élevé des circulations sur la ligne.</li></ul><h3 id=fonctionnement-dun-circuit-de-voie>Fonctionnement d&rsquo;un circuit de voie</h3><p>Un circuit de voie est principalement constitué de trois éléments :</p><ul><li>un émetteur, branché à l’une des extrémités de la zone. Il délivre un courant qui peut être de différente nature selon les types de circuit de voie (continu, impulsionnel, alternatif, etc.) ;</li><li>une ligne de transmission, constituée par les deux files de rails ;</li><li>un récepteur, branché à l’autre extrémité de la zone. Il assure le filtrage, l’amplification et la transformation du signal reçu via les rails, ce qui agit sur un relais appelé relais de voie. Les contacts de ce relais sont utilisés pour établir ou couper le circuit électrique du signal d’entrée du canton.</li></ul><p>Lorsqu’aucun véhicule n’est présent sur la zone délimitant le circuit de voie (voie libre), le signal délivré par l’émetteur parvient au récepteur à travers la ligne de transmission, et le relais de voie est excité. Le feu d’entrée du canton est à voie libre (cas 1 ci-dessous).</p><p>Lorsqu’un véhicule est présent, son premier essieu agit comme une faible résistance, appelée shunt, qui court-circuite la transmission. Dans ce cas, le niveau du signal parvenant au récepteur n’est plus suffisant et le relais de voie se désexcite, ce qui entraine la fermeture du signal d’entrée du canton (cas 2 ci-dessous).</p><p><img src=/images/docs/railway-wiki/signalling/image-079.png alt></p><h3 id=fonctionnement-des-compteurs-dessieux>Fonctionnement des compteurs d&rsquo;essieux</h3><p>Un compteur d’essieux est un dispositif technique servant à détecter la présence d’une circulation sur une section, par
comptage des essieux qui franchissent les détecteurs encadrant cette section.</p><p>Un point de détection est installé à chaque extrémité de la section, et chaque fois qu’un essieu passe sur ce point au
début de la section, un compteur s’incrémente. Quand le train passe sur le point de détection en fin de la section, le
compteur décrémente. Si le nombre final est zéro, la section est présumée libre pour un deuxième train et le signal
d’entrée du canton présentera l’indication « voie libre ».</p></div><div class=td-content style=page-break-before:always><h1 id=pg-08b5addab59fe72a885332dbf065460a>5.2.4.1.1 - BAL</h1><div class=lead>Block Automatique Lumineux</div><p>Le signal d’entrée du canton présente une indication liée à l’état d’occupation du ou des cantons suivants, selon les
règles suivantes :</p><ul><li>indication d’arrêt lorsque le canton est occupé par au moins une portion du train</li><li>annonce lorsque le canton suivant est occupé</li><li>voie libre par défaut (sauf signaux Nf)</li></ul><p>La longueur maximale d’un canton est en principe de 2800 m. Elle est généralement de 1500 m sur les lignes parcourues à
la vitesse maximale de 160 km/h.</p><p><img src=/images/docs/railway-wiki/signalling/image-080.png alt></p><h3 id=avantages-du-bal>Avantages du BAL</h3><p>Le BAL offre un niveau élevé de sécurité et permet un débit important.</p><h3 id=limites>Limites</h3><p>L’installation du BAL est très coûteuse, et son fonctionnement nécessite une garantie de contact électrique entre la
roue et le rail.</p><h3 id=implémentation>Implémentation</h3><p>Simuler correctement le système BAL nécessite de respecter les critères suivants :</p><ul><li>lorsque la tête du train pénètre dans un canton, le signal d&rsquo;entrée de celui-ci passe en indication d&rsquo;arrêt</li><li>lorsque la queue du train libère un canton, son signal d&rsquo;entrée passe en annonce</li><li>lorsque la queue du train libère un canton, le signal d&rsquo;entrée du canton précédent passe en voie libre</li><li>les signaux présentent une voie libre par défaut, sauf les signaux Nf qui sont par défaut en indication d&rsquo;arrêt</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b5e7441819b3b64284fbe4d4e890de77>5.2.4.1.2 - BAPR</h1><div class=lead>Block Automatique à Permitivité Restreinte</div><p>Le signal d’entrée du canton est un signal qui présente une indication liée à l’état d’occupation du canton suivant
(indication d’arrêt ou de voie libre). Sur certaines lignes l’occupation du canton n’est pas obtenue par le circuit de
voie mais par un système de comptage d’essieux entrants et sortants.</p><p>Les cantons sont beaucoup plus longs que le BAL (jusqu’à 15 km et plus) et par conséquent le débit est moins important.</p><p><img src=/images/docs/railway-wiki/signalling/image-081.png alt></p><p><img src=/images/docs/railway-wiki/signalling/image-082.png alt></p><h3 id=avantages-du-bapr>Avantages du BAPR</h3><p>Le BAPR offre un bon niveau de sécurité et il est moins coûteux que le BAL.</p><h3 id=limites>Limites</h3><p>Ce type de block n’est adapté qu’aux lignes conventionnelles à trafic moyen compte tenu de l’espacement imposé entre 2
trains successifs.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-89e71c403e165f25cd4f5d4d5f242194>5.2.4.2 - ERTMS</h1><div class=lead>European Rail Traffic Management System</div><h3 id=introduction>Introduction</h3><p>L&rsquo;ERTMS, pour <em>European Rail Traffic Management System</em>, est un système qui vise à harmoniser la signalisation
ferroviaire en Europe.</p><p>Il est composé de trois sous-systèmes :</p><ul><li>un système de signalisation : l&rsquo;<a href=etcs/>ETCS</a></li><li>un système de communication : <a href=gsm-r/>GSM-R</a> / <a href=gprs/>GPRS</a> / <a href=frmcs/>FRMCS</a></li><li>un système de gestion du traffic : l&rsquo;<a href=etml/>ETML</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b91b9453a9d5ab3d563706ebc34c7d43>5.2.4.2.1 - ETCS</h1><div class=lead>European Train Control System</div><h3 id=généralités>Généralités</h3><p>ETCS est le système européen de contrôle commande des trains. La partie bord est interopérable. La partie sol peut être
différente selon les pays tout en répondant aux mêmes objectifs de fonctionnalité.</p><p>Il existe quatre niveaux différents dont deux sont en service : L’<a href=#etcs-niveau-1>ETCS 1</a> et L’<a href=#etcs-niveau-2>ETCS 2</a>. L’ETCS 0 est interdit en France.
L’ETCS 3 est encore à l’état de développement dans la plupart des pays de l’Union européenne.</p><p>Il s’agit d’un système de signalisation de cabine et de contrôle de vitesse faisant appel aux trois composantes
suivantes :</p><ul><li><strong>sol</strong> : pour la gestion des circulations comprenant notamment l’espacement, la protection des points à protéger et des
circulations</li><li><strong>bord</strong> : pour l’affichage des ordres et informations à destination du conducteur et le contrôle de la bonne exécution de
ceux-ci, dénommé EUROCAB</li><li><strong>liaison</strong> : pour les échanges de données entre le sol et le bord :<ul><li>liaison ponctuelle unidirectionnelle du sol vers le bord par EURO BALISES,</li><li>liaison radiotéléphonique continue et bidirectionnelle par <a href=../gsm-r/>GSM-R</a> DATA pour <a href=#etcs-niveau-2>ETCS2</a> dénommé EURORADIO.</li></ul></li></ul><p>Sur le <a href=../../../../glossary/#r>RFN</a>, sont mis en oeuvre les niveaux d&rsquo;exploitations suivants :</p><ul><li><p>L’<a href=#etcs-niveau-1>ETCS1</a> sur certaines lignes parcourables jusqu’à 220 km/h. Il correspond à un système de signalisation de cabine,
généralement superposé à la signalisation au sol existante, dont les informations entre le sol et le bord sont
transmises ponctuellement par eurobalise.</p></li><li><p>L’<a href=#etcs-niveau-2>ETCS2</a> sur certaines lignes à grande vitesse. Il correspond à un système de signalisation de cabine dont les
informations entre le sol et le bord sont transmises en temps utile ou cycliquement par liaison permanente <a href=../gsm-r/>GSM-R</a> DATA.</p><p>L’<a href=#etcs-niveau-2>ETCS2</a> est un système qui ne nécessite pas la matérialisation des cantons sur le terrain.</p></li></ul><p>Préalablement à tout déplacement, les données relatives au train doivent être saisies ou paramétrées à bord. Ainsi, le
système peut, à partir des données bord et sol, superviser le train, c&rsquo;est-à-dire contrôler sa vitesse et ses
déplacements et intervenir en cas de nécessité.</p><p>La détection d&rsquo;une circulation sur une partie de voie est réalisée au moyen de circuits de voie ou de compteurs
d’essieux.
En <a href=#etcs-niveau-2>ETCS2</a>, la combinaison des équipements sol et bord est telle qu’elle ne nécessite, normalement, pas de signalisation
complémentaire au sol.</p><h3 id=équipement-bord>Équipement bord</h3><p>Le bord est constitué d&rsquo;un DMI, d’un EVC, de capteurs odométriques (de vitesse), d’antennes pour la lecture des PI ETCS,
un modem <a href=../gsm-r/>GSM-R</a> (Euroradio) pour ETCS2, d’une unité juridique d’enregistrement des paramètres d’exploitation,
d’interfaces avec le train.</p><p><img src=/images/docs/railway-wiki/signalling/image-106.png alt></p><h3 id=le-dmi>Le DMI</h3><p>Le DMI est l’interface entre le conducteur et la machine. Il permet d’afficher les ordres et instructions en fonction
des données sol et/ou bord. Le conducteur renseigne également le système par saisie de données.</p><p>L’espacement des circulations et la protection des points dangereux se traduisent par l’affichage en temps utile d’une
vitesse but et d’une distance but. La vitesse but doit être respectée par le conducteur au point défini par la distance but.</p><p>En « marche normale », le DMI indique au conducteur la vitesse autorisée qui ne doit pas être dépassée. Dans ce cas, il
n’y a pas d’affichage de la distance but et de la vitesse but.</p><p>Un secteur pouvant présenter différentes couleurs est utilisé pour indiquer les ordres de vitesse ou d&rsquo;arrêt.</p><p>Enfin, d’autres indications sont affichées telles que la signalisation de traction électrique, le niveau d&rsquo;exploitation,
le mode technique. Les changements d’indication au DMI peuvent être accompagnés d’indications sonores. Une zone en
partie basse du DMI est également réservée pour l’affichage de messages textuels. Certaines informations complémentaires
peuvent également être affichées par l&rsquo;entreprise ferroviaire.</p><p><img src=../../../images/document-pedagogique-signaux-regimes-exploitation-v1/image-107.png alt></p><blockquote><p>Dans cet exemple, le conducteur autorisé à circuler à 140 km/h maximum, circule à 125 km/h, il va devoir observer une
phase de ralentissement afin de respecter la vitesse maxi de 100 km/h (vitesse But) à une distance de 2850 mètres (distance But).</p></blockquote><p>Le DMI utilise un code couleur, avec la signification suivante :</p><ul><li><strong>blanc/gris clair/gris foncé</strong> : aucune action immédiate n’est exigée du conducteur</li><li><strong>jaune</strong> : le conducteur doit intervenir si la vitesse réelle est proche de la vitesse autorisée (risque de passer à
la couleur orange en l’absence de réaction)</li><li><strong>orange</strong> : l’intervention est insuffisante (risque de passer à la couleur rouge en l’absence de réaction du conducteur)</li><li><strong>rouge</strong> : réaction trop tardive du conducteur, prise en charge par le système (peut revenir au jaune, au gris ou au
blanc après une action appropriée)</li></ul><h3 id=etcs-niveau-1>ETCS niveau 1</h3><h4 id=transmission-sol-bord>Transmission sol-bord</h4><p>Ce niveau utilise une transmission ponctuelle à l&rsquo;aide de balises placées au pied des signaux et en amont. Ces balises
(eurobalises) communiquent les données de signalisation au train.</p><h4 id=détection-des-trains>Détection des trains</h4><p>Le niveau 1 nécessite l&rsquo;utilisation d&rsquo;un système de détection des trains au sol (tel que des circuits de voie, compteurs
d&rsquo;essieux et autres). Toutes ces informations sont donc transmises ponctuellement au train. La cadence de l’information
donnée pouvant être augmentée en jouant sur le nombre de balises, ou en installant une boucle (euroloop), équivalent
d&rsquo;une balise, mais longeant la ligne sur une certaine distance.</p><h3 id=etcs-niveau-2>ETCS niveau 2</h3><h4 id=transmission-sol-bord-1>Transmission sol-bord</h4><p>Les données de signalisation sont transmises de manière permanente, via le réseau <a href=../gsm-r/>GSM-R</a>. Le train communique constamment
sa position (qu&rsquo;il détermine avec un odomètre) au centre de contrôle qui lui communique en retour les actions à
effectuer (vitesse, arrêt, etc.).</p><p>Des eurobalises sont toujours présentes sur la voie pour recaler éventuellement l&rsquo;odométrie embarquée.</p><h4 id=détection-des-trains-1>Détection des trains</h4><p>Un système de détection des trains au sol s’appuie sur l’existence des circuits de voie pour localiser un train aval sur
un canton. Cette information est transmise au radio block center (RBC) qui gère ensuite l’espacement entre deux circulations.
Le train suiveur reçoit une nouvelle autorisation de circulation par l’intermédiaire de la liaison radio <a href=../gsm-r/>GSM-R</a>.
Dès que le train aval libère un canton le poste central de commande reçoit l’information correspondante du sol qui est
transmise par liaison radio au train suiveur.</p><h4 id=avantage>Avantage</h4><p>Le niveau 2 rend disponible quasi immédiatement une information « libératoire » pour le train suiveur et contribue ainsi
à augmenter la fluidité. Cette immédiateté est la différence par rapport à la signalisation conventionnelle, où une
demi-minute est parfois nécessaire pour libérer un aiguillage alors que le train est déjà bien loin.</p><h3 id=les-modes-techniques>Les modes techniques</h3><p>Les modes techniques utilisés sur le RFN sont :</p><ul><li><p><strong>Mode FS</strong> : Conduite en supervision complète.</p><p>Toutes les données train et voie sont disponibles à bord.</p><p>Le <a href=#le-dmi>DMI</a> affiche :</p><ul><li>la vitesse réelle du train et la vitesse autorisée</li><li>lors de l&rsquo;approche d&rsquo;un <a href=../../../../glossary/#e>EOA</a>, d&rsquo;un repère d&rsquo;arrêt ETCS ou un heurtoir, la vitesse but et la distance but</li></ul><p>Le système « bord » supervise la vitesse, le déplacement du train, le respect de l’<a href=../../../../glossary/#e>EOA</a> matérialisé par un repère
d’arrêt ETCS, un signal d’arrêt ou un heurtoir en ETCS1.</p></li><li><p><strong>Mode <a href=../../../../glossary/#o>OS</a></strong> : Conduite en marche à vue.</p><p>Toutes les données train et voie sont disponibles à bord sauf l’assurance de la libération de toute ou partie de la
voie allouée au train.</p><p>Le DMI affiche les mêmes indications qu’en mode FS.</p><p>Le système « bord » assure également la supervision comme en mode FS.</p></li><li><p><strong>Mode <a href=../../../../glossary/#s>SR</a></strong> : Conduite sous la responsabilité des agents.</p><p>Ce mode technique est utilisé pour les situations dégradées et la procédure « Mise en service » lorsque le bord n’a
pas reçu d’allocation de voie. Le système « bord » ne supervise que la vitesse du mode SR et le franchissement des
repères d&rsquo;arrêt ETCS et des signaux d’arrêt.</p></li><li><p><strong>Mode <a href=../../../../glossary/#s>SH</a></strong> : Circulation en manœuvre.</p><p>Ce mode technique est sélectionné par le conducteur pour les mouvements de manœuvre. Le système « bord » ne supervise
que la vitesse du train.</p></li><li><p><strong>Mode <a href=../../../../glossary/#n>NL</a></strong> : Conduite d&rsquo;un engin moteur non en tête du mouvement</p><p>Ce mode technique est utilisé en cas de pousse ou de double traction.</p></li></ul><h3 id=protection-contre-le-rattrapage>Protection contre le rattrapage</h3><p>En mode FS, une vitesse autorisée affichée sans la présentation de l&rsquo;<a href=../../../../glossary/#e>EOA</a> signifie « marche normale ».</p><p>La <a href=../../../../glossary/#m>MA</a> constituée d’un ou plusieurs cantons est allouée canton par canton, par ajout successif d’un canton.
Si le canton en aval du dernier canton alloué est occupé le train doit être en mesure de s’arrêter avant l’entrée de ce
canton. Le conducteur est alors avisé par une indication sonore au DMI.</p><p>Dès lors, les indications de conduite (vitesse but égale à 0 et une distance but) permettant de respecter la courbe de
freinage sont affichées.</p><p>Le conducteur doit ralentir de façon à être en mesure de s’arrêter avant l’<a href=../../../../glossary/#e>EOA</a>, tout en respectant la vitesse autorisée.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6988544024b60acd07fb520b7bfc0e09>5.2.4.2.2 - GSM-R</h1><div class=lead>Global System for Mobiles - Railways</div></div><div class=td-content style=page-break-before:always><h1 id=pg-012e5ac62f6e0b2510c489c37be9be3c>5.2.4.2.3 - GPRS</h1><div class=lead>General Packet Radio Service</div></div><div class=td-content style=page-break-before:always><h1 id=pg-9280c524af6ef8f312009fd261a14b08>5.2.4.2.4 - FRMCS</h1><div class=lead>Futur Système de Communications Mobiles Ferroviaires</div></div><div class=td-content style=page-break-before:always><h1 id=pg-838697130cc09115244a64c389c36a13>5.2.4.2.5 - ETML</h1><div class=lead>European Train Management Layer</div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/osrd-project/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Contributeurs à OSRD. Tous droits réservés</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin=anonymous></script><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.928c8c2d8b4f463998503da833bc465b748d40b80287e0398a7e1a38ab1c87a2.js integrity="sha256-koyMLYtPRjmYUD2oM7xGW3SNQLgCh+A5in4aOKsch6I=" crossorigin=anonymous></script></body></html>