{
    "$defs": {
        "Battery": {
            "additionalProperties": false,
            "description": "Battery used when simulating qualesi trains",
            "properties": {
                "efficiency": {
                    "description": "Battery efficiency",
                    "maximum": 1,
                    "minimum": 0,
                    "title": "Efficiency",
                    "type": "number"
                },
                "energy_source_type": {
                    "const": "Battery",
                    "default": "Battery",
                    "title": "Energy Source Type"
                },
                "energy_storage": {
                    "$ref": "#/$defs/EnergyStorage"
                },
                "max_input_power": {
                    "$ref": "#/$defs/SpeedDependantPower"
                },
                "max_output_power": {
                    "$ref": "#/$defs/SpeedDependantPower"
                }
            },
            "required": [
                "max_input_power",
                "max_output_power",
                "energy_storage",
                "efficiency"
            ],
            "title": "Battery",
            "type": "object"
        },
        "ComfortType": {
            "description": "This enum defines the comfort type that can take a train.",
            "enum": [
                "STANDARD",
                "AC",
                "HEATING"
            ],
            "title": "ComfortType",
            "type": "string"
        },
        "ConditionalEffortCurve": {
            "additionalProperties": false,
            "description": "Effort curve subject to application conditions",
            "properties": {
                "cond": {
                    "allOf": [
                        {
                            "$ref": "#/$defs/EffortCurveConditions"
                        }
                    ],
                    "default": {
                        "comfort": null,
                        "electrical_profile_level": null,
                        "power_restriction_code": null
                    }
                },
                "curve": {
                    "allOf": [
                        {
                            "$ref": "#/$defs/EffortCurve"
                        }
                    ],
                    "description": "Effort curve to apply if the conditions are met"
                }
            },
            "required": [
                "curve"
            ],
            "title": "ConditionalEffortCurve",
            "type": "object"
        },
        "EffortCurve": {
            "additionalProperties": false,
            "properties": {
                "max_efforts": {
                    "items": {
                        "minimum": 0,
                        "type": "number"
                    },
                    "minItems": 2,
                    "title": "Max Efforts",
                    "type": "array"
                },
                "speeds": {
                    "description": "Curves mapping speed (in m/s) to maximum traction (in newtons)",
                    "items": {
                        "minimum": 0,
                        "type": "number"
                    },
                    "minItems": 2,
                    "title": "Speeds",
                    "type": "array"
                }
            },
            "required": [
                "speeds",
                "max_efforts"
            ],
            "title": "EffortCurve",
            "type": "object"
        },
        "EffortCurveConditions": {
            "additionalProperties": false,
            "properties": {
                "comfort": {
                    "anyOf": [
                        {
                            "$ref": "#/$defs/ComfortType"
                        },
                        {
                            "type": "null"
                        }
                    ],
                    "default": null
                },
                "electrical_profile_level": {
                    "anyOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "null"
                        }
                    ],
                    "default": null,
                    "title": "Electrical Profile Level"
                },
                "power_restriction_code": {
                    "anyOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "null"
                        }
                    ],
                    "default": null,
                    "title": "Power Restriction Code"
                }
            },
            "title": "EffortCurveConditions",
            "type": "object"
        },
        "EffortCurves": {
            "additionalProperties": false,
            "description": "\n    Effort curves for a given rolling stock.\n    This schema handle multiple modes and conditions such as comfort, power restrictions, etc.\n    ",
            "properties": {
                "default_mode": {
                    "description": "The default profile to use",
                    "title": "Default Mode",
                    "type": "string"
                },
                "modes": {
                    "additionalProperties": {
                        "$ref": "#/$defs/ModeEffortCurves"
                    },
                    "description": "Map profiles such as '25kV' to comfort effort curves",
                    "title": "Modes",
                    "type": "object"
                }
            },
            "required": [
                "modes",
                "default_mode"
            ],
            "title": "EffortCurves",
            "type": "object"
        },
        "Electrification": {
            "additionalProperties": false,
            "description": "Electrification used when simulating qualesi trains",
            "properties": {
                "efficiency": {
                    "description": "Efficiency of electrification and pantograph transmission",
                    "maximum": 1,
                    "minimum": 0,
                    "title": "Efficiency",
                    "type": "number"
                },
                "energy_source_type": {
                    "const": "Electrification",
                    "default": "Electrification",
                    "title": "Energy Source Type"
                },
                "max_input_power": {
                    "$ref": "#/$defs/SpeedDependantPower"
                },
                "max_output_power": {
                    "$ref": "#/$defs/SpeedDependantPower"
                }
            },
            "required": [
                "max_input_power",
                "max_output_power",
                "efficiency"
            ],
            "title": "Electrification",
            "type": "object"
        },
        "EnergySource": {
            "additionalProperties": false,
            "description": "Energy sources used when simulating qualesi trains",
            "discriminator": {
                "mapping": {
                    "Battery": "#/$defs/Battery",
                    "Electrification": "#/$defs/Electrification",
                    "PowerPack": "#/$defs/PowerPack"
                },
                "propertyName": "energy_source_type"
            },
            "oneOf": [
                {
                    "$ref": "#/$defs/Electrification"
                },
                {
                    "$ref": "#/$defs/PowerPack"
                },
                {
                    "$ref": "#/$defs/Battery"
                }
            ],
            "title": "EnergySource"
        },
        "EnergyStorage": {
            "additionalProperties": false,
            "description": "If the EnergySource is capable of storing some energy",
            "properties": {
                "capacity": {
                    "description": "How much energy the source can store (in Joules)",
                    "minimum": 0,
                    "title": "Capacity",
                    "type": "number"
                },
                "refill_law": {
                    "anyOf": [
                        {
                            "$ref": "#/$defs/RefillLaw"
                        },
                        {
                            "type": "null"
                        }
                    ],
                    "default": null
                },
                "soc": {
                    "description": "The state of charge, SoC\u00b7capacity = actual stock of energy",
                    "maximum": 1,
                    "minimum": 0,
                    "title": "Soc",
                    "type": "number"
                },
                "soc_max": {
                    "description": "The maximum SoC, where the available energy is capacity",
                    "maximum": 1,
                    "minimum": 0,
                    "title": "Soc Max",
                    "type": "number"
                },
                "soc_min": {
                    "description": "The minimum SoC, where the available energy is zero",
                    "maximum": 1,
                    "minimum": 0,
                    "title": "Soc Min",
                    "type": "number"
                }
            },
            "required": [
                "capacity",
                "soc",
                "soc_min",
                "soc_max"
            ],
            "title": "EnergyStorage",
            "type": "object"
        },
        "Gamma": {
            "additionalProperties": false,
            "properties": {
                "type": {
                    "$ref": "#/$defs/GammaType"
                },
                "value": {
                    "exclusiveMinimum": 0,
                    "title": "Value",
                    "type": "number"
                }
            },
            "required": [
                "type",
                "value"
            ],
            "title": "Gamma",
            "type": "object"
        },
        "GammaType": {
            "enum": [
                "CONST",
                "MAX"
            ],
            "title": "GammaType",
            "type": "string"
        },
        "LoadingGaugeType": {
            "description": "This class allows to know the category of the loading gauge.",
            "enum": [
                "G1",
                "G2",
                "GA",
                "GB",
                "GB1",
                "GC",
                "FR3.3",
                "FR3.3/GB/G2",
                "GLOTT"
            ],
            "title": "LoadingGaugeType",
            "type": "string"
        },
        "ModeEffortCurves": {
            "additionalProperties": false,
            "description": "Effort curves for a given mode",
            "properties": {
                "curves": {
                    "description": "List of conditional effort curves, sorted by match priority",
                    "items": {
                        "$ref": "#/$defs/ConditionalEffortCurve"
                    },
                    "title": "Curves",
                    "type": "array"
                },
                "default_curve": {
                    "allOf": [
                        {
                            "$ref": "#/$defs/EffortCurve"
                        }
                    ],
                    "description": "Curve used if no condition is met"
                },
                "is_electric": {
                    "description": "Whether the mode is electric or not",
                    "title": "Is Electric",
                    "type": "boolean"
                }
            },
            "required": [
                "curves",
                "default_curve",
                "is_electric"
            ],
            "title": "ModeEffortCurves",
            "type": "object"
        },
        "PowerPack": {
            "additionalProperties": false,
            "description": "Power pack, either diesel or hydrogen, used when simulating qualesi trains",
            "properties": {
                "efficiency": {
                    "description": "Efficiency of the power pack",
                    "maximum": 1,
                    "minimum": 0,
                    "title": "Efficiency",
                    "type": "number"
                },
                "energy_source_type": {
                    "const": "PowerPack",
                    "default": "PowerPack",
                    "title": "Energy Source Type"
                },
                "energy_storage": {
                    "$ref": "#/$defs/EnergyStorage"
                },
                "max_input_power": {
                    "$ref": "#/$defs/SpeedDependantPower"
                },
                "max_output_power": {
                    "$ref": "#/$defs/SpeedDependantPower"
                }
            },
            "required": [
                "max_input_power",
                "max_output_power",
                "energy_storage",
                "efficiency"
            ],
            "title": "PowerPack",
            "type": "object"
        },
        "PowerRestrictions": {
            "additionalProperties": {
                "type": "string"
            },
            "title": "PowerRestrictions",
            "type": "object"
        },
        "RefillLaw": {
            "additionalProperties": false,
            "description": "The EnergyStorage refilling behavior",
            "properties": {
                "soc_ref": {
                    "description": "Reference (target) value of state of charge",
                    "maximum": 1,
                    "minimum": 0,
                    "title": "Soc Ref",
                    "type": "number"
                },
                "tau": {
                    "description": "Time constant of the refill behavior (in seconds)",
                    "minimum": 0,
                    "title": "Tau",
                    "type": "number"
                }
            },
            "required": [
                "tau",
                "soc_ref"
            ],
            "title": "RefillLaw",
            "type": "object"
        },
        "RollingResistance": {
            "additionalProperties": false,
            "properties": {
                "A": {
                    "minimum": 0,
                    "title": "A",
                    "type": "number"
                },
                "B": {
                    "minimum": 0,
                    "title": "B",
                    "type": "number"
                },
                "C": {
                    "minimum": 0,
                    "title": "C",
                    "type": "number"
                },
                "type": {
                    "const": "davis",
                    "title": "Type"
                }
            },
            "required": [
                "type",
                "A",
                "B",
                "C"
            ],
            "title": "RollingResistance",
            "type": "object"
        },
        "SignalingSystem": {
            "enum": [
                "BAL",
                "BAPR",
                "TVM300",
                "TVM430"
            ],
            "title": "SignalingSystem",
            "type": "string"
        },
        "SpeedDependantPower": {
            "additionalProperties": false,
            "description": "\n    A curve that account for speed-related power (output/availability) behavior of specific energy sources,\n    - the pantograph power is lowered at low speed to avoid welding the pantograph to the electrification\n    - the power outputted by Hydrogen fuel cells increases with speed\n    ",
            "properties": {
                "powers": {
                    "description": "power values",
                    "items": {
                        "minimum": 0,
                        "type": "number"
                    },
                    "minItems": 1,
                    "title": "Powers",
                    "type": "array"
                },
                "speeds": {
                    "description": "speed values",
                    "items": {
                        "minimum": 0,
                        "type": "number"
                    },
                    "minItems": 1,
                    "title": "Speeds",
                    "type": "array"
                }
            },
            "required": [
                "speeds",
                "powers"
            ],
            "title": "SpeedDependantPower",
            "type": "object"
        }
    },
    "additionalProperties": false,
    "description": "Electrical profiles and power classes are used to model the power loss along a electrification:\n    * Rolling stocks are attributed a power class depending on their power usage.\n    * Electrical profiles are then computed for each power class along all electrifications.\n    The electrical profile's value along the electrification is akin to an \"actual available power\" value.\n    * Then, speed-effort curves can be computed for all electrical profile values.\n\n    To prevent power grid overloads, infrastructure managers can enforce power restrictions on some parts of their\n    infrastructure for some trains. These train-specific restrictions are given a code.\n    To respect the prescribed power restrictions, the driver has to change the power notch used in the train, which\n    changes the power consumption of the train, akin to a car's gear.\n    In our model, we consider that trains' power notches and the associated power restriction codes are equivalent.\n    Thus power restrictions affect the effort curves, and change the power class of the rolling stock.\n    ",
    "properties": {
        "base_power_class": {
            "anyOf": [
                {
                    "type": "string"
                },
                {
                    "type": "null"
                }
            ],
            "default": null,
            "description": "The power usage class of the train (optional because it is specific to SNCF)",
            "title": "Base Power Class"
        },
        "comfort_acceleration": {
            "description": "The maximum operational acceleration in m/s^2",
            "exclusiveMinimum": 0,
            "title": "Comfort Acceleration",
            "type": "number"
        },
        "effort_curves": {
            "allOf": [
                {
                    "$ref": "#/$defs/EffortCurves"
                }
            ],
            "description": "Curves mapping speed (in m/s) to maximum traction (in newtons)"
        },
        "electrical_power_startup_time": {
            "anyOf": [
                {
                    "minimum": 0,
                    "type": "number"
                },
                {
                    "type": "null"
                }
            ],
            "default": null,
            "description": "The time the train takes before actually using electrical power (in s). Is null if the train is not electric.",
            "title": "Electrical Power Startup Time"
        },
        "energy_sources": {
            "items": {
                "$ref": "#/$defs/EnergySource"
            },
            "title": "Energy Sources",
            "type": "array"
        },
        "features": {
            "description": "A list of features the train exhibits",
            "items": {
                "maxLength": 255,
                "type": "string"
            },
            "title": "Features",
            "type": "array"
        },
        "gamma": {
            "allOf": [
                {
                    "$ref": "#/$defs/Gamma"
                }
            ],
            "description": "The max or const braking coefficient in m/s^2"
        },
        "inertia_coefficient": {
            "exclusiveMinimum": 0,
            "title": "Inertia Coefficient",
            "type": "number"
        },
        "length": {
            "description": "The length of the train, in m",
            "exclusiveMinimum": 0,
            "title": "Length",
            "type": "number"
        },
        "loading_gauge": {
            "$ref": "#/$defs/LoadingGaugeType"
        },
        "locked": {
            "default": false,
            "description": "Whether the rolling stock can be edited/deleted or not",
            "title": "Locked",
            "type": "boolean"
        },
        "mass": {
            "description": "The mass of the train, in kg",
            "exclusiveMinimum": 0,
            "title": "Mass",
            "type": "number"
        },
        "max_speed": {
            "description": "Maximum speed in m/s",
            "exclusiveMinimum": 0,
            "title": "Max Speed",
            "type": "number"
        },
        "metadata": {
            "additionalProperties": {
                "type": "string"
            },
            "description": "Properties used in the frontend to display the rolling stock",
            "title": "Metadata",
            "type": "object"
        },
        "name": {
            "maxLength": 255,
            "title": "Name",
            "type": "string"
        },
        "power_restrictions": {
            "anyOf": [
                {
                    "$ref": "#/$defs/PowerRestrictions"
                },
                {
                    "type": "null"
                }
            ],
            "default": null,
            "description": "Mapping from train's power restriction codes to power classes"
        },
        "railjson_version": {
            "const": "3.2",
            "default": "3.2",
            "title": "Railjson Version"
        },
        "raise_pantograph_time": {
            "anyOf": [
                {
                    "minimum": 0,
                    "type": "number"
                },
                {
                    "type": "null"
                }
            ],
            "default": null,
            "description": "The time it takes to raise this train's pantograph in s. Is null if the train is not electric.",
            "title": "Raise Pantograph Time"
        },
        "rolling_resistance": {
            "allOf": [
                {
                    "$ref": "#/$defs/RollingResistance"
                }
            ],
            "description": "The formula to use to compute rolling resistance"
        },
        "startup_acceleration": {
            "description": "The maximum acceleration during startup in m/s^2",
            "minimum": 0,
            "title": "Startup Acceleration",
            "type": "number"
        },
        "startup_time": {
            "description": "The time the train takes before it can start accelerating in s",
            "minimum": 0,
            "title": "Startup Time",
            "type": "number"
        },
        "supported_signaling_systems": {
            "items": {
                "$ref": "#/$defs/SignalingSystem"
            },
            "title": "Supported Signaling Systems",
            "type": "array"
        }
    },
    "required": [
        "name",
        "effort_curves",
        "length",
        "max_speed",
        "startup_time",
        "startup_acceleration",
        "comfort_acceleration",
        "gamma",
        "inertia_coefficient",
        "features",
        "mass",
        "rolling_resistance",
        "loading_gauge",
        "metadata"
    ],
    "title": "RollingStock",
    "type": "object"
}
