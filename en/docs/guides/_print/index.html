<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://osrd.fr/en/docs/guides/><link rel=alternate type=application/rss+xml href=https://osrd.fr/en/docs/guides/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>How-to Guides | OSRD</title>
<meta name=description content="Recipes for addressing key problems and use-cases"><meta property="og:title" content="How-to Guides"><meta property="og:description" content="Recipes for addressing key problems and use-cases"><meta property="og:type" content="website"><meta property="og:url" content="https://osrd.fr/en/docs/guides/"><meta itemprop=name content="How-to Guides"><meta itemprop=description content="Recipes for addressing key problems and use-cases"><meta name=twitter:card content="summary"><meta name=twitter:title content="How-to Guides"><meta name=twitter:description content="Recipes for addressing key problems and use-cases"><link rel=preload href=/scss/main.min.6a97a232111e8c01d1eed2c4b5cf2d0b180718f96d5c7e5aec2f7e997230ba06.css as=style><link href=/scss/main.min.6a97a232111e8c01d1eed2c4b5cf2d0b180718f96d5c7e5aec2f7e997230ba06.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/en/><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" id="svg36" width="110.767" height="22"><style id="style1">.st9{fill:#fff}</style><g id="ok" transform="scale(.1918)"><g id="g36"><g id="g29"><path id="path23" d="M38.5 83.4c-1.9 8.2-2.9 17-2.9 26.5v4.8h16.6c-2.8-13.2-7.8-23.4-13.7-31.3z" class="st9"/><path id="path24" d="M0 57.5v19.9c3.1 1.2 6.3 2.7 9.5 4.6 8.5 5.2 15 12.6 19.4 21.8v-31c-3.4-3-6.9-5.5-10.3-7.5-6.5-3.7-13-6.2-18.6-7.8z" class="st9"/><path id="path25" d="M35.6 69.9c4.3-11.3 10.6-21.1 18.9-29.4V0H35.6z" class="st9"/><path id="path26" d="M40.8 75.4c5.3 6.2 10.1 13.8 13.7 23.3V50.6C48.6 57.8 44 66.1 40.8 75.4z" class="st9"/><path id="path27" d="M100.7.0H61.3v34.5C73.1 25.2 86 20 96.9 17.2c1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-11.4 2.9-25.3 8.6-37.2 19.7v31.8c2.9-6.3 6.7-11.7 11.4-16.4 9.4-9.3 21-14.1 30.5-16.6 1.8-.5 3.7.6 4.1 2.4.5 1.8-.6 3.6-2.4 4.1-4.7 1.2-10.1 3.1-15.3 6-19 10.3-28.2 28.4-28.2 55.2v4.8h39.3c7.8.0 14.1-6.3 14.1-14.1V14.1C114.7 6.3 108.4.0 100.7.0z" class="st9"/><path id="path28" d="M22 59.6c2.2 1.3 4.5 2.8 6.8 4.6V0H14.1C6.3.0.0 6.3.0 14.1v36.4c6.5 1.7 14.2 4.5 22 9.1z" class="st9"/><path id="path29" d="M5.4 87.5c-1.8-1.1-3.6-2-5.4-2.8v15.9c0 7.8 6.3 14.1 14.1 14.1h11.6c-3.6-12.2-10.4-21.3-20.3-27.2z" class="st9"/></g><g id="g30"><path id="path30" d="M201.7 109c-30.8.0-53.7-21.2-53.7-52.5.0-31.7 22.9-51.6 53.7-51.6 31 0 53.9 20 53.9 51.6-.1 31.3-23 52.5-53.9 52.5zm0-82.6c-16.7.0-28.2 12.8-28.2 30.1.0 17.9 11.6 30.7 28.2 30.7S230 74.4 230 56.6c0-17.3-11.6-30.2-28.3-30.2z" class="st9"/></g><g id="g32"><g id="g31"><path id="path31" d="M334.3 33.3c-4-5.2-11.4-8.5-17.6-8.5-6.2.0-13.8 2.1-13.8 9.9.0 6.6 5.9 8.7 15.2 11.6 13.4 4.3 30.7 10 30.7 29.7.0 22.7-18.3 32.9-37.8 32.9-14.1.0-28.3-5.2-37-14.2l15.6-15.9c4.7 6 13.5 10.5 21.3 10.5 7.3.0 13.7-2.8 13.7-10.7.0-7.5-7.5-9.9-20.5-14.1C291.6 60.3 279 53.9 279 36c0-21.9 19.8-31 38.2-31 11.2.0 23.7 4.2 32.4 12.1z" class="st9"/></g></g><g id="g34"><g id="g33"><path id="path32" d="m433.1 106.4-21.3-39.2h-8.1v39.2h-23.4V7.6H418c19 0 37.8 7.3 37.8 29.9.0 13.3-7.8 22.7-20.5 26.6l25.8 42.3zm-16.9-79.6h-12.7v23h11.3c7.7.0 17.3-2 17.3-12 0-9.2-8.7-11-15.9-11z" class="st9"/></g></g><g id="g35"><path id="path34" d="M522.2 106.4h-36.8V7.6H521c28 0 56.5 11.7 56.5 49.1.0 34.7-28.1 49.7-55.3 49.7zm-1.7-78.5h-11.9v57.8h11.3c17 0 32.8-7 32.8-29 0-22.2-15.8-28.8-32.2-28.8z" class="st9"/></g></g></g></svg></span><span class=navbar-brand__name>OSRD</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/en/about/><span>About</span></a></li><li class=nav-item><a class="nav-link active" href=/en/docs/><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=/en/blog/><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/fr/docs/guides/>Français</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.9f512f7b771ae954767d2beacbf81d8e.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/en/docs/guides/>Return to the regular view of this page</a>.</p></div><h1 class=title>How-to Guides</h1><div class=lead>Recipes for addressing key problems and use-cases</div><ul><li>1: <a href=#pg-3ce54efed8813f1db94e060b5c4d3dba>Contribute to OSRD</a></li><ul><li>1.1: <a href=#pg-74bffd71515706df7537d3023dae3294>Preamble</a></li><li>1.2: <a href=#pg-68a5956342263ff5f4886c72db28df09>License and set-up</a></li><li>1.3: <a href=#pg-3ccabd1cd3cca32b70c0e05e5f70140a>Contribute code</a></li><ul><li>1.3.1: <a href=#pg-20bcbda082d1db739aaf2707ad636133>General principles</a></li><li>1.3.2: <a href=#pg-1dc6aff750b242c67234a9fd8036834a>Back-end conventions</a></li><li>1.3.3: <a href=#pg-c00d970cd31ed499e445d0092488ea53>Front-end conventions</a></li><li>1.3.4: <a href=#pg-e860c4a45f93c7fb63441214882a9d83>Write code</a></li><li>1.3.5: <a href=#pg-5e34e5f431c2652dad4e8905b8d58b51>Commit style</a></li><li>1.3.6: <a href=#pg-686cc94482965b0e45aee58c42de5752>Share your changes</a></li><li>1.3.7: <a href=#pg-24dfcd6e0a300c88dde36000f0679f04>Tests</a></li></ul><li>1.4: <a href=#pg-7e589464386341f7bd591dc4e255d00d>Review process</a></li><li>1.5: <a href=#pg-447ef90d37a1cd8a734c648d8c6dfc8e>Report issues</a></li><li>1.6: <a href=#pg-2a9a05ac75d9487faa1944da40452ac6></a></li></ul><li>2: <a href=#pg-40f3139debf9072e101dd5017feea52f>Deploy OSRD</a></li><ul><li>2.1: <a href=#pg-e686fb26d1c6bf4e0f647ff392d42cec>Docker Compose</a></li><ul></ul><li>2.2: <a href=#pg-e0a9ed49604351550da3ab0ba4bc265c>Kubernetes with Helm</a></li><ul></ul></ul><li>3: <a href=#pg-abcf30a6dedb6f28a328ee776192db94>Logo</a></li><li>4: <a href=#pg-2da528ba6fb6472a09f78336402e93a7>OSRD's design</a></li></ul><div class=content><p>How-to guides are recipes. They guide you through the steps involved in addressing key problems and use-cases. They are more advanced than tutorials and assume some knowledge of how OSRD works.</p></div></div><div class=td-content><h1 id=pg-3ce54efed8813f1db94e060b5c4d3dba>1 - Contribute to OSRD</h1><div class=lead>Learn about the how we work, and how you can work with us</div></div><div class=td-content><h1 id=pg-74bffd71515706df7537d3023dae3294>1.1 - Preamble</h1><div class=lead>An introduction to contributing to OSRD</div><p>First off, thanks for taking the time to contribute!</p><p>The following chapters are a set of guidelines for contributing to OSRD. These guidelines are mostly not strict rules, it&rsquo;s probably fine to do things slightly differently. If you have already contributed to open source projects before, you probably won&rsquo;t be surprised. If you have not, it will probably help a lot!</p><h3 id=communicate>Communicate</h3><p>Chatting with other contributors is a great way to speed things up:</p><ul><li><a href=https://github.com/osrd-project/osrd/issues/new/choose><strong>Create an issue</strong></a> to discuss your contribution project.</li></ul><h3 id=inquire>Inquire</h3><p>Just like with any project, changes rely on past work.
Before making changes, it is best to learn about what&rsquo;s already there:</p><ul><li><a href=https://osrd.fr/en/docs/>read technical documentation</a></li><li>read the existing source code related to your project</li><li>chat with developers who last worked on areas you are interested in</li></ul><p><em><a href=https://osrd.fr/en/docs/guides/contribute/license-and-set-up/>Continue towards initial set-up ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-68a5956342263ff5f4886c72db28df09>1.2 - License and set-up</h1><div class=lead>How to set up your development environment? What does our license involve?</div><h2 id=license-of-code-contributions>License of code contributions</h2><p>The source code of OSRD is available under <a href=https://choosealicense.com/licenses/lgpl-3.0/>the LGPLv3 license</a>.
By contributing to the codebase, you consent to the distribution of your changes under the project&rsquo;s license.</p><p>LGPLv3 forbids modifying source code without sharing the changes under the same license: use other people&rsquo;s work, and share yours!</p><p>This constraint does not propagate through APIs: You can use OSRD as a library, framework or API server to interface with proprietary software. Please suggest changes if you need new interfaces.</p><h2 id=set-things-up>Set things up</h2><div class="alert alert-info" role=alert>Most OSRD developers use Linux (incl. <a href=https://learn.microsoft.com/en-us/windows/wsl/>WSL</a>). Windows and MacOS should work too, but you may run into some issues.</div><h3 id=get-the-source-code>Get the source code</h3><ul><li>Install <a href=https://git-scm.com/><code>git</code></a>.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></li><li>Open a terminal<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> in the folder where the source code of OSRD will be located</li><li>Run <code>git clone git@github.com:osrd-project/osrd</code></li></ul><h3 id=launch-the-application>Launch the application</h3><p>Thanks to <code>docker</code>, one can easily compile, configure, and run all services after making a change. One can also start only a subset of the services.</p><ul><li>Install <code>docker</code>. <sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></li><li>Follow <a href=https://github.com/osrd-project/osrd#getting-started>OSRD&rsquo;s README</a>.</li></ul><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/>Continue towards code contribution ‣</a></em></p><h4 id=editoast-specific-batch-dependency-updates><code>editoast</code> specific: batch dependency updates</h4><p>We use dependabot on the project to signal when dependencies are outdated. We do not use dependabot to automatically update dependencies, as we want to merge all updates at once and review the changes.</p><p>Here is the process to update dependencies:</p><ol><li>Change the versions.<ul><li><em>If you&rsquo;re using VSCode</em> you can install the <a href="https://marketplace.visualstudio.com/items?itemName=serayuzgur.crates"><code>serayuzgur.crates</code></a> extension and run the &ldquo;update all dependencies&rdquo; command.<br>Make sure that the new version chosen is stable, and that loose constraints are not overwritten in your commit.</li><li><em>If you&rsquo;re not</em>, you can go check the versions used by dependabot in <a href="https://github.com/osrd-project/osrd/pulls?q=is%3Aopen+label%3Aarea%3Aeditoast+label%3Adependencies">its PRs</a> and update the versions manually.</li></ul></li><li>Run <code>cargo update</code> to update the Cargo.lock file (even sub-dependencies).</li><li>Check that all <a href="https://github.com/osrd-project/osrd/pulls?q=is%3Aopen+label%3Aarea%3Aeditoast+label%3Adependencies">dependabot editoast PRs</a> are included in your update.</li><li>Adapt the code to the new versions, if needed.</li><li>Create a PR with your changes, and link all dependabot PRs in the description.</li></ol><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Under Linux, follow installations steps for your distribution on <a href=https://docs.docker.com/engine/install/>Docker&rsquo;s documentation</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Under Windows, open <code>Git Bash</code>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Under Windows/<a href=https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-containers>WSL</a>, <a href=https://www.docker.com/products/docker-desktop/>Docker Desktop</a> is recommended&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3ccabd1cd3cca32b70c0e05e5f70140a>1.3 - Contribute code</h1><div class=lead>Integrate changes into OSRD</div><p>This chapter is about the process of integrating changes into the common code base. <strong>If you need help at any stage, open an issue or message us.</strong></p><p>OSRD application is split in multiple services written in several languages. We try to follow general code best practices and follow each language specificities when required.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-20bcbda082d1db739aaf2707ad636133>1.3.1 - General principles</h1><div class=lead>Please read this first!</div><ul><li>Explain what you&rsquo;re doing and why.</li><li>Document new code with doc comments.</li><li>Include clear, simple tests.</li><li>Break work into digestible chunks.</li><li>Take the time to pick good names.</li><li>Avoid non well-known abbreviations.</li><li><strong>Control and consistency over 3rd party code reuse</strong>: Only add a dependency if it is absolutely necessary.</li><li>Every dependency we add decreases our autonomy and consistency.</li><li><strong>Don&rsquo;t reinvent every wheel</strong>: as a counter to the previous point, don&rsquo;t reinvent everything at all costs.</li><li>If there is a dependency in the ecosystem that is the &ldquo;de facto&rdquo; standard, we should heavily consider using it.</li><li>More code general recommendations in main repository <a href=https://github.com/osrd-project/osrd/blob/dev/CONTRIBUTING.md>CONTRIBUTING.md</a>.</li><li>Ask for any help that you need!</li></ul><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/backend-conventions/>Consult back-end conventions ‣</a></em></p><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/frontend-conventions/>Consult front-end conventions ‣</a></em></p><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/write-code/>Continue towards write code ‣</a></em></p><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/tests/>Continue towards tests ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-1dc6aff750b242c67234a9fd8036834a>1.3.2 - Back-end conventions</h1><div class=lead>Coding style guide and best practices for back-end</div><h1 id=python>Python</h1><p>Python code is used for some packages and integration testing.</p><ul><li>Follow <a href=https://www.python.org/dev/peps/pep-0020/>the Zen of Python</a>.</li><li>Code is linted with <a href=https://github.com/csachs/pyproject-flake8>flake8</a>.</li><li>Code is formatted with <a href=https://github.com/psf/black>Black</a>.</li><li>Imports are sorted with <a href=https://github.com/PyCQA/isort>Isort</a>.</li><li>Python tests are written using <a href=https://docs.pytest.org/>pytest</a>.</li><li>Typing is checked using <a href=https://google.github.io/pytype/>pytype</a>.</li></ul><h1 id=rust>Rust</h1><ul><li>As a reference for our API development we are using the <a href=https://rust-lang.github.io/api-guidelines/about.html>Rust API guidelines</a>.
Generally, these should be followed.</li><li>Prefer granular imports over glob imports like <code>diesel::*</code>.</li><li>Tests are written with the <a href=https://doc.rust-lang.org/book/ch11-01-writing-tests.html>built-in testing framework</a>.</li><li>Use the <a href=https://doc.rust-lang.org/rust-by-example/meta/doc.html>documentation example</a> to know how to phrase and format your documentation.</li><li>Use consistent comment style:<ul><li><code>///</code> doc comments belong above <code>#[derive(Trait)]</code> invocations.</li><li><code>//</code> comments should generally go above the line in question, rather than in-line.</li><li>Start comments with capital letters. End them with a period if they are sentence-like.</li></ul></li><li>Use comments to organize long and complex stretches of code that can&rsquo;t sensibly be refactored into separate functions.</li><li>Code is linted with <a href=https://github.com/rust-lang/rust-clippy>clippy</a>.</li><li>Code is formatted with <a href=https://github.com/rust-lang/rustfmt>fmt</a>.</li></ul><h1 id=java>Java</h1><ul><li>Code is formatted with <a href=https://checkstyle.sourceforge.io/>checkstyle</a>.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-c00d970cd31ed499e445d0092488ea53>1.3.3 - Front-end conventions</h1><div class=lead>Coding style guide and best practices for front-end</div><p>We use <strong>ReactJS</strong> and all files must be written in <strong>Typescript</strong>.</p><p>The code is <strong>linted</strong> with <a href=https://eslint.org/>eslint</a>, and <strong>formatted</strong> with <a href=https://prettier.io/>prettier</a>.</p><h2 id=nomenclature>Nomenclature</h2><p><img src=/images/docs/contribute/nomenclature-front-end.svg alt="Infrastructure diagram"></p><p>The <strong>applications</strong> (osrd eex, osrd stdcm, infra editor, rolling-stock editor) offer <strong>views</strong> (project management, study management, etc.) linked to <strong>modules</strong> (project, study, etc.) which contain the components.</p><p>These <strong>views</strong> are made up of <strong>components</strong> and sub-components <u>all derived from the modules</u>.
In addition to containing the <strong>views</strong> files for the applications, they may also contain a <strong>scripts</strong> directory which offers scripts related to these views. The <strong>views</strong> determine the logic and <u>access to the store</u>.</p><p><strong>Modules</strong> are collections of <strong>components</strong> attached to an <strong>object</strong> (a scenario, a rolling stock, a TrainSchedule). They contain :</p><ul><li>a <em>components</em> directory hosting <u>all</u> components</li><li>an optional <em>styles</em> directory <u>per module</u> for styling components in scss</li><li>an optional <em>assets</em> directory <u>per module</u> (which contains assets, e.g. default datasets, specific to the module)</li><li>an optional <em>reducers</em> file <u>per module</u></li><li>an optional <em>types</em> file <u>per module</u></li><li>an optional <em>consts</em> file <u>per module</u></li></ul><p>An <strong>assets</strong> directory (containing images and other files).</p><p>Last but not least, a <strong>common</strong> directory offering :</p><ul><li>a <em>utils</em> directory for utility functions common to the entire project</li><li>a <em>types</em> file for types common to the entire project</li><li>a <em>consts</em> file for constants common to the entire project</li></ul><h2 id=implementation-principles>Implementation principles</h2><h3 id=routing--slug>Routing & SLUG</h3><p><em>In progress</em></p><p><code>projects/{nom du projet}/studies/{nom de l'étude}/scenarios/{nom du scenario}</code></p><h3 id=styles--scss>Styles & SCSS</h3><blockquote><p>WARNING: in CSS/React, the scope of a class does not depend on where the file is imported, but is valid for the entire application. If you import an <code>scss</code> file in the depths of a component (which we strongly advise against), its classes will be available to the whole application and may therefore cause side effects.</p></blockquote><p>It is therefore highly recommended to be able to easily follow the tree structure of applications, views, modules and components also within the SCSS code, and in particular to nest class names to avoid edge effects, as the compiler will take care of making the necessary hierarchy.</p><p>If, for example, we have a <code>rollingStockSelector</code> component which proposes a list of rolling stock <code>rollingStockList</code> represented by <code>rollingStockCard</code> containing an image representing the rolling stock <code>rollingStockImg</code> we should have the following SCSS structure:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scss data-lang=scss><span style=display:flex><span><span style=color:#000>.rollinStockSelector</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>.rollingStockList</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>.rollingStockCard</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>.rollingStockImg</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>width</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#204a87;font-weight:700>rem</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>height</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#ce5c00>auto</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>This ensures that the image contained in the rolling stock card inherits the correct css properties <code>.rollinStockSelector.rollingStockList.rollingStockCard.rollingStockImg</code>.</p><h4 id=css-modules>CSS Modules</h4><p>CSS modules allow scoping CSS styles to a specific component, thereby avoiding conflicts with global class names.</p><p>Vite natively supports CSS modules. Ensure that your CSS file has the <code>.module.css</code> extension, for example, <code>styles.module.css</code>.</p><h5 id=using-css-modules-in-components>Using CSS Modules in Components</h5><ol><li><strong>Create an SCSS file with the <code>.module.scss</code> extension</strong>:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/* MyComponent.module.scss */</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>.</span><span style=color:#000>container</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>background-color</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>white</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>.</span><span style=color:#000>title</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>font-size</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>24</span><span style=color:#204a87;font-weight:700>px</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>color</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>#333</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><ol start=2><li><strong>Use the classes in your React component</strong>:</li></ol><p>Vite transforms classes into objects that contain hashed classes (e.g., <code>_container_h3d8bg</code>) and uses them during bundle generation, making the classes unique.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>React</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#39;react&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>styles</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#39;./MyComponent.module.scss&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>MyComponent() {</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>styles</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>container</span><span style=color:#000;font-weight:700>}&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>h1</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>styles</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;title&#34;</span><span style=color:#000;font-weight:700>]}&gt;</span><span style=color:#000>My</span> <span style=color:#000>Title</span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>h1</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>};</span>
</span></span></code></pre></div><p>For more information, you can refer to the <a href=https://vitejs.dev/guide/features.html#css-modules>Vite.js documentation</a>.</p><h4 id=class-names-using-cx>Class names, using <code>cx()</code>.</h4><p>Classes are normally added one after the other, in the <code>className=""</code> property.</p><p>However, when necessary - class usage tests, concatenation, etc. - we use the <a href=https://github.com/JedWatson/classnames>classnames library</a>, which recommends the following usage:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;rollingStockSelector&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;rollingStockList&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;rollingStockCard w-100 my-2&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>img</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>className</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#000>cx</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;rollingStockImg&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;m-2&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;p-1&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;bg-white&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>valid</span>: <span style=color:#204a87;font-weight:700>isValid</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>          <span style=color:#000>selected</span>: <span style=color:#204a87;font-weight:700>rollingStockID</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#000>selectedRollingStockID</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>})}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Classes are <strong>separated</strong> each in a <code>string</code> and Boolean or other operations are performed in an object that will return - or not - the property name as the class name to be used in CSS.</p><h3 id=storeredux>Store/Redux</h3><p>Everything that is <em>selector</em> is managed by the <strong>view</strong> and passed as props to components and sub-components.</p><p>Consequently, read and write calls to the store must be made at view level, irrigating the components proposed by the view with <em>props</em> and <em>states</em>.</p><h3 id=rtk>RTK</h3><p>Utiliser les endpoints générés à partir des fichiers <code>openapi.yaml</code> pour consommer le backend.</p><h4 id=fonctionnement-du-cache-dans-rtk-query>Fonctionnement du cache dans RTK Query</h4><p>Lorsque de la donnée est récupérée depuis le back, RTK va mettre cette donnée en cache dans le store. Si le même endpoint est appelé avec les même paramètres, RTK va réutiliser la donnée dans le cache plutôt que de rappeler le back.</p><p>Dans le store, vous verrez cette clé <code>editoastApi</code> qui contient la donnée en cache de tous les endpoints editoast :</p><p><img src=/images/docs/contribute/store-redux-main.png alt="store Redux"></p><p>Ici par exemple l’endpoint <code>getProjects</code> a été appelé.</p><p>RTK stocke le nom de l’endpoint, ainsi que les paramètres d’appel, pour former une clé unique <code>nomDuEndpoint({ paramètres })</code>. (ici <code>getProjects({"ordering":"LastModifiedDesc","pageSize":1000})</code>).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;getProjectsByProjectIdStudiesAndStudyId({&#34;projectId&#34;:13,&#34;studyId&#34;:16})&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>status</span> <span style=color:#ce5c00;font-weight:700>:</span><span style=color:#4e9a06>&#34;fulfilled&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>etc</span><span style=color:#a40000>…</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;getProjectsByProjectIdStudiesAndStudyId({&#34;projectId&#34;:13,&#34;studyId&#34;:14})&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a40000>…</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Dans ce deuxième exemple, le même endpoint a été appelé avec le même paramètre <code>projectId</code>, mais un paramètre <code>studyId</code> différent.</p><h5 id=sérialisation-des-clés-dans-le-cache>Sérialisation des clés dans le cache</h5><p>Les string utilisées comme clé dans le cache sont à peu de choses près l’objet paramètre passé à la moulinette <code>JSON.stringify</code> que transforme un object JS en string (donc sérialisé).</p><p>Normalement La sérialisation ne conserve pas l’ordre des clés des objets. Par exemple, <code>JSON.stringify</code> ne produira pas la même string avec ces deux objets: <code>{ a: 1, b: 2 }</code> et <code>{ b: 2, a: 1 }</code>.</p><p>RTK va optimiser la mise en cache en faisant en sorte que le résultat d’un appel avec <code>{"projectId":13,"studyId":16}</code> ou <code>{"studyId":16, "projectId":13}</code> soient stockées dans la même clé dans le cache.</p><p>Pour voir le fonctionnement en détail, voici le code de cette fonction de sérialisation :</p><details><summary>Fonction de sérialisation RTK</summary><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>defaultSerializeQueryArgs</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>SerializeQueryArgs</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>any</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>    <span style=color:#000>endpointName</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>})</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>serialized</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>cached</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cache</span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>typeof</span> <span style=color:#000>cached</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#4e9a06>&#39;string&#39;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>serialized</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>cached</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>stringified</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>stringify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>isPlainObject</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#204a87>Object</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>keys</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>.</span><span style=color:#000>sort</span><span style=color:#000;font-weight:700>()</span> <span style=color:#8f5902;font-style:italic>// les clés sont remises dans l’ordre ici
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>              <span style=color:#000;font-weight:700>.</span><span style=color:#000>reduce</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>any</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>((</span><span style=color:#000>acc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>key</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>acc</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>value</span> <span style=color:#000>as</span> <span style=color:#000>any</span><span style=color:#000;font-weight:700>)[</span><span style=color:#000>key</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>acc</span>
</span></span><span style=display:flex><span>              <span style=color:#000;font-weight:700>},</span> <span style=color:#000;font-weight:700>{})</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>value</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>isPlainObject</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>cache</span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>queryArgs</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>stringified</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>serialized</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stringified</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Sort the object keys before stringifying, to prevent useQuery({ a: 1, b: 2 }) having a different cache key than useQuery({ b: 2, a: 1 })
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>`</span><span style=color:#4e9a06>${</span><span style=color:#000>endpointName</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>(</span><span style=color:#4e9a06>${</span><span style=color:#000>serialized</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>)`</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></details><h5 id=souscriptions-à-la-donnée>Souscriptions à la donnée</h5><p>Dans la terminologie de RTK query, Lorsqu’un composant react appelle un endpoint défini dans RTK Query, il <em>souscrit</em> à la donnée.</p><p>RTK compte le nombre de référence à la même paire (endpoint,{paramètres}). Lorsque deux composants souscrivent à la même donnée. Ils partagent la même clé dans le cache.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>osrdEditoastApi</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#39;./api.ts&#39;</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component1() {</span>  
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the data  
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component2() {</span>  
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the data  
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component3() {</span>  
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the data  
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>Component4() {</span>  
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// component subscribes to the *same* data as ComponentThree,  
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// as it has the same query parameters  
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>data</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>osrdEditoastApi</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>useGetXQuery</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;...&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Ici <code>Component3</code> et <code>Component4</code> ne vont générer qu’un seul appel vers le back. Ils souscrivent à la même donnée (même endpoint et même paramètre <code>3</code>). Ils vont partager la même clé dans le cache.</p><p>Au total ici il y aura trois appels vers le back, avec les paramètres <code>1</code>, <code>2</code>, <code>3</code>.</p><p>Tant qu’il existe au moins un composant react monté, qui appelle le hook <code>osrdEditoastApi.endpoints.getProjectsByProjectId.useQuery</code> par exemple, la donnée sera conservée dans le cache.</p><p>Dès que le dernier composant est démonté, la donnée est supprimée du cache au bout de 60 secondes (valeur par défaut).</p><h2 id=lois-et-éléments-importants>Lois et éléments importants</h2><h4 id=no-component-should-be-responsible-for-updating-the-data-it-uses>No component should be responsible for updating the data it uses</h4><p>Only <u>views</u> contain the store selectors, which are then given as props to the components of the module linked to the view.</p><h4 id=scss-is-not-scoped>SCSS is not scoped</h4><p>A <code>.scss</code> file buried in the tree structure doesn&rsquo;t guarantee that the classes it contains can only be accessed there, even by importing react (formally forbidden by the way: you must use SCSS import), all declared classes are accessible everywhere.</p><p>Prefer a judicious choice of root class name for a given module, and use the tree structure available in the SCSS file.</p><h4 id=import-links-must-be-absolute>Import links must be absolute</h4><p>You must use the <u>full path</u> for all your imports.</p><blockquote><p>Import links can be relative only if the file to be imported is in the same directory.</p></blockquote><h2 id=typescript>TypeScript</h2><h3 id=import--export>import & export</h3><p>We recommend using typed imports and exports.</p><p>When an <code>import</code> or <code>export</code> contains only types, indicate it with the <code>type</code> keyword.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>type</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Direction</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>DirectionalTrackRange</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>TrackRange</span> <span style=color:#000;font-weight:700>};</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#204a87;font-weight:700>type</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>typedEntries</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ValueOf</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#4e9a06>&#39;utils/types&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p>This allows to:</p><ul><li>Improve the performance and analysis process of the compiler and the linter.</li><li>Make these declarations more readable; we can clearly see what we are importing.</li><li>Avoid dependency cycles:</li></ul><p><img src=/images/docs/contribute/dependency-cycle.png alt="dependency cyle"></p><p>The error disappears with the <code>type</code> keyword</p><p><img src=/images/docs/contribute/dependency-cycle-gone.png alt="dependency cyle"></p><ul><li>Make final bundle lighter (all types disappear at compilation)</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e860c4a45f93c7fb63441214882a9d83>1.3.4 - Write code</h1><div class=lead>Integrate changes into OSRD</div><ol><li><p>If you are not used to Git, <a href=https://learngitbranching.js.org/>follow this tutorial</a></p></li><li><p><strong>Create a branch</strong><br>If you intend to contribute regularly, you can request access to the <a href=https://github.com/osrd-project/osrd>main repository</a>. Otherwise, <a href=https://github.com/osrd-project/osrd/fork>create a fork</a>.</p></li><li><p><strong>Add changes to your branch</strong><br>Before you start working, try to split your work into macroscopic steps.
At the end of each stop, save your changes into a commit.
Try to make commits of logical and atomic units.
Try to follow <a href=../conventions/>style conventions</a>.</p></li><li><p><strong>Keep your branch up-to-date</strong></p><pre tabindex=0><code>git switch &lt;your_branch&gt;
git fetch
git rebase origin/dev
</code></pre></li></ol><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/commit-style/>Continue towards commit style ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-5e34e5f431c2652dad4e8905b8d58b51>1.3.5 - Commit style</h1><div class=lead>A few advises and rules about commit messages</div><p>The overall format for git commits is as follows:</p><pre tabindex=0><code>component1, component2: imperative description of the change

Detailed or technical description of the change and what motivates it,
if it is not entirely obvious from the title.
</code></pre><ul><li><strong>the commit message, just like the code, must be in english</strong> (only ASCII characters for the title)</li><li>there can be multiple components separated by <code>:</code> in case of hierarchical relationships, with <code>,</code> otherwise</li><li>components are lower-case, using <code>-</code>, <code>_</code> or <code>.</code> if necessary</li><li>the imperative description of the change begins with a lower-case verb</li><li>the title must not contain any link (<code>#</code> is forbidden)</li></ul><p>Ideally:</p><ul><li>the title should be self-explanatory: no need to read anything else to understand it</li><li>the commit title is all lower-case</li><li>the title is clear to a reader not familiar with the code</li><li>the body of the commit contains a detailled description of the change</li></ul><div class="alert alert-info" role=alert>An automated check is performed to enforce as much as possible this formating.</div><h3 id=counter-examples-of-commit-titles>Counter-examples of commit titles</h3><ul><li><code>component: update ./some/file.ext</code>: specify the update itself rather than the file, the files
are technical elements welcome in the <em>body</em> of the commit</li><li><code>component: fix #42</code>: specify the problem fixed in the title, links (to issue, etc.) are very
welcome in commit&rsquo;s <em>body</em></li><li><code>wip</code>: describe the work (and finish it)</li></ul><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/share-changes/>Continue towards sharing your changes ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-686cc94482965b0e45aee58c42de5752>1.3.6 - Share your changes</h1><div class=lead>How to submit your code modifications for review?</div><p>The author of a <em>pull request (PR)</em> is responsible for its &ldquo;life cycle&rdquo;. He is responsible for contacting the various parties involved, following the review, responding to comments and correcting the code following review (you could also check <a href=https://osrd.fr/en/docs/guides/contribute/code-review/>dedicated page about code review</a>).</p><blockquote><p>In the case of a large PR, don&rsquo;t hesitate to ask several reviewers to organize themselves, or even to carry out the review together, reviewers and author.</p></blockquote><ol><li><p><strong>Open a <em>pull request</em></strong><br>Once your changes are ready, you have to request integration with the <code>dev</code> branch.</p><p>If possible:</p><ul><li>Make PR of logical and atomic units too (avoid mixing refactoring, new features and bug fix at the same time).</li><li>Add a description to PRs to explain what they do and why.</li><li>Help the reviewer by following advice given in <a href=https://mtlynch.io/code-review-love/>mtlynch article</a>.</li><li>Add tags <code>area:&lt;affected_area></code> to show which part of the application have been impacted. It can be done through <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request>the web interface</a>.</li></ul></li><li><p><strong>Take feedback into account</strong><br>Once your PR is open, <a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/about-pull-request-reviews>other contributors can review your changes</a>:</p><ul><li>Any user can review your changes.</li><li>Your code has to be approved by <a href=https://github.com/osrd-project/osrd/blob/dev/.github/CODEOWNERS>a contributor familiar with the code</a>.</li><li>All users are expected to take comments into account.</li><li>Comments tend to be written in an open and direct manner.
The intent is to efficiently collaborate towards a solution we all agree on.</li><li>Once all discussions are resolved, a maintainer integrates the change.</li></ul></li><li><p><strong>If you believe somebody forgot to review / merge your change, please speak out, multiple times if needs be.</strong></p></li></ol><h2 id=suggested-workflow>Suggested workflow</h2><p>Here&rsquo;s a suggested workflow.</p><p><strong>It is necessary to communicate via instant messaging (Matrix, Slack, etc.) in order to guarantee the smooth flow of PR validation.</strong></p><pre class=mermaid>sequenceDiagram
  actor A as PR author
  actor R as Reviewer/Maintainer
  
  A-&gt;&gt;R: Asks for a review, notifying some people
  R-&gt;&gt;A: Answers yes or no
  
  loop Loop between author and reviewer
    R--&gt;&gt;&#43;A: Comments, asks for changes
    A--&gt;&gt;R: Answers to comments or requested changes
    A--&gt;&gt;-R: Makes necessary changes in dedicated &#34;fixups&#34;
    R--&gt;&gt;A: Reviews changes
    R--&gt;&gt;A: Resolves requested changes/conversations if ok
  end
 
  A-&gt;&gt;R: Rebase and apply fixups
  R-&gt;&gt;A: Checks commits history
  R-&gt;&gt;A: Approves or closes the PR
  Note left of R: &amp; Merges if maintainer</pre><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/tests/>Finally continue towards tests ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-24dfcd6e0a300c88dde36000f0679f04>1.3.7 - Tests</h1><div class=lead>Recommandations for testing purpose</div><h2 id=back-end>Back-end</h2><ul><li>Integration tests are written with <a href=https://docs.pytest.org/>pytest</a> in the <code>/tests</code> folder.</li><li>Each route described in the <code>openapi.yaml</code> files must have an integration test.</li><li>The test must check both the format and content of valid and invalid responses.</li></ul><h2 id=front-end>Front-end</h2><p>The functional writing of the tests is carried out with the <em>Product Owners</em>, and the developers choose a technical implementation that precisely meets the needs expressed and fits in with the recommendations presented here.</p><p>We use <a href=https://playwright.dev/>Playwright</a> to write end-to-end tests, and <a href=https://vitest.dev/>vitest</a> to write unit tests.</p><p>The browsers tested are currently <a href=https://www.mozilla.org/fr/firefox/switch/>Firefox</a> and Chromium.</p><h3 id=basic-principles>Basic principles</h3><ul><li>Tests must be <strong>short</strong> (1min max) and go <strong>straight to the point</strong>.</li><li>Arbitrary timeouts are outlawed; a test must systematically wait for a specific event. It is possible to use <em>polling</em> (retry an action - a click for example - after a certain time) proposed in the <a href=https://playwright.dev/>Playwright&rsquo;s</a> API.</li><li>All tests must be parallelizable.</li><li>Tests must not point to or wait for text elements from the translation, prefer the <em>DOM</em> tree structure or place specific <code>id</code>.</li><li>We&rsquo;re not testing the data, but the application and its functionality. Data-specific tests should be developed in parallel.</li></ul><h4 id=data>Data</h4><p><strong>The data tested must be public data</strong>.
The data required (infrastructure and rolling stock) for the tests are offered in the application&rsquo;s <code>json</code> files, <em>injected</em> at the start of each test and deleted at the end, regardless of its result or how it is stopped, including with <code>CTRL+C</code>.</p><p>This is done by API calls in typescript before launching the actual test.</p><p>The data tested is the same, both locally and via continuous integration.</p><h4 id=atomicity-of-a-test>Atomicity of a test</h4><p>Each test must be <strong>atomic</strong>: it is self-sufficient and cannot be divided.</p><p>A test will target a single feature or component, provided it is not too large. A test will not test an entire module or application; it will necessarily be a set of tests, in order to preserve test atomicity.</p><p>If a test needs elements to be created or added, these operations must be carried out by API calls in typescript upstream of the test, as is done for adding data. These elements must be deleted at the end of the test, regardless of the result or how it is stopped, including by <code>CTRL+C</code>.</p><p>This allows tests to be parallelized.</p><p>However, in certain cases where it is relevant, a test may contain several clearly explained and justified test subdivisions (several <code>test()</code> in a single <code>describe()</code>).</p><h3 id=example-of-a-test>Example of a test</h3><p>The requirement: &ldquo;We want to test the addition of a train to a timetable&rdquo;.</p><ol><li>add the test infrastructure and rolling stock to the database <strong>by API calls</strong>.</li><li>create project, study and scenario with choice of test infrastructure <strong>by API calls</strong>.</li><li>start the test, clicking on &ldquo;add one or more trains&rdquo; until the presence of the trains in the timetable is verified</li><li>the test passes, fails or is stopped, the project, study and scenario are deleted, along with the test rolling stock and infrastructure <strong>by API calls</strong>.</li></ol><p><em>NB: the test will not test all the possibilities offered by the addition of trains; this should be a specific test which would test the response of the interface for all scenarios without adding trains.</em></p><p><em><a href=https://osrd.fr/en/docs/guides/contribute/contribute-code/write-code/>Continue towards write code ‣</a></em></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7e589464386341f7bd591dc4e255d00d>1.4 - Review process</h1><div class=lead>How to give useful feedback</div><p>The reviewer/maintainer undertakes to carry out the review quickly, and is also responsible for closing <em>request changes</em>, check commit history and quickly merge the <em>pull request</em> if allowed.</p><p>We propose you a few tips and recommendations that we think are relevant to a human, relevant and rewarding code review for all contributors:</p><ul><li><a href=https://mtlynch.io/code-review-love/>How to Make Your Code Reviewer Fall in Love with You?</a> by Michael Lynch.</li><li><a href=https://mtlynch.io/human-code-reviews-1/>How to Do Code Reviews Like a Human? </a>by Michael Lynch.</li></ul><p>Here&rsquo;s a suggested workflow.</p><p><strong>It is necessary to communicate via instant messaging (Matrix, Slack, etc.) in order to guarantee the smooth flow of PR validation.</strong></p><pre class=mermaid>sequenceDiagram
  actor A as PR author
  actor R as Reviewer/Maintainer
  
  A-&gt;&gt;R: Asks for a review, notifying some people
  R-&gt;&gt;A: Answers yes or no
  
  loop Loop between author and reviewer
    R--&gt;&gt;&#43;A: Comments, asks for changes
    A--&gt;&gt;R: Answers to comments or requested changes
    A--&gt;&gt;-R: Makes necessary changes in dedicated &#34;fixups&#34;
    R--&gt;&gt;A: Reviews changes
    R--&gt;&gt;A: Resolves requested changes/conversations if ok
  end
 
  A-&gt;&gt;R: Rebase and apply fixups
  R-&gt;&gt;A: Checks commits history
  R-&gt;&gt;A: Approves or closes the PR
  Note left of R: &amp; Merges if maintainer</pre><blockquote><p>If the reviewer is not maintainer, the PR&rsquo;s author has the responsability to contact a maintainer to merge the PR. In special cases (especially near feature freeze), maintainer should be found early.</p></blockquote><h2 id=the-code-review-pyramid>The code review pyramid</h2><figure><a href=https://www.morling.dev/blog/the-code-review-pyramid/><img src=/images/docs/contribute/code_review_pyramid.svg></a></figure></div><div class=td-content style=page-break-before:always><h1 id=pg-447ef90d37a1cd8a734c648d8c6dfc8e>1.5 - Report issues</h1><div class=lead>Report a bug or suggest an enhancement</div><p><strong>Please report anything you deem significant!</strong></p><p>Our bug tracking platform is <a href=https://github.com/osrd-project/osrd/issues>github</a>, so you have to register to report bugs.</p><p>Follow <a href=https://github.com/osrd-project/osrd/issues/new/choose>this link</a> and pick whatever template fits the best.</p><h3 id=bugs>Bugs</h3><ul><li>Bug must have a correct description and the bug&rsquo;s issue template must be filled carefully.</li><li>Bug must be tagged with (<em>for team members</em>):<ul><li><code>kind:bug</code></li><li>one or several <code>area:&lt;affected_area></code> if possible, if the affected area is not known leave it blank it will be added later by another team member.</li><li>one <code>severity:&lt;bug_severity></code> if possible, if severity is not known leave it blank it will be added later by another team member.<ul><li><code>severity:minor</code>: User can still use the feature.</li><li><code>severity:major</code>: User sometimes can&rsquo;t use the feature.</li><li><code>severity:critical</code>: User can&rsquo;t use the feature.</li></ul></li></ul></li><li>OSRD team members can change issues&rsquo; tags (severity, area, kind, &mldr;).
You may leave a comment to explain changes.</li><li>If you are working on a bug or plan to work on a bug, assign yourself to the bug.</li><li>PRs solving bugs should add a regression tests to ensure that bug will not be back in the future.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2a9a05ac75d9487faa1944da40452ac6>1.6 -</h1><p>Here&rsquo;s a suggested workflow.</p><p><strong>It is necessary to communicate via instant messaging (Matrix, Slack, etc.) in order to guarantee the smooth flow of PR validation.</strong></p><pre class=mermaid>sequenceDiagram
  actor A as PR author
  actor R as Reviewer/Maintainer
  
  A-&gt;&gt;R: Asks for a review, notifying some people
  R-&gt;&gt;A: Answers yes or no
  
  loop Loop between author and reviewer
    R--&gt;&gt;&#43;A: Comments, asks for changes
    A--&gt;&gt;R: Answers to comments or requested changes
    A--&gt;&gt;-R: Makes necessary changes in dedicated &#34;fixups&#34;
    R--&gt;&gt;A: Reviews changes
    R--&gt;&gt;A: Resolves requested changes/conversations if ok
  end
 
  A-&gt;&gt;R: Rebase and apply fixups
  R-&gt;&gt;A: Checks commits history
  R-&gt;&gt;A: Approves or closes the PR
  Note left of R: &amp; Merges if maintainer</pre></div><div class=td-content style=page-break-before:always><h1 id=pg-40f3139debf9072e101dd5017feea52f>2 - Deploy OSRD</h1><div class=lead>Learn how to deploy OSRD in various environments</div><p>First of all, we recommend learning about the <a href=https://osrd.fr/en/docs/explanation/containers-architecture/>containers architecture of OSRD</a>.</p><p>We will cover how to deploy OSRD within the following setups:</p><ul><li><a href=https://osrd.fr/en/docs/guides/deploy/docker-compose/>Using docker compose</a> on a single node.</li><li><a href=https://osrd.fr/en/docs/guides/deploy/docker-compose/>Using helm</a> on a kubernetes cluster.</li></ul><p>It is also possible to deploy each service of OSRD manually on a system, but we will not cover this topic within this guide.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e686fb26d1c6bf4e0f647ff392d42cec>2.1 - Docker Compose</h1><div class=lead>Using docker compose for single node deployment</div><p>The OSRD project includes a <code>docker-compose.yml</code> file designed to facilitate the deployment of a fully functional OSRD environment. Primarily intended for development purposes, this Docker Compose configuration can also be adapted for quick, single-node deployments.</p><h2 id=prerequisites>Prerequisites</h2><p>Before proceeding with the deployment, ensure that you have the following installed:</p><ul><li>Docker</li><li>Docker Compose</li></ul><h2 id=configuration-overview>Configuration Overview</h2><p>The <code>docker-compose.yml</code> file defines the following services:</p><ol><li><strong>PostgreSQL</strong>: A PostgreSQL database with PostGIS extension.</li><li><strong>Redis</strong>: A Redis server for caching.</li><li><strong>Core</strong>: The core OSRD service.</li><li><strong>Front</strong>: The front-end service for OSRD.</li><li><strong>Editoast</strong>: A OSRD service responsible for various editorial functions.</li><li><strong>Gateway</strong>: Serves as the gateway for the OSRD services.</li><li><strong>Wait-Healthy</strong>: A utility service to ensure all services are healthy before proceeding.</li></ol><p>Each service is configured with health checks, volume mounts and necessary environment variables.</p><h2 id=deployment-steps>Deployment Steps</h2><ol><li><strong>Clone the Repository</strong>: First, clone the OSRD repository to your local machine.</li><li><strong>Environment Variables</strong> (optional): Set necessary environment variables if you need to adjust some configurations.</li><li><strong>Build and Run</strong>: Navigate to the directory containing <code>docker-compose.yml</code> and run:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up --build
</span></span></code></pre></div><p>This command builds the images and starts the services defined in the Docker Compose file.</p><h2 id=accessing-services>Accessing Services</h2><p>While all HTTP service are used through the gateway (<code>http://localhost:4000</code>), you can access directly each service using their exposed ports:</p><ul><li><strong>PostgreSQL</strong>: Accessible on <code>localhost:5432</code>.</li><li><strong>Redis</strong>: Accessible on <code>localhost:6379</code>.</li><li><strong>Core Service</strong>: Accessible on <code>localhost:8080</code>.</li><li><strong>Front-End</strong>: Accessible on <code>localhost:3000</code>.</li><li><strong>Editoast</strong>: Accessible on <code>localhost:8090</code>.</li></ul><h2 id=notes-and-considerations>Notes and Considerations</h2><ul><li>This setup is designed for development and quick deployments. For production environments, additional considerations for security, scalability and reliability should be addressed.</li><li>Ensure that the <code>POSTGRES_PASSWORD</code> and other sensitive credentials are securely managed, especially in production deployments.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e0a9ed49604351550da3ab0ba4bc265c>2.2 - Kubernetes with Helm</h1><div class=lead>Using Helm for Kubernetes deployments</div><p>The OSRD project&rsquo;s Helm Chart provides a flexible and efficient way to deploy OSRD services in a Kubernetes environment. This document outlines the configuration options available in the Helm Chart, focusing on each service component.</p><h2 id=prerequisites>Prerequisites</h2><p>Before proceeding with the deployment, ensure that you have the following installed:</p><ul><li>A Kubernetes cluster up and running</li><li>A PostgreSQL database with PostGIS</li><li>A Redis server (used for caching)</li></ul><h2 id=the-tileserver>The tileserver</h2><p>Tileserver is the component responsible for generating vector map tiles. It is recommended to separate it from standard Editoast while running a production setup since Editoast cannot be scaled horizontally (it is stateful).</p><p>You can visualize the recommended deployment here:</p><pre class=mermaid>flowchart TD
    gw[&#34;gateway&#34;]
    front[&#34;front-end static files&#34;]
    gw -- local file --&gt; front
    
    browser --&gt; gw
    gw -- HTTP --&gt; editoast
    gw -- HTTP --&gt; tileserver-1
    gw -- HTTP --&gt; tileserver-2
    gw -- HTTP --&gt; tileserver-n...
    editoast -- HTTP --&gt; core</pre><p>The Helm chart leverages Kubernete&rsquo;s <a href=https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/>HorizontalPodAutoscaler</a> in order to spawn as much tileserver as required for the current workload.</p><h2 id=chart-values-overview>Chart Values Overview</h2><p>The Helm Chart is configurable through the following values:</p><h3 id=core-service>Core Service</h3><ul><li><code>core</code>: Configuration for the core OSRD service.<ul><li><code>internalUrl</code>: Internal URL for service communication.</li><li><code>image</code>: Docker image to use.</li><li><code>pullPolicy</code>: Image pull policy.</li><li><code>replicaCount</code>: Number of replicas.</li><li><code>service</code>: Service type and port configuration.</li><li><code>resources</code>, <code>env</code>, <code>annotations</code>, <code>labels</code>, <code>nodeSelector</code>, <code>tolerations</code>, <code>affinity</code>: Various Kubernetes deployment options.</li></ul></li></ul><h3 id=editoast-service>Editoast Service</h3><ul><li><code>editoast</code>: Configuration for the Editoast service.<ul><li>Includes similar options as <code>core</code> for Kubernetes deployment.</li><li><code>init</code>: Initialization configuration.</li></ul></li></ul><h3 id=tile-server>Tile Server</h3><ul><li><code>tileServer</code>: Specialized Editoast service that serves only vector map tiles.<ul><li><code>enabled</code>: Set to <code>true</code> to enable tile server functionality.</li><li><code>image</code>: Docker image to use (typically the same as Editoast).</li><li><code>replicaCount</code>: Number of replicas, allowing for horizontal scaling.</li><li><code>hpa</code>: Horizontal Pod Autoscaler configuration.</li><li>Other standard Kubernetes deployment options.</li></ul></li></ul><h3 id=gateway>Gateway</h3><ul><li><code>gateway</code>: Configuration for the OSRD gateway.<ul><li>Includes service, ingress, and other Kubernetes deployment options.</li><li><code>config</code>: Specific configurations for authentication and trusted proxies.</li></ul></li></ul><h2 id=deployment>Deployment</h2><p>The chart is available at ghcr OCI repository. You can find 2 Helm charts:</p><ul><li><a href=https://github.com/osrd-project/osrd-chart/pkgs/container/charts%2Fosrd>Stable charts</a>: <code>oci://ghcr.io/osrd-project/charts/osrd</code></li><li><a href=https://github.com/osrd-project/osrd-chart/pkgs/container/charts%2Fosrd-dev>Dev charts</a>: <code>oci://ghcr.io/osrd-project/charts/osrd-dev</code></li></ul><p>To deploy the OSRD services using this Helm Chart:</p><ol><li><p><strong>Configure Values</strong>: Adjust the values in the Helm Chart to suit your deployment needs.</p></li><li><p><strong>Install Chart</strong>: Use Helm to install the chart into your Kubernetes cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install osrd oci://ghcr.io/osrd-project/charts/osrd -f values.yml
</span></span></code></pre></div></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-abcf30a6dedb6f28a328ee776192db94>3 - Logo</h1><div class=lead>The OSRD logo, its variants, and its use</div><p>You can download each logo independently by clicking directly on it, or <a href=pictures/logo-osrd.zip>all the logos compressed into a zip file</a>.</p><p>It is advisable to carefully choose the logo you want to use, depending on the background on which you want to display it.</p><p>Modification, addition or deletion of the <strong>shading</strong> other than as presented in the logos <strong>are not authorised</strong> (this applies more generally throughout the design, the choice to use <em>drop shadows</em> is part of the design considerations, it is not a variable element).</p><h3 id=official>Official</h3><div style=display:inline-block;padding:16px;background-color:#fff><a target=_blank href=pictures/logo-osrd-color-black.svg><img src=pictures/logo-osrd-color-black.svg width=256></a></div><h3 id=official-for-dark-backgrounds>Official for dark backgrounds</h3><div style=display:inline-block;padding:16px;background-color:#333><a target=_blank href=pictures/logo-osrd-color-white.svg><img src=pictures/logo-osrd-color-white.svg width=256></a></div><h3 id=white>White</h3><div style=display:inline-block;padding:16px;background-color:#333><a target=_blank href=pictures/logo-osrd-white.svg><img src=pictures/logo-osrd-white.svg width=256></a></div><h3 id=black>Black</h3><div style=display:inline-block;padding:16px;background-color:#fff><a target=_blank href=pictures/logo-osrd-black.svg><img src=pictures/logo-osrd-black.svg width=256></a></div><h3 id=favicons-logo-without-text>Favicons, logo without text</h3><div style=display:inline-block;padding:16px;background-color:#fff><a target=_blank href=pictures/fav-osrd-color.svg><img src=pictures/fav-osrd-color.svg width=64></a></div><div style=display:inline-block;padding:16px;background-color:#fff;margin-left:16px><a target=_blank href=pictures/fav-osrd-black.svg><img src=pictures/fav-osrd-black.svg width=64></a></div><div style=display:inline-block;padding:16px;background-color:#333;margin-left:16px><a target=_blank href=pictures/fav-osrd-white.svg><img src=pictures/fav-osrd-white.svg width=64></a></div><h2 id=-what-you-cant-do>🚫 What you can&rsquo;t do</h2><h4 id=too-small--16px-height>Too small (&lt; 16px height)</h4><img src=pictures/dont/dont5.svg style=height:32px><h4 id=disproportion>Disproportion</h4><img src=pictures/dont/dont1.svg style=margin-left:16px;height:64px><h4 id=change-the-text-colour-or-drop-shadow>Change the text colour or drop shadow</h4><img src=pictures/dont/dont2.svg style=height:64px><h4 id=changing-direction>Changing direction</h4><img src=pictures/dont/dont3.svg style=margin-left:16px;height:64px><h4 id=deformation>Deformation</h4><img src=pictures/dont/dont4.svg style=height:64px><h2 id=-what-you-can-do>✅ What you can do</h2><h4 id=changing-the-internal-colour-for-a-specific-event>Changing the internal colour for a specific event</h4><div><a style=display:inline-block;padding:8px;background-color:#fff href=pictures/events/xmas-fav-osrd-color.svg target=_blank><img src=pictures/events/xmas-fav-osrd-color.svg style=height:32px>
</a><a style=display:inline-block;margin-left:8px;padding:8px;background-color:#fff href=pictures/events/xmas-logo-osrd-color-black.svg target=_blank><img src=pictures/events/xmas-logo-osrd-color-black.svg style=height:32px>
</a><a style=display:inline-block;margin-left:8px;padding:8px;background-color:#333 href=pictures/events/xmas-logo-osrd-color-white.svg><img src=pictures/events/xmas-logo-osrd-color-white.svg style=height:32px></a></div><div style=margin-top:8px><a style=display:inline-block;padding:8px;background-color:#fff href=pictures/events/proud-fav-osrd-color.svg target=_blank><img src=pictures/events/proud-fav-osrd-color.svg style=height:32px>
</a><a style=display:inline-block;margin-left:8px;padding:8px;background-color:#fff href=pictures/events/proud-logo-osrd-color-black.svg target=_blank><img src=pictures/events/proud-logo-osrd-color-black.svg style=height:32px>
</a><a style=display:inline-block;margin-left:8px;padding:8px;background-color:#333 href=pictures/events/proud-logo-osrd-color-white.svg><img src=pictures/events/proud-logo-osrd-color-white.svg style=height:32px></a></div><h4 id=use-of-logo-only-without-text>Use of logo only (without text)</h4><div style=display:inline-block><img src=pictures/fav-osrd-color.svg style=height:64px></div><h2 id=colors>Colors</h2><blockquote><p>These colours are <strong>those of the logo</strong> and should not be confused with those of the overall design of the OSRD interface.</p></blockquote><p><span style=display:inline-block;background-color:#786abf;width:128px;height:128px;color:#fff;font-weight:700;padding:16px;margin-top:16px>#786ABF</span>
<span style=display:inline-block;background-color:#c7b2de;width:128px;height:128px;color:#fff;font-weight:700;padding:16px;margin-top:16px;margin-left:16px>#C7B2DE</span></p></div><div class=td-content style=page-break-before:always><h1 id=pg-2da528ba6fb6472a09f78336402e93a7>4 - OSRD's design</h1><div class=lead>Colours, fonts, uses&mldr;</div><p>Everything is presented on a dedicated website <a href=https://design.osrd.fr>https://design.osrd.fr</a></p><p>A &ldquo;design system&rdquo; is being developed.</p><figure><a href=https://design.osrd.fr><img src=/en/docs/guides/design/images/design.webp></a></figure></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/osrd-project/osrd aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2024 OSRD contributors. All Rights Reserved</span></div></div></div></footer></div><style>.markmap>svg{width:100%;height:300px}</style><script>window.markmap={autoLoader:{manual:!0,onReady(){const{autoLoader:e,builtInPlugins:t}=window.markmap;e.transformPlugins=t.filter(e=>e.name!=="prism")}}}</script><script src=https://cdn.jsdelivr.net/npm/markmap-autoloader></script><script src=https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js integrity="sha512-ku2nmBrzAXY5YwohzTqLYH1/lvyMrpTVxgQKrvTabd/b/uesqltLORdmpVapYv6QhZVCLUX6wkvFaKOAY4xpUA==" crossorigin=anonymous></script><script src=/js/main.min.4261519102c0270f3bdd4edcd2b45867ee7a584a0ea82c94f59e4f991c6337a1.js integrity="sha256-QmFRkQLAJw873U7c0rRYZ+56WEoOqCyU9Z5PmRxjN6E=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>